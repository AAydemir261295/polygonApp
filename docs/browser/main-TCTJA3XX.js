var KM=Object.create;var j_=Object.defineProperty,JM=Object.defineProperties,QM=Object.getOwnPropertyDescriptor,eS=Object.getOwnPropertyDescriptors,tS=Object.getOwnPropertyNames,bw=Object.getOwnPropertySymbols,nS=Object.getPrototypeOf,Ew=Object.prototype.hasOwnProperty,rS=Object.prototype.propertyIsEnumerable;var ww=(o,s,h)=>s in o?j_(o,s,{enumerable:!0,configurable:!0,writable:!0,value:h}):o[s]=h,Dt=(o,s)=>{for(var h in s||={})Ew.call(s,h)&&ww(o,h,s[h]);if(bw)for(var h of bw(s))rS.call(s,h)&&ww(o,h,s[h]);return o},dr=(o,s)=>JM(o,eS(s));var Cw=(o,s)=>()=>(s||o((s={exports:{}}).exports,s),s.exports);var iS=(o,s,h,u)=>{if(s&&typeof s=="object"||typeof s=="function")for(let g of tS(s))!Ew.call(o,g)&&g!==h&&j_(o,g,{get:()=>s[g],enumerable:!(u=QM(s,g))||u.enumerable});return o};var Tw=(o,s,h)=>(h=o!=null?KM(nS(o)):{},iS(s||!o||!o.__esModule?j_(h,"default",{value:o,enumerable:!0}):h,o));var zT=Cw((k0,L0)=>{(function(o,s){typeof k0=="object"&&typeof L0<"u"?L0.exports=s():typeof define=="function"&&define.amd?define(s):(o=typeof globalThis<"u"?globalThis:o||self,o.mapboxgl=s())})(k0,function(){"use strict";var o,s,h;function u(i,w){if(!o)o=w;else if(!s)s=w;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",B={};o(B),h=w(B),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(h.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}u(["exports"],function(i){"use strict";var w=typeof self<"u"?self:{},O="2.15.0";let B,j={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(B==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{B=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{B=t}}return B},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!j.API_URL)return null;try{let t=new URL(j.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ie={supported:!1,testSupport:function(t){!Re&&Be&&(tt?Mt(t):_e=t)}},_e,Be,Re=!1,tt=!1;function Mt(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Be),t.isContextLost())return;ie.supported=!0}catch{}t.deleteTexture(e),Re=!0}w.document&&(Be=w.document.createElement("img"),Be.onload=function(){_e&&Mt(_e),_e=null,tt=!0},Be.onerror=function(){Re=!0,_e=null},Be.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let En="01";function Ct(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gn=Un;function Un(t,e,n,a){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=a}Un.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,a=0;a<8;a++){var c=this.sampleCurveX(n)-t;if(Math.abs(c)<e)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=c/f}var m=0,y=1;for(n=t,a=0;a<20&&(c=this.sampleCurveX(n),!(Math.abs(c-t)<e));a++)t>c?m=n:y=n,n=.5*(y-m)+m;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var xr=Ct(gn),ei=nr;function nr(t,e){this.x=t,this.y=e}nr.prototype={clone:function(){return new nr(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(t,e){var n=Math.cos(t),a=Math.sin(t),c=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},nr.convert=function(t){return t instanceof nr?t:Array.isArray(t)?new nr(t[0],t[1]):t};var rt=Ct(ei);let Fo=Math.PI/180,Ws=180/Math.PI;function At(t){return t*Fo}function Pr(t){return t*Ws}let No=[[0,0],[1,0],[1,1],[0,1]];function Ma(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function zo(t,e,n,a){let c=new xr(t,e,n,a);return function(f){return c.solve(f)}}let Zs=zo(.25,.1,.25,1);function Ht(t,e,n){return Math.min(n,Math.max(e,t))}function Bo(t,e,n){return(n=Ht((n-t)/(e-t),0,1))*n*(3-2*n)}function mr(t,e,n){let a=n-e,c=((t-e)%a+a)%a+e;return c===e?n:c}function gr(t,e,n){if(!t.length)return n(null,[]);let a=t.length,c=new Array(t.length),f=null;t.forEach((m,y)=>{e(m,(x,b)=>{x&&(f=x),c[y]=b,--a==0&&n(f,c)})})}function Zi(t){let e=[];for(let n in t)e.push(t[n]);return e}function un(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}let ti=1;function ni(){return ti++}function br(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function co(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ms(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function _r(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function qt(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Jt(t,e,n){let a={};for(let c in t)a[c]=e.call(n||this,t[c],c,t);return a}function Xs(t,e,n){let a={};for(let c in t)e.call(n||this,t[c],c,t)&&(a[c]=t[c]);return a}function hi(t){return Array.isArray(t)?t.map(hi):typeof t=="object"&&t?Jt(t,hi):t}let uo={};function Jn(t){uo[t]||(typeof console<"u"&&console.warn(t),uo[t]=!0)}function cn(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Sa(t){let e=0;for(let n,a,c=0,f=t.length,m=f-1;c<f;m=c++)n=t[c],a=t[m],e+=(a.x-n.x)*(n.y+a.y);return e}function ho(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function di(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,c,f)=>{let m=c||f;return e[a]=!m||m.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let bi=null;function Ys(t){if(bi==null){let e=t.navigator?t.navigator.userAgent:null;bi=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return bi}function Aa(t){try{let e=w[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function fo(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}let po="mapbox-tiles",Pa=500,Xi=50,ri,Ni;function gs(){try{return w.caches}catch{}}function zi(){gs()&&!ri&&(ri=w.caches.open(po))}function mo(t){let e=t.indexOf("?");if(e<0)return t;let n=function(c){let f=c.indexOf("?");return f>0?c.slice(f+1).split("&"):[]}(t),a=n.filter(c=>{let f=c.split("=");return f[0]==="language"||f[0]==="worldview"});return a.length?`${t.slice(0,e)}?${a.join("&")}`:t.slice(0,e)}let Vo=1/0,Yi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Yi);class jo extends Error{constructor(e,n,a){n===401&&Ee(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let _s=ho()?()=>self.worker&&self.worker.referrer:()=>(w.location.protocol==="blob:"?w.parent:w).location.href,wi=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(_s())&&!/^\w+:/.test(n))){if(w.fetch&&w.Request&&w.AbortController&&w.Request.prototype.hasOwnProperty("signal"))return function(a,c){let f=new w.AbortController,m=new w.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:_s(),referrerPolicy:a.referrerPolicy,signal:f.signal}),y=!1,x=!1,b=(D=m.url).indexOf("sku=")>0&&Ee(D);var D;a.type==="json"&&m.headers.set("Accept","application/json");let M=(k,L,z)=>{if(x)return;if(k&&k.message!=="SecurityError"&&Jn(k.toString()),L&&z)return S(L);let H=Date.now();w.fetch(m).then(K=>{if(K.ok){let se=b?K.clone():null;return S(K,se,H)}return c(new jo(K.statusText,K.status,a.url))}).catch(K=>{K.name!=="AbortError"&&c(new Error(`${K.message} ${a.url}`))})},S=(k,L,z)=>{(a.type==="arrayBuffer"?k.arrayBuffer():a.type==="json"?k.json():k.text()).then(H=>{x||(L&&z&&function(K,se,J){if(zi(),!ri)return;let oe={status:se.status,statusText:se.statusText,headers:new w.Headers};se.headers.forEach((Me,Te)=>oe.headers.set(Te,Me));let ue=di(se.headers.get("Cache-Control")||"");if(ue["no-store"])return;ue["max-age"]&&oe.headers.set("Expires",new Date(J+1e3*ue["max-age"]).toUTCString());let le=oe.headers.get("Expires");le&&(new Date(le).getTime()-J<42e4||function(Me,Te){if(Ni===void 0)try{new Response(new ReadableStream),Ni=!0}catch{Ni=!1}Ni?Te(Me.body):Me.blob().then(Te)}(se,Me=>{let Te=new w.Response(Me,oe);zi(),ri&&ri.then(Fe=>Fe.put(mo(K.url),Te)).catch(Fe=>Jn(Fe.message))}))}(m,L,z),y=!0,c(null,H,k.headers.get("Cache-Control"),k.headers.get("Expires")))}).catch(H=>{x||c(new Error(H.message))})};return b?function(k,L){if(zi(),!ri)return L(null);let z=mo(k.url);ri.then(H=>{H.match(z).then(K=>{let se=function(J){if(!J)return!1;let oe=new Date(J.headers.get("Expires")||0),ue=di(J.headers.get("Cache-Control")||"");return oe>Date.now()&&!ue["no-cache"]}(K);H.delete(z),se&&H.put(z,K.clone()),L(null,K,se)}).catch(L)}).catch(L)}(m,M):M(null,null),{cancel:()=>{x=!0,y||f.abort()}}}(t,e);if(ho()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(a,c){let f=new w.XMLHttpRequest;f.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(let m in a.headers)f.setRequestHeader(m,a.headers[m]);return a.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=a.credentials==="include",f.onerror=()=>{c(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let m=f.response;if(a.type==="json")try{m=JSON.parse(f.response)}catch(y){return c(y)}c(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else c(new jo(f.statusText,f.status,a.url))},f.send(a.body),{cancel:()=>f.abort()}}(t,e)},Ks=function(t,e){return wi(un(t,{type:"arrayBuffer"}),e)};function Js(t){let e=w.document.createElement("a");return e.href=t,e.protocol===w.document.location.protocol&&e.host===w.document.location.host}let re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",V,U;V=[],U=0;let ee=function(t,e){if(ie.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),U>=j.MAX_PARALLEL_IMAGE_REQUESTS){let f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return V.push(f),f}U++;let n=!1,a=()=>{if(!n)for(n=!0,U--;V.length&&U<j.MAX_PARALLEL_IMAGE_REQUESTS;){let f=V.shift(),{requestParameters:m,callback:y,cancelled:x}=f;x||(f.cancel=ee(m,y).cancel)}},c=Ks(t,(f,m,y,x)=>{a(),f?e(f):m&&(w.createImageBitmap?function(b,D){let M=new w.Blob([new Uint8Array(b)],{type:"image/png"});w.createImageBitmap(M).then(S=>{D(null,S)}).catch(S=>{D(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(b,D)=>e(b,D,y,x)):function(b,D){let M=new w.Image,S=w.URL;M.onload=()=>{D(null,M),S.revokeObjectURL(M.src),M.onload=null,w.requestAnimationFrame(()=>{M.src=re})},M.onerror=()=>D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let k=new w.Blob([new Uint8Array(b)],{type:"image/png"});M.src=b.byteLength?S.createObjectURL(k):re}(m,(b,D)=>e(b,D,y,x)))});return{cancel:()=>{c.cancel(),a()}}},ce="NO_ACCESS_TOKEN";function pe(t){return t.indexOf("mapbox:")===0}function Ee(t){return j.API_URL_REGEX.test(t)}function we(t){return j.API_CDN_URL_REGEX.test(t)}function me(t){return j.API_STYLE_REGEX.test(t)&&!Se(t)}function Se(t){return j.API_SPRITE_REGEX.test(t)}let Ke=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(t){let e=t.match(Ke);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ze(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let Lt="mapbox.eventData";function St(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(w.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ot{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=St(j.ACCESS_TOKEN),a="";return a=n&&n.u?w.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,f)=>String.fromCharCode(+("0x"+f)))):j.ACCESS_TOKEN||"",e?`${Lt}.${e}:${a}`:`${Lt}:${a}`}fetchEventData(){let e=Aa("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{let c=w.localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));let f=w.localStorage.getItem(a);f&&(this.anonId=f)}catch{Jn("Unable to read from LocalStorage")}}saveEventData(){let e=Aa("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{w.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&w.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Jn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,a,c){if(!j.EVENTS_URL)return;let f=it(j.EVENTS_URL);f.params.push(`access_token=${c||j.ACCESS_TOKEN||""}`);let m={event:this.type,created:new Date(e).toISOString()},y=n?un(m,n):m,x={url:Ze(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(b,D){return wi(un(b,{method:"POST"}),D)}(x,b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let $t=new class extends Ot{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){j.EVENTS_URL&&j.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>pe(n)||Ee(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=St(j.ACCESS_TOKEN),n=e?e.u:j.ACCESS_TOKEN,a=n!==this.eventData.tokenU;ms(this.anonId)||(this.anonId=br(),a=!0);let c=this.queue.shift();if(this.eventData.lastSuccess){let f=new Date(this.eventData.lastSuccess),m=new Date(c),y=(c-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||f.getDate()!==m.getDate()}else a=!0;a?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:En,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t):this.processRequests()}},Wt=$t.postTurnstileEvent.bind($t),Sn=new class extends Ot{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,a){this.skuToken=e,this.errorCb=a,j.EVENTS_URL&&(n||j.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ce)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ms(this.anonId)||(this.anonId=br()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:En,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}},cr=Sn.postMapLoadEvent.bind(Sn),wr=new class extends Ot{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){j.EVENTS_URL&&(t||j.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),a=function(c){let f=w.performance.getEntriesByType("resource"),m=w.performance.getEntriesByType("mark"),y=function(S){let k={};if(S){for(let L in S)if(L!=="other")for(let z of S[L]){let H=`${L}ResolveRangeMin`,K=`${L}ResolveRangeMax`,se=`${L}RequestCount`,J=`${L}RequestCachedCount`;k[H]=Math.min(k[H]||1/0,z.startTime),k[K]=Math.max(k[K]||-1/0,z.responseEnd);let oe=ue=>{k[ue]===void 0&&(k[ue]=0),++k[ue]};z.transferSize!==void 0&&z.transferSize===0&&oe(J),oe(se)}}return k}(function(S,k){let L={};if(S)for(let z of S){let H=k(z);L[H]===void 0&&(L[H]=[]),L[H].push(z)}return L}(f,au)),x=w.devicePixelRatio,b=w.navigator.connection||w.navigator.mozConnection||w.navigator.webkitConnection,D={counters:[],metadata:[],attributes:[]},M=(S,k,L)=>{L!=null&&S.push({name:k,value:L.toString()})};for(let S in y)M(D.counters,S,y[S]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(M(D.counters,"interactionRangeMin",c.interactionRange[0]),M(D.counters,"interactionRangeMax",c.interactionRange[1])),m)for(let S of Object.keys(Qs)){let k=Qs[S],L=m.find(z=>z.name===k);L&&M(D.counters,k,L.startTime)}return M(D.counters,"visibilityHidden",c.visibilityHidden),M(D.attributes,"style",function(S){if(S)for(let k of S){let L=k.name.split("?")[0];if(me(L)){let z=L.split("/").slice(-2);if(z.length===2)return`mapbox://styles/${z[0]}/${z[1]}`}}}(f)),M(D.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),M(D.attributes,"fogEnabled",c.fogEnabled?"true":"false"),M(D.attributes,"projection",c.projection),M(D.attributes,"zoom",c.zoom),M(D.metadata,"devicePixelRatio",x),M(D.metadata,"connectionEffectiveType",b?b.effectiveType:void 0),M(D.metadata,"navigatorUserAgent",w.navigator.userAgent),M(D.metadata,"screenWidth",w.screen.width),M(D.metadata,"screenHeight",w.screen.height),M(D.metadata,"windowWidth",w.innerWidth),M(D.metadata,"windowHeight",w.innerHeight),M(D.metadata,"mapWidth",c.width/x),M(D.metadata,"mapHeight",c.height/x),M(D.metadata,"webglRenderer",c.renderer),M(D.metadata,"webglVendor",c.vendor),M(D.metadata,"sdkVersion",O),M(D.metadata,"sdkIdentifier","mapbox-gl-js"),D}(n);for(let c of a.metadata);for(let c of a.counters);for(let c of a.attributes);this.postEvent(e,a,()=>{},t)}},or=wr.postPerformanceEvent.bind(wr),Ki=new class extends Ot{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,a){if(!j.API_URL||!j.SESSION_PATH)return;let c=it(j.API_URL+j.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${a||j.ACCESS_TOKEN||""}`);let f={url:Ze(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,y){return wi(un(m,{method:"GET"}),y)}(f,m=>{this.pendingRequest=null,n(m),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,n,a){this.skuToken=e,this.errorCb=a,j.SESSION_PATH&&j.API_URL&&(n||j.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ce)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}},Rr=Ki.getSessionAPI.bind(Ki),Rn=new Set,Qs={create:"create",load:"load",fullLoad:"fullLoad"},Bh={mark(t){w.performance.mark(t)},measure(t,e,n){w.performance.measure(t,e,n)}};function au(t){let e=t.name.split("?")[0];return we(e)&&e.includes("mapbox-gl.js")?"javascript":we(e)&&e.includes("mapbox-gl.css")?"css":function(n){return j.API_FONTS_REGEX.test(n)}(e)?"fontRange":Se(e)?"sprite":me(e)?"style":function(n){return j.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}let hn=w.performance;function Ql(t){let e=t?t.url.toString():void 0;return hn.getEntriesByName(e)}let ys,ec,vs,Ei,Bi={now:()=>vs!==void 0?vs:w.performance.now(),setNow(t){vs=t},restoreNow(){vs=void 0},frame(t){let e=w.requestAnimationFrame(t);return{cancel:()=>w.cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:a}=t;Ei||(Ei=w.document.createElement("canvas"));let c=Ei.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>Ei.width||a>Ei.height)&&(Ei.width=n,Ei.height=a),c.clearRect(-e,-e,n+2*e,a+2*e),c.drawImage(t,0,0,n,a),c.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:t=>(ys||(ys=w.document.createElement("a")),ys.href=t,ys.href),get devicePixelRatio(){return w.devicePixelRatio},get prefersReducedMotion(){return!!w.matchMedia&&(ec==null&&(ec=w.matchMedia("(prefers-reduced-motion: reduce)")),ec.matches)}};function fr(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function ul(t,e,n){if(n&&n[t]){let a=n[t].indexOf(e);a!==-1&&n[t].splice(a,1)}}class Uo{constructor(e,n={}){un(this,n),this.type=e}}class zr extends Uo{constructor(e,n={}){super("error",un({error:e},n))}}class ii{on(e,n){return this._listeners=this._listeners||{},fr(e,n,this._listeners),this}off(e,n){return ul(e,n,this._listeners),ul(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},fr(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new Uo(e,n||{}));let a=e.type;if(this.listens(a)){e.target=this;let c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let y of c)y.call(this,e);let f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let y of f)ul(a,y,this._oneTimeListeners),y.call(this,e);let m=this._eventedParent;m&&(un(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof zr&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Oe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Hr(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}function $n(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Er(t){if(Array.isArray(t))return t.map(Er);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Er(t[n]);return e}return $n(t)}class lu extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Ji=lu;class tc{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[a,c]of n)this.bindings[a]=c}concat(e){return new tc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var nc=tc;let $o={kind:"null"},at={kind:"number"},Yt={kind:"string"},Zt={kind:"boolean"},fi={kind:"color"},Vi={kind:"object"},Vt={kind:"value"},C={kind:"collator"},A={kind:"formatted"},$={kind:"resolvedImage"};function ne(t,e){return{kind:"array",itemType:t,N:e}}function ae(t){if(t.kind==="array"){let e=ae(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let ge=[$o,at,Yt,Zt,fi,A,Vi,ne(Vt),$];function ve(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ve(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of ge)if(!ve(n,e))return null}}return`Expected ${ae(t)} but found ${ae(e)} instead.`}function Xe(t,e){return e.some(n=>n.kind===t.kind)}function nt(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}var ht,ft={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ot(t){return(t=Math.round(t))<0?0:t>255?255:t}function Pt(t){return ot(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Zn(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function kt(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{ht={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in ft)return ft[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=n.indexOf("("),c=n.indexOf(")");if(a!==-1&&c+1===n.length){var f=n.substr(0,a),m=n.substr(a+1,c-(a+1)).split(","),y=1;switch(f){case"rgba":if(m.length!==4)return null;y=Zn(m.pop());case"rgb":return m.length!==3?null:[Pt(m[0]),Pt(m[1]),Pt(m[2]),y];case"hsla":if(m.length!==4)return null;y=Zn(m.pop());case"hsl":if(m.length!==3)return null;var x=(parseFloat(m[0])%360+360)%360/360,b=Zn(m[1]),D=Zn(m[2]),M=D<=.5?D*(b+1):D+b-D*b,S=2*D-M;return[ot(255*kt(S,M,x+1/3)),ot(255*kt(S,M,x)),ot(255*kt(S,M,x-1/3)),y];default:return null}}return null}}catch{}class _n{constructor(e,n,a,c=1){this.r=e,this.g=n,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof _n)return e;if(typeof e!="string")return;let n=ht(e);return n?new _n(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,a,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${c})`}toArray(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*a/c,c]}toArray01(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[e/c,n/c,a/c,c]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:a,a:c}=this;return[e,n,a,c]}}_n.black=new _n(0,0,0,1),_n.white=new _n(1,1,1,1),_n.transparent=new _n(0,0,0,0),_n.red=new _n(1,0,0,1),_n.blue=new _n(0,0,1,1);var Ne=_n;class yt{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Cn{constructor(e,n,a,c,f){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=c,this.textColor=f}}class Tn{constructor(e){this.sections=e}static fromString(e){return new Tn([new Cn(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Tn?e:Tn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);let a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(a)}return e}}class Dn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Dn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function hl(t,e,n,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,n,a]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ra(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Ne||t instanceof yt||t instanceof Tn||t instanceof Dn)return!0;if(Array.isArray(t)){for(let e of t)if(!Ra(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!Ra(t[e]))return!1;return!0}return!1}function Ft(t){if(t===null)return $o;if(typeof t=="string")return Yt;if(typeof t=="boolean")return Zt;if(typeof t=="number")return at;if(t instanceof Ne)return fi;if(t instanceof yt)return C;if(t instanceof Tn)return A;if(t instanceof Dn)return $;if(Array.isArray(t)){let e=t.length,n;for(let a of t){let c=Ft(a);if(n){if(n===c)continue;n=Vt;break}n=c}return ne(n||Vt,e)}return Vi}function ea(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Ne||t instanceof Tn||t instanceof Dn?t.toString():JSON.stringify(t)}class rc{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ra(e[1]))return n.error("invalid value");let a=e[1],c=Ft(a),f=n.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new rc(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ne?["rgba"].concat(this.value.toArray()):this.value instanceof Tn?this.value.serialize():this.value}}var qr=rc,Or=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};let dl={string:Yt,number:at,boolean:Zt,object:Vi};class fl{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,c=1,f=e[0];if(f==="array"){let y,x;if(e.length>2){let b=e[1];if(typeof b!="string"||!(b in dl)||b==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=dl[b],c++}else y=Vt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}a=ne(y,x)}else a=dl[f];let m=[];for(;c<e.length;c++){let y=n.parse(e[c],c,Vt);if(!y)return null;m.push(y)}return new fl(a,m)}evaluate(e){for(let n=0;n<this.args.length;n++){let a=this.args[n].evaluate(e);if(!ve(this.type,Ft(a)))return a;if(n===this.args.length-1)throw new Or(`Expected value to be of type ${ae(this.type)}, but found ${ae(Ft(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);let c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(a=>a.serialize()))}}var ji=fl;class go{constructor(e){this.type=A,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");let c=[],f=!1;for(let m=1;m<=e.length-1;++m){let y=e[m];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=n.parse(y["font-scale"],1,at),!x))return null;let b=null;if(y["text-font"]&&(b=n.parse(y["text-font"],1,ne(Yt)),!b))return null;let D=null;if(y["text-color"]&&(D=n.parse(y["text-color"],1,fi),!D))return null;let M=c[c.length-1];M.scale=x,M.font=b,M.textColor=D}else{let x=n.parse(e[m],1,Vt);if(!x)return null;let b=x.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new go(c)}evaluate(e){return new Tn(this.sections.map(n=>{let a=n.content.evaluate(e);return Ft(a)===$?new Cn("",a,null,null,null):new Cn(ea(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class Oa{constructor(e){this.type=$,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");let a=n.parse(e[1],1,Yt);return a?new Oa(a):n.error("No image name provided.")}evaluate(e){let n=this.input.evaluate(e),a=Dn.fromString(n);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(n)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}let Vh={"to-boolean":Zt,"to-color":fi,"to-number":at,"to-string":Yt};class ic{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");let c=Vh[a],f=[];for(let m=1;m<e.length;m++){let y=n.parse(e[m],m,Vt);if(!y)return null;f.push(y)}return new ic(c,f)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(let c of this.args){if(n=c.evaluate(e),a=null,n instanceof Ne)return n;if(typeof n=="string"){let f=e.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:hl(n[0],n[1],n[2],n[3]),!a))return new Ne(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Or(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let a of this.args){if(n=a.evaluate(e),n===null)return 0;let c=Number(n);if(!isNaN(c))return c}throw new Or(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Tn.fromString(ea(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Dn.fromString(ea(this.args[0].evaluate(e))):ea(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new go([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Oa(this.args[0]).serialize();let e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var ta=ic;let Ui=["Unknown","Point","LineString","Polygon"];var pl=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ui[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(a*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Ne.parse(t)),e}};class Go{constructor(e,n,a,c){this.name=e,this.type=n,this._evaluate=a,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let a=e[0],c=Go.definitions[a];if(!c)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let f=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=m.filter(([b])=>!Array.isArray(b)||b.length===e.length-1),x=null;for(let[b,D]of y){x=new cc(n.registry,n.path,null,n.scope);let M=[],S=!1;for(let k=1;k<e.length;k++){let L=e[k],z=Array.isArray(b)?b[k-1]:b.type,H=x.parse(L,1+M.length,z);if(!H){S=!0;break}M.push(H)}if(!S)if(Array.isArray(b)&&b.length!==M.length)x.error(`Expected ${b.length} arguments, but found ${M.length} instead.`);else{for(let k=0;k<M.length;k++){let L=Array.isArray(b)?b[k]:b.type,z=M[k];x.concat(k+1).checkSubtype(L,z.type)}if(x.errors.length===0)return new Go(a,f,D,M)}}if(y.length===1)n.errors.push(...x.errors);else{let b=(y.length?y:m).map(([M])=>{return S=M,Array.isArray(S)?`(${S.map(ae).join(", ")})`:`(${ae(S.type)}...)`;var S}).join(" | "),D=[];for(let M=1;M<e.length;M++){let S=n.parse(e[M],1+D.length);if(!S)return null;D.push(ae(S.type))}n.error(`Expected arguments of type ${b}, but found (${D.join(", ")}) instead.`)}return null}static register(e,n){Go.definitions=n;for(let a in n)e[a]=Go}}var _o=Go;class ka{constructor(e,n,a){this.type=C,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");let c=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Zt);if(!c)return null;let f=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Zt);if(!f)return null;let m=null;return a.locale&&(m=n.parse(a.locale,1,Yt),!m)?null:new ka(c,f,m)}evaluate(e){return new yt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}let Ci=8192;function na(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function xs(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function oi(t,e){let n=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*Ci),Math.round(a*c*Ci)]}function oc(t,e,n){let a=t[0]-e[0],c=t[1]-e[1],f=t[0]-n[0],m=t[1]-n[1];return a*m-f*c==0&&a*f<=0&&c*m<=0}function La(t,e){let n=!1;for(let m=0,y=e.length;m<y;m++){let x=e[m];for(let b=0,D=x.length;b<D-1;b++){if(oc(t,x[b],x[b+1]))return!1;(c=x[b])[1]>(a=t)[1]!=(f=x[b+1])[1]>a[1]&&a[0]<(f[0]-c[0])*(a[1]-c[1])/(f[1]-c[1])+c[0]&&(n=!n)}}var a,c,f;return n}function sc(t,e){for(let n=0;n<e.length;n++)if(La(t,e[n]))return!0;return!1}function ml(t,e,n,a){let c=a[0]-n[0],f=a[1]-n[1],m=(t[0]-n[0])*f-c*(t[1]-n[1]),y=(e[0]-n[0])*f-c*(e[1]-n[1]);return m>0&&y<0||m<0&&y>0}function yo(t,e,n){for(let b of n)for(let D=0;D<b.length-1;++D)if((y=[(m=b[D+1])[0]-(f=b[D])[0],m[1]-f[1]])[0]*(x=[(c=e)[0]-(a=t)[0],c[1]-a[1]])[1]-y[1]*x[0]!=0&&ml(a,c,f,m)&&ml(f,m,a,c))return!0;var a,c,f,m,y,x;return!1}function dn(t,e){for(let n=0;n<t.length;++n)if(!La(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(yo(t[n],t[n+1],e))return!1;return!0}function cu(t,e){for(let n=0;n<e.length;n++)if(dn(t,e[n]))return!0;return!1}function ac(t,e,n){let a=[];for(let c=0;c<t.length;c++){let f=[];for(let m=0;m<t[c].length;m++){let y=oi(t[c][m],n);na(e,y),f.push(y)}a.push(f)}return a}function Ho(t,e,n){let a=[];for(let c=0;c<t.length;c++){let f=ac(t[c],e,n);a.push(f)}return a}function gl(t,e,n,a){if(t[0]<n[0]||t[0]>n[2]){let c=.5*a,f=t[0]-n[0]>c?-a:n[0]-t[0]>c?a:0;f===0&&(f=t[0]-n[2]>c?-a:n[2]-t[0]>c?a:0),t[0]+=f}na(e,t)}function uu(t,e,n,a){let c=Math.pow(2,a.z)*Ci,f=[a.x*Ci,a.y*Ci],m=[];if(!t)return m;for(let y of t)for(let x of y){let b=[x.x+f[0],x.y+f[1]];gl(b,e,n,c),m.push(b)}return m}function lc(t,e,n,a){let c=Math.pow(2,a.z)*Ci,f=[a.x*Ci,a.y*Ci],m=[];if(!t)return m;for(let x of t){let b=[];for(let D of x){let M=[D.x+f[0],D.y+f[1]];na(e,M),b.push(M)}m.push(b)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(let x of m)for(let b of x)gl(b,e,n,c)}var y;return m}class qo{constructor(e,n){this.type=Zt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ra(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){let f=a.features[c].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new qo(a,a.features[c].geometry)}else if(a.type==="Feature"){let c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new qo(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new qo(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if(a.type==="Polygon"){let y=ac(a.coordinates,f,m),x=uu(n.geometry(),c,f,m);if(!xs(c,f))return!1;for(let b of x)if(!La(b,y))return!1}if(a.type==="MultiPolygon"){let y=Ho(a.coordinates,f,m),x=uu(n.geometry(),c,f,m);if(!xs(c,f))return!1;for(let b of x)if(!sc(b,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if(a.type==="Polygon"){let y=ac(a.coordinates,f,m),x=lc(n.geometry(),c,f,m);if(!xs(c,f))return!1;for(let b of x)if(!dn(b,y))return!1}if(a.type==="MultiPolygon"){let y=Ho(a.coordinates,f,m),x=lc(n.geometry(),c,f,m);if(!xs(c,f))return!1;for(let b of x)if(!cu(b,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Wo=qo;function Zo(t){if(t instanceof _o&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Wo)return!1;let e=!0;return t.eachChild(n=>{e&&!Zo(n)&&(e=!1)}),e}function $i(t){if(t instanceof _o&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!$i(n)&&(e=!1)}),e}function vo(t,e){if(t instanceof _o&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(a=>{n&&!vo(a,e)&&(n=!1)}),n}class Xo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let a=e[1];return n.scope.has(a)?new Xo(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var hu=Xo;class Fa{constructor(e,n=[],a,c=new nc,f=[]){this.registry=e,this.path=n,this.key=n.map(m=>`[${m}]`).join(""),this.scope=c,this.errors=f,this.expectedType=a}parse(e,n,a,c,f={}){return n?this.concat(n,a,c)._parse(e,f):this._parse(e,f)}_parse(e,n){function a(c,f,m){return m==="assert"?new ji(f,[c]):m==="coerce"?new ta(f,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let f=this.registry[c];if(f){let m=f.parse(e,this);if(!m)return null;if(this.expectedType){let y=this.expectedType,x=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(y,x))return null}else m=a(m,y,n.typeAnnotation||"coerce");else m=a(m,y,n.typeAnnotation||"assert")}if(!(m instanceof qr)&&m.type.kind!=="resolvedImage"&&uc(m)){let y=new pl;try{m=new qr(m.type,m.evaluate(y))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){let c=typeof e=="number"?this.path.concat(e):this.path,f=a?this.scope.concat(a):this.scope;return new Fa(this.registry,c,n||null,f,this.errors)}error(e,...n){let a=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Ji(a,e))}checkSubtype(e,n){let a=ve(e,n);return a&&this.error(a),a}}var cc=Fa;function uc(t){if(t instanceof hu)return uc(t.boundExpression);if(t instanceof _o&&t.name==="error"||t instanceof ka||t instanceof Wo)return!1;let e=t instanceof ta||t instanceof ji,n=!0;return t.eachChild(a=>{n=e?n&&uc(a):n&&a instanceof qr}),!!n&&Zo(t)&&vo(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function _l(t,e){let n=t.length-1,a,c,f=0,m=n,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),a=t[y],c=t[y+1],a<=e){if(y===n||e<c)return y;f=y+1}else{if(!(a>e))throw new Or("Input is not a number.");m=y-1}return 0}class Na{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[c,f]of a)this.labels.push(c),this.outputs.push(f)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let a=n.parse(e[1],1,at);if(!a)return null;let c=[],f=null;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);for(let m=1;m<e.length;m+=2){let y=m===1?-1/0:e[m],x=e[m+1],b=m,D=m+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(c.length&&c[c.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);let M=n.parse(x,D,f);if(!M)return null;f=f||M.type,c.push([y,M])}return new Na(f,a,c)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let f=n.length;return c>=n[f-1]?a[f-1].evaluate(e):a[_l(n,c)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var za=Na;function Xt(t,e,n){return t*(1-n)+e*n}var pi=Object.freeze({__proto__:null,array:function(t,e,n){return t.map((a,c)=>Xt(a,e[c],n))},color:function(t,e,n){return new Ne(Xt(t.r,e.r,n),Xt(t.g,e.g,n),Xt(t.b,e.b,n),Xt(t.a,e.a,n))},number:Xt});let Yo=.95047,ra=1.08883,xo=4/29,bs=6/29,ia=3*bs*bs,Ba=bs*bs*bs,du=Math.PI/180,fu=180/Math.PI;function hc(t){return t>Ba?Math.pow(t,1/3):t/ia+xo}function dc(t){return t>bs?t*t*t:ia*(t-xo)}function yl(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Va(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ja(t){let e=Va(t.r),n=Va(t.g),a=Va(t.b),c=hc((.4124564*e+.3575761*n+.1804375*a)/Yo),f=hc((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*f-16,a:500*(c-f),b:200*(f-hc((.0193339*e+.119192*n+.9503041*a)/ra)),alpha:t.a}}function ws(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*dc(e),n=Yo*dc(n),a=ra*dc(a),new Ne(yl(3.2404542*n-1.5371385*e-.4985314*a),yl(-.969266*n+1.8760108*e+.041556*a),yl(.0556434*n-.2040259*e+1.0572252*a),t.alpha)}function jh(t,e,n){let a=e-t;return t+n*(a>180||a<-180?a-360*Math.round(a/360):a)}let Ti={forward:ja,reverse:ws,interpolate:function(t,e,n){return{l:Xt(t.l,e.l,n),a:Xt(t.a,e.a,n),b:Xt(t.b,e.b,n),alpha:Xt(t.alpha,e.alpha,n)}}},oa={forward:function(t){let{l:e,a:n,b:a}=ja(t),c=Math.atan2(a,n)*fu;return{h:c<0?c+360:c,c:Math.sqrt(n*n+a*a),l:e,alpha:t.a}},reverse:function(t){let e=t.h*du,n=t.c;return ws({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:jh(t.h,e.h,n),c:Xt(t.c,e.c,n),l:Xt(t.l,e.l,n),alpha:Xt(t.alpha,e.alpha,n)}}};var bo=Object.freeze({__proto__:null,hcl:oa,lab:Ti});class sa{constructor(e,n,a,c,f){this.type=e,this.operator=n,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(let[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,n,a,c){let f=0;if(e.name==="exponential")f=fc(n,e.base,a,c);else if(e.name==="linear")f=fc(n,1,a,c);else if(e.name==="cubic-bezier"){let m=e.controlPoints;f=new xr(m[0],m[1],m[2],m[3]).solve(fc(n,1,a,c))}return f}static parse(e,n){let[a,c,f,...m]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let b=c[1];if(typeof b!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:b}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let b=c.slice(1);if(b.length!==4||b.some(D=>typeof D!="number"||D<0||D>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,at),!f)return null;let y=[],x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=fi:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let b=0;b<m.length;b+=2){let D=m[b],M=m[b+1],S=b+3,k=b+4;if(typeof D!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(y.length&&y[y.length-1][0]>=D)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);let L=n.parse(M,k,x);if(!L)return null;x=x||L.type,y.push([D,L])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new sa(x,a,c,f,y):n.error(`Type ${ae(x)} is not interpolatable.`)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let f=n.length;if(c>=n[f-1])return a[f-1].evaluate(e);let m=_l(n,c),y=sa.interpolationFactor(this.interpolation,c,n[m],n[m+1]),x=a[m].evaluate(e),b=a[m+1].evaluate(e);return this.operator==="interpolate"?pi[this.type.kind.toLowerCase()](x,b,y):this.operator==="interpolate-hcl"?oa.reverse(oa.interpolate(oa.forward(x),oa.forward(b),y)):Ti.reverse(Ti.interpolate(Ti.forward(x),Ti.forward(b),y))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function fc(t,e,n,a){let c=a-n,f=t-n;return c===0?0:e===1?f/c:(Math.pow(e,f)-1)/(Math.pow(e,c)-1)}var mi=sa;class aa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null,c=n.expectedType;c&&c.kind!=="value"&&(a=c);let f=[];for(let y of e.slice(1)){let x=n.parse(y,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,f.push(x)}let m=c&&f.some(y=>ve(c,y.type));return new aa(m?Vt:a,f)}evaluate(e){let n,a=null,c=0;for(let f of this.args){if(c++,a=f.evaluate(e),a&&a instanceof Dn&&!a.available&&(n||(n=a),a=null,c===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var vl=aa;class Ua{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let f=1;f<e.length-1;f+=2){let m=e[f];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);let y=n.parse(e[f+1],f+1);if(!y)return null;a.push([m,y])}let c=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return c?new Ua(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}var pc=Ua;class Es{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,at),c=n.parse(e[2],2,ne(n.expectedType||Vt));return a&&c?new Es(c.type.itemType,a,c):null}evaluate(e){let n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new Or(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new Or(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new Or(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var pu=Es;class mc{constructor(e,n){this.type=Zt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Vt),c=n.parse(e[2],2,Vt);return a&&c?Xe(a.type,[Zt,Yt,at,$o,Vt])?new mc(a,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ae(a.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!nt(n,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${ae(Ft(n))} instead.`);if(!nt(a,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${ae(Ft(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var be=mc;class Le{constructor(e,n,a){this.type=at,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Vt),c=n.parse(e[2],2,Vt);if(!a||!c)return null;if(!Xe(a.type,[Zt,Yt,at,$o,Vt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ae(a.type)} instead`);if(e.length===4){let f=n.parse(e[3],3,at);return f?new Le(a,c,f):null}return new Le(a,c)}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!nt(n,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${ae(Ft(n))} instead.`);if(!nt(a,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${ae(Ft(a))} instead.`);if(this.fromIndex){let c=this.fromIndex.evaluate(e);return a.indexOf(n,c)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ut=Le;class wt{constructor(e,n,a,c,f,m){this.inputType=e,this.type=n,this.input=a,this.cases=c,this.outputs=f,this.otherwise=m}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);let f={},m=[];for(let b=2;b<e.length-1;b+=2){let D=e[b],M=e[b+1];Array.isArray(D)||(D=[D]);let S=n.concat(b);if(D.length===0)return S.error("Expected at least one branch label.");for(let L of D){if(typeof L!="number"&&typeof L!="string")return S.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return S.error("Numeric branch labels must be integer values.");if(a){if(S.checkSubtype(a,Ft(L)))return null}else a=Ft(L);if(f[String(L)]!==void 0)return S.error("Branch labels must be unique.");f[String(L)]=m.length}let k=n.parse(M,b,c);if(!k)return null;c=c||k.type,m.push(k)}let y=n.parse(e[1],1,Vt);if(!y)return null;let x=n.parse(e[e.length-1],e.length-1,c);return x?y.type.kind!=="value"&&n.concat(1).checkSubtype(a,y.type)?null:new wt(a,c,y,f,m,x):null}evaluate(e){let n=this.input.evaluate(e);return(Ft(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],c={};for(let m of n){let y=c[this.cases[m]];y===void 0?(c[this.cases[m]]=a.length,a.push([this.cases[m],[m]])):a[y][1].push(m)}let f=m=>this.inputType.kind==="number"?Number(m):m;for(let[m,y]of a)e.push(y.length===1?f(y[0]):y.map(f)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var Qn=wt;class rn{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);let c=[];for(let m=1;m<e.length-1;m+=2){let y=n.parse(e[m],m,Zt);if(!y)return null;let x=n.parse(e[m+1],m+1,a);if(!x)return null;c.push([y,x]),a=a||x.type}let f=n.parse(e[e.length-1],e.length-1,a);return f?new rn(a,c,f):null}evaluate(e){for(let[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var sr=rn;class rr{constructor(e,n,a,c){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Vt),c=n.parse(e[2],2,at);if(!a||!c)return null;if(!Xe(a.type,[ne(Vt),Yt,Vt]))return n.error(`Expected first argument to be of type array or string, but found ${ae(a.type)} instead`);if(e.length===4){let f=n.parse(e[3],3,at);return f?new rr(a.type,a,c,f):null}return new rr(a.type,a,c)}evaluate(e){let n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!nt(n,["string","array"]))throw new Or(`Expected first argument to be of type array or string, but found ${ae(Ft(n))} instead.`);if(this.endIndex){let c=this.endIndex.evaluate(e);return n.slice(a,c)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Di=rr;function ur(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function yr(t,e,n,a){return a.compare(e,n)===0}function Wr(t,e,n){let a=t!=="=="&&t!=="!=";return class NT{constructor(f,m,y){this.type=Zt,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");let y=f[0],x=m.parse(f[1],1,Vt);if(!x)return null;if(!ur(y,x.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${ae(x.type)}'.`);let b=m.parse(f[2],2,Vt);if(!b)return null;if(!ur(y,b.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${ae(b.type)}'.`);if(x.type.kind!==b.type.kind&&x.type.kind!=="value"&&b.type.kind!=="value")return m.error(`Cannot compare types '${ae(x.type)}' and '${ae(b.type)}'.`);a&&(x.type.kind==="value"&&b.type.kind!=="value"?x=new ji(b.type,[x]):x.type.kind!=="value"&&b.type.kind==="value"&&(b=new ji(x.type,[b])));let D=null;if(f.length===4){if(x.type.kind!=="string"&&b.type.kind!=="string"&&x.type.kind!=="value"&&b.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(D=m.parse(f[3],3,C),!D)return null}return new NT(x,b,D)}evaluate(f){let m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){let x=Ft(m),b=Ft(y);if(x.kind!==b.kind||x.kind!=="string"&&x.kind!=="number")throw new Or(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${x.kind}, ${b.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let x=Ft(m),b=Ft(y);if(x.kind!=="string"||b.kind!=="string")return e(f,m,y)}return this.collator?n(f,m,y,this.collator.evaluate(f)):e(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){let f=[t];return this.eachChild(m=>{f.push(m.serialize())}),f}}}let wo=Wr("==",function(t,e,n){return e===n},yr),Zr=Wr("!=",function(t,e,n){return e!==n},function(t,e,n,a){return!yr(0,e,n,a)}),Eo=Wr("<",function(t,e,n){return e<n},function(t,e,n,a){return a.compare(e,n)<0}),la=Wr(">",function(t,e,n){return e>n},function(t,e,n,a){return a.compare(e,n)>0}),xl=Wr("<=",function(t,e,n){return e<=n},function(t,e,n,a){return a.compare(e,n)<=0}),Cs=Wr(">=",function(t,e,n){return e>=n},function(t,e,n,a){return a.compare(e,n)>=0});class Ko{constructor(e,n,a,c,f,m){this.type=Yt,this.number=e,this.locale=n,this.currency=a,this.unit=c,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let a=n.parse(e[1],1,at);if(!a)return null;let c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=n.parse(c.locale,1,Yt),!f))return null;let m=null;if(c.currency&&(m=n.parse(c.currency,1,Yt),!m))return null;let y=null;if(c.unit&&(y=n.parse(c.unit,1,Yt),!y))return null;let x=null;if(c["min-fraction-digits"]&&(x=n.parse(c["min-fraction-digits"],1,at),!x))return null;let b=null;return c["max-fraction-digits"]&&(b=n.parse(c["max-fraction-digits"],1,at),!b)?null:new Ko(a,f,m,y,x,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ts{constructor(e){this.type=at,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${ae(a.type)} instead.`):new Ts(a):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Or(`Expected value to be of type string or array, but found ${ae(Ft(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}let mu={"==":wo,"!=":Zr,">":la,"<":Eo,">=":Cs,"<=":xl,array:ji,at:pu,boolean:ji,case:sr,coalesce:vl,collator:ka,format:go,image:Oa,in:be,"index-of":ut,interpolate:mi,"interpolate-hcl":mi,"interpolate-lab":mi,length:Ts,let:pc,literal:qr,match:Qn,number:ji,"number-format":Ko,object:ji,slice:Di,step:za,string:ji,"to-boolean":ta,"to-color":ta,"to-number":ta,"to-string":ta,var:hu,within:Wo};function gu(t,[e,n,a,c]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let f=c?c.evaluate(t):1,m=hl(e,n,a,f);if(m)throw new Or(m);return new Ne(e/255*f,n/255*f,a/255*f,f)}function fn(t,e){return t in e}function xn(t,e){let n=e[t];return n===void 0?null:n}function Xr(t){return{type:t}}_o.register(mu,{error:[{kind:"error"},[Yt],(t,[e])=>{throw new Or(e.evaluate(t))}],typeof:[Yt,[Vt],(t,[e])=>ae(Ft(e.evaluate(t)))],"to-rgba":[ne(at,4),[fi],(t,[e])=>e.evaluate(t).toArray()],rgb:[fi,[at,at,at],gu],rgba:[fi,[at,at,at,at],gu],has:{type:Zt,overloads:[[[Yt],(t,[e])=>fn(e.evaluate(t),t.properties())],[[Yt,Vi],(t,[e,n])=>fn(e.evaluate(t),n.evaluate(t))]]},get:{type:Vt,overloads:[[[Yt],(t,[e])=>xn(e.evaluate(t),t.properties())],[[Yt,Vi],(t,[e,n])=>xn(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Vt,[Yt],(t,[e])=>xn(e.evaluate(t),t.featureState||{})],properties:[Vi,[],t=>t.properties()],"geometry-type":[Yt,[],t=>t.geometryType()],id:[Vt,[],t=>t.id()],zoom:[at,[],t=>t.globals.zoom],pitch:[at,[],t=>t.globals.pitch||0],"distance-from-center":[at,[],t=>t.distanceFromCenter()],"heatmap-density":[at,[],t=>t.globals.heatmapDensity||0],"line-progress":[at,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[at,[],t=>t.globals.skyRadialProgress||0],accumulated:[Vt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[at,Xr(at),(t,e)=>{let n=0;for(let a of e)n+=a.evaluate(t);return n}],"*":[at,Xr(at),(t,e)=>{let n=1;for(let a of e)n*=a.evaluate(t);return n}],"-":{type:at,overloads:[[[at,at],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[at],(t,[e])=>-e.evaluate(t)]]},"/":[at,[at,at],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[at,[at,at],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[at,[],()=>Math.LN2],pi:[at,[],()=>Math.PI],e:[at,[],()=>Math.E],"^":[at,[at,at],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[at,[at],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[at,[at],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[at,[at],(t,[e])=>Math.log(e.evaluate(t))],log2:[at,[at],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[at,[at],(t,[e])=>Math.sin(e.evaluate(t))],cos:[at,[at],(t,[e])=>Math.cos(e.evaluate(t))],tan:[at,[at],(t,[e])=>Math.tan(e.evaluate(t))],asin:[at,[at],(t,[e])=>Math.asin(e.evaluate(t))],acos:[at,[at],(t,[e])=>Math.acos(e.evaluate(t))],atan:[at,[at],(t,[e])=>Math.atan(e.evaluate(t))],min:[at,Xr(at),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[at,Xr(at),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[at,[at],(t,[e])=>Math.abs(e.evaluate(t))],round:[at,[at],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[at,[at],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[at,[at],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Zt,[Yt,Vt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Zt,[Vt],(t,[e])=>t.id()===e.value],"filter-type-==":[Zt,[Yt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Zt,[Yt,Vt],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Zt,[Vt],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[Zt,[Yt,Vt],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a>c}],"filter-id->":[Zt,[Vt],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[Zt,[Yt,Vt],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Zt,[Vt],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[Zt,[Yt,Vt],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Zt,[Vt],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[Zt,[Vt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Zt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Zt,[ne(Yt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Zt,[ne(Vt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Zt,[Yt,ne(Vt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Zt,[Yt,ne(Vt)],(t,[e,n])=>function(a,c,f,m){for(;f<=m;){let y=f+m>>1;if(c[y]===a)return!0;c[y]>a?m=y-1:f=y+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Zt,overloads:[[[Zt,Zt],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Xr(Zt),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Zt,overloads:[[[Zt,Zt],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Xr(Zt),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Zt,[Zt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Zt,[Yt],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Yt,[Yt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Yt,[Yt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Yt,Xr(Vt),(t,e)=>e.map(n=>ea(n.evaluate(t))).join("")],"resolved-locale":[Yt,[C],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Ii=mu;function bl(t){return{result:"success",value:t}}function kr(t){return{result:"error",value:t}}function si(t){return t["property-type"]==="data-driven"}function Gi(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Jo(t){return!!t.expression&&t.expression.interpolated}function tn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Qi(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Qo(t){return t}function $a(t,e){let n=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",c=a||!(a||t.property!==void 0),f=t.type||(Jo(e)?"exponential":"interval");if(n&&((t=Hr({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],Ne.parse(b[1])])),t.default=Ne.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!bo[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let m,y,x;if(f==="exponential")m=Mi;else if(f==="interval")m=Ds;else if(f==="categorical"){m=wl,y=Object.create(null);for(let b of t.stops)y[b[0]]=b[1];x=typeof t.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);m=gc}if(a){let b={},D=[];for(let k=0;k<t.stops.length;k++){let L=t.stops[k],z=L[0].zoom;b[z]===void 0&&(b[z]={zoom:z,type:t.type,property:t.property,default:t.default,stops:[]},D.push(z)),b[z].stops.push([L[0].value,L[1]])}let M=[];for(let k of D)M.push([b[k].zoom,$a(b[k],e)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:mi.interpolationFactor.bind(void 0,S),zoomStops:M.map(k=>k[0]),evaluate:({zoom:k},L)=>Mi({stops:M,base:t.base},e,k).evaluate(k,L)}}if(c){let b=f==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:mi.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(D=>D[0]),evaluate:({zoom:D})=>m(t,e,D,y,x)}}return{kind:"source",evaluate(b,D){let M=D&&D.properties?D.properties[t.property]:void 0;return M===void 0?Co(t.default,e.default):m(t,e,M,y,x)}}}function Co(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function wl(t,e,n,a,c){return Co(typeof n===c?a[n]:void 0,t.default,e.default)}function Ds(t,e,n){if(tn(n)!=="number")return Co(t.default,e.default);let a=t.stops.length;if(a===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];let c=_l(t.stops.map(f=>f[0]),n);return t.stops[c][1]}function Mi(t,e,n){let a=t.base!==void 0?t.base:1;if(tn(n)!=="number")return Co(t.default,e.default);let c=t.stops.length;if(c===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];let f=_l(t.stops.map(D=>D[0]),n),m=function(D,M,S,k){let L=k-S,z=D-S;return L===0?0:M===1?z/L:(Math.pow(M,z)-1)/(Math.pow(M,L)-1)}(n,a,t.stops[f][0],t.stops[f+1][0]),y=t.stops[f][1],x=t.stops[f+1][1],b=pi[e.type]||Qo;if(t.colorSpace&&t.colorSpace!=="rgb"){let D=bo[t.colorSpace];b=(M,S)=>D.reverse(D.interpolate(D.forward(M),D.forward(S),m))}return typeof y.evaluate=="function"?{evaluate(...D){let M=y.evaluate.apply(void 0,D),S=x.evaluate.apply(void 0,D);if(M!==void 0&&S!==void 0)return b(M,S,m)}}:b(y,x,m)}function gc(t,e,n){return e.type==="color"?n=Ne.parse(n):e.type==="formatted"?n=Tn.fromString(n.toString()):e.type==="resolvedImage"?n=Dn.fromString(n.toString()):tn(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Co(n,t.default,e.default)}class Is{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new pl,this._defaultValue=n?function(a){return a.type==="color"&&(Qi(a.default)||Array.isArray(a.default))?new Ne(0,0,0,0):a.type==="color"?Ne.parse(a.default)||null:a.default===void 0?null:a.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,c,f,m,y,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,c,f,m,y,x){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Or(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function To(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ii}function El(t,e){let n=new cc(Ii,[],e?function(c){let f={color:fi,string:Yt,number:at,enum:Yt,boolean:Zt,formatted:A,resolvedImage:$};return c.type==="array"?ne(f[c.value]||Vt,c.length):f[c.type]}(e):void 0),a=n.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?bl(new Is(a,e)):kr(n.errors)}class Uh{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!$i(n.expression)}evaluateWithoutErrorHandling(e,n,a,c,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,f,m)}evaluate(e,n,a,c,f,m){return this._styleExpression.evaluate(e,n,a,c,f,m)}}class _c{constructor(e,n,a,c){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!$i(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,a,c,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,f,m)}evaluate(e,n,a,c,f,m){return this._styleExpression.evaluate(e,n,a,c,f,m)}interpolationFactor(e,n,a){return this.interpolationType?mi.interpolationFactor(this.interpolationType,e,n,a):0}}function yc(t,e){if((t=El(t,e)).result==="error")return t;let n=t.value.expression,a=Zo(n);if(!a&&!si(e))return kr([new Ji("","data expressions not supported")]);let c=vo(n,["zoom","pitch","distance-from-center"]);if(!c&&!Gi(e))return kr([new Ji("","zoom expressions not supported")]);let f=yu(n);return f||c?f instanceof Ji?kr([f]):f instanceof mi&&!Jo(e)?kr([new Ji("",'"interpolate" expressions cannot be used with this property')]):bl(f?new _c(a?"camera":"composite",t.value,f.labels,f instanceof mi?f.interpolation:void 0):new Uh(a?"constant":"source",t.value)):kr([new Ji("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _u{constructor(e,n){this._parameters=e,this._specification=n,Hr(this,$a(this._parameters,this._specification))}static deserialize(e){return new _u(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function yu(t){let e=null;if(t instanceof pc)e=yu(t.result);else if(t instanceof vl){for(let n of t.args)if(e=yu(n),e)break}else(t instanceof za||t instanceof mi)&&t.input instanceof _o&&t.input.name==="zoom"&&(e=t);return e instanceof Ji||t.eachChild(n=>{let a=yu(n);a instanceof Ji?e=a:!e&&a?e=new Ji("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Ji("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class dt{constructor(e,n,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Do(t){let e=t.key,n=t.value,a=t.valueSpec||{},c=t.objectElementValidators||{},f=t.style,m=t.styleSpec,y=[],x=tn(n);if(x!=="object")return[new dt(e,n,`object expected, ${x} found`)];for(let b in n){let D=b.split(".")[0],M;c[D]?M=c[D]:a[D]?M=ai:c["*"]?M=c["*"]:a["*"]&&(M=ai),M?y=y.concat(M({key:(e&&`${e}.`)+b,value:n[b],valueSpec:a[D]||a["*"],style:f,styleSpec:m,object:n,objectKey:b},n)):y.push(new dt(e,n[b],`unknown property "${b}"`))}for(let b in a)c[b]||a[b].required&&a[b].default===void 0&&n[b]===void 0&&y.push(new dt(e,n,`missing required property "${b}"`));return y}function Rf(t){let e=t.value,n=t.valueSpec,a=t.style,c=t.styleSpec,f=t.key,m=t.arrayElementValidator||ai;if(tn(e)!=="array")return[new dt(f,e,`array expected, ${tn(e)} found`)];if(n.length&&e.length!==n.length)return[new dt(f,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new dt(f,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let y={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};c.$version<7&&(y.function=n.function),tn(n.value)==="object"&&(y=n.value);let x=[];for(let b=0;b<e.length;b++)x=x.concat(m({array:e,arrayIndex:b,value:e[b],valueSpec:y,style:a,styleSpec:c,key:`${f}[${b}]`}));return x}function vc(t){let e=t.key,n=t.value,a=t.valueSpec,c=tn(n);if(c==="number"&&n!=n&&(c="NaN"),c!=="number")return[new dt(e,n,`number expected, ${c} found`)];if("minimum"in a){let f=a.minimum;if(tn(a.minimum)==="array"&&(f=a.minimum[t.arrayIndex]),n<f)return[new dt(e,n,`${n} is less than the minimum value ${f}`)]}if("maximum"in a){let f=a.maximum;if(tn(a.maximum)==="array"&&(f=a.maximum[t.arrayIndex]),n>f)return[new dt(e,n,`${n} is greater than the maximum value ${f}`)]}return[]}function xc(t){let e=t.valueSpec,n=$n(t.value.type),a,c,f,m={},y=n!=="categorical"&&t.value.property===void 0,x=!y,b=tn(t.value.stops)==="array"&&tn(t.value.stops[0])==="array"&&tn(t.value.stops[0][0])==="object",D=Do({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(k){if(n==="identity")return[new dt(k.key,k.value,'identity function may not have a "stops" property')];let L=[],z=k.value;return L=L.concat(Rf({key:k.key,value:z,valueSpec:k.valueSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:M})),tn(z)==="array"&&z.length===0&&L.push(new dt(k.key,z,"array must have at least one stop")),L},default:function(k){return ai({key:k.key,value:k.value,valueSpec:e,style:k.style,styleSpec:k.styleSpec})}}});return n==="identity"&&y&&D.push(new dt(t.key,t.value,'missing required property "property"')),n==="identity"||t.value.stops||D.push(new dt(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!Jo(t.valueSpec)&&D.push(new dt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(x&&!si(t.valueSpec)?D.push(new dt(t.key,t.value,"property functions not supported")):y&&!Gi(t.valueSpec)&&D.push(new dt(t.key,t.value,"zoom functions not supported"))),n!=="categorical"&&!b||t.value.property!==void 0||D.push(new dt(t.key,t.value,'"property" property is required')),D;function M(k){let L=[],z=k.value,H=k.key;if(tn(z)!=="array")return[new dt(H,z,`array expected, ${tn(z)} found`)];if(z.length!==2)return[new dt(H,z,`array length 2 expected, length ${z.length} found`)];if(b){if(tn(z[0])!=="object")return[new dt(H,z,`object expected, ${tn(z[0])} found`)];if(z[0].zoom===void 0)return[new dt(H,z,"object stop key must have zoom")];if(z[0].value===void 0)return[new dt(H,z,"object stop key must have value")];let K=$n(z[0].zoom);if(typeof K!="number")return[new dt(H,z[0].zoom,"stop zoom values must be numbers")];if(f&&f>K)return[new dt(H,z[0].zoom,"stop zoom values must appear in ascending order")];K!==f&&(f=K,c=void 0,m={}),L=L.concat(Do({key:`${H}[0]`,value:z[0],valueSpec:{zoom:{}},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{zoom:vc,value:S}}))}else L=L.concat(S({key:`${H}[0]`,value:z[0],valueSpec:{},style:k.style,styleSpec:k.styleSpec},z));return To(Er(z[1]))?L.concat([new dt(`${H}[1]`,z[1],"expressions are not allowed in function stops.")]):L.concat(ai({key:`${H}[1]`,value:z[1],valueSpec:e,style:k.style,styleSpec:k.styleSpec}))}function S(k,L){let z=tn(k.value),H=$n(k.value),K=k.value!==null?k.value:L;if(a){if(z!==a)return[new dt(k.key,K,`${z} stop domain type must match previous stop domain type ${a}`)]}else a=z;if(z!=="number"&&z!=="string"&&z!=="boolean"&&typeof H!="number"&&typeof H!="string"&&typeof H!="boolean")return[new dt(k.key,K,"stop domain value must be a number, string, or boolean")];if(z!=="number"&&n!=="categorical"){let se=`number expected, ${z} found`;return si(e)&&n===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new dt(k.key,K,se)]}return n!=="categorical"||z!=="number"||typeof H=="number"&&isFinite(H)&&Math.floor(H)===H?n!=="categorical"&&z==="number"&&typeof H=="number"&&typeof c=="number"&&c!==void 0&&H<c?[new dt(k.key,K,"stop domain values must appear in ascending order")]:(c=H,n==="categorical"&&H in m?[new dt(k.key,K,"stop domain values must be unique")]:(m[H]=!0,[])):[new dt(k.key,K,`integer expected, found ${String(H)}`)]}}function Br(t){let e=(t.expressionContext==="property"?yc:El)(Er(t.value),t.valueSpec);if(e.result==="error")return e.value.map(a=>new dt(`${t.key}${a.key}`,t.value,a.message));let n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new dt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!$i(n))return[new dt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return bc(n,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!vo(n,["zoom","feature-state"]))return[new dt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Zo(n))return[new dt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bc(t,e){let n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(let c of e.valueSpec.expression.parameters)n.delete(c);if(n.size===0)return[];let a=[];return t instanceof _o&&n.has(t.name)?[new dt(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(c=>{a.push(...bc(c,e))}),a)}function vu(t){let e=t.key,n=t.value,a=t.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf($n(n))===-1&&c.push(new dt(e,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(a.values).indexOf($n(n))===-1&&c.push(new dt(e,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function $h(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!$h(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function xu(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};$h(t)||(t=Tl(t));let n=t,a=!0;try{a=function(b){if(!Cl(b))return b;let D=Er(b);return bu(D),D=Of(D),D}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let c=Oe[`filter_${e}`],f=El(a,c),m=null;if(f.result==="error")throw new Error(f.value.map(b=>`${b.key}: ${b.message}`).join(", "));m=(b,D,M)=>f.value.evaluate(b,D,{},M);let y=null,x=null;if(a!==n){let b=El(n,c);if(b.result==="error")throw new Error(b.value.map(D=>`${D.key}: ${D.message}`).join(", "));y=(D,M,S,k,L)=>b.value.evaluate(D,M,{},S,void 0,void 0,k,L),x=!Zo(b.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:kf(a),needFeature:!!x}}function Of(t){if(!Array.isArray(t))return t;let e=function(n){if(Gh.has(n[0])){for(let a=1;a<n.length;a++)if(Cl(n[a]))return!0}return n}(t);return e===!0?e:e.map(n=>Of(n))}function bu(t){let e=!1,n=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||Cl(t[a]),n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Cl(t[1]);for(let a=2;a<t.length-1;a+=2)n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Cl(t[1]);for(let a=1;a<t.length-1;a+=2)n.push(t[a+1])}e&&(t.length=0,t.push("any",...n));for(let a=1;a<t.length;a++)bu(t[a])}function Cl(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Cl(t[n]))return!0;return!1}let Gh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wg(t,e){return t<e?-1:t>e?1:0}function kf(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(kf(t[e]))return!0;return!1}function Tl(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?Hh(t[1],t[2],"=="):e==="!="?wu(Hh(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Hh(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Tl))):e==="all"?["all"].concat(t.slice(1).map(Tl)):e==="none"?["all"].concat(t.slice(1).map(Tl).map(wu)):e==="in"?qh(t[1],t.slice(2)):e==="!in"?wu(qh(t[1],t.slice(2))):e==="has"?Wh(t[1]):e==="!has"?wu(Wh(t[1])):e!=="within"||t;var n}function Hh(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function qh(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(wg)]]:["filter-in-small",t,["literal",e]]}}function Wh(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function wu(t){return["!",t]}function wc(t){return $h(Er(t.value))?Br(Hr({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Ec(t)}function Ec(t){let e=t.value,n=t.key;if(tn(e)!=="array")return[new dt(n,e,`array expected, ${tn(e)} found`)];let a=t.styleSpec,c,f=[];if(e.length<1)return[new dt(n,e,"filter array must have at least 1 element")];switch(f=f.concat(vu({key:`${n}[0]`,value:e[0],valueSpec:a.filter_operator,style:t.style,styleSpec:t.styleSpec})),$n(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&$n(e[1])==="$type"&&f.push(new dt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new dt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=tn(e[1]),c!=="string"&&f.push(new dt(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let m=2;m<e.length;m++)c=tn(e[m]),$n(e[1])==="$type"?f=f.concat(vu({key:`${n}[${m}]`,value:e[m],valueSpec:a.geometry_type,style:t.style,styleSpec:t.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&f.push(new dt(`${n}[${m}]`,e[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)f=f.concat(Ec({key:`${n}[${m}]`,value:e[m],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":c=tn(e[1]),e.length!==2?f.push(new dt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&f.push(new dt(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=tn(e[1]),e.length!==2?f.push(new dt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&f.push(new dt(`${n}[1]`,e[1],`object expected, ${c} found`))}return f}function Zh(t,e){let n=t.key,a=t.style,c=t.styleSpec,f=t.value,m=t.objectKey,y=c[`${e}_${t.layerType}`];if(!y)return[];let x=m.match(/^(.*)-transition$/);if(e==="paint"&&x&&y[x[1]]&&y[x[1]].transition)return ai({key:n,value:f,valueSpec:c.transition,style:a,styleSpec:c});let b=t.valueSpec||y[m];if(!b)return[new dt(n,f,`unknown property "${m}"`)];let D;if(tn(f)==="string"&&si(b)&&!b.tokens&&(D=/^{([^}]+)}$/.exec(f))){let S=`\`{ "type": "identity", "property": ${D?JSON.stringify(D[1]):'"_"'} }\``;return[new dt(n,f,`"${m}" does not support interpolation syntax
Use an identity property function instead: ${S}.`)]}let M=[];return t.layerType==="symbol"&&(m==="text-field"&&a&&!a.glyphs&&M.push(new dt(n,f,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Qi(Er(f))&&$n(f.type)==="identity"&&M.push(new dt(n,f,'"text-font" does not support identity functions'))),M.concat(ai({key:t.key,value:f,valueSpec:b,style:a,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:m}))}function Lf(t){return Zh(t,"paint")}function Xh(t){return Zh(t,"layout")}function Ff(t){let e=[],n=t.value,a=t.key,c=t.style,f=t.styleSpec;n.type||n.ref||e.push(new dt(a,n,'either "type" or "ref" is required'));let m=$n(n.type),y=$n(n.ref);if(n.id){let x=$n(n.id);for(let b=0;b<t.arrayIndex;b++){let D=c.layers[b];$n(D.id)===x&&e.push(new dt(a,n.id,`duplicate layer id "${n.id}", previously used at line ${D.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(b=>{b in n&&e.push(new dt(a,n[b],`"${b}" is prohibited for ref layers`))}),c.layers.forEach(b=>{$n(b.id)===y&&(x=b)}),x?x.ref?e.push(new dt(a,n.ref,"ref cannot reference another ref layer")):m=$n(x.type):typeof y=="string"&&e.push(new dt(a,n.ref,`ref layer "${y}" not found`))}else if(m!=="background"&&m!=="sky")if(n.source){let x=c.sources&&c.sources[n.source],b=x&&$n(x.type);x?b==="vector"&&m==="raster"?e.push(new dt(a,n.source,`layer "${n.id}" requires a raster source`)):b==="raster"&&m!=="raster"?e.push(new dt(a,n.source,`layer "${n.id}" requires a vector source`)):b!=="vector"||n["source-layer"]?b==="raster-dem"&&m!=="hillshade"?e.push(new dt(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||b==="geojson"&&x.lineMetrics||e.push(new dt(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new dt(a,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new dt(a,n.source,`source "${n.source}" not found`))}else e.push(new dt(a,n,'missing required property "source"'));return e=e.concat(Do({key:a,value:n,valueSpec:f.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ai({key:`${a}.type`,value:n.type,valueSpec:f.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:x=>wc(Hr({layerType:m},x)),layout:x=>Do({layer:n,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":b=>Xh(Hr({layerType:m},b))}}),paint:x=>Do({layer:n,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":b=>Lf(Hr({layerType:m},b))}})}})),e}function ca(t){let e=t.value,n=t.key,a=tn(e);return a!=="string"?[new dt(n,e,`string expected, ${a} found`)]:[]}let Nf={promoteId:function({key:t,value:e}){if(tn(e)==="string")return ca({key:t,value:e});{let n=[];for(let a in e)n.push(...ca({key:`${t}.${a}`,value:e[a]}));return n}}};function zf(t){let e=t.value,n=t.key,a=t.styleSpec,c=t.style;if(!e.type)return[new dt(n,e,'"type" is required')];let f=$n(e.type),m;switch(f){case"vector":case"raster":case"raster-dem":return m=Do({key:n,value:e,valueSpec:a[`source_${f.replace("-","_")}`],style:t.style,styleSpec:a,objectElementValidators:Nf}),m;case"geojson":if(m=Do({key:n,value:e,valueSpec:a.source_geojson,style:c,styleSpec:a,objectElementValidators:Nf}),e.cluster)for(let y in e.clusterProperties){let[x,b]=e.clusterProperties[y],D=typeof x=="string"?[x,["accumulated"],["get",y]]:x;m.push(...Br({key:`${n}.${y}.map`,value:b,expressionContext:"cluster-map"})),m.push(...Br({key:`${n}.${y}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return m;case"video":return Do({key:n,value:e,valueSpec:a.source_video,style:c,styleSpec:a});case"image":return Do({key:n,value:e,valueSpec:a.source_image,style:c,styleSpec:a});case"canvas":return[new dt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vu({key:`${n}.type`,value:e.type,valueSpec:{values:Eg(a)},style:c,styleSpec:a})}}function Eg(t){return t.source.reduce((e,n)=>{let a=t[n];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Bf(t){let e=t.value,n=t.styleSpec,a=n.light,c=t.style,f=[],m=tn(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new dt("light",e,`object expected, ${m} found`)]),f;for(let y in e){let x=y.match(/^(.*)-transition$/);f=f.concat(x&&a[x[1]]&&a[x[1]].transition?ai({key:y,value:e[y],valueSpec:n.transition,style:c,styleSpec:n}):a[y]?ai({key:y,value:e[y],valueSpec:a[y],style:c,styleSpec:n}):[new dt(y,e[y],`unknown property "${y}"`)])}return f}function Yh(t){let e=t.value,n=t.key,a=t.style,c=t.styleSpec,f=c.terrain,m=[],y=tn(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new dt("terrain",e,`object expected, ${y} found`)]),m;for(let x in e){let b=x.match(/^(.*)-transition$/);m=m.concat(b&&f[b[1]]&&f[b[1]].transition?ai({key:x,value:e[x],valueSpec:c.transition,style:a,styleSpec:c}):f[x]?ai({key:x,value:e[x],valueSpec:f[x],style:a,styleSpec:c}):[new dt(x,e[x],`unknown property "${x}"`)])}if(e.source){let x=a.sources&&a.sources[e.source],b=x&&$n(x.type);x?b!=="raster-dem"&&m.push(new dt(n,e.source,`terrain cannot be used with a source of type ${String(b)}, it only be used with a "raster-dem" source type`)):m.push(new dt(n,e.source,`source "${e.source}" not found`))}else m.push(new dt(n,e,'terrain is missing required property "source"'));return m}function Vf(t){let e=t.value,n=t.style,a=t.styleSpec,c=a.fog,f=[],m=tn(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new dt("fog",e,`object expected, ${m} found`)]),f;for(let y in e){let x=y.match(/^(.*)-transition$/);f=f.concat(x&&c[x[1]]&&c[x[1]].transition?ai({key:y,value:e[y],valueSpec:a.transition,style:n,styleSpec:a}):c[y]?ai({key:y,value:e[y],valueSpec:c[y],style:n,styleSpec:a}):[new dt(y,e[y],`unknown property "${y}"`)])}return f}let jf={"*":()=>[],array:Rf,boolean:function(t){let e=t.value,n=t.key,a=tn(e);return a!=="boolean"?[new dt(n,e,`boolean expected, ${a} found`)]:[]},number:vc,color:function(t){let e=t.key,n=t.value,a=tn(n);return a!=="string"?[new dt(e,n,`color expected, ${a} found`)]:ht(n)===null?[new dt(e,n,`color expected, "${n}" found`)]:[]},enum:vu,filter:wc,function:xc,layer:Ff,object:Do,source:zf,light:Bf,terrain:Yh,fog:Vf,string:ca,formatted:function(t){return ca(t).length===0?[]:Br(t)},resolvedImage:function(t){return ca(t).length===0?[]:Br(t)},projection:function(t){let e=t.value,n=t.styleSpec,a=n.projection,c=t.style,f=[],m=tn(e);if(m==="object")for(let y in e)f=f.concat(ai({key:y,value:e[y],valueSpec:a[y],style:c,styleSpec:n}));else m!=="string"&&(f=f.concat([new dt("projection",e,`object or string expected, ${m} found`)]));return f}};function ai(t){let e=t.value,n=t.valueSpec,a=t.styleSpec;return n.expression&&Qi($n(e))?xc(t):n.expression&&To(Er(e))?Br(t):n.type&&jf[n.type]?jf[n.type](t):Do(Hr({},t,{valueSpec:n.type?a[n.type]:n}))}function Cg(t){let e=t.value,n=t.key,a=ca(t);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new dt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new dt(n,e,'"glyphs" url must include a "{range}" token'))),a}function Uf(t,e=Oe){return eo(ai({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Cg,"*":()=>[]}}))}let Tg=t=>eo(Lf(t)),Dg=t=>eo(Xh(t));function eo(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function $f(t,e){let n=!1;if(e&&e.length)for(let a of e)t.fire(new zr(new Error(a.message))),n=!0;return n}var Ig=es,Io=3;function es(t,e,n){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var f=0;f<this.d*this.d;f++){var m=c[Io+f],y=c[Io+f+1];a.push(m===y?null:c.subarray(m,y))}var x=c[Io+a.length+1];this.keys=c.subarray(c[Io+a.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var b=0;b<this.d*this.d;b++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var D=n/e*t;this.min=-D,this.max=t+D}es.prototype.insert=function(t,e,n,a,c){this._forEachCell(e,n,a,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c)},es.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},es.prototype._insertCell=function(t,e,n,a,c,f){this.cells[c].push(f)},es.prototype.query=function(t,e,n,a,c){var f=this.min,m=this.max;if(t<=f&&e<=f&&m<=n&&m<=a&&!c)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(t,e,n,a,this._queryCell,y,{},c),y},es.prototype._queryCell=function(t,e,n,a,c,f,m,y){var x=this.cells[c];if(x!==null)for(var b=this.keys,D=this.bboxes,M=0;M<x.length;M++){var S=x[M];if(m[S]===void 0){var k=4*S;(y?y(D[k+0],D[k+1],D[k+2],D[k+3]):t<=D[k+2]&&e<=D[k+3]&&n>=D[k+0]&&a>=D[k+1])?(m[S]=!0,f.push(b[S])):m[S]=!1}}},es.prototype._forEachCell=function(t,e,n,a,c,f,m,y){for(var x=this._convertToCellCoord(t),b=this._convertToCellCoord(e),D=this._convertToCellCoord(n),M=this._convertToCellCoord(a),S=x;S<=D;S++)for(var k=b;k<=M;k++){var L=this.d*k+S;if((!y||y(this._convertFromCellCoord(S),this._convertFromCellCoord(k),this._convertFromCellCoord(S+1),this._convertFromCellCoord(k+1)))&&c.call(this,t,e,n,a,L,f,m,y))return}},es.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},es.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},es.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Io+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var f=e,m=0;m<t.length;m++){var y=t[m];c[Io+m]=f,c.set(y,f),f+=y.length}return c[Io+t.length]=f,c.set(this.keys,f),c[Io+t.length+1]=f+=this.keys.length,c.set(this.bboxes,f),f+=this.bboxes.length,c.buffer};var Ga=Ct(Ig);let Eu={};function pt(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Eu[e]={klass:t,omit:n.omit||[]}}pt(Object,"Object"),Ga.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Ga.deserialize=function(t){return new Ga(t.buffer)},Object.defineProperty(Ga,"name",{value:"Grid"}),pt(Ga,"Grid"),pt(Ne,"Color"),pt(Error,"Error"),pt(jo,"AJAXError"),pt(Dn,"ResolvedImage"),pt(_u,"StylePropertyFunction"),pt(Is,"StyleExpression",{omit:["_evaluator"]}),pt(_c,"ZoomDependentExpression"),pt(Uh,"ZoomConstantExpression"),pt(_o,"CompoundExpression",{omit:["_evaluate"]});for(let t in Ii)Eu[Ii[t]._classRegistryKey]||pt(Ii[t],`Expression${t}`);function Kh(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Jh(t){return w.ImageBitmap&&t instanceof w.ImageBitmap}function Dl(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Kh(t)||Jh(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.push(n.buffer),n}if(t instanceof w.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let a of t)n.push(Dl(a,e));return n}if(typeof t=="object"){let n=t.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let f in t)t.hasOwnProperty(f)&&(Eu[a].omit.indexOf(f)>=0||(c[f]=Dl(t[f],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof t)}function Ha(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Kh(t)||Jh(t)||ArrayBuffer.isView(t)||t instanceof w.ImageData)return t;if(Array.isArray(t))return t.map(Ha);if(typeof t=="object"){let e=t.$name||"Object",{klass:n}=Eu[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let a=Object.create(n.prototype);for(let c of Object.keys(t))c!=="$name"&&(a[c]=Ha(t[c]));return a}throw new Error("can't deserialize object of type "+typeof t)}let ct={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Qh(t){for(let e of t)if(ed(e.charCodeAt(0)))return!0;return!1}function Mg(t){for(let e of t)if(!Gf(e.charCodeAt(0)))return!1;return!0}function Gf(t){return!(ct.Arabic(t)||ct["Arabic Supplement"](t)||ct["Arabic Extended-A"](t)||ct["Arabic Presentation Forms-A"](t)||ct["Arabic Presentation Forms-B"](t))}function ed(t){return!(t!==746&&t!==747&&(t<4352||!(ct["Bopomofo Extended"](t)||ct.Bopomofo(t)||ct["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ct["CJK Compatibility Ideographs"](t)||ct["CJK Compatibility"](t)||ct["CJK Radicals Supplement"](t)||ct["CJK Strokes"](t)||!(!ct["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||ct["CJK Unified Ideographs Extension A"](t)||ct["CJK Unified Ideographs"](t)||ct["Enclosed CJK Letters and Months"](t)||ct["Hangul Compatibility Jamo"](t)||ct["Hangul Jamo Extended-A"](t)||ct["Hangul Jamo Extended-B"](t)||ct["Hangul Jamo"](t)||ct["Hangul Syllables"](t)||ct.Hiragana(t)||ct["Ideographic Description Characters"](t)||ct.Kanbun(t)||ct["Kangxi Radicals"](t)||ct["Katakana Phonetic Extensions"](t)||ct.Katakana(t)&&t!==12540||!(!ct["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!ct["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ct["Unified Canadian Aboriginal Syllabics"](t)||ct["Unified Canadian Aboriginal Syllabics Extended"](t)||ct["Vertical Forms"](t)||ct["Yijing Hexagram Symbols"](t)||ct["Yi Syllables"](t)||ct["Yi Radicals"](t))))}function Hf(t){return!(ed(t)||function(e){return!!(ct["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ct["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ct["Letterlike Symbols"](e)||ct["Number Forms"](e)||ct["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ct["Control Pictures"](e)&&e!==9251||ct["Optical Character Recognition"](e)||ct["Enclosed Alphanumerics"](e)||ct["Geometric Shapes"](e)||ct["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ct["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ct["CJK Symbols and Punctuation"](e)||ct.Katakana(e)||ct["Private Use Area"](e)||ct["CJK Compatibility Forms"](e)||ct["Small Form Variants"](e)||ct["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function qf(t){return t>=1424&&t<=2303||ct["Arabic Presentation Forms-A"](t)||ct["Arabic Presentation Forms-B"](t)}function Sg(t,e){return!(!e&&qf(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ct.Khmer(t))}function Ag(t){for(let e of t)if(qf(e.charCodeAt(0)))return!0;return!1}let td="deferred",nd="loading",rd="loaded",Il=null,d="unavailable",r=null,l=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(d="error"),Il&&Il(t)};function p(){_.fire(new Uo("pluginStateChange",{pluginStatus:d,pluginURL:r}))}let _=new ii,v=function(){return d},E=function(){if(d!==td||!r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=nd,p(),r&&Ks({url:r},t=>{t?l(t):(d=rd,p())})},T={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===rd||T.applyArabicShaping!=null,isLoading:()=>d===nd,setState(t){d=t.pluginStatus,r=t.pluginURL},isParsed:()=>T.applyArabicShaping!=null&&T.processBidirectionalText!=null&&T.processStyledBidirectionalText!=null,getPluginURL:()=>r};class I{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,a){for(let c of n)if(!Sg(c.charCodeAt(0),a))return!1;return!0}(e,T.isLoaded())}}class R{constructor(e,n){this.property=e,this.value=n,this.expression=function(a,c){if(Qi(a))return new _u(a,c);if(To(a)){let f=yc(a,c);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=a;return typeof a=="string"&&c.type==="color"&&(f=Ne.parse(a)),{kind:"constant",evaluate:()=>f}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class P{constructor(e){this.property=e,this.value=new R(e,void 0)}transitioned(e,n){return new G(this.property,this.value,n,un({},e.transition,this.transition),e.now)}untransitioned(){return new G(this.property,this.value,null,{},0)}}class F{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return hi(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new P(this._values[e].property)),this._values[e].value=new R(this._values[e].property,n===null?void 0:hi(n))}getTransition(e){return hi(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new P(this._values[e].property)),this._values[e].transition=hi(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a);let c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){let a=new W(this._properties);for(let c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,n._values[c]);return a}untransitioned(){let e=new W(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class G{constructor(e,n,a,c,f){let m=c.delay||0,y=c.duration||0;f=f||0,this.property=e,this.value=n,this.begin=f+m,this.end=this.begin+y,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){let c=e.now||0,f=this.value.possiblyEvaluate(e,n,a),m=this.prior;if(m){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return m.possiblyEvaluate(e,n,a);{let y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,n,a),f,Ma(y))}}return f}}class W{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){let c=new Y(this._properties);for(let f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,n,a);return c}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class X{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return hi(this._values[e].value)}setValue(e,n){this._values[e]=new R(this._values[e].property,n===null?void 0:hi(n))}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){let c=new Y(this._properties);for(let f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,n,a);return c}}class Z{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,c){return this.property.evaluate(this.value,this.parameters,e,n,a,c)}}class Y{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class N{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){let c=pi[this.specification.type];return c?c(e,n,a):e}}class q{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,c){return new Z(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,c)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Z(this,{kind:"constant",value:void 0},e.parameters);let c=pi[this.specification.type];return c?new Z(this,{kind:"constant",value:c(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,c,f,m){return e.kind==="constant"?e.value:e.evaluate(n,a,c,f,m)}}class Q{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,c){return!!e.expression.evaluate(n,null,{},a,c)}interpolate(){return!1}}class te{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new I(0,{});for(let a in e){let c=e[a];c.specification.overridable&&this.overridableProperties.push(a);let f=this.defaultPropertyValues[a]=new R(c,void 0),m=this.defaultTransitionablePropertyValues[a]=new P(c);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=f.possiblyEvaluate(n)}}}function he(t,e){return 256*(t=Ht(Math.floor(t),0,255))+Ht(Math.floor(e),0,255)}pt(q,"DataDrivenProperty"),pt(N,"DataConstantProperty"),pt(Q,"ColorRampProperty");let fe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class de{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ye(t,e=1){let n=0,a=0;return{members:t.map(c=>{let f=fe[c.type].BYTES_PER_ELEMENT,m=n=Ie(n,Math.max(e,f)),y=c.components||1;return a=Math.max(a,f),n+=f*y,{name:c.name,type:c.type,components:y,offset:m}}),size:Ie(n,Math.max(a,e)),alignment:e}}function Ie(t,e){return Math.ceil(t/e)*e}class qe extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.int16[c+0]=n,this.int16[c+1]=a,e}}qe.prototype.bytesPerElement=4,pt(qe,"StructArrayLayout2i4");class Ce extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let f=3*e;return this.int16[f+0]=n,this.int16[f+1]=a,this.int16[f+2]=c,e}}Ce.prototype.bytesPerElement=6,pt(Ce,"StructArrayLayout3i6");class Ve extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c)}emplace(e,n,a,c,f){let m=4*e;return this.int16[m+0]=n,this.int16[m+1]=a,this.int16[m+2]=c,this.int16[m+3]=f,e}}Ve.prototype.bytesPerElement=8,pt(Ve,"StructArrayLayout4i8");class Ae extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,m,y){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,c,f,m,y)}emplace(e,n,a,c,f,m,y,x){let b=6*e,D=12*e,M=3*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.uint8[D+4]=c,this.uint8[D+5]=f,this.uint8[D+6]=m,this.uint8[D+7]=y,this.float32[M+2]=x,e}}Ae.prototype.bytesPerElement=12,pt(Ae,"StructArrayLayout2i4ub1f12");class He extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c)}emplace(e,n,a,c,f){let m=4*e;return this.float32[m+0]=n,this.float32[m+1]=a,this.float32[m+2]=c,this.float32[m+3]=f,e}}He.prototype.bytesPerElement=16,pt(He,"StructArrayLayout4f16");class De extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c,f)}emplace(e,n,a,c,f,m){let y=6*e,x=3*e;return this.uint16[y+0]=n,this.uint16[y+1]=a,this.uint16[y+2]=c,this.uint16[y+3]=f,this.float32[x+2]=m,e}}De.prototype.bytesPerElement=12,pt(De,"StructArrayLayout4ui1f12");class ze extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c)}emplace(e,n,a,c,f){let m=4*e;return this.uint16[m+0]=n,this.uint16[m+1]=a,this.uint16[m+2]=c,this.uint16[m+3]=f,e}}ze.prototype.bytesPerElement=8,pt(ze,"StructArrayLayout4ui8");class Ye extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,f,m)}emplace(e,n,a,c,f,m,y){let x=6*e;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,e}}Ye.prototype.bytesPerElement=12,pt(Ye,"StructArrayLayout6i12");class $e extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,m,y,x,b,D,M,S){let k=this.length;return this.resize(k+1),this.emplace(k,e,n,a,c,f,m,y,x,b,D,M,S)}emplace(e,n,a,c,f,m,y,x,b,D,M,S,k){let L=12*e;return this.int16[L+0]=n,this.int16[L+1]=a,this.int16[L+2]=c,this.int16[L+3]=f,this.uint16[L+4]=m,this.uint16[L+5]=y,this.uint16[L+6]=x,this.uint16[L+7]=b,this.int16[L+8]=D,this.int16[L+9]=M,this.int16[L+10]=S,this.int16[L+11]=k,e}}$e.prototype.bytesPerElement=24,pt($e,"StructArrayLayout4i4ui4i24");class Je extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,f,m)}emplace(e,n,a,c,f,m,y){let x=10*e,b=5*e;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=c,this.float32[b+2]=f,this.float32[b+3]=m,this.float32[b+4]=y,e}}Je.prototype.bytesPerElement=20,pt(Je,"StructArrayLayout3i3f20");class vt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}vt.prototype.bytesPerElement=4,pt(vt,"StructArrayLayout1ul4");class Rt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,m,y,x,b,D,M,S,k){let L=this.length;return this.resize(L+1),this.emplace(L,e,n,a,c,f,m,y,x,b,D,M,S,k)}emplace(e,n,a,c,f,m,y,x,b,D,M,S,k,L){let z=20*e,H=10*e;return this.int16[z+0]=n,this.int16[z+1]=a,this.int16[z+2]=c,this.int16[z+3]=f,this.int16[z+4]=m,this.float32[H+3]=y,this.float32[H+4]=x,this.float32[H+5]=b,this.float32[H+6]=D,this.int16[z+14]=M,this.uint32[H+8]=S,this.uint16[z+18]=k,this.uint16[z+19]=L,e}}Rt.prototype.bytesPerElement=40,pt(Rt,"StructArrayLayout5i4f1i1ul2ui40");class mt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,m,y){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,c,f,m,y)}emplace(e,n,a,c,f,m,y,x){let b=8*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+4]=f,this.int16[b+5]=m,this.int16[b+6]=y,this.int16[b+7]=x,e}}mt.prototype.bytesPerElement=16,pt(mt,"StructArrayLayout3i2i2i16");class Et extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c,f)}emplace(e,n,a,c,f,m){let y=4*e,x=8*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=c,this.int16[x+6]=f,this.int16[x+7]=m,e}}Et.prototype.bytesPerElement=16,pt(Et,"StructArrayLayout2f1f2i16");class Qt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c)}emplace(e,n,a,c,f){let m=12*e,y=3*e;return this.uint8[m+0]=n,this.uint8[m+1]=a,this.float32[y+1]=c,this.float32[y+2]=f,e}}Qt.prototype.bytesPerElement=12,pt(Qt,"StructArrayLayout2ub2f12");class Kt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let f=3*e;return this.float32[f+0]=n,this.float32[f+1]=a,this.float32[f+2]=c,e}}Kt.prototype.bytesPerElement=12,pt(Kt,"StructArrayLayout3f12");class _t extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let f=3*e;return this.uint16[f+0]=n,this.uint16[f+1]=a,this.uint16[f+2]=c,e}}_t.prototype.bytesPerElement=6,pt(_t,"StructArrayLayout3ui6");class In extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,m,y,x,b,D,M,S,k,L,z,H,K,se,J,oe,ue){let le=this.length;return this.resize(le+1),this.emplace(le,e,n,a,c,f,m,y,x,b,D,M,S,k,L,z,H,K,se,J,oe,ue)}emplace(e,n,a,c,f,m,y,x,b,D,M,S,k,L,z,H,K,se,J,oe,ue,le){let Me=30*e,Te=15*e,Fe=60*e;return this.int16[Me+0]=n,this.int16[Me+1]=a,this.int16[Me+2]=c,this.float32[Te+2]=f,this.float32[Te+3]=m,this.uint16[Me+8]=y,this.uint16[Me+9]=x,this.uint32[Te+5]=b,this.uint32[Te+6]=D,this.uint32[Te+7]=M,this.uint16[Me+16]=S,this.uint16[Me+17]=k,this.uint16[Me+18]=L,this.float32[Te+10]=z,this.float32[Te+11]=H,this.uint8[Fe+48]=K,this.uint8[Fe+49]=se,this.uint8[Fe+50]=J,this.uint32[Te+13]=oe,this.int16[Me+28]=ue,this.uint8[Fe+58]=le,e}}In.prototype.bytesPerElement=60,pt(In,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class On extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,m,y,x,b,D,M,S,k,L,z,H,K,se,J,oe,ue,le,Me,Te,Fe,We,Pe,je,Ue,Ge){let Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,e,n,a,c,f,m,y,x,b,D,M,S,k,L,z,H,K,se,J,oe,ue,le,Me,Te,Fe,We,Pe,je,Ue,Ge)}emplace(e,n,a,c,f,m,y,x,b,D,M,S,k,L,z,H,K,se,J,oe,ue,le,Me,Te,Fe,We,Pe,je,Ue,Ge,Qe){let ke=38*e,st=19*e;return this.int16[ke+0]=n,this.int16[ke+1]=a,this.int16[ke+2]=c,this.float32[st+2]=f,this.float32[st+3]=m,this.int16[ke+8]=y,this.int16[ke+9]=x,this.int16[ke+10]=b,this.int16[ke+11]=D,this.int16[ke+12]=M,this.int16[ke+13]=S,this.uint16[ke+14]=k,this.uint16[ke+15]=L,this.uint16[ke+16]=z,this.uint16[ke+17]=H,this.uint16[ke+18]=K,this.uint16[ke+19]=se,this.uint16[ke+20]=J,this.uint16[ke+21]=oe,this.uint16[ke+22]=ue,this.uint16[ke+23]=le,this.uint16[ke+24]=Me,this.uint16[ke+25]=Te,this.uint16[ke+26]=Fe,this.uint16[ke+27]=We,this.uint16[ke+28]=Pe,this.uint32[st+15]=je,this.float32[st+16]=Ue,this.float32[st+17]=Ge,this.float32[st+18]=Qe,e}}On.prototype.bytesPerElement=76,pt(On,"StructArrayLayout3i2f6i15ui1ul3f76");class kn extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}kn.prototype.bytesPerElement=4,pt(kn,"StructArrayLayout1f4");class Ln extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c,f)}emplace(e,n,a,c,f,m){let y=5*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=c,this.float32[y+3]=f,this.float32[y+4]=m,e}}Ln.prototype.bytesPerElement=20,pt(Ln,"StructArrayLayout5f20");class li extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c)}emplace(e,n,a,c,f){let m=6*e;return this.uint32[3*e+0]=n,this.uint16[m+2]=a,this.uint16[m+3]=c,this.uint16[m+4]=f,e}}li.prototype.bytesPerElement=12,pt(li,"StructArrayLayout1ul3ui12");class Vr extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=a,e}}Vr.prototype.bytesPerElement=4,pt(Vr,"StructArrayLayout2ui4");class to extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}to.prototype.bytesPerElement=2,pt(to,"StructArrayLayout1ui2");class ts extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.float32[c+0]=n,this.float32[c+1]=a,e}}ts.prototype.bytesPerElement=8,pt(ts,"StructArrayLayout2f8");class ir extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ir.prototype.size=40;class Fn extends Rt{get(e){return new ir(this,e)}}pt(Fn,"CollisionBoxArray");class yn extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}yn.prototype.size=60;class Cr extends In{get(e){return new yn(this,e)}}pt(Cr,"PlacedSymbolArray");class gi extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}gi.prototype.size=76;class er extends On{get(e){return new gi(this,e)}}pt(er,"SymbolInstanceArray");class Si extends kn{getoffsetX(e){return this.float32[1*e+0]}}pt(Si,"GlyphOffsetArray");class Cu extends qe{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}pt(Cu,"SymbolLineVertexArray");class qa extends de{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qa.prototype.size=12;class Cc extends li{get(e){return new qa(this,e)}}pt(Cc,"FeatureIndexArray");class Ms extends Vr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}pt(Ms,"FillExtrusionCentroidArray");let ua=ye([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Wa=ye([{name:"a_dash",components:4,type:"Uint16"}]);var Tu={exports:{}},Tc={exports:{}};Tc.exports=function(t,e){var n,a,c,f,m,y,x,b;for(a=t.length-(n=3&t.length),c=e,m=3432918353,y=461845907,b=0;b<a;)x=255&t.charCodeAt(b)|(255&t.charCodeAt(++b))<<8|(255&t.charCodeAt(++b))<<16|(255&t.charCodeAt(++b))<<24,++b,c=27492+(65535&(f=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&t.charCodeAt(b+2))<<16;case 2:x^=(255&t.charCodeAt(b+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&t.charCodeAt(b)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var id=Tc.exports,H0={exports:{}};H0.exports=function(t,e){for(var n,a=t.length,c=e^a,f=0;a>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(f)|(255&t.charCodeAt(++f))<<8|(255&t.charCodeAt(++f))<<16|(255&t.charCodeAt(++f))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++f;switch(a){case 3:c^=(255&t.charCodeAt(f+2))<<16;case 2:c^=(255&t.charCodeAt(f+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(f)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var q0=id,ED=H0.exports;Tu.exports=q0,Tu.exports.murmur3=q0,Tu.exports.murmur2=ED;var Pg=Ct(Tu.exports);class Wf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,a,c){this.ids.push(W0(e)),this.positions.push(n,a,c)}getPositions(e){let n=W0(e),a=0,c=this.ids.length-1;for(;a<c;){let m=a+c>>1;this.ids[m]>=n?c=m:a=m+1}let f=[];for(;this.ids[a]===n;)f.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return f}static serialize(e,n){let a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Rg(a,c,0,a.length-1),n&&n.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(e){let n=new Wf;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function W0(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Pg(String(t))}function Rg(t,e,n,a){for(;n<a;){let c=t[n+a>>1],f=n-1,m=a+1;for(;;){do f++;while(t[f]<c);do m--;while(t[m]>c);if(f>=m)break;Zf(t,f,m),Zf(e,3*f,3*m),Zf(e,3*f+1,3*m+1),Zf(e,3*f+2,3*m+2)}m-n<a-m?(Rg(t,e,n,m),n=m+1):(Rg(t,e,m+1,a),a=m)}}function Zf(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}pt(Wf,"FeaturePositionMap");class Za{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Xf extends Za{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Z0 extends Za{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class X0 extends Za{constructor(e){super(e),this.current=Ne.transparent}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let CD=new Float32Array(16),TD=new Float32Array(9),DD=new Float32Array(4);function Og(t){return[he(255*t.r,255*t.g),he(255*t.b,255*t.a)]}class od{constructor(e,n,a){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=a}setUniform(e,n,a,c,f){n.set(e,f,c.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new X0(e):new Xf(e)}}class Du{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,c,f){let m=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;m&&n.set(e,f,m)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Z0(e):new Xf(e)}}class Xa{constructor(e,n,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,a,c,f,m){let y=this.paintVertexArray.length,x=this.expression.evaluate(new I(0),n,{},f,c,m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)}updatePaintArray(e,n,a,c,f){let m=this.expression.evaluate({zoom:0},a,c,void 0,f);this._setPaintValue(e,n,m)}_setPaintValue(e,n,a){if(this.type==="color"){let c=Og(a);for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ss{constructor(e,n,a,c,f,m){this.expression=e,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=c,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,n,a,c,f,m){let y=this.expression.evaluate(new I(this.zoom),n,{},f,c,m),x=this.expression.evaluate(new I(this.zoom+1),n,{},f,c,m),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,y,x)}updatePaintArray(e,n,a,c,f){let m=this.expression.evaluate({zoom:this.zoom},a,c,void 0,f),y=this.expression.evaluate({zoom:this.zoom+1},a,c,void 0,f);this._setPaintValue(e,n,m,y)}_setPaintValue(e,n,a,c){if(this.type==="color"){let f=Og(a),m=Og(c);for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,c,f){let m=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=Ht(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);n.set(e,f,y)}getBinding(e,n){return new Xf(e)}}class Ml{constructor(e,n,a,c,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(a==="array"?Wa:ua).members;for(let m=0;m<n.length;++m);this.paintVertexArray=new c}populatePaintArray(e,n,a){let c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,c,f,m){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,n,a,c){if(!c||!a)return;let f=c[a];if(!f)return;let{tl:m,br:y,pixelRatio:x}=f;for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,m[0],m[1],y[0],y[1],x)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sl{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[];let c=[];for(let f in e.paint._values){if(!a(f))continue;let m=e.paint.get(f);if(!(m instanceof Z&&si(m.property.specification)))continue;let y=MD(f,e.type),x=m.value,b=m.property.specification.type,D=!!m.property.useIntegerZoom,M=f==="line-dasharray"||f.endsWith("pattern"),S=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||S)if(x.kind==="source"||S||M){let k=Y0(f,b,"source");this.binders[f]=M?new Ml(x,y,b,k,e.id):new Xa(x,y,b,k),c.push(`/a_${f}`)}else{let k=Y0(f,b,"composite");this.binders[f]=new Ss(x,y,b,D,n,k),c.push(`/z_${f}`)}else this.binders[f]=M?new Du(x.value,y):new od(x.value,y,b),c.push(`/u_${f}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Xa||n instanceof Ss?n.maxValue:0}populatePaintArrays(e,n,a,c,f,m){for(let y in this.binders){let x=this.binders[y];(x instanceof Xa||x instanceof Ss||x instanceof Ml)&&x.populatePaintArray(e,n,a,c,f,m)}}setConstantPatternPositions(e){for(let n in this.binders){let a=this.binders[n];a instanceof Du&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,c,f,m){let y=!1;for(let x in e){let b=n.getPositions(x);for(let D of b){let M=a.feature(D.index);for(let S in this.binders){let k=this.binders[S];if((k instanceof Xa||k instanceof Ss||k instanceof Ml)&&k.expression.isStateDependent===!0){let L=c.paint.get(S);k.expression=L.value,k.updatePaintArray(D.start,D.end,M,e[x],f,m),y=!0}}}}return y}defines(){let e=[];for(let n in this.binders){let a=this.binders[n];(a instanceof od||a instanceof Du)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof Xa||a instanceof Ss||a instanceof Ml)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof od||a instanceof Du||a instanceof Ss)for(let c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let a in this.binders){let c=this.binders[a];if(c instanceof od||c instanceof Du||c instanceof Ss)for(let f of c.uniformNames)n.push({name:f,property:a,binding:c.getBinding(e,f)})}return n}setUniforms(e,n,a,c,f){for(let{name:m,property:y,binding:x}of a)this.binders[y].setUniform(e,x,f,c.get(y),m)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Xa||n instanceof Ss||n instanceof Ml)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let a=this.binders[n];(a instanceof Xa||a instanceof Ss||a instanceof Ml)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Xa||n instanceof Ss||n instanceof Ml)&&n.destroy()}}}class Dc{constructor(e,n,a=()=>!0){this.programConfigurations={};for(let c of e)this.programConfigurations[c.id]=new Sl(c,n,a);this.needsUpload=!1,this._featureMap=new Wf,this._bufferOffset=0}populatePaintArrays(e,n,a,c,f,m,y){for(let x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,n,c,f,m,y);n.id!==void 0&&this._featureMap.add(n.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,c,f){for(let m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,n,m,c,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let ID={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function MD(t,e){return ID[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let SD={"line-pattern":{source:De,composite:De},"fill-pattern":{source:De,composite:De},"fill-extrusion-pattern":{source:De,composite:De},"line-dasharray":{source:ze,composite:ze}},AD={color:{source:ts,composite:He},number:{source:kn,composite:ts}};function Y0(t,e,n){let a=SD[t];return a&&a[n]||AD[e][n]}pt(od,"ConstantBinder"),pt(Du,"PatternConstantBinder"),pt(Xa,"SourceExpressionBinder"),pt(Ml,"PatternCompositeBinder"),pt(Ss,"CompositeExpressionBinder"),pt(Sl,"ProgramConfiguration",{omit:["_buffers"]}),pt(Dc,"ProgramConfigurationSet");let K0="-transition";class As extends ii{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new X(n.layout)),n.paint)){this._transitionablePaint=new F(n.paint);for(let a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(let a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Y(n.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,a={}){n!=null&&this._validate(Dg,`layers.${this.id}.layout.${e}`,e,n,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return qt(e,K0)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,a={}){if(n!=null&&this._validate(Tg,`layers.${this.id}.paint.${e}`,e,n,a))return!1;if(qt(e,K0))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{let c=this._transitionablePaint._values[e],f=c.value.isDataDriven(),m=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);let y=this._transitionablePaint._values[e].value,x=y.isDataDriven(),b=qt(e,"pattern")||e==="line-dasharray";return x||f||b||this._handleOverridablePaintPropertyUpdate(e,m,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){let e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Xs(e,(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}_validate(e,n,a,c,f={}){return(!f||f.validate!==!1)&&$f(this,e.call(Uf,{key:n,layerType:this.type,objectKey:a,value:c,styleSpec:Oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof Z&&si(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=xu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}let PD=ye([{name:"a_pos",components:2,type:"Int16"}],4),RD=ye([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Tr{constructor(e=[]){this.segments=e}prepareSegment(e,n,a,c){let f=this.segments[this.segments.length-1];return e>Tr.MAX_VERTEX_ARRAY_LENGTH&&Jn(`Max vertices per segment is ${Tr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Tr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},c!==void 0&&(f.sortKey=c),this.segments.push(f)),f}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,c){return new Tr([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}Tr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt(Tr,"SegmentVector");var bt=8192;class Al{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Nn?new Nn(e.lng,e.lat):Nn.convert(e),this}setSouthWest(e){return this._sw=e instanceof Nn?new Nn(e.lng,e.lat):Nn.convert(e),this}extend(e){let n=this._sw,a=this._ne,c,f;if(e instanceof Nn)c=e,f=e;else{if(!(e instanceof Al))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Al.convert(e)):this.extend(Nn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Nn.convert(e)):this;if(c=e._sw,f=e._ne,!c||!f)return this}return n||a?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),a.lng=Math.max(f.lng,a.lng),a.lat=Math.max(f.lat,a.lat)):(this._sw=new Nn(c.lng,c.lat),this._ne=new Nn(f.lng,f.lat)),this}getCenter(){return new Nn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Nn(this.getWest(),this.getNorth())}getSouthEast(){return new Nn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:a}=Nn.convert(e),c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return!e||e instanceof Al?e:new Al(e)}}var Yf=1e-6,no=typeof Float32Array<"u"?Float32Array:Array;function J0(){var t=new no(9);return no!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Q0(t,e,n){var a=e[0],c=e[1],f=e[2],m=e[3],y=e[4],x=e[5],b=e[6],D=e[7],M=e[8],S=n[0],k=n[1],L=n[2],z=n[3],H=n[4],K=n[5],se=n[6],J=n[7],oe=n[8];return t[0]=S*a+k*m+L*b,t[1]=S*c+k*y+L*D,t[2]=S*f+k*x+L*M,t[3]=z*a+H*m+K*b,t[4]=z*c+H*y+K*D,t[5]=z*f+H*x+K*M,t[6]=se*a+J*m+oe*b,t[7]=se*c+J*y+oe*D,t[8]=se*f+J*x+oe*M,t}function Ps(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function kg(t,e){var n=e[0],a=e[1],c=e[2],f=e[3],m=e[4],y=e[5],x=e[6],b=e[7],D=e[8],M=e[9],S=e[10],k=e[11],L=e[12],z=e[13],H=e[14],K=e[15],se=n*y-a*m,J=n*x-c*m,oe=n*b-f*m,ue=a*x-c*y,le=a*b-f*y,Me=c*b-f*x,Te=D*z-M*L,Fe=D*H-S*L,We=D*K-k*L,Pe=M*H-S*z,je=M*K-k*z,Ue=S*K-k*H,Ge=se*Ue-J*je+oe*Pe+ue*We-le*Fe+Me*Te;return Ge?(t[0]=(y*Ue-x*je+b*Pe)*(Ge=1/Ge),t[1]=(c*je-a*Ue-f*Pe)*Ge,t[2]=(z*Me-H*le+K*ue)*Ge,t[3]=(S*le-M*Me-k*ue)*Ge,t[4]=(x*We-m*Ue-b*Fe)*Ge,t[5]=(n*Ue-c*We+f*Fe)*Ge,t[6]=(H*oe-L*Me-K*J)*Ge,t[7]=(D*Me-S*oe+k*J)*Ge,t[8]=(m*je-y*We+b*Te)*Ge,t[9]=(a*We-n*je-f*Te)*Ge,t[10]=(L*le-z*oe+K*se)*Ge,t[11]=(M*oe-D*le-k*se)*Ge,t[12]=(y*Fe-m*Pe-x*Te)*Ge,t[13]=(n*Pe-a*Fe+c*Te)*Ge,t[14]=(z*J-L*ue-H*se)*Ge,t[15]=(D*ue-M*J+S*se)*Ge,t):null}function Ic(t,e,n){var a=e[0],c=e[1],f=e[2],m=e[3],y=e[4],x=e[5],b=e[6],D=e[7],M=e[8],S=e[9],k=e[10],L=e[11],z=e[12],H=e[13],K=e[14],se=e[15],J=n[0],oe=n[1],ue=n[2],le=n[3];return t[0]=J*a+oe*y+ue*M+le*z,t[1]=J*c+oe*x+ue*S+le*H,t[2]=J*f+oe*b+ue*k+le*K,t[3]=J*m+oe*D+ue*L+le*se,t[4]=(J=n[4])*a+(oe=n[5])*y+(ue=n[6])*M+(le=n[7])*z,t[5]=J*c+oe*x+ue*S+le*H,t[6]=J*f+oe*b+ue*k+le*K,t[7]=J*m+oe*D+ue*L+le*se,t[8]=(J=n[8])*a+(oe=n[9])*y+(ue=n[10])*M+(le=n[11])*z,t[9]=J*c+oe*x+ue*S+le*H,t[10]=J*f+oe*b+ue*k+le*K,t[11]=J*m+oe*D+ue*L+le*se,t[12]=(J=n[12])*a+(oe=n[13])*y+(ue=n[14])*M+(le=n[15])*z,t[13]=J*c+oe*x+ue*S+le*H,t[14]=J*f+oe*b+ue*k+le*K,t[15]=J*m+oe*D+ue*L+le*se,t}function sd(t,e,n){var a,c,f,m,y,x,b,D,M,S,k,L,z=n[0],H=n[1],K=n[2];return e===t?(t[12]=e[0]*z+e[4]*H+e[8]*K+e[12],t[13]=e[1]*z+e[5]*H+e[9]*K+e[13],t[14]=e[2]*z+e[6]*H+e[10]*K+e[14],t[15]=e[3]*z+e[7]*H+e[11]*K+e[15]):(c=e[1],f=e[2],m=e[3],y=e[4],x=e[5],b=e[6],D=e[7],M=e[8],S=e[9],k=e[10],L=e[11],t[0]=a=e[0],t[1]=c,t[2]=f,t[3]=m,t[4]=y,t[5]=x,t[6]=b,t[7]=D,t[8]=M,t[9]=S,t[10]=k,t[11]=L,t[12]=a*z+y*H+M*K+e[12],t[13]=c*z+x*H+S*K+e[13],t[14]=f*z+b*H+k*K+e[14],t[15]=m*z+D*H+L*K+e[15]),t}function Mc(t,e,n){var a=n[0],c=n[1],f=n[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Lg(t,e,n){var a=Math.sin(n),c=Math.cos(n),f=e[4],m=e[5],y=e[6],x=e[7],b=e[8],D=e[9],M=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*c+b*a,t[5]=m*c+D*a,t[6]=y*c+M*a,t[7]=x*c+S*a,t[8]=b*c-f*a,t[9]=D*c-m*a,t[10]=M*c-y*a,t[11]=S*c-x*a,t}function Kf(t,e,n){var a=Math.sin(n),c=Math.cos(n),f=e[0],m=e[1],y=e[2],x=e[3],b=e[8],D=e[9],M=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*c-b*a,t[1]=m*c-D*a,t[2]=y*c-M*a,t[3]=x*c-S*a,t[8]=f*a+b*c,t[9]=m*a+D*c,t[10]=y*a+M*c,t[11]=x*a+S*c,t}function ex(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function tx(t,e,n){var a,c,f,m=n[0],y=n[1],x=n[2],b=Math.hypot(m,y,x);return b<Yf?null:(m*=b=1/b,y*=b,x*=b,a=Math.sin(e),c=Math.cos(e),t[0]=m*m*(f=1-c)+c,t[1]=y*m*f+x*a,t[2]=x*m*f-y*a,t[3]=0,t[4]=m*y*f-x*a,t[5]=y*y*f+c,t[6]=x*y*f+m*a,t[7]=0,t[8]=m*x*f+y*a,t[9]=y*x*f-m*a,t[10]=x*x*f+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var OD=Ic;function Fg(){var t=new no(3);return no!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function nx(t){var e=new no(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ad(t){return Math.hypot(t[0],t[1],t[2])}function Iu(t,e,n){var a=new no(3);return a[0]=t,a[1]=e,a[2]=n,a}function Ya(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Ng(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function rx(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ld(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function cd(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Mo(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function ud(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t}function Ai(t,e){var n=e[0],a=e[1],c=e[2],f=n*n+a*a+c*c;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t}function ns(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function zg(t,e,n){var a=e[0],c=e[1],f=e[2],m=n[0],y=n[1],x=n[2];return t[0]=c*x-f*y,t[1]=f*m-a*x,t[2]=a*y-c*m,t}function vr(t,e,n){var a=e[0],c=e[1],f=e[2],m=n[3]*a+n[7]*c+n[11]*f+n[15];return t[0]=(n[0]*a+n[4]*c+n[8]*f+n[12])/(m=m||1),t[1]=(n[1]*a+n[5]*c+n[9]*f+n[13])/m,t[2]=(n[2]*a+n[6]*c+n[10]*f+n[14])/m,t}function ix(t,e,n){var a=n[0],c=n[1],f=n[2],m=e[0],y=e[1],x=e[2],b=c*x-f*y,D=f*m-a*x,M=a*y-c*m,S=c*M-f*D,k=f*b-a*M,L=a*D-c*b,z=2*n[3];return D*=z,M*=z,k*=2,L*=2,t[0]=m+(b*=z)+(S*=2),t[1]=y+D+k,t[2]=x+M+L,t}var hd,Rs=Ng,kD=rx,LD=ad;function ox(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function sx(t,e){var n=e[0],a=e[1],c=e[2],f=e[3],m=n*n+a*a+c*c+f*f;return m>0&&(m=1/Math.sqrt(m)),t[0]=n*m,t[1]=a*m,t[2]=c*m,t[3]=f*m,t}function Sc(t,e,n){var a=e[0],c=e[1],f=e[2],m=e[3];return t[0]=n[0]*a+n[4]*c+n[8]*f+n[12]*m,t[1]=n[1]*a+n[5]*c+n[9]*f+n[13]*m,t[2]=n[2]*a+n[6]*c+n[10]*f+n[14]*m,t[3]=n[3]*a+n[7]*c+n[11]*f+n[15]*m,t}function ax(){var t=new no(4);return no!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function lx(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function cx(t,e,n){n*=.5;var a=e[0],c=e[1],f=e[2],m=e[3],y=Math.sin(n),x=Math.cos(n);return t[0]=a*x+m*y,t[1]=c*x+f*y,t[2]=f*x-c*y,t[3]=m*x-a*y,t}function ux(t,e,n){n*=.5;var a=e[0],c=e[1],f=e[2],m=e[3],y=Math.sin(n),x=Math.cos(n);return t[0]=a*x-f*y,t[1]=c*x+m*y,t[2]=f*x+a*y,t[3]=m*x-c*y,t}Fg(),hd=new no(4),no!=Float32Array&&(hd[0]=0,hd[1]=0,hd[2]=0,hd[3]=0);var FD=sx;Fg(),Iu(1,0,0),Iu(0,1,0),ax(),ax(),J0();let ND=ye([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:hx}=ND,dx=ye([{name:"a_pos_3",components:3,type:"Int16"}]);var dd=ye([{name:"a_pos",type:"Int16",components:2}]);class Bg{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){let c=ns(n,this.dir);if(Math.abs(c)<1e-6)return!1;let f=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return a[0]=this.pos[0]+this.dir[0]*f,a[1]=this.pos[1]+this.dir[1]*f,a[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,n,a){if(function(k,L){var z=k[0],H=k[1],K=k[2],se=L[0],J=L[1],oe=L[2];return Math.abs(z-se)<=Yf*Math.max(1,Math.abs(z),Math.abs(se))&&Math.abs(H-J)<=Yf*Math.max(1,Math.abs(H),Math.abs(J))&&Math.abs(K-oe)<=Yf*Math.max(1,Math.abs(K),Math.abs(oe))}(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;let[c,f,m]=this.dir,y=this.pos[0]-e[0],x=this.pos[1]-e[1],b=this.pos[2]-e[2],D=c*c+f*f+m*m,M=2*(y*c+x*f+b*m),S=M*M-4*D*(y*y+x*x+b*b-n*n);if(S<0){let k=Math.max(-M/2,0),L=y+c*k,z=x+f*k,H=b+m*k,K=Math.hypot(L,z,H);return a[0]=L*n/K,a[1]=z*n/K,a[2]=H*n/K,!1}{let k=(-M-Math.sqrt(S))/(2*D);if(k<0){let L=Math.hypot(y,x,b);return a[0]=y*n/L,a[1]=x*n/L,a[2]=b*n/L,!1}return a[0]=y+c*k,a[1]=x+f*k,a[2]=b+m*k,!0}}}class Vg{constructor(e,n,a,c,f){this.TL=e,this.TR=n,this.BR=a,this.BL=c,this.horizon=f}static fromInvProjectionMatrix(e,n,a){let c=[-1,1,1],f=[1,1,1],m=[1,-1,1],y=[-1,-1,1],x=vr(c,c,e),b=vr(f,f,e),D=vr(m,m,e),M=vr(y,y,e);return new Vg(x,b,D,M,n/a)}}class jg{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,a,c){let f=Math.pow(2,a),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{let b=Sc([],x,e),D=1/b[3]/n*f;return function(M,S,k){return M[0]=S[0]*k[0],M[1]=S[1]*k[1],M[2]=S[2]*k[2],M[3]=S[3]*k[3],M}(b,b,[D,D,c?1/b[3]:D,D])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{let b=Ai([],zg([],Rs([],m[x[0]],m[x[1]]),Rs([],m[x[2]],m[x[1]]))),D=-ns(b,m[x[1]]);return b.concat(D)});return new jg(m,y)}}class Pi{static fromPoints(e){let n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let c of e)ld(n,n,c),cd(a,a,c);return new Pi(n,a)}static applyTransform(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)vr(a[c],a[c],n);return Pi.fromPoints(a)}constructor(e,n){this.min=e,this.max=n,this.center=Mo([],Ya([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],a=nx(this.min),c=nx(this.max);for(let f=0;f<n.length;f++)a[f]=n[f]?this.min[f]:this.center[f],c[f]=n[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new Pi(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){let n=this.getCorners(),a=!0;for(let c=0;c<e.planes.length;c++){let f=e.planes[c],m=0;for(let y=0;y<n.length;y++)m+=ns(f,n[y])+f[3]>=0;if(m===0)return 0;m!==n.length&&(a=!1)}if(a)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){let x=e.points[y][c]-this.min[c];f=Math.min(f,x),m=Math.max(m,x)}if(m<0||f>this.max[c]-this.min[c])return 0}return 1}}let Ug=5,fx=6,ha=bt/Math.PI/2,zD=16383,Ac=64,fd=[Ac,32,16],rs=-ha,is=ha,BD=[new Pi([rs,rs,rs],[is,is,is]),new Pi([rs,rs,rs],[0,0,is]),new Pi([0,rs,rs],[is,0,is]),new Pi([rs,0,rs],[0,is,is]),new Pi([0,0,rs],[is,is,is])];function Jf(t){return t*ha/gd}function px(t,e,n,a=!0){let c=Mo([],t._camera.position,t.worldSize),f=[e,n,1,1];Sc(f,f,t.pixelMatrixInverse),ox(f,f,1/f[3]);let m=Ai([],Rs([],f,c)),y=t.globeMatrix,x=[y[12],y[13],y[14]],b=Rs([],x,c),D=ad(b),M=Ai([],b),S=t.worldSize/(2*Math.PI),k=ns(M,m),L=Math.asin(S/D);if(L<Math.acos(k)){if(!a)return null;let We=[],Pe=[];Mo(We,m,D/k),Ai(Pe,Rs(Pe,We,b)),Ai(m,Ya(m,b,Mo(m,Pe,Math.tan(L)*D)))}let z=[];new Bg(c,m).closestPointOnSphere(x,S,z);let H=Ai([],fo(y,0)),K=Ai([],fo(y,1)),se=Ai([],fo(y,2)),J=ns(H,z),oe=ns(K,z),ue=ns(se,z),le=Pr(Math.asin(-oe/S)),Me=Pr(Math.atan2(J,ue));Me=t.center.lng+function(We,Pe){let je=(Pe-We+180)%360-180;return je<-180?je+360:je}(t.center.lng,Me);let Te=fa(Me),Fe=Ht(pa(le),0,1);return new Pu(Te,Fe)}class VD{constructor(e,n,a){this.a=Rs([],e,a),this.b=Rs([],n,a),this.center=a;let c=Ai([],this.a),f=Ai([],this.b);this.angle=Math.acos(ns(c,f))}}function $g(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(a,c,f,m){let y=Math.sin(f);return a*(Math.sin((1-m)*f)/y)+c*(Math.sin(m*f)/y)}(t.a[e],t.b[e],t.angle,Ht(n,0,1))+t.center[e]}function da(t){if(t.z<=1)return BD[t.z+2*t.y+t.x];let e=Gg(Qf(t));return Pi.fromPoints(e)}function Pc(t,e,n){return Mo(t,t,1-n),ud(t,t,e,n)}function mx(t,e){let n=Au(e.zoom);if(n===0)return da(t);let a=Qf(t),c=Gg(a),f=fa(a.getWest())*e.worldSize,m=fa(a.getEast())*e.worldSize,y=pa(a.getNorth())*e.worldSize,x=pa(a.getSouth())*e.worldSize,b=[f,y,0],D=[m,y,0],M=[f,x,0],S=[m,x,0],k=kg([],e.globeMatrix);return vr(b,b,k),vr(D,D,k),vr(M,M,k),vr(S,S,k),c[0]=Pc(c[0],M,n),c[1]=Pc(c[1],S,n),c[2]=Pc(c[2],D,n),c[3]=Pc(c[3],b,n),Pi.fromPoints(c)}function gx(t,e,n){for(let a of t)vr(a,a,e),Mo(a,a,n)}function jD(t,e,n){let a=e/t.worldSize,c=t.globeMatrix;if(n.z<=1){let Te=da(n).getCorners();return gx(Te,c,a),Pi.fromPoints(Te)}let f=Qf(n),m=Gg(f);gx(m,c,a);let y=Number.MAX_VALUE,x=[-y,-y,-y],b=[y,y,y];if(f.contains(t.center)){for(let We of m)ld(b,b,We),cd(x,x,We);x[2]=0;let Te=t.point,Fe=[Te.x*a,Te.y*a,0];return ld(b,b,Fe),cd(x,x,Fe),new Pi(b,x)}let D=[c[12]*a,c[13]*a,c[14]*a],M=f.getCenter(),S=Ht(t.center.lat,-ui,ui),k=Ht(M.lat,-ui,ui),L=fa(t.center.lng),z=pa(S),H=L-fa(M.lng),K=z-pa(k);H>.5?H-=1:H<-.5&&(H+=1);let se=0;Math.abs(H)>Math.abs(K)?se=H>=0?1:3:(se=K>=0?0:2,ud(D,D,[c[4]*a,c[5]*a,c[6]*a],-Math.sin(At(K>=0?f.getSouth():f.getNorth()))*ha));let J=m[se],oe=m[(se+1)%4],ue=new VD(J,oe,D),le=[$g(ue,0)||J[0],$g(ue,1)||J[1],$g(ue,2)||J[2]],Me=Au(t.zoom);if(Me>0){let Te=function({x:We,y:Pe,z:je},Ue,Ge,Qe,ke){let st=1/(1<<je),gt=We*st,lt=gt+st,Nt=Pe*st,et=Nt+st,xt=0,zt=(gt+lt)/2-Qe;return zt>.5?xt=-1:zt<-.5&&(xt=1),gt=((gt+xt)*Ue-(Qe*=Ue))*Ge+Qe,lt=((lt+xt)*Ue-Qe)*Ge+Qe,Nt=(Nt*Ue-(ke*=Ue))*Ge+ke,et=(et*Ue-ke)*Ge+ke,[[gt,et,0],[lt,et,0],[lt,Nt,0],[gt,Nt,0]]}(n,e,t._pixelsPerMercatorPixel,L,z);for(let We=0;We<m.length;We++)Pc(m[We],Te[We],Me);let Fe=Ya([],Te[se],Te[(se+1)%4]);Mo(Fe,Fe,.5),Pc(le,Fe,Me)}for(let Te of m)ld(b,b,Te),cd(x,x,Te);return b[2]=Math.min(J[2],oe[2]),ld(b,b,le),cd(x,x,le),new Pi(b,x)}function Qf({x:t,y:e,z:n}){let a=1/(1<<n),c=new Nn(So(t*a),ci((e+1)*a)),f=new Nn(So((t+1)*a),ci(e*a));return new Al(c,f)}function Gg(t){let e=At(t.getNorth()),n=At(t.getSouth()),a=Math.cos(e),c=Math.cos(n),f=Math.sin(e),m=Math.sin(n),y=t.getWest(),x=t.getEast();return[Mu(c,m,y),Mu(c,m,x),Mu(a,f,x),Mu(a,f,y)]}function Mu(t,e,n,a=ha){return n=At(n),[t*Math.sin(n)*a,-e*a,t*Math.cos(n)*a]}function Su(t,e,n){return Mu(Math.cos(At(t)),Math.sin(At(t)),e,n)}function pd(t,e,n,a){let c=1<<n.z,f=(t/bt+n.x)/c;return Su(ci((e/bt+n.y)/c),So(f),a)}function ep({min:t,max:e}){return zD/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let _x=new Float64Array(16);function md(t){let e=ep(t),n=ex(_x,[e,e,e]);return sd(n,n,((a=[])[0]=-(c=t.min)[0],a[1]=-c[1],a[2]=-c[2],a));var a,c}function Hg(t){let e=(a=t.min,(n=_x)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=a[0],n[13]=a[1],n[14]=a[2],n[15]=1,n);var n,a;let c=1/ep(t);return Mc(e,e,[c,c,c])}function yx(t,e,n,a,c){let f=function(x){let b=bt/(2*Math.PI);return x/(2*Math.PI)/b}(n),m=[t,e,-n/(2*Math.PI)],y=Ps(new Float64Array(16));return sd(y,y,m),Mc(y,y,[f,f,f]),Lg(y,y,At(-c)),Kf(y,y,At(-a)),y}function Au(t){return Bo(Ug,fx,t)}function vx(t,e){let n=Su(e.lat,e.lng),a=function(L){let z=Su(L._center.lat,L._center.lng),H=zg([],Iu(0,1,0),z),K=tx([],-L.angle,z);H=vr(H,H,K),tx(K,-L._pitch,H);let se=Ai([],z);return Mo(se,se,Jf(L.cameraToCenterDistance/L.pixelsPerMeter)),vr(se,se,K),Ya([],z,se)}(t);return m=(c=Ng([],a,n))[0],y=c[1],x=c[2],b=(f=n)[0],D=f[1],M=f[2],k=(S=Math.sqrt(m*m+y*y+x*x)*Math.sqrt(b*b+D*D+M*M))&&ns(c,f)/S,Math.acos(Math.min(Math.max(k,-1),1));var c,f,m,y,x,b,D,M,S,k}function qg(t,e){return vx(t,e)>Math.PI/2*1.01}let xx=At(85),UD=Math.cos(xx),$D=Math.sin(xx),gd=63710088e-1,bx=2*Math.PI*gd;class Pl{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Pl(mr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,a=this.lat*n,c=e.lat*n,f=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return gd*Math.acos(Math.min(f,1))}toBounds(e=0){let n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new Al(new Pl(this.lng-a,this.lat-n),new Pl(this.lng+a,this.lat+n))}toEcef(e){let n=Jf(e);return Su(this.lat,this.lng,ha+n)}static convert(e){if(e instanceof Pl)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Pl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Pl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Nn=Pl;function Wg(t){return bx*Math.cos(t*Math.PI/180)}function fa(t){return(180+t)/360}function pa(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Os(t,e){return t/Wg(e)}function So(t){return 360*t-180}function ci(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function wx(t,e){return t*Wg(ci(e))}let ui=85.051129;function Ex(t){return 1/Math.cos(t*Math.PI/180)}class Pu{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){let a=Nn.convert(e);return new Pu(fa(a.lng),pa(a.lat),Os(n,a.lat))}toLngLat(){return new Nn(So(this.x),ci(this.y))}toAltitude(){return wx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/bx*Ex(ci(this.y))}}function Zg(t,e,n,a,c,f,m,y,x){let b=(e+a)/2,D=(n+c)/2,M=new rt(b,D);y(M),function(S,k,L,z,H,K){let se=L-H,J=z-K;return Math.abs((z-k)*se-(L-S)*J)/Math.hypot(se,J)}(M.x,M.y,f.x,f.y,m.x,m.y)>=x?(Zg(t,e,n,b,D,f,M,y,x),Zg(t,b,D,a,c,M,m,y,x)):t.push(m)}function Cx(t,e,n){let a=t[0],c=a.x,f=a.y;e(a);let m=[a];for(let y=1;y<t.length;y++){let x=t[y],{x:b,y:D}=x;e(x),Zg(m,c,f,b,D,a,x,e,n),c=b,f=D,a=x}return m}function Xg(t,e,n,a){if(a(e,n)){let c=e.add(n)._mult(.5);Xg(t,e,c,a),Xg(t,c,n,a)}else t.push(n)}function GD(t,e){let n=t[0],a=[n];for(let c=1;c<t.length;c++){let f=t[c];Xg(a,n,f,e),n=f}return a}let Yg=Math.pow(2,14)-1,Tx=-Yg-1;function HD(t,e){let n=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=Ht(n,Tx,Yg),t.y=Ht(a,Tx,Yg),(n<t.x||n>t.x+1||a<t.y||a>t.y+1)&&Jn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ka(t,e,n){let a=t.loadGeometry(),c=t.extent,f=bt/c;if(e&&n&&n.projection.isReprojectedInTileSpace){let m=1<<e.z,{scale:y,x,y:b,projection:D}=n,M=S=>{let k=So((e.x+S.x/c)/m),L=ci((e.y+S.y/c)/m),z=D.project(k,L);S.x=(z.x*y-x)*c,S.y=(z.y*y-b)*c};for(let S=0;S<a.length;S++)if(t.type!==1)a[S]=Cx(a[S],M,1);else{let k=[];for(let L of a[S])L.x<0||L.x>=c||L.y<0||L.y>=c||(M(L),k.push(L));a[S]=k}}for(let m of a)for(let y of m)HD(y,f);return a}function Rc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ka(t):[]}}function tp(t,e,n,a,c){t.emplaceBack(2*e+(a+1)/2,2*n+(c+1)/2)}function np(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Kg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new qe,this.indexArray=new _t,this.segments=new Tr,this.programConfigurations=new Dc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a,c){let f=this.layers[0],m=[],y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(let{feature:b,id:D,index:M,sourceLayerIndex:S}of e){let k=this.layers[0]._featureFilter.needGeometry,L=Rc(b,k);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),L,a))continue;let z=y?y.evaluate(L,{},a):void 0,H={id:D,properties:b.properties,type:b.type,sourceLayerIndex:S,index:M,geometry:k?L.geometry:Ka(b,a,c),patterns:{},sortKey:z};m.push(H)}y&&m.sort((b,D)=>b.sortKey-D.sortKey);let x=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new Ye,x=c.projection);for(let b of m){let{geometry:D,index:M,sourceLayerIndex:S}=b,k=e[M].feature;this.addFeature(b,D,M,n.availableImages,a,x),n.featureIndex.insert(k,D,M,S,this.index)}}update(e,n,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,PD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,RD.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,c,f,m){for(let y of n)for(let x of y){let b=x.x,D=x.y;if(b<0||b>=bt||D<0||D>=bt)continue;if(m){let k=m.projectTilePoint(b,D,f),L=m.upVector(f,b,D),z=this.globeExtVertexArray;np(z,k,L),np(z,k,L),np(z,k,L),np(z,k,L)}let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=M.vertexLength;tp(this.layoutVertexArray,b,D,-1,-1),tp(this.layoutVertexArray,b,D,1,-1),tp(this.layoutVertexArray,b,D,1,1),tp(this.layoutVertexArray,b,D,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+2,S+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,f)}}function Dx(t,e){for(let n=0;n<t.length;n++)if(Oc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Oc(t,e[n]))return!0;return!!Jg(t,e)}function qD(t,e,n){return!!Oc(t,e)||!!Qg(e,t,n)}function Ix(t,e){if(t.length===1)return Sx(e,t[0]);for(let n=0;n<e.length;n++){let a=e[n];for(let c=0;c<a.length;c++)if(Oc(t,a[c]))return!0}for(let n=0;n<t.length;n++)if(Sx(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Jg(t,e[n]))return!0;return!1}function WD(t,e,n){if(t.length>1){if(Jg(t,e))return!0;for(let a=0;a<e.length;a++)if(Qg(e[a],t,n))return!0}for(let a=0;a<t.length;a++)if(Qg(t[a],e,n))return!0;return!1}function Jg(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let a=t[n],c=t[n+1];for(let f=0;f<e.length-1;f++)if(ZD(a,c,e[f],e[f+1]))return!0}return!1}function ZD(t,e,n,a){return cn(t,n,a)!==cn(e,n,a)&&cn(t,e,n)!==cn(t,e,a)}function Qg(t,e,n){let a=n*n;if(e.length===1)return t.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(Mx(t,e[c-1],e[c])<a)return!0;return!1}function Mx(t,e,n){let a=e.distSqr(n);if(a===0)return t.distSqr(e);let c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/a;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function Sx(t,e){let n,a,c,f=!1;for(let m=0;m<t.length;m++){n=t[m];for(let y=0,x=n.length-1;y<n.length;x=y++)a=n[y],c=n[x],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(f=!f)}return f}function Oc(t,e){let n=!1;for(let a=0,c=t.length-1;a<t.length;c=a++){let f=t[a],m=t[c];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(n=!n)}return n}function Ax(t,e,n,a,c){for(let m of t)if(e<=m.x&&n<=m.y&&a>=m.x&&c>=m.y)return!0;let f=[new rt(e,n),new rt(e,c),new rt(a,c),new rt(a,n)];if(t.length>2){for(let m of f)if(Oc(t,m))return!0}for(let m=0;m<t.length-1;m++)if(XD(t[m],t[m+1],f))return!0;return!1}function XD(t,e,n){let a=n[0],c=n[2];if(t.x<a.x&&e.x<a.x||t.x>c.x&&e.x>c.x||t.y<a.y&&e.y<a.y||t.y>c.y&&e.y>c.y)return!1;let f=cn(t,e,n[0]);return f!==cn(t,e,n[1])||f!==cn(t,e,n[2])||f!==cn(t,e,n[3])}function Ru(t,e,n){let a=e.paint.get(t).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(t)}function rp(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Px(t,e,n,a,c){if(!e[0]&&!e[1])return t;let f=rt.convert(e)._mult(c);n==="viewport"&&f._rotate(-a);let m=[];for(let y=0;y<t.length;y++)m.push(t[y].sub(f));return m}function Rx(t,e,n,a){let c=rt.convert(t)._mult(a);return e==="viewport"&&c._rotate(-n),c}pt(Kg,"CircleBucket",{omit:["layers"]});let YD=new te({"circle-sort-key":new q(Oe.layout_circle["circle-sort-key"])});var KD={paint:new te({"circle-radius":new q(Oe.paint_circle["circle-radius"]),"circle-color":new q(Oe.paint_circle["circle-color"]),"circle-blur":new q(Oe.paint_circle["circle-blur"]),"circle-opacity":new q(Oe.paint_circle["circle-opacity"]),"circle-translate":new N(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new N(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new N(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new N(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new q(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new q(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new q(Oe.paint_circle["circle-stroke-opacity"])}),layout:YD};function Ox(t,e,n,a,c,f,m,y,x){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(x*=t.pixelToTileUnitsFactor);let b=t.tileID.canonical,D=n.projection.upVectorScale(b,n.center.lat,n.worldSize).metersToTile;for(let M of e)for(let S of M){let k=S.add(y),L=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(k.x,k.y,!0):0,z=n.projection.projectTilePoint(k.x,k.y,b);if(L>0){let J=n.projection.upVector(b,k.x,k.y);z.x+=J[0]*D*L,z.y+=J[1]*D*L,z.z+=J[2]*D*L}let H=f?k:JD(z.x,z.y,z.z,a),K=f?t.tilespaceRays.map(J=>eI(J,L)):t.queryGeometry.screenGeometry,se=Sc([],[z.x,z.y,z.z,1],a);if(!m&&f?x*=se[3]/n.cameraToCenterDistance:m&&!f&&(x*=n.cameraToCenterDistance/se[3]),f){let J=ci((S.y/bt+b.y)/(1<<b.z));x/=n.projection.pixelsPerMeter(J,1)/Os(1,J)}if(qD(K,H,x))return!0}return!1}function JD(t,e,n,a){let c=Sc([],[t,e,n,1],a);return new rt(c[0]/c[3],c[1]/c[3])}let kx=Iu(0,0,0),QD=Iu(0,0,1);function eI(t,e){let n=Fg();return kx[2]=e,t.intersectsPlane(kx,QD,n),new rt(n[0],n[1])}class Lx extends Kg{}function Fx(t,{width:e,height:n},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*a);return t.width=e,t.height=n,t.data=c,t}function Nx(t,e,n){let{width:a,height:c}=e;a===t.width&&c===t.height||(e_(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,c)},n),t.width=a,t.height=c,t.data=e.data)}function e_(t,e,n,a,c,f){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let m=t.data,y=e.data;for(let x=0;x<c.height;x++){let b=((n.y+x)*t.width+n.x)*f,D=((a.y+x)*e.width+a.x)*f;for(let M=0;M<c.width*f;M++)y[D+M]=m[b+M]}return e}pt(Lx,"HeatmapBucket",{omit:["layers"]});class Ja{constructor(e,n){Fx(this,e,1,n)}resize(e){Nx(this,new Ja(e),1)}clone(){return new Ja({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,f){e_(e,n,a,c,f,1)}}class ro{constructor(e,n){Fx(this,e,4,n)}resize(e){Nx(this,new ro(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ro({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,f){e_(e,n,a,c,f,4)}}pt(Ja,"AlphaImage"),pt(ro,"RGBAImage");var tI={paint:new te({"heatmap-radius":new q(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new q(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new N(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Q(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new N(Oe.paint_heatmap["heatmap-opacity"])})};function t_(t){let e={},n=t.resolution||256,a=t.clips?t.clips.length:1,c=t.image||new ro({width:n,height:a}),f=(m,y,x)=>{e[t.evaluationKey]=x;let b=t.expression.evaluate(e);c.data[m+y+0]=Math.floor(255*b.r/b.a),c.data[m+y+1]=Math.floor(255*b.g/b.a),c.data[m+y+2]=Math.floor(255*b.b/b.a),c.data[m+y+3]=Math.floor(255*b.a)};if(t.clips)for(let m=0,y=0;m<a;++m,y+=4*n)for(let x=0,b=0;x<n;x++,b+=4){let D=x/(n-1),{start:M,end:S}=t.clips[m];f(y,b,M*(1-D)+S*D)}else for(let m=0,y=0;m<n;m++,y+=4)f(0,y,m/(n-1));return c}var nI={paint:new te({"hillshade-illumination-direction":new N(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new N(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new N(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new N(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new N(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new N(Oe.paint_hillshade["hillshade-accent-color"])})};let rI=ye([{name:"a_pos",components:2,type:"Int16"}],4),{members:iI}=rI;var n_={exports:{}};function ip(t,e,n){n=n||2;var a,c,f,m,y,x,b,D=e&&e.length,M=D?e[0]*n:t.length,S=zx(t,0,M,n,!0),k=[];if(!S||S.next===S.prev)return k;if(D&&(S=function(z,H,K,se){var J,oe,ue,le=[];for(J=0,oe=H.length;J<oe;J++)(ue=zx(z,H[J]*se,J<oe-1?H[J+1]*se:z.length,se,!1))===ue.next&&(ue.steiner=!0),le.push(dI(ue));for(le.sort(cI),J=0;J<le.length;J++)K=uI(le[J],K);return K}(t,e,S,n)),t.length>80*n){a=f=t[0],c=m=t[1];for(var L=n;L<M;L+=n)(y=t[L])<a&&(a=y),(x=t[L+1])<c&&(c=x),y>f&&(f=y),x>m&&(m=x);b=(b=Math.max(f-a,m-c))!==0?32767/b:0}return _d(S,k,n,a,c,b,0),k}function zx(t,e,n,a,c){var f,m;if(c===o_(t,e,n,a)>0)for(f=e;f<n;f+=a)m=jx(f,t[f],t[f+1],m);else for(f=n-a;f>=e;f-=a)m=jx(f,t[f],t[f+1],m);return m&&op(m,m.next)&&(vd(m),m=m.next),m}function kc(t,e){if(!t)return t;e||(e=t);var n,a=t;do if(n=!1,a.steiner||!op(a,a.next)&&Dr(a.prev,a,a.next)!==0)a=a.next;else{if(vd(a),(a=e=a.prev)===a.next)break;n=!0}while(n||a!==e);return e}function _d(t,e,n,a,c,f,m){if(t){!m&&f&&function(D,M,S,k){var L=D;do L.z===0&&(L.z=r_(L.x,L.y,M,S,k)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==D);L.prevZ.nextZ=null,L.prevZ=null,function(z){var H,K,se,J,oe,ue,le,Me,Te=1;do{for(K=z,z=null,oe=null,ue=0;K;){for(ue++,se=K,le=0,H=0;H<Te&&(le++,se=se.nextZ);H++);for(Me=Te;le>0||Me>0&&se;)le!==0&&(Me===0||!se||K.z<=se.z)?(J=K,K=K.nextZ,le--):(J=se,se=se.nextZ,Me--),oe?oe.nextZ=J:z=J,J.prevZ=oe,oe=J;K=se}oe.nextZ=null,Te*=2}while(ue>1)}(L)}(t,a,c,f);for(var y,x,b=t;t.prev!==t.next;)if(y=t.prev,x=t.next,f?sI(t,a,c,f):oI(t))e.push(y.i/n|0),e.push(t.i/n|0),e.push(x.i/n|0),vd(t),t=x.next,b=x.next;else if((t=x)===b){m?m===1?_d(t=aI(kc(t),e,n),e,n,a,c,f,2):m===2&&lI(t,e,n,a,c,f):_d(kc(t),e,n,a,c,f,1);break}}}function oI(t){var e=t.prev,n=t,a=t.next;if(Dr(e,n,a)>=0)return!1;for(var c=e.x,f=n.x,m=a.x,y=e.y,x=n.y,b=a.y,D=c<f?c<m?c:m:f<m?f:m,M=y<x?y<b?y:b:x<b?x:b,S=c>f?c>m?c:m:f>m?f:m,k=y>x?y>b?y:b:x>b?x:b,L=a.next;L!==e;){if(L.x>=D&&L.x<=S&&L.y>=M&&L.y<=k&&Ou(c,y,f,x,m,b,L.x,L.y)&&Dr(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function sI(t,e,n,a){var c=t.prev,f=t,m=t.next;if(Dr(c,f,m)>=0)return!1;for(var y=c.x,x=f.x,b=m.x,D=c.y,M=f.y,S=m.y,k=y<x?y<b?y:b:x<b?x:b,L=D<M?D<S?D:S:M<S?M:S,z=y>x?y>b?y:b:x>b?x:b,H=D>M?D>S?D:S:M>S?M:S,K=r_(k,L,e,n,a),se=r_(z,H,e,n,a),J=t.prevZ,oe=t.nextZ;J&&J.z>=K&&oe&&oe.z<=se;){if(J.x>=k&&J.x<=z&&J.y>=L&&J.y<=H&&J!==c&&J!==m&&Ou(y,D,x,M,b,S,J.x,J.y)&&Dr(J.prev,J,J.next)>=0||(J=J.prevZ,oe.x>=k&&oe.x<=z&&oe.y>=L&&oe.y<=H&&oe!==c&&oe!==m&&Ou(y,D,x,M,b,S,oe.x,oe.y)&&Dr(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;J&&J.z>=K;){if(J.x>=k&&J.x<=z&&J.y>=L&&J.y<=H&&J!==c&&J!==m&&Ou(y,D,x,M,b,S,J.x,J.y)&&Dr(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;oe&&oe.z<=se;){if(oe.x>=k&&oe.x<=z&&oe.y>=L&&oe.y<=H&&oe!==c&&oe!==m&&Ou(y,D,x,M,b,S,oe.x,oe.y)&&Dr(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function aI(t,e,n){var a=t;do{var c=a.prev,f=a.next.next;!op(c,f)&&Bx(c,a,a.next,f)&&yd(c,f)&&yd(f,c)&&(e.push(c.i/n|0),e.push(a.i/n|0),e.push(f.i/n|0),vd(a),vd(a.next),a=t=f),a=a.next}while(a!==t);return kc(a)}function lI(t,e,n,a,c,f){var m=t;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&fI(m,y)){var x=Vx(m,y);return m=kc(m,m.next),x=kc(x,x.next),_d(m,e,n,a,c,f,0),void _d(x,e,n,a,c,f,0)}y=y.next}m=m.next}while(m!==t)}function cI(t,e){return t.x-e.x}function uI(t,e){var n=function(c,f){var m,y=f,x=c.x,b=c.y,D=-1/0;do{if(b<=y.y&&b>=y.next.y&&y.next.y!==y.y){var M=y.x+(b-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(M<=x&&M>D&&(D=M,m=y.x<y.next.x?y:y.next,M===x))return m}y=y.next}while(y!==f);if(!m)return null;var S,k=m,L=m.x,z=m.y,H=1/0;y=m;do x>=y.x&&y.x>=L&&x!==y.x&&Ou(b<z?x:D,b,L,z,b<z?D:x,b,y.x,y.y)&&(S=Math.abs(b-y.y)/(x-y.x),yd(y,c)&&(S<H||S===H&&(y.x>m.x||y.x===m.x&&hI(m,y)))&&(m=y,H=S)),y=y.next;while(y!==k);return m}(t,e);if(!n)return e;var a=Vx(n,t);return kc(a,a.next),kc(n,n.next)}function hI(t,e){return Dr(t.prev,t,e.prev)<0&&Dr(e.next,t,t.next)<0}function r_(t,e,n,a,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function dI(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Ou(t,e,n,a,c,f,m,y){return(c-m)*(e-y)>=(t-m)*(f-y)&&(t-m)*(a-y)>=(n-m)*(e-y)&&(n-m)*(f-y)>=(c-m)*(a-y)}function fI(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,a){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==a.i&&c.next.i!==a.i&&Bx(c,c.next,n,a))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(yd(t,e)&&yd(e,t)&&function(n,a){var c=n,f=!1,m=(n.x+a.x)/2,y=(n.y+a.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&m<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==n);return f}(t,e)&&(Dr(t.prev,t,e.prev)||Dr(t,e.prev,e))||op(t,e)&&Dr(t.prev,t,t.next)>0&&Dr(e.prev,e,e.next)>0)}function Dr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function op(t,e){return t.x===e.x&&t.y===e.y}function Bx(t,e,n,a){var c=ap(Dr(t,e,n)),f=ap(Dr(t,e,a)),m=ap(Dr(n,a,t)),y=ap(Dr(n,a,e));return c!==f&&m!==y||!(c!==0||!sp(t,n,e))||!(f!==0||!sp(t,a,e))||!(m!==0||!sp(n,t,a))||!(y!==0||!sp(n,e,a))}function sp(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function ap(t){return t>0?1:t<0?-1:0}function yd(t,e){return Dr(t.prev,t,t.next)<0?Dr(t,e,t.next)>=0&&Dr(t,t.prev,e)>=0:Dr(t,e,t.prev)<0||Dr(t,t.next,e)<0}function Vx(t,e){var n=new i_(t.i,t.x,t.y),a=new i_(e.i,e.x,e.y),c=t.next,f=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,a.next=n,n.prev=a,f.next=a,a.prev=f,a}function jx(t,e,n,a){var c=new i_(t,e,n);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function vd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function i_(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function o_(t,e,n,a){for(var c=0,f=e,m=n-a;f<n;f+=a)c+=(t[m]-t[f])*(t[f+1]+t[m+1]),m=f;return c}n_.exports=ip,n_.exports.default=ip,ip.deviation=function(t,e,n,a){var c=e&&e.length,f=Math.abs(o_(t,0,c?e[0]*n:t.length,n));if(c)for(var m=0,y=e.length;m<y;m++)f-=Math.abs(o_(t,e[m]*n,m<y-1?e[m+1]*n:t.length,n));var x=0;for(m=0;m<a.length;m+=3){var b=a[m]*n,D=a[m+1]*n,M=a[m+2]*n;x+=Math.abs((t[b]-t[M])*(t[D+1]-t[b+1])-(t[b]-t[D])*(t[M+1]-t[b+1]))}return f===0&&x===0?0:Math.abs((x-f)/f)},ip.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},a=0,c=0;c<t.length;c++){for(var f=0;f<t[c].length;f++)for(var m=0;m<e;m++)n.vertices.push(t[c][f][m]);c>0&&n.holes.push(a+=t[c-1].length)}return n};var s_=Ct(n_.exports);function pI(t,e,n,a,c){Ux(t,e,n||0,a||t.length-1,c||mI)}function Ux(t,e,n,a,c){for(;a>n;){if(a-n>600){var f=a-n+1,m=e-n+1,y=Math.log(f),x=.5*Math.exp(2*y/3),b=.5*Math.sqrt(y*x*(f-x)/f)*(m-f/2<0?-1:1);Ux(t,e,Math.max(n,Math.floor(e-m*x/f+b)),Math.min(a,Math.floor(e+(f-m)*x/f+b)),c)}var D=t[e],M=n,S=a;for(xd(t,n,e),c(t[a],D)>0&&xd(t,n,a);M<S;){for(xd(t,M,S),M++,S--;c(t[M],D)<0;)M++;for(;c(t[S],D)>0;)S--}c(t[n],D)===0?xd(t,n,S):xd(t,++S,a),S<=e&&(n=S+1),e<=S&&(a=S-1)}}function xd(t,e,n){var a=t[e];t[e]=t[n],t[n]=a}function mI(t,e){return t<e?-1:t>e?1:0}function a_(t,e){let n=t.length;if(n<=1)return[t];let a=[],c,f;for(let m=0;m<n;m++){let y=Sa(t[m]);y!==0&&(t[m].area=Math.abs(y),f===void 0&&(f=y<0),f===y<0?(c&&a.push(c),c=[t[m]]):c.push(t[m]))}if(c&&a.push(c),e>1)for(let m=0;m<a.length;m++)a[m].length<=e||(pI(a[m],e,1,a[m].length-1,gI),a[m]=a[m].slice(0,e));return a}function gI(t,e){return e.area-t.area}function l_(t,e,n){let a=n.patternDependencies,c=!1;for(let f of e){let m=f.paint.get(`${t}-pattern`);m.isConstant()||(c=!0);let y=m.constantOr(null);y&&(c=!0,a[y]=!0)}return c}function c_(t,e,n,a,c){let f=c.patternDependencies;for(let m of e){let y=m.paint.get(`${t}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:a},n,{},c.availableImages);x=x&&x.name?x.name:x,f[x]=!0,n.patterns[m.id]=x}}return n}class lp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new qe,this.indexArray=new _t,this.indexArray2=new Vr,this.programConfigurations=new Dc(e.layers,e.zoom),this.segments=new Tr,this.segments2=new Tr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,a,c){this.hasPattern=l_("fill",this.layers,n);let f=this.layers[0].layout.get("fill-sort-key"),m=[];for(let{feature:y,id:x,index:b,sourceLayerIndex:D}of e){let M=this.layers[0]._featureFilter.needGeometry,S=Rc(y,M);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),S,a))continue;let k=f?f.evaluate(S,{},a,n.availableImages):void 0,L={id:x,properties:y.properties,type:y.type,sourceLayerIndex:D,index:b,geometry:M?S.geometry:Ka(y,a,c),patterns:{},sortKey:k};m.push(L)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(let y of m){let{geometry:x,index:b,sourceLayerIndex:D}=y;if(this.hasPattern){let M=c_("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(y,x,b,a,{},n.availableImages);n.featureIndex.insert(e[b].feature,x,b,D,this.index)}}update(e,n,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a,c)}addFeatures(e,n,a,c,f){for(let m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iI),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,c,f,m=[]){for(let y of a_(n,500)){let x=0;for(let L of y)x+=L.length;let b=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),D=b.vertexLength,M=[],S=[];for(let L of y){if(L.length===0)continue;L!==y[0]&&S.push(M.length/2);let z=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),H=z.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(H+L.length-1,H),M.push(L[0].x),M.push(L[0].y);for(let K=1;K<L.length;K++)this.layoutVertexArray.emplaceBack(L[K].x,L[K].y),this.indexArray2.emplaceBack(H+K-1,H+K),M.push(L[K].x),M.push(L[K].y);z.vertexLength+=L.length,z.primitiveLength+=L.length}let k=s_(M,S);for(let L=0;L<k.length;L+=3)this.indexArray.emplaceBack(D+k[L],D+k[L+1],D+k[L+2]);b.vertexLength+=x,b.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,m,c)}}pt(lp,"FillBucket",{omit:["layers","patternFeatures"]});let _I=new te({"fill-sort-key":new q(Oe.layout_fill["fill-sort-key"])});var yI={paint:new te({"fill-antialias":new N(Oe.paint_fill["fill-antialias"]),"fill-opacity":new q(Oe.paint_fill["fill-opacity"]),"fill-color":new q(Oe.paint_fill["fill-color"]),"fill-outline-color":new q(Oe.paint_fill["fill-outline-color"]),"fill-translate":new N(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new N(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new q(Oe.paint_fill["fill-pattern"])}),layout:_I};let vI=ye([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),xI=ye([{name:"a_centroid_pos",components:2,type:"Uint16"}]),bI=ye([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:wI}=vI;var cp={},EI=ei,$x=ku;function ku(t,e,n,a,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=c,t.readFields(CI,this,e)}function CI(t,e,n){t==1?e.id=n.readVarint():t==2?function(a,c){for(var f=a.readVarint()+a.pos;a.pos<f;){var m=c._keys[a.readVarint()],y=c._values[a.readVarint()];c.properties[m]=y}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function TI(t){for(var e,n,a=0,c=0,f=t.length,m=f-1;c<f;m=c++)a+=((n=t[m]).x-(e=t[c]).x)*(e.y+n.y);return a}ku.types=["Unknown","Point","LineString","Polygon"],ku.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,a=1,c=0,f=0,m=0,y=[];t.pos<n;){if(c<=0){var x=t.readVarint();a=7&x,c=x>>3}if(c--,a===1||a===2)f+=t.readSVarint(),m+=t.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new EI(f,m));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},ku.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,a=0,c=0,f=0,m=1/0,y=-1/0,x=1/0,b=-1/0;t.pos<e;){if(a<=0){var D=t.readVarint();n=7&D,a=D>>3}if(a--,n===1||n===2)(c+=t.readSVarint())<m&&(m=c),c>y&&(y=c),(f+=t.readSVarint())<x&&(x=f),f>b&&(b=f);else if(n!==7)throw new Error("unknown command "+n)}return[m,x,y,b]},ku.prototype.toGeoJSON=function(t,e,n){var a,c,f=this.extent*Math.pow(2,n),m=this.extent*t,y=this.extent*e,x=this.loadGeometry(),b=ku.types[this.type];function D(k){for(var L=0;L<k.length;L++){var z=k[L];k[L]=[360*(z.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(z.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(a=0;a<x.length;a++)M[a]=x[a][0];D(x=M);break;case 2:for(a=0;a<x.length;a++)D(x[a]);break;case 3:for(x=function(k){var L=k.length;if(L<=1)return[k];for(var z,H,K=[],se=0;se<L;se++){var J=TI(k[se]);J!==0&&(H===void 0&&(H=J<0),H===J<0?(z&&K.push(z),z=[k[se]]):z.push(k[se]))}return z&&K.push(z),K}(x),a=0;a<x.length;a++)for(c=0;c<x[a].length;c++)D(x[a][c])}x.length===1?x=x[0]:b="Multi"+b;var S={type:"Feature",geometry:{type:b,coordinates:x},properties:this.properties};return"id"in this&&(S.id=this.id),S};var DI=$x,Gx=Hx;function Hx(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(II,this,e),this.length=this._features.length}function II(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(a){for(var c=null,f=a.readVarint()+a.pos;a.pos<f;){var m=a.readVarint()>>3;c=m===1?a.readString():m===2?a.readFloat():m===3?a.readDouble():m===4?a.readVarint64():m===5?a.readVarint():m===6?a.readSVarint():m===7?a.readBoolean():null}return c}(n))}Hx.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new DI(this._pbf,e,this.extent,this._keys,this._values)};var MI=Gx;function SI(t,e,n){if(t===3){var a=new MI(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}var u_=cp.VectorTile=function(t,e){this.layers=t.readFields(SI,{},e)},up=cp.VectorTileFeature=$x;function hp(t,e,n,a){let c=[],f=a===0?(m,y,x,b,D,M)=>{m.push(new rt(M,x+(M-y)/(b-y)*(D-x)))}:(m,y,x,b,D,M)=>{m.push(new rt(y+(M-x)/(D-x)*(b-y),M))};for(let m of t){let y=[];for(let x of m){if(x.length<=2)continue;let b=[];for(let S=0;S<x.length-1;S++){let k=x[S].x,L=x[S].y,z=x[S+1].x,H=x[S+1].y,K=a===0?k:L,se=a===0?z:H;K<e?se>e&&f(b,k,L,z,H,e):K>n?se<n&&f(b,k,L,z,H,n):b.push(x[S]),se<e&&K>=e&&f(b,k,L,z,H,e),se>n&&K<=n&&f(b,k,L,z,H,n)}let D=x[x.length-1],M=a===0?D.x:D.y;M>=e&&M<=n&&b.push(D),b.length&&(D=b[b.length-1],b[0].x===D.x&&b[0].y===D.y||b.push(b[0]),y.push(b))}y.length&&c.push(y)}return c}cp.VectorTileLayer=Gx;let AI=up.types,PI=Math.pow(2,13);function bd(t,e,n,a,c,f,m,y){t.emplaceBack((e<<1)+m,(n<<1)+f,(Math.floor(a*PI)<<1)+c,Math.round(y))}function wd(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class qx{constructor(){this.acc=new rt(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new rt(e.x,e.y),this.max=new rt(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);let a=this.min,c=this.max;e.x<a.x?a.x=e.x:e.x>c.x&&(c.x=e.x),e.y<a.y?a.y=e.y:e.y>c.y&&(c.y=e.y),((e.x===0||e.x===bt)&&e.x===n.x)!=((e.y===0||e.y===bt)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,Xt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>bt!=e.x>bt&&this.addBorderIntersection(1,Xt(n.y,e.y,(bt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Xt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>bt!=e.y>bt&&this.addBorderIntersection(3,Xt(n.x,e.x,(bt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){let e=this.polyCount.reduce((n,a)=>n+a.edges,0);return e!==0?this.acc.div(e)._round():new rt(0,0)}span(){return new rt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Ed{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Ve,this.centroidVertexArray=new Ms,this.indexArray=new _t,this.programConfigurations=new Dc(e.layers,e.zoom),this.segments=new Tr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,a,c){this.features=[],this.hasPattern=l_("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){let m=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*m/(m*m+1)/bt/(1<<f.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:f,id:m,index:y,sourceLayerIndex:x}of e){let b=this.layers[0]._featureFilter.needGeometry,D=Rc(f,b);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),D,a))continue;let M={id:m,sourceLayerIndex:x,index:y,geometry:b?D.geometry:Ka(f,a,c),properties:f.properties,type:f.type,patterns:{}},S=this.layoutVertexArray.length;this.hasPattern?this.features.push(c_("fill-extrusion",this.layers,M,this.zoom,n)):this.addFeature(M,M.geometry,y,a,{},n.availableImages,c),n.featureIndex.insert(f,M.geometry,y,x,this.index,S)}this.sortBorders()}addFeatures(e,n,a,c,f){for(let m of this.features){let{geometry:y}=m;this.addFeature(m,y,m.index,n,a,c,f)}this.sortBorders()}update(e,n,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wI),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,bI.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,xI.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,c,f,m,y){let x=[new rt(0,0),new rt(bt,bt)],b=y.projection,D=b.name==="globe",M=this.enableTerrain&&!D?new qx:null,S=AI[e.type]==="Polygon";D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ye);let k=a_(n,500);for(let K=k.length-1;K>=0;K--){let se=k[K];(se.length===0||(L=se[0]).every(J=>J.x<=0)||L.every(J=>J.x>=bt)||L.every(J=>J.y<=0)||L.every(J=>J.y>=bt))&&k.splice(K,1)}var L;let z;if(D)z=Qx(k,x,c);else{z=[];for(let K of k)z.push({polygon:K,bounds:x})}let H=S?this.edgeRadius:0;for(let{polygon:K,bounds:se}of z){let J=0,oe=0;for(let le of K)S&&!le[0].equals(le[le.length-1])&&le.push(le[0]),oe+=S?le.length-1:le.length;let ue=this.segments.prepareSegment((S?5:4)*oe,this.layoutVertexArray,this.indexArray);if(S){let le=[],Me=[];J=ue.vertexLength;for(let Fe of K){let We,Pe;Fe.length&&Fe!==K[0]&&Me.push(le.length/2),We=Fe[1].sub(Fe[0])._perp()._unit();for(let je=1;je<Fe.length;je++){let Ue=Fe[je],Ge=Fe[je===Fe.length-1?1:je+1],{x:Qe,y:ke}=Ue;if(H){Pe=Ge.sub(Ue)._perp()._unit();let st=We.add(Pe)._unit(),gt=H*Math.min(4,1/(We.x*st.x+We.y*st.y));Qe+=gt*st.x,ke+=gt*st.y,We=Pe}bd(this.layoutVertexArray,Qe,ke,0,0,1,1,0),ue.vertexLength++,le.push(Ue.x,Ue.y),D&&wd(this.layoutVertexExtArray,b.projectTilePoint(Qe,ke,c),b.upVector(c,Qe,ke))}}let Te=s_(le,Me);for(let Fe=0;Fe<Te.length;Fe+=3)this.indexArray.emplaceBack(J+Te[Fe],J+Te[Fe+2],J+Te[Fe+1]),ue.primitiveLength++}for(let le of K){M&&le.length&&M.startRing(le[0]);let Me,Te,Fe,We=le.length>4&&Yx(le[le.length-2],le[0],le[1]),Pe=H?RI(le[le.length-2],le[0],le[1],H):0;Te=le[1].sub(le[0])._perp()._unit();let je=!0;for(let Ue=1,Ge=0;Ue<le.length;Ue++){let Qe=le[Ue-1],ke=le[Ue],st=le[Ue===le.length-1?1:Ue+1];if(M&&S&&M.currentPolyCount.top++,Xx(ke,Qe,se)){H&&(Te=st.sub(ke)._perp()._unit(),je=!je);continue}M&&M.append(ke,Qe);let gt=ke.sub(Qe)._perp(),lt=gt.x/(Math.abs(gt.x)+Math.abs(gt.y)),Nt=gt.y>0?1:0,et=Qe.dist(ke);if(Ge+et>32768&&(Ge=0),H){Fe=st.sub(ke)._perp()._unit();let Bt=Zx(Qe,ke,st,Wx(Te,Fe),H);isNaN(Bt)&&(Bt=0);let Tt=ke.sub(Qe)._unit();Qe=Qe.add(Tt.mult(Pe))._round(),ke=ke.add(Tt.mult(-Bt))._round(),Pe=Bt,Te=Fe}let xt=ue.vertexLength,zt=le.length>4&&Yx(Qe,ke,st),pn=Kx(Ge,We,je);if(bd(this.layoutVertexArray,Qe.x,Qe.y,lt,Nt,0,0,pn),bd(this.layoutVertexArray,Qe.x,Qe.y,lt,Nt,0,1,pn),Ge+=et,pn=Kx(Ge,zt,!je),We=zt,bd(this.layoutVertexArray,ke.x,ke.y,lt,Nt,0,0,pn),bd(this.layoutVertexArray,ke.x,ke.y,lt,Nt,0,1,pn),ue.vertexLength+=4,this.indexArray.emplaceBack(xt+0,xt+1,xt+2),this.indexArray.emplaceBack(xt+1,xt+3,xt+2),ue.primitiveLength+=2,H){let Bt=J+(Ue===1?le.length-2:Ue-2),Tt=Ue===1?J:Bt+1;if(this.indexArray.emplaceBack(xt+1,Bt,xt+3),this.indexArray.emplaceBack(Bt,Tt,xt+3),ue.primitiveLength+=2,Me===void 0&&(Me=xt),!Xx(st,le[Ue],se)){let Xn=Ue===le.length-1?Me:ue.vertexLength;this.indexArray.emplaceBack(xt+2,xt+3,Xn),this.indexArray.emplaceBack(xt+3,Xn+1,Xn),this.indexArray.emplaceBack(xt+3,Tt,Xn+1),ue.primitiveLength+=3}je=!je}if(D){let Bt=this.layoutVertexExtArray,Tt=b.projectTilePoint(Qe.x,Qe.y,c),Xn=b.projectTilePoint(ke.x,ke.y,c),jt=b.upVector(c,Qe.x,Qe.y),Ut=b.upVector(c,ke.x,ke.y);wd(Bt,Tt,jt),wd(Bt,Tt,jt),wd(Bt,Xn,Ut),wd(Bt,Xn,Ut)}}S&&(J+=le.length-1)}}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;let K=M.borders,se=this.featuresOnBorder.push(M)-1;for(let J=0;J<4;J++)K[J][0]!==Number.MAX_VALUE&&this.borders[J].push(se)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,m,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,n,a=!0){let c,f;if(e)if(e.y!==0){let y=n.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else c=Math.ceil(7*(e.x+450)),f=0;else c=0,f=+a;let m=a?this.centroidVertexArray.length:n.vertexArrayOffset;for(let y of n.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let x=0;x<y.top;x++)this.centroidVertexArray.emplace(m++,c,f);for(let x=0;x<2*y.edges;x++)this.centroidVertexArray.emplace(m++,0,f),this.centroidVertexArray.emplace(m++,c,f)}}}function Wx(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function RI(t,e,n,a){let c=e.sub(t)._perp()._unit(),f=n.sub(e)._perp()._unit();return Zx(t,e,n,Wx(c,f),a)}function Zx(t,e,n,a,c){let f=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(n)/3,c*f/a)}function Xx(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function Yx(t,e,n){if(t.x<0||t.x>=bt||e.x<0||e.x>=bt||n.x<0||n.x>=bt)return!1;let a=n.sub(e),c=a.perp(),f=t.sub(e);return(a.x*f.x+a.y*f.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(f.x*f.x+f.y*f.y))>-.866&&c.x*f.x+c.y*f.y<0}function Kx(t,e,n){let a=e?2|t:-3&t;return n?1|a:-2&a}function Jx(){let t=Math.PI/32,e=Math.tan(t),n=gd;return n*Math.sqrt(1+2*e*e)-n}function Qx(t,e,n){let a=1<<n.z,c=So(n.x/a),f=So((n.x+1)/a),m=ci(n.y/a),y=ci((n.y+1)/a);return function(x,b,D,M,S=0,k){let L=[];if(!x.length||!D||!M)return L;let z=(le,Me)=>{for(let Te of le)L.push({polygon:Te,bounds:Me})},H=Math.ceil(Math.log2(D)),K=Math.ceil(Math.log2(M)),se=H-K,J=[];for(let le=0;le<Math.abs(se);le++)J.push(se>0?0:1);for(let le=0;le<Math.min(H,K);le++)J.push(0),J.push(1);let oe=x;if(oe=hp(oe,b[0].y-S,b[1].y+S,1),oe=hp(oe,b[0].x-S,b[1].x+S,0),!oe.length)return L;let ue=[];for(J.length?ue.push({polygons:oe,bounds:b,depth:0}):z(oe,b);ue.length;){let le=ue.pop(),Me=le.depth,Te=J[Me],Fe=le.bounds[0],We=le.bounds[1],Pe=Te===0?Fe.x:Fe.y,je=Te===0?We.x:We.y,Ue=k?k(Te,Pe,je):.5*(Pe+je),Ge=hp(le.polygons,Pe-S,Ue+S,Te),Qe=hp(le.polygons,Ue-S,je+S,Te);if(Ge.length){let ke=[Fe,new rt(Te===0?Ue:We.x,Te===1?Ue:We.y)];J.length>Me+1?ue.push({polygons:Ge,bounds:ke,depth:Me+1}):z(Ge,ke)}if(Qe.length){let ke=[new rt(Te===0?Ue:Fe.x,Te===1?Ue:Fe.y),We];J.length>Me+1?ue.push({polygons:Qe,bounds:ke,depth:Me+1}):z(Qe,ke)}}return L}(t,e,Math.ceil((f-c)/11.25),Math.ceil((m-y)/11.25),1,(x,b,D)=>{if(x===0)return .5*(b+D);{let M=ci((n.y+b/bt)/a);return(pa(.5*(ci((n.y+D/bt)/a)+M))*a-n.y)*bt}})}pt(Ed,"FillExtrusionBucket",{omit:["layers","features"]}),pt(qx,"PartMetadata");let OI=new te({"fill-extrusion-edge-radius":new N(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var kI={paint:new te({"fill-extrusion-opacity":new N(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new q(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new N(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new N(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new q(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new q(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new q(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new N(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new N(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new N(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new N(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:OI};function eb(t,e,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[t*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class dp{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=Cd(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let a=function(f,m,y){var x=eb(256*f,256*(m=Math.pow(2,y)-m-1),y),b=eb(256*(f+1),256*(m+1),y);return x[0]+","+x[1]+","+b[0]+","+b[1]}(this.x,this.y,this.z),c=function(f,m,y){let x,b="";for(let D=f;D>0;D--)x=1<<D-1,b+=(m&x?1:0)+(y&x?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class tb{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Cd(e,n.z,n.z,n.x,n.y)}}class Ri{constructor(e,n,a,c,f){this.overscaledZ=e,this.wrap=n,this.canonical=new dp(a,+c,+f),this.key=n===0&&e===a?this.canonical.key:Cd(n,e,a,c,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new Ri(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ri(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Cd(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return Cd(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Ri(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Ri(n,this.wrap,n,a,c),new Ri(n,this.wrap,n,a+1,c),new Ri(n,this.wrap,n,a,c+1),new Ri(n,this.wrap,n,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ri(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ri(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new tb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Cd(t,e,n,a,c){let f=1<<Math.min(n,22),m=f*(c%f)+a%f;return t&&n<22&&(m+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*m+n)+(e-n)}pt(dp,"CanonicalTileID"),pt(Ri,"OverscaledTileID",{omit:["projMatrix"]});class Lu extends rt{constructor(e,n,a){super(e,n),this.z=a}}function Td(t,e){return t.x*e.x+t.y*e.y}function nb(t,e){if(t.length===1){let n=0,a=e[n++],c;for(;!c||a.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){let f=e[n],m=t[0],y=c.sub(a),x=f.sub(a),b=m.sub(a),D=Td(y,y),M=Td(y,x),S=Td(x,x),k=Td(b,y),L=Td(b,x),z=D*S-M*M,H=(S*k-M*L)/z,K=(D*L-M*k)/z,se=a.z*(1-H-K)+c.z*H+f.z*K;if(isFinite(se))return se}return 1/0}{let n=1/0;for(let a of e)n=Math.min(n,a.z);return n}}function rb(t,e,n,a,c,f,m,y){let x=m*c.getElevationAt(t,e,!0,!0),b=f[0]!==0,D=b?f[1]===0?m*(f[0]/7-450):m*function(M,S,k){let L=Math.floor(S[0]/8),z=Math.floor(S[1]/8),H=10*(S[0]-8*L),K=10*(S[1]-8*z),se=M.getElevationAt(L,z,!0,!0),J=M.getMeterToDEM(k),oe=Math.floor(.5*(H*J-1)),ue=Math.floor(.5*(K*J-1)),le=M.tileCoordToPixel(L,z),Me=2*oe+1,Te=2*ue+1,Fe=function(Qe,ke,st,gt,lt){return[Qe.getElevationAtPixel(ke,st,!0),Qe.getElevationAtPixel(ke+lt,st,!0),Qe.getElevationAtPixel(ke,st+lt,!0),Qe.getElevationAtPixel(ke+gt,st+lt,!0)]}(M,le.x-oe,le.y-ue,Me,Te),We=Math.abs(Fe[0]-Fe[1]),Pe=Math.abs(Fe[2]-Fe[3]),je=Math.abs(Fe[0]-Fe[2])+Math.abs(Fe[1]-Fe[3]),Ue=Math.min(.25,.5*J*(We+Pe)/Me),Ge=Math.min(.25,.5*J*je/Te);return se+Math.max(Ue*H,Ge*K)}(c,f,y):x;return{base:x+(n===0)?-1:n,top:b?Math.max(D+a,x+n+2):x+a}}let LI=ye([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:FI}=LI,NI=ye([{name:"a_packed",components:4,type:"Float32"}]),{members:zI}=NI,BI=up.types,VI=Math.cos(Math.PI/180*37.5);class fp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Ae,this.layoutVertexArray2=new He,this.indexArray=new _t,this.programConfigurations=new Dc(e.layers,e.zoom),this.segments=new Tr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a,c){this.hasPattern=l_("line",this.layers,n);let f=this.layers[0].layout.get("line-sort-key"),m=[];for(let{feature:D,id:M,index:S,sourceLayerIndex:k}of e){let L=this.layers[0]._featureFilter.needGeometry,z=Rc(D,L);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),z,a))continue;let H=f?f.evaluate(z,{},a):void 0,K={id:M,properties:D.properties,type:D.type,sourceLayerIndex:k,index:S,geometry:L?z.geometry:Ka(D,a,c),patterns:{},sortKey:H};m.push(K)}f&&m.sort((D,M)=>D.sortKey-M.sortKey);let{lineAtlas:y,featureIndex:x}=n,b=this.addConstantDashes(y);for(let D of m){let{geometry:M,index:S,sourceLayerIndex:k}=D;if(b&&this.addFeatureDashes(D,y),this.hasPattern){let L=c_("line",this.layers,D,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(D,M,S,a,y.positions,n.availableImages);x.insert(e[S].feature,M,S,k,this.index)}}addConstantDashes(e){let n=!1;for(let a of this.layers){let c=a.paint.get("line-dasharray").value,f=a.layout.get("line-cap").value;if(c.kind!=="constant"||f.kind!=="constant")n=!0;else{let m=f.value,y=c.value;if(!y)continue;e.addDash(y,m)}}return n}addFeatureDashes(e,n){let a=this.zoom;for(let c of this.layers){let f=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if(f.kind==="constant"&&m.kind==="constant")continue;let y,x;if(f.kind==="constant"){if(y=f.value,!y)continue}else y=f.evaluate({zoom:a},e);x=m.kind==="constant"?m.value:m.evaluate({zoom:a},e),n.addDash(y,x),e.patterns[c.id]=n.getKey(y,x)}}update(e,n,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a,c)}addFeatures(e,n,a,c,f){for(let m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,zI)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,FI),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,c,f,m){let y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),b=y.get("line-cap").evaluate(e,{}),D=y.get("line-miter-limit"),M=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let S of n)this.addLine(S,e,x,b,D,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,m,c)}addLine(e,n,a,c,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<e.length-1;K++)this.totalDistance+=e[K].dist(e[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let y=BI[n.type]==="Polygon",x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let b=0;for(;b<x-1&&e[b].equals(e[b+1]);)b++;if(x<(y?3:2))return;a==="bevel"&&(f=1.05);let D=this.overscaling<=16?15*bt/(512*this.overscaling):0,M=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray),S,k,L,z,H;this.e1=this.e2=-1,y&&(S=e[x-2],H=e[b].sub(S)._unit()._perp());for(let K=b;K<x;K++){if(L=K===x-1?y?e[b+1]:void 0:e[K+1],L&&e[K].equals(L))continue;H&&(z=H),S&&(k=S),S=e[K],H=L?L.sub(S)._unit()._perp():z,z=z||H;let se=z.add(H);se.x===0&&se.y===0||se._unit();let J=z.x*H.x+z.y*H.y,oe=se.x*H.x+se.y*H.y,ue=oe!==0?1/oe:1/0,le=2*Math.sqrt(2-2*oe),Me=oe<VI&&k&&L,Te=z.x*H.y-z.y*H.x>0;if(Me&&K>b){let Pe=S.dist(k);if(Pe>2*D){let je=S.sub(S.sub(k)._mult(D/Pe)._round());this.updateDistance(k,je),this.addCurrentVertex(je,z,0,0,M),k=je}}let Fe=k&&L,We=Fe?a:y?"butt":c;if(Fe&&We==="round"&&(ue<m?We="miter":ue<=2&&(We="fakeround")),We==="miter"&&ue>f&&(We="bevel"),We==="bevel"&&(ue>2&&(We="flipbevel"),ue<f&&(We="miter")),k&&this.updateDistance(k,S),We==="miter")se._mult(ue),this.addCurrentVertex(S,se,0,0,M);else if(We==="flipbevel"){if(ue>100)se=H.mult(-1);else{let Pe=ue*z.add(H).mag()/z.sub(H).mag();se._perp()._mult(Pe*(Te?-1:1))}this.addCurrentVertex(S,se,0,0,M),this.addCurrentVertex(S,se.mult(-1),0,0,M)}else if(We==="bevel"||We==="fakeround"){let Pe=-Math.sqrt(ue*ue-1),je=Te?Pe:0,Ue=Te?0:Pe;if(k&&this.addCurrentVertex(S,z,je,Ue,M),We==="fakeround"){let Ge=Math.round(180*le/Math.PI/20);for(let Qe=1;Qe<Ge;Qe++){let ke=Qe/Ge;if(ke!==.5){let gt=ke-.5;ke+=ke*gt*(ke-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*gt*gt+(.848013+J*(.215638*J-1.06021)))}let st=H.sub(z)._mult(ke)._add(z)._unit()._mult(Te?-1:1);this.addHalfVertex(S,st.x,st.y,!1,Te,0,M)}}L&&this.addCurrentVertex(S,H,-je,-Ue,M)}else if(We==="butt")this.addCurrentVertex(S,se,0,0,M);else if(We==="square"){let Pe=k?1:-1;k||this.addCurrentVertex(S,se,Pe,Pe,M),this.addCurrentVertex(S,se,0,0,M),k&&this.addCurrentVertex(S,se,Pe,Pe,M)}else We==="round"&&(k&&(this.addCurrentVertex(S,z,0,0,M),this.addCurrentVertex(S,z,1,1,M,!0)),L&&(this.addCurrentVertex(S,H,-1,-1,M,!0),this.addCurrentVertex(S,H,0,0,M)));if(Me&&K<x-1){let Pe=S.dist(L);if(Pe>2*D){let je=S.add(L.sub(S)._mult(D/Pe)._round());this.updateDistance(S,je),this.addCurrentVertex(je,H,0,0,M),S=je}}}}addCurrentVertex(e,n,a,c,f,m=!1){let y=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*a,n.y-n.x*a,m,!1,a,f),this.addHalfVertex(e,y,x,m,!0,-c,f)}addHalfVertex({x:e,y:n},a,c,f,m,y,x){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(n<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let b=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),x.primitiveLength++),m?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}pt(fp,"LineBucket",{omit:["layers","patternFeatures"]});let jI=new te({"line-cap":new q(Oe.layout_line["line-cap"]),"line-join":new q(Oe.layout_line["line-join"]),"line-miter-limit":new N(Oe.layout_line["line-miter-limit"]),"line-round-limit":new N(Oe.layout_line["line-round-limit"]),"line-sort-key":new q(Oe.layout_line["line-sort-key"])});var ib={paint:new te({"line-opacity":new q(Oe.paint_line["line-opacity"]),"line-color":new q(Oe.paint_line["line-color"]),"line-translate":new N(Oe.paint_line["line-translate"]),"line-translate-anchor":new N(Oe.paint_line["line-translate-anchor"]),"line-width":new q(Oe.paint_line["line-width"]),"line-gap-width":new q(Oe.paint_line["line-gap-width"]),"line-offset":new q(Oe.paint_line["line-offset"]),"line-blur":new q(Oe.paint_line["line-blur"]),"line-dasharray":new q(Oe.paint_line["line-dasharray"]),"line-pattern":new q(Oe.paint_line["line-pattern"]),"line-gradient":new Q(Oe.paint_line["line-gradient"]),"line-trim-offset":new N(Oe.paint_line["line-trim-offset"])}),layout:jI};let ob=new class extends q{possiblyEvaluate(t,e){return e=new I(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,a){return e=un({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,a)}}(ib.paint.properties["line-width"].specification);function sb(t,e){return e>0?e+2*t:t}ob.useIntegerZoom=!0;let UI=ye([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$I=ye([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),GI=ye([{name:"a_projected_pos",components:4,type:"Float32"}],4);ye([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let HI=ye([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),qI=ye([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let ab=ye([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),WI=ye([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ye([{name:"triangle",components:3,type:"Uint16"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ye([{type:"Float32",name:"offsetX"}]),ye([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Yr=24;let ks=128;function h_(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new I(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:c}=n,f=0;for(;f<a.length&&a[f]<=t;)f++;f=Math.max(0,f-1);let m=f;for(;m<a.length&&a[m]<t+1;)m++;m=Math.min(a.length-1,m);let y=a[f],x=a[m];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:x,minSize:n.evaluate(new I(y)),maxSize:n.evaluate(new I(x)),interpolationType:c}}}function pp(t,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:c}){return t.kind==="source"?a/ks:t.kind==="composite"?Xt(a/ks,c/ks,n):e}function Fu(t,e){let n=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:c,minZoom:f,maxZoom:m}=t,y=c?Ht(mi.interpolationFactor(c,e,f,m),0,1):0;t.kind==="camera"?a=Xt(t.minSize,t.maxSize,y):n=y}return{uSizeT:n,uSize:a}}var ZI=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ks,evaluateSizeForFeature:pp,evaluateSizeForZoom:Fu,getSizeData:h_});function XI(t,e,n){return t.sections.forEach(a=>{a.text=function(c,f,m){let y=f.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),T.applyArabicShaping&&(c=T.applyArabicShaping(c)),c}(a.text,e,n)}),t}let Dd={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function YI(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function KI(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var lb=Gn,cb=function(t,e,n,a,c){var f,m,y=8*c-a-1,x=(1<<y)-1,b=x>>1,D=-7,M=n?c-1:0,S=n?-1:1,k=t[e+M];for(M+=S,f=k&(1<<-D)-1,k>>=-D,D+=y;D>0;f=256*f+t[e+M],M+=S,D-=8);for(m=f&(1<<-D)-1,f>>=-D,D+=a;D>0;m=256*m+t[e+M],M+=S,D-=8);if(f===0)f=1-b;else{if(f===x)return m?NaN:1/0*(k?-1:1);m+=Math.pow(2,a),f-=b}return(k?-1:1)*m*Math.pow(2,f-a)},ub=function(t,e,n,a,c,f){var m,y,x,b=8*f-c-1,D=(1<<b)-1,M=D>>1,S=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=a?0:f-1,L=a?1:-1,z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=D):(m=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-m))<1&&(m--,x*=2),(e+=m+M>=1?S/x:S*Math.pow(2,1-M))*x>=2&&(m++,x/=2),m+M>=D?(y=0,m=D):m+M>=1?(y=(e*x-1)*Math.pow(2,c),m+=M):(y=e*Math.pow(2,M-1)*Math.pow(2,c),m=0));c>=8;t[n+k]=255&y,k+=L,y/=256,c-=8);for(m=m<<c|y,b+=c;b>0;t[n+k]=255&m,k+=L,m/=256,b-=8);t[n+k-L]|=128*z};function Gn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Gn.Varint=0,Gn.Fixed64=1,Gn.Bytes=2,Gn.Fixed32=5;var d_=4294967296,hb=1/d_,db=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Qa(t){return t.type===Gn.Bytes?t.readVarint()+t.pos:t.pos+1}function Nu(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function fb(t,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var c=n.pos-1;c>=t;c--)n.buf[c+a]=n.buf[c]}function JI(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function QI(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function eM(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function tM(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function nM(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function rM(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function iM(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function oM(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function sM(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function mp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function zu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function pb(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Gn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),c=a>>3,f=this.pos;this.type=7&a,t(c,e,this),this.pos===f&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=mp(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=pb(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=mp(this.buf,this.pos)+mp(this.buf,this.pos+4)*d_;return this.pos+=8,t},readSFixed64:function(){var t=mp(this.buf,this.pos)+pb(this.buf,this.pos+4)*d_;return this.pos+=8,t},readFloat:function(){var t=cb(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=cb(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(c,f,m){var y,x,b=m.buf;if(y=(112&(x=b[m.pos++]))>>4,x<128||(y|=(127&(x=b[m.pos++]))<<3,x<128)||(y|=(127&(x=b[m.pos++]))<<10,x<128)||(y|=(127&(x=b[m.pos++]))<<17,x<128)||(y|=(127&(x=b[m.pos++]))<<24,x<128)||(y|=(1&(x=b[m.pos++]))<<31,x<128))return Nu(c,y,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&db?function(n,a,c){return db.decode(n.subarray(a,c))}(this.buf,e,t):function(n,a,c){for(var f="",m=a;m<c;){var y,x,b,D=n[m],M=null,S=D>239?4:D>223?3:D>191?2:1;if(m+S>c)break;S===1?D<128&&(M=D):S===2?(192&(y=n[m+1]))==128&&(M=(31&D)<<6|63&y)<=127&&(M=null):S===3?(x=n[m+2],(192&(y=n[m+1]))==128&&(192&x)==128&&((M=(15&D)<<12|(63&y)<<6|63&x)<=2047||M>=55296&&M<=57343)&&(M=null)):S===4&&(x=n[m+2],b=n[m+3],(192&(y=n[m+1]))==128&&(192&x)==128&&(192&b)==128&&((M=(15&D)<<18|(63&y)<<12|(63&x)<<6|63&b)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,S=1):M>65535&&(M-=65536,f+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),f+=String.fromCharCode(M),m+=S}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Gn.Bytes)return t.push(this.readVarint(e));var n=Qa(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Gn.Bytes)return t.push(this.readSVarint());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Gn.Bytes)return t.push(this.readBoolean());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Gn.Bytes)return t.push(this.readFloat());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Gn.Bytes)return t.push(this.readDouble());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Gn.Bytes)return t.push(this.readFixed32());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Gn.Bytes)return t.push(this.readSFixed32());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Gn.Bytes)return t.push(this.readFixed64());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Gn.Bytes)return t.push(this.readSFixed64());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Gn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Gn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Gn.Fixed32)this.pos+=4;else{if(e!==Gn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),zu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),zu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),zu(this.buf,-1&t,this.pos),zu(this.buf,Math.floor(t*hb),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),zu(this.buf,-1&t,this.pos),zu(this.buf,Math.floor(t*hb),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var a,c;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(f,m,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)}(a,0,n),function(f,m){var y=(7&f)<<4;m.buf[m.pos++]|=y|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,c,f){for(var m,y,x=0;x<c.length;x++){if((m=c.charCodeAt(x))>55295&&m<57344){if(!y){m>56319||x+1===c.length?(a[f++]=239,a[f++]=191,a[f++]=189):y=m;continue}if(m<56320){a[f++]=239,a[f++]=191,a[f++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(a[f++]=239,a[f++]=191,a[f++]=189,y=null);m<128?a[f++]=m:(m<2048?a[f++]=m>>6|192:(m<65536?a[f++]=m>>12|224:(a[f++]=m>>18|240,a[f++]=m>>12&63|128),a[f++]=m>>6&63|128),a[f++]=63&m|128)}return f}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&fb(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),ub(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ub(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var a=this.pos-n;a>=128&&fb(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,n){this.writeTag(t,Gn.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,JI,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,QI,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,nM,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,eM,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,tM,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,rM,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,iM,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,oM,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,sM,e)},writeBytesField:function(t,e){this.writeTag(t,Gn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Gn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Gn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Gn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Gn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Gn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Gn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Gn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Gn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Gn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var gp=Ct(lb);let f_=3;function aM(t,e,n){e.glyphs=[],t===1&&n.readMessage(lM,e)}function lM(t,e,n){if(t===3){let{id:a,bitmap:c,width:f,height:m,left:y,top:x,advance:b}=n.readMessage(cM,{});e.glyphs.push({id:a,bitmap:new Ja({width:f+2*f_,height:m+2*f_},c),metrics:{width:f,height:m,left:y,top:x,advance:b}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function cM(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let mb=f_;function p_(t){let e=0,n=0;for(let m of t)e+=m.w*m.h,n=Math.max(n,m.w);t.sort((m,y)=>y.h-m.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],c=0,f=0;for(let m of t)for(let y=a.length-1;y>=0;y--){let x=a[y];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,f=Math.max(f,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===x.w&&m.h===x.h){let b=a.pop();y<a.length&&(a[y]=b)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(a.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:c,h:f,fill:e/(c*f)||0}}let Hi=1;class m_{constructor(e,{pixelRatio:n,version:a,stretchX:c,stretchY:f,content:m}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=f,this.content=m,this.version=a}get tl(){return[this.paddedRect.x+Hi,this.paddedRect.y+Hi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Hi,this.paddedRect.y+this.paddedRect.h-Hi]}get displaySize(){return[(this.paddedRect.w-2*Hi)/this.pixelRatio,(this.paddedRect.h-2*Hi)/this.pixelRatio]}}class gb{constructor(e,n){let a={},c={};this.haveRenderCallbacks=[];let f=[];this.addImages(e,a,f),this.addImages(n,c,f);let{w:m,h:y}=p_(f),x=new ro({width:m||1,height:y||1});for(let b in e){let D=e[b],M=a[b].paddedRect;ro.copy(D.data,x,{x:0,y:0},{x:M.x+Hi,y:M.y+Hi},D.data)}for(let b in n){let D=n[b],M=c[b].paddedRect,S=M.x+Hi,k=M.y+Hi,L=D.data.width,z=D.data.height;ro.copy(D.data,x,{x:0,y:0},{x:S,y:k},D.data),ro.copy(D.data,x,{x:0,y:z-1},{x:S,y:k-1},{width:L,height:1}),ro.copy(D.data,x,{x:0,y:0},{x:S,y:k+z},{width:L,height:1}),ro.copy(D.data,x,{x:L-1,y:0},{x:S-1,y:k},{width:1,height:z}),ro.copy(D.data,x,{x:0,y:0},{x:S+L,y:k},{width:1,height:z})}this.image=x,this.iconPositions=a,this.patternPositions=c}addImages(e,n,a){for(let c in e){let f=e[c],m={x:0,y:0,w:f.data.width+2*Hi,h:f.data.height+2*Hi};a.push(m),n[c]=new m_(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;let[c,f]=e.tl;a.update(n.data,void 0,{x:c,y:f})}}pt(m_,"ImagePosition"),pt(gb,"ImageAtlas");let Ao={horizontal:1,vertical:2,horizontalOnly:3},_b=-17;class Id{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let a=new Id;return a.scale=e||1,a.fontStack=n,a}static forImage(e){let n=new Id;return n.imageName=e,n}}class Bu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let a=new Bu;for(let c=0;c<e.sections.length;c++){let f=e.sections[c];f.image?a.addImageSection(f):a.addTextSection(f,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,a){let c="";for(let f=0;f<n.length;f++){let m=n.charCodeAt(f+1)||null,y=n.charCodeAt(f-1)||null;c+=!a&&(m&&Hf(m)&&!Dd[n[f+1]]||y&&Hf(y)&&!Dd[n[f-1]])||!Dd[n[f]]?n[f]:Dd[n[f]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&_p[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&_p[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let a=new Bu;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Id.forText(e.scale,e.fontStack||n));let a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e){let n=e.image?e.image.name:"";if(n.length===0)return void Jn("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Id.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Jn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function g_(t,e,n,a,c,f,m,y,x,b,D,M,S,k,L){let z=Bu.fromFeature(t,c);M===Ao.vertical&&z.verticalizePunctuation(S);let H=[],K=function(le,Me,Te,Fe,We,Pe){if(!le)return[];let je=[],Ue=function(st,gt,lt,Nt,et,xt){let zt=0;for(let pn=0;pn<st.length();pn++){let Bt=st.getSection(pn);zt+=yb(st.getCharCode(pn),Bt,Nt,et,gt,xt)}return zt/Math.max(1,Math.ceil(zt/lt))}(le,Me,Te,Fe,We,Pe),Ge=le.text.indexOf("\u200B")>=0,Qe=0;for(let st=0;st<le.length();st++){let gt=le.getSection(st),lt=le.getCharCode(st);if(_p[lt]||(Qe+=yb(lt,gt,Fe,We,Me,Pe)),st<le.length()-1){let Nt=!((ke=lt)<11904||!(ct["Bopomofo Extended"](ke)||ct.Bopomofo(ke)||ct["CJK Compatibility Forms"](ke)||ct["CJK Compatibility Ideographs"](ke)||ct["CJK Compatibility"](ke)||ct["CJK Radicals Supplement"](ke)||ct["CJK Strokes"](ke)||ct["CJK Symbols and Punctuation"](ke)||ct["CJK Unified Ideographs Extension A"](ke)||ct["CJK Unified Ideographs"](ke)||ct["Enclosed CJK Letters and Months"](ke)||ct["Halfwidth and Fullwidth Forms"](ke)||ct.Hiragana(ke)||ct["Ideographic Description Characters"](ke)||ct["Kangxi Radicals"](ke)||ct["Katakana Phonetic Extensions"](ke)||ct.Katakana(ke)||ct["Vertical Forms"](ke)||ct["Yi Radicals"](ke)||ct["Yi Syllables"](ke)));(uM[lt]||Nt||gt.imageName)&&je.push(xb(st+1,Qe,Ue,je,hM(lt,le.getCharCode(st+1),Nt&&Ge),!1))}}var ke;return bb(xb(le.length(),Qe,Ue,je,0,!0))}(z,b,f,e,a,k),{processBidirectionalText:se,processStyledBidirectionalText:J}=T;if(se&&z.sections.length===1){let le=se(z.toString(),K);for(let Me of le){let Te=new Bu;Te.text=Me,Te.sections=z.sections;for(let Fe=0;Fe<Me.length;Fe++)Te.sectionIndex.push(0);H.push(Te)}}else if(J){let le=J(z.text,z.sectionIndex,K);for(let Me of le){let Te=new Bu;Te.text=Me[0],Te.sectionIndex=Me[1],Te.sections=z.sections,H.push(Te)}}else H=function(le,Me){let Te=[],Fe=le.text,We=0;for(let Pe of Me)Te.push(le.substring(We,Pe)),We=Pe;return We<Fe.length&&Te.push(le.substring(We,Fe.length)),Te}(z,K);let oe=[],ue={positionedLines:oe,text:z.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(le,Me,Te,Fe,We,Pe,je,Ue,Ge,Qe,ke,st){let gt=0,lt=0,Nt=0,et=Ue==="right"?1:Ue==="left"?0:.5,xt=!1;for(let jt of We){let Ut=jt.getSections();for(let zn of Ut){if(zn.imageName)continue;let Hn=Me[zn.fontStack];if(Hn&&(xt=Hn.ascender!==void 0&&Hn.descender!==void 0,!xt))break}if(!xt)break}let zt=0;for(let jt of We){jt.trim();let Ut=jt.getMaxScale(),zn=(Ut-1)*Yr,Hn={positionedGlyphs:[],lineOffset:0};le.positionedLines[zt]=Hn;let qn=Hn.positionedGlyphs,Bn=0;if(!jt.length()){lt+=Pe,++zt;continue}let ar=0,pr=0;for(let Vn=0;Vn<jt.length();Vn++){let Lr=jt.getSection(Vn),Mr=jt.getSectionIndex(Vn),hr=jt.getCharCode(Vn),vn=Lr.scale,Sr=null,Wn=null,Oi=null,Ar=Yr,Kr=0,jr=!(Ge===Ao.horizontal||!ke&&!ed(hr)||ke&&(_p[hr]||(pn=hr,ct.Arabic(pn)||ct["Arabic Supplement"](pn)||ct["Arabic Extended-A"](pn)||ct["Arabic Presentation Forms-A"](pn)||ct["Arabic Presentation Forms-B"](pn))));if(Lr.imageName){let ki=Fe[Lr.imageName];if(!ki)continue;Oi=Lr.imageName,le.iconsInText=le.iconsInText||!0,Wn=ki.paddedRect;let Ur=ki.displaySize;vn=vn*Yr/st,Sr={width:Ur[0],height:Ur[1],left:Hi,top:-mb,advance:jr?Ur[1]:Ur[0],localGlyph:!1},Kr=xt?-Sr.height*vn:_b+Ut*Yr-Ur[1]*vn,Ar=Sr.advance;let Ns=(jr?Ur[0]:Ur[1])*vn-Yr*Ut;Ns>0&&Ns>Bn&&(Bn=Ns)}else{let ki=Te[Lr.fontStack];if(!ki)continue;ki[hr]&&(Wn=ki[hr]);let Ur=Me[Lr.fontStack];if(!Ur)continue;let Ns=Ur.glyphs[hr];if(!Ns)continue;if(Sr=Ns.metrics,Ar=hr!==8203?Yr:0,xt){let qu=Ur.ascender!==void 0?Math.abs(Ur.ascender):0,Nd=Ur.descender!==void 0?Math.abs(Ur.descender):0,zd=(qu+Nd)*vn;ar<zd&&(ar=zd,pr=(qu-Nd)/2*vn),Kr=-qu*vn}else Kr=_b+(Ut-vn)*Yr}jr?(le.verticalizable=!0,qn.push({glyph:hr,imageName:Oi,x:gt,y:lt+Kr,vertical:jr,scale:vn,localGlyph:Sr.localGlyph,fontStack:Lr.fontStack,sectionIndex:Mr,metrics:Sr,rect:Wn}),gt+=Ar*vn+Qe):(qn.push({glyph:hr,imageName:Oi,x:gt,y:lt+Kr,vertical:jr,scale:vn,localGlyph:Sr.localGlyph,fontStack:Lr.fontStack,sectionIndex:Mr,metrics:Sr,rect:Wn}),gt+=Sr.advance*vn+Qe)}qn.length!==0&&(Nt=Math.max(gt-Qe,Nt),xt?wb(qn,et,Bn,pr,Pe*Ut/2):wb(qn,et,Bn,0,Pe/2)),gt=0;let Ir=Pe*Ut+Bn;Hn.lineOffset=Math.max(Bn,zn),lt+=Ir,++zt}var pn;let Bt=lt,{horizontalAlign:Tt,verticalAlign:Xn}=__(je);(function(jt,Ut,zn,Hn,qn,Bn){let ar=(Ut-zn)*qn,pr=-Bn*Hn;for(let Ir of jt)for(let Vn of Ir.positionedGlyphs)Vn.x+=ar,Vn.y+=pr})(le.positionedLines,et,Tt,Xn,Nt,Bt),le.top+=-Xn*Bt,le.bottom=le.top+Bt,le.left+=-Tt*Nt,le.right=le.left+Nt,le.hasBaseline=xt}(ue,e,n,a,H,m,y,x,M,b,S,L),!function(le){for(let Me of le)if(Me.positionedGlyphs.length!==0)return!1;return!0}(oe)&&ue}let _p={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yb(t,e,n,a,c,f){if(e.imageName){let m=a[e.imageName];return m?m.displaySize[0]*e.scale*Yr/f+c:0}{let m=n[e.fontStack],y=m&&m.glyphs[t];return y?y.metrics.advance*e.scale+c:0}}function vb(t,e,n,a){let c=Math.pow(t-e,2);return a?t<e?c/2:2*c:c+Math.abs(n)*n}function hM(t,e,n){let a=0;return t===10&&(a-=1e4),n&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function xb(t,e,n,a,c,f){let m=null,y=vb(e,n,c,f);for(let x of a){let b=vb(e-x.x,n,c,f)+x.badness;b<=y&&(m=x,y=b)}return{index:t,x:e,priorBreak:m,badness:y}}function bb(t){return t?bb(t.priorBreak).concat(t.index):[]}function __(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function wb(t,e,n,a,c){if(!(e||n||a||c))return;let f=t.length-1,m=t[f],y=(m.x+m.metrics.advance*m.scale)*e;for(let x=0;x<=f;x++)t[x].x-=y,t[x].y+=n+a+c}function dM(t,e,n){let{horizontalAlign:a,verticalAlign:c}=__(n),f=e[0]-t.displaySize[0]*a,m=e[1]-t.displaySize[1]*c;return{image:t,top:m,bottom:m+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function Eb(t,e,n,a,c,f){let m=t.image,y;if(m.content){let H=m.content,K=m.pixelRatio||1;y=[H[0]/K,H[1]/K,m.displaySize[0]-H[2]/K,m.displaySize[1]-H[3]/K]}let x=e.left*f,b=e.right*f,D,M,S,k;n==="width"||n==="both"?(k=c[0]+x-a[3],M=c[0]+b+a[1]):(k=c[0]+(x+b-m.displaySize[0])/2,M=k+m.displaySize[0]);let L=e.top*f,z=e.bottom*f;return n==="height"||n==="both"?(D=c[1]+L-a[0],S=c[1]+z+a[2]):(D=c[1]+(L+z-m.displaySize[1])/2,S=D+m.displaySize[1]),{image:m,top:D,right:M,bottom:S,left:k,collisionPadding:y}}class el extends rt{constructor(e,n,a,c,f){super(e,n),this.angle=c,this.z=a,f!==void 0&&(this.segment=f)}clone(){return new el(this.x,this.y,this.z,this.angle,this.segment)}}function Cb(t,e,n,a,c){if(e.segment===void 0)return!0;let f=e,m=e.segment+1,y=0;for(;y>-n/2;){if(m--,m<0)return!1;y-=t[m].dist(f),f=t[m]}y+=t[m].dist(t[m+1]),m++;let x=[],b=0;for(;y<n/2;){let D=t[m],M=t[m+1];if(!M)return!1;let S=t[m-1].angleTo(D)-D.angleTo(M);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:S}),b+=S;y-x[0].distance>a;)b-=x.shift().angleDelta;if(b>c)return!1;m++,y+=D.dist(M)}return!0}function Tb(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Db(t,e,n){return t?.6*e*n:0}function Ib(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function fM(t,e,n,a,c,f){let m=Db(n,c,f),y=Ib(n,a)*f,x=0,b=Tb(t)/2;for(let D=0;D<t.length-1;D++){let M=t[D],S=t[D+1],k=M.dist(S);if(x+k>b){let L=(b-x)/k,z=Xt(M.x,S.x,L),H=Xt(M.y,S.y,L),K=new el(z,H,0,S.angleTo(M),D);return!m||Cb(t,K,y,m,e)?K:void 0}x+=k}}function pM(t,e,n,a,c,f,m,y,x){let b=Db(a,f,m),D=Ib(a,c),M=D*m,S=t[0].x===0||t[0].x===x||t[0].y===0||t[0].y===x;return e-M<e/4&&(e=M+e/4),Mb(t,S?e/2*y%e:(D/2+2*f)*m*y%e,e,b,n,M,S,!1,x)}function Mb(t,e,n,a,c,f,m,y,x){let b=f/2,D=Tb(t),M=0,S=e-n,k=[];for(let L=0;L<t.length-1;L++){let z=t[L],H=t[L+1],K=z.dist(H),se=H.angleTo(z);for(;S+n<M+K;){S+=n;let J=(S-M)/K,oe=Xt(z.x,H.x,J),ue=Xt(z.y,H.y,J);if(oe>=0&&oe<x&&ue>=0&&ue<x&&S-b>=0&&S+b<=D){let le=new el(oe,ue,0,se,L);le._round(),a&&!Cb(t,le,f,a,c)||k.push(le)}}M+=K}return y||k.length||m||(k=Mb(t,M/2,n,a,c,f,m,!0,x)),k}function Sb(t,e,n,a,c){let f=[];for(let m=0;m<t.length;m++){let y=t[m],x;for(let b=0;b<y.length-1;b++){let D=y[b],M=y[b+1];D.x<e&&M.x<e||(D.x<e?D=new rt(e,D.y+(e-D.x)/(M.x-D.x)*(M.y-D.y))._round():M.x<e&&(M=new rt(e,D.y+(e-D.x)/(M.x-D.x)*(M.y-D.y))._round()),D.y<n&&M.y<n||(D.y<n?D=new rt(D.x+(n-D.y)/(M.y-D.y)*(M.x-D.x),n)._round():M.y<n&&(M=new rt(D.x+(n-D.y)/(M.y-D.y)*(M.x-D.x),n)._round()),D.x>=a&&M.x>=a||(D.x>=a?D=new rt(a,D.y+(a-D.x)/(M.x-D.x)*(M.y-D.y))._round():M.x>=a&&(M=new rt(a,D.y+(a-D.x)/(M.x-D.x)*(M.y-D.y))._round()),D.y>=c&&M.y>=c||(D.y>=c?D=new rt(D.x+(c-D.y)/(M.y-D.y)*(M.x-D.x),c)._round():M.y>=c&&(M=new rt(D.x+(c-D.y)/(M.y-D.y)*(M.x-D.x),c)._round()),x&&D.equals(x[x.length-1])||(x=[D],f.push(x)),x.push(M)))))}}return f}pt(el,"Anchor");let Md=1e20;function Ab(t,e,n,a,c,f,m,y,x){for(let b=e;b<e+a;b++)Pb(t,n*f+b,f,c,m,y,x);for(let b=n;b<n+c;b++)Pb(t,b*f+e,1,a,m,y,x)}function Pb(t,e,n,a,c,f,m){f[0]=0,m[0]=-Md,m[1]=Md,c[0]=t[e];for(let y=1,x=0,b=0;y<a;y++){c[y]=t[e+y*n];let D=y*y;do{let M=f[x];b=(c[y]-c[M]+D-M*M)/(y-M)/2}while(b<=m[x]&&--x>-1);x++,f[x]=y,m[x]=b,m[x+1]=Md}for(let y=0,x=0;y<a;y++){for(;m[x+1]<y;)x++;let b=f[x],D=y-b;t[e+y*n]=c[b]+D*D}}let Ls=2,y_={none:0,ideographs:1,all:2};class Vu{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){let a=[];for(let c in e)for(let f of e[c])a.push({stack:c,id:f});gr(a,({stack:c,id:f},m)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=y.glyphs[f];if(x!==void 0)return void m(null,{stack:c,id:f,glyph:x});if(x=this._tinySDF(y,c,f),x)return y.glyphs[f]=x,void m(null,{stack:c,id:f,glyph:x});let b=Math.floor(f/256);if(256*b>65535)return void m(new Error("glyphs > 65535 not supported"));if(y.ranges[b])return void m(null,{stack:c,id:f,glyph:x});let D=y.requests[b];D||(D=y.requests[b]=[],Vu.loadGlyphRange(c,b,this.url,this.requestManager,(M,S)=>{if(S){y.ascender=S.ascender,y.descender=S.descender;for(let k in S.glyphs)this._doesCharSupportLocalGlyph(+k)||(y.glyphs[+k]=S.glyphs[+k]);y.ranges[b]=!0}for(let k of D)k(M,S);delete y.requests[b]})),D.push((M,S)=>{M?m(M):S&&m(null,{stack:c,id:f,glyph:S.glyphs[f]||null})})},(c,f)=>{if(c)n(c);else if(f){let m={};for(let{stack:y,id:x,glyph:b}of f)m[y]===void 0&&(m[y]={}),m[y].glyphs===void 0&&(m[y].glyphs={}),m[y].glyphs[x]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},m[y].ascender=this.entries[y].ascender,m[y].descender=this.entries[y].descender;n(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==y_.none&&(this.localGlyphMode===y_.all?!!this.localFontFamily:!!this.localFontFamily&&(ct["CJK Unified Ideographs"](e)||ct["Hangul Syllables"](e)||ct.Hiragana(e)||ct.Katakana(e)||ct["CJK Symbols and Punctuation"](e)))}_tinySDF(e,n,a){let c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let f=e.tinySDF;if(!f){let z="400";/bold/i.test(n)?z="900":/medium/i.test(n)?z="500":/light/i.test(n)&&(z="200"),f=e.tinySDF=new Vu.TinySDF({fontFamily:c,fontWeight:z,fontSize:24*Ls,buffer:3*Ls,radius:8*Ls}),f.fontWeight=z}if(this.localGlyphs[f.fontWeight][a])return this.localGlyphs[f.fontWeight][a];let m=String.fromCharCode(a),{data:y,width:x,height:b,glyphWidth:D,glyphHeight:M,glyphLeft:S,glyphTop:k,glyphAdvance:L}=f.draw(m);return this.localGlyphs[f.fontWeight][a]={id:a,bitmap:new Ja({width:x,height:b},y),metrics:{width:D/Ls,height:M/Ls,left:S/Ls,top:k/Ls-27,advance:L/Ls,localGlyph:!0}}}}Vu.loadGlyphRange=function(t,e,n,a,c){let f=256*e,m=f+255,y=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${f}-${m}`),Yi.Glyphs);Ks(y,(x,b)=>{if(x)c(x);else if(b){let D={},M=function(S){return new gp(S).readFields(aM,{})}(b);for(let S of M.glyphs)D[S.id]=S;c(null,{glyphs:D,ascender:M.ascender,descender:M.descender})}})},Vu.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;let y=this.size=t+4*e,x=this._createCanvas(y),b=this.ctx=x.getContext("2d",{willReadFrequently:!0});b.font=`${m} ${f} ${t}px ${c}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(t),m=Math.ceil(n),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),x=Math.min(this.size-this.buffer,m+Math.ceil(a)),b=y+2*this.buffer,D=x+2*this.buffer,M=Math.max(b*D,0),S=new Uint8ClampedArray(M),k={data:S,width:b,height:D,glyphWidth:y,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||x===0)return k;let{ctx:L,buffer:z,gridInner:H,gridOuter:K}=this;L.clearRect(z,z,y,x),L.fillText(t,z,z+m);let se=L.getImageData(z,z,y,x);K.fill(Md,0,M),H.fill(0,0,M);for(let J=0;J<x;J++)for(let oe=0;oe<y;oe++){let ue=se.data[4*(J*y+oe)+3]/255;if(ue===0)continue;let le=(J+z)*b+oe+z;if(ue===1)K[le]=0,H[le]=Md;else{let Me=.5-ue;K[le]=Me>0?Me*Me:0,H[le]=Me<0?Me*Me:0}}Ab(K,0,0,b,D,b,this.f,this.v,this.z),Ab(H,z,z,y,x,b,this.f,this.v,this.z);for(let J=0;J<M;J++){let oe=Math.sqrt(K[J])-Math.sqrt(H[J]);S[J]=Math.round(255-255*(oe/this.radius+this.cutoff))}return k}};let ju=Hi;function Rb(t,e,n,a){let c=[],f=t.image,m=f.pixelRatio,y=f.paddedRect.w-2*ju,x=f.paddedRect.h-2*ju,b=t.right-t.left,D=t.bottom-t.top,M=f.stretchX||[[0,y]],S=f.stretchY||[[0,x]],k=(Pe,je)=>Pe+je[1]-je[0],L=M.reduce(k,0),z=S.reduce(k,0),H=y-L,K=x-z,se=0,J=L,oe=0,ue=z,le=0,Me=H,Te=0,Fe=K;if(f.content&&a){let Pe=f.content;se=yp(M,0,Pe[0]),oe=yp(S,0,Pe[1]),J=yp(M,Pe[0],Pe[2]),ue=yp(S,Pe[1],Pe[3]),le=Pe[0]-se,Te=Pe[1]-oe,Me=Pe[2]-Pe[0]-J,Fe=Pe[3]-Pe[1]-ue}let We=(Pe,je,Ue,Ge)=>{let Qe=vp(Pe.stretch-se,J,b,t.left),ke=xp(Pe.fixed-le,Me,Pe.stretch,L),st=vp(je.stretch-oe,ue,D,t.top),gt=xp(je.fixed-Te,Fe,je.stretch,z),lt=vp(Ue.stretch-se,J,b,t.left),Nt=xp(Ue.fixed-le,Me,Ue.stretch,L),et=vp(Ge.stretch-oe,ue,D,t.top),xt=xp(Ge.fixed-Te,Fe,Ge.stretch,z),zt=new rt(Qe,st),pn=new rt(lt,st),Bt=new rt(lt,et),Tt=new rt(Qe,et),Xn=new rt(ke/m,gt/m),jt=new rt(Nt/m,xt/m),Ut=e*Math.PI/180;if(Ut){let qn=Math.sin(Ut),Bn=Math.cos(Ut),ar=[Bn,-qn,qn,Bn];zt._matMult(ar),pn._matMult(ar),Tt._matMult(ar),Bt._matMult(ar)}let zn=Pe.stretch+Pe.fixed,Hn=je.stretch+je.fixed;return{tl:zt,tr:pn,bl:Tt,br:Bt,tex:{x:f.paddedRect.x+ju+zn,y:f.paddedRect.y+ju+Hn,w:Ue.stretch+Ue.fixed-zn,h:Ge.stretch+Ge.fixed-Hn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xn,pixelOffsetBR:jt,minFontScaleX:Me/m/b,minFontScaleY:Fe/m/D,isSDF:n}};if(a&&(f.stretchX||f.stretchY)){let Pe=Ob(M,H,L),je=Ob(S,K,z);for(let Ue=0;Ue<Pe.length-1;Ue++){let Ge=Pe[Ue],Qe=Pe[Ue+1];for(let ke=0;ke<je.length-1;ke++)c.push(We(Ge,je[ke],Qe,je[ke+1]))}}else c.push(We({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return c}function yp(t,e,n){let a=0;for(let c of t)a+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return a}function Ob(t,e,n){let a=[{fixed:-ju,stretch:0}];for(let[c,f]of t){let m=a[a.length-1];a.push({fixed:c-m.stretch,stretch:m.stretch}),a.push({fixed:c-m.stretch,stretch:m.stretch+(f-c)})}return a.push({fixed:e+ju,stretch:n}),a}function vp(t,e,n,a){return t/e*n+a}function xp(t,e,n,a){return t-e*n/a}function mM(t,e,n,a){let c=e+t.positionedLines[a].lineOffset;return a===0?n+c/2:n+(c+(e+t.positionedLines[a-1].lineOffset))/2}class gM{constructor(e=[],n=_M){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:n,compare:a}=this,c=n[e];for(;e>0;){let f=e-1>>1,m=n[f];if(a(c,m)>=0)break;n[e]=m,e=f}n[e]=c}_down(e){let{data:n,compare:a}=this,c=this.length>>1,f=n[e];for(;e<c;){let m=1+(e<<1),y=n[m],x=m+1;if(x<this.length&&a(n[x],y)<0&&(m=x,y=n[x]),a(y,f)>=0)break;n[e]=y,e=m}n[e]=f}}function _M(t,e){return t<e?-1:t>e?1:0}function yM(t,e=1,n=!1){let a=1/0,c=1/0,f=-1/0,m=-1/0,y=t[0];for(let k=0;k<y.length;k++){let L=y[k];(!k||L.x<a)&&(a=L.x),(!k||L.y<c)&&(c=L.y),(!k||L.x>f)&&(f=L.x),(!k||L.y>m)&&(m=L.y)}let x=Math.min(f-a,m-c),b=x/2,D=new gM([],vM);if(x===0)return new rt(a,c);for(let k=a;k<f;k+=x)for(let L=c;L<m;L+=x)D.push(new Uu(k+b,L+b,b,t));let M=function(k){let L=0,z=0,H=0,K=k[0];for(let se=0,J=K.length,oe=J-1;se<J;oe=se++){let ue=K[se],le=K[oe],Me=ue.x*le.y-le.x*ue.y;z+=(ue.x+le.x)*Me,H+=(ue.y+le.y)*Me,L+=3*Me}return new Uu(z/L,H/L,0,k)}(t),S=D.length;for(;D.length;){let k=D.pop();(k.d>M.d||!M.d)&&(M=k,n&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,S)),k.max-M.d<=e||(b=k.h/2,D.push(new Uu(k.p.x-b,k.p.y-b,b,t)),D.push(new Uu(k.p.x+b,k.p.y-b,b,t)),D.push(new Uu(k.p.x-b,k.p.y+b,b,t)),D.push(new Uu(k.p.x+b,k.p.y+b,b,t)),S+=4)}return n&&(console.log(`num probes: ${S}`),console.log(`best distance: ${M.d}`)),M.p}function vM(t,e){return e.max-t.max}class Uu{constructor(e,n,a,c){this.p=new rt(e,n),this.h=a,this.d=function(f,m){let y=!1,x=1/0;for(let b=0;b<m.length;b++){let D=m[b];for(let M=0,S=D.length,k=S-1;M<S;k=M++){let L=D[M],z=D[k];L.y>f.y!=z.y>f.y&&f.x<(z.x-L.x)*(f.y-L.y)/(z.y-L.y)+L.x&&(y=!y),x=Math.min(x,Mx(f,L,z))}}return(y?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}let $u=7,v_=Number.POSITIVE_INFINITY,xM=Math.sqrt(2);function kb(t,[e,n]){let a=0,c=0;if(n===v_){e<0&&(e=0);let f=e/xM;switch(t){case"top-right":case"top-left":c=f-$u;break;case"bottom-right":case"bottom-left":c=-f+$u;break;case"bottom":c=-e+$u;break;case"top":c=e-$u}switch(t){case"top-right":case"bottom-right":a=-f;break;case"top-left":case"bottom-left":a=f;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":c=n-$u;break;case"bottom-right":case"bottom-left":case"bottom":c=-n+$u}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function bM(t,e,n,a,c,f,m,y,x,b){t.createArrays(),t.tilePixelRatio=bt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let D=t.layers[0].layout,M=t.layers[0]._unevaluatedLayout._values,S={};if(t.textSizeData.kind==="composite"){let{minZoom:z,maxZoom:H}=t.textSizeData;S.compositeTextSizes=[M["text-size"].possiblyEvaluate(new I(z),y),M["text-size"].possiblyEvaluate(new I(H),y)]}if(t.iconSizeData.kind==="composite"){let{minZoom:z,maxZoom:H}=t.iconSizeData;S.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new I(z),y),M["icon-size"].possiblyEvaluate(new I(H),y)]}S.layoutTextSize=M["text-size"].possiblyEvaluate(new I(x+1),y),S.layoutIconSize=M["icon-size"].possiblyEvaluate(new I(x+1),y),S.textMaxSize=M["text-size"].possiblyEvaluate(new I(18),y);let k=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",L=D.get("text-size");for(let z of t.features){let H=D.get("text-font").evaluate(z,{},y).join(","),K=L.evaluate(z,{},y),se=S.layoutTextSize.evaluate(z,{},y),J=(S.layoutIconSize.evaluate(z,{},y),{horizontal:{},vertical:void 0}),oe=z.text,ue,le=[0,0];if(oe){let Fe=oe.toString(),We=D.get("text-letter-spacing").evaluate(z,{},y)*Yr,Pe=D.get("text-line-height").evaluate(z,{},y)*Yr,je=Mg(Fe)?We:0,Ue=D.get("text-anchor").evaluate(z,{},y),Ge=D.get("text-variable-anchor");if(!Ge){let lt=D.get("text-radial-offset").evaluate(z,{},y);le=lt?kb(Ue,[lt*Yr,v_]):D.get("text-offset").evaluate(z,{},y).map(Nt=>Nt*Yr)}let Qe=k?"center":D.get("text-justify").evaluate(z,{},y),ke=D.get("symbol-placement")==="point",st=ke?D.get("text-max-width").evaluate(z,{},y)*Yr:1/0,gt=lt=>{t.allowVerticalPlacement&&Qh(Fe)&&(J.vertical=g_(oe,e,n,c,H,st,Pe,Ue,lt,je,le,Ao.vertical,!0,se,K))};if(!k&&Ge){let lt=Qe==="auto"?Ge.map(et=>x_(et)):[Qe],Nt=!1;for(let et=0;et<lt.length;et++){let xt=lt[et];if(!J.horizontal[xt])if(Nt)J.horizontal[xt]=J.horizontal[0];else{let zt=g_(oe,e,n,c,H,st,Pe,"center",xt,je,le,Ao.horizontal,!1,se,K);zt&&(J.horizontal[xt]=zt,Nt=zt.positionedLines.length===1)}}gt("left")}else{if(Qe==="auto"&&(Qe=x_(Ue)),ke||D.get("text-writing-mode").indexOf("horizontal")>=0||!Qh(Fe)){let lt=g_(oe,e,n,c,H,st,Pe,Ue,Qe,je,le,Ao.horizontal,!1,se,K);lt&&(J.horizontal[Qe]=lt)}gt(ke?"left":Qe)}}let Me=!1;if(z.icon&&z.icon.name){let Fe=a[z.icon.name];Fe&&(ue=dM(c[z.icon.name],D.get("icon-offset").evaluate(z,{},y),D.get("icon-anchor").evaluate(z,{},y)),Me=Fe.sdf,t.sdfIcons===void 0?t.sdfIcons=Fe.sdf:t.sdfIcons!==Fe.sdf&&Jn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Fe.pixelRatio!==t.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Te=Fb(J.horizontal)||J.vertical;t.iconsInText||(t.iconsInText=!!Te&&Te.iconsInText),(Te||ue)&&wM(t,z,J,ue,a,S,se,0,le,Me,m,y,b)}f&&t.generateCollisionDebugBuffers(x,t.collisionBoxArray)}function x_(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wM(t,e,n,a,c,f,m,y,x,b,D,M,S){let k=f.textMaxSize.evaluate(e,{},M);k===void 0&&(k=m);let L=t.layers[0].layout,z=L.get("icon-offset").evaluate(e,{},M),H=Fb(n.horizontal)||n.vertical,K=S.name==="globe",se=Yr,J=m/se,oe=t.tilePixelRatio*k/se,ue=(Ue=t.overscaling,t.zoom>18&&Ue>2&&(Ue>>=1),Math.max(bt/(512*Ue),1)*L.get("symbol-spacing")),le=L.get("text-padding")*t.tilePixelRatio,Me=L.get("icon-padding")*t.tilePixelRatio,Te=At(L.get("text-max-angle")),Fe=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",We=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Pe=L.get("symbol-placement"),je=ue/2;var Ue;let Ge=L.get("icon-text-fit"),Qe;a&&Ge!=="none"&&(t.allowVerticalPlacement&&n.vertical&&(Qe=Eb(a,n.vertical,Ge,L.get("icon-text-fit-padding"),z,J)),H&&(a=Eb(a,H,Ge,L.get("icon-text-fit-padding"),z,J)));let ke=(st,gt,lt)=>{if(gt.x<0||gt.x>=bt||gt.y<0||gt.y>=bt)return;let Nt=null;if(K){let{x:et,y:xt,z:zt}=S.projectTilePoint(gt.x,gt.y,lt);Nt={anchor:new el(et,xt,zt,0,void 0),up:S.upVector(lt,gt.x,gt.y)}}(function(et,xt,zt,pn,Bt,Tt,Xn,jt,Ut,zn,Hn,qn,Bn,ar,pr,Ir,Vn,Lr,Mr,hr,vn,Sr,Wn,Oi,Ar){let Kr=et.addToLineVertexArray(xt,pn),jr,ki,Ur,Ns,qu,Nd,zd,mw=0,gw=0,_w=0,yw=0,L_=-1,F_=-1,ya={},vw=Pg(""),Nc=zt?zt.anchor:xt,N_=0,z_=0;if(Ut._unevaluatedLayout.getValue("text-radial-offset")===void 0?[N_,z_]=Ut.layout.get("text-offset").evaluate(vn,{},Ar).map(io=>io*Yr):(N_=Ut.layout.get("text-radial-offset").evaluate(vn,{},Ar)*Yr,z_=v_),et.allowVerticalPlacement&&Bt.vertical){let io=Bt.vertical;if(pr)Nd=b_(io),jt&&(zd=b_(jt));else{let oo=Ut.layout.get("text-rotate").evaluate(vn,{},Ar)+90;Ur=bp(zn,Nc,xt,Hn,qn,Bn,io,ar,oo,Ir),jt&&(Ns=bp(zn,Nc,xt,Hn,qn,Bn,jt,Lr,oo))}}if(Tt){let io=Ut.layout.get("icon-rotate").evaluate(vn,{},Ar),oo=Ut.layout.get("icon-text-fit")!=="none",Bd=Rb(Tt,io,Wn,oo),V_=jt?Rb(jt,io,Wn,oo):void 0;ki=bp(zn,Nc,xt,Hn,qn,Bn,Tt,Lr,io),mw=4*Bd.length;let xw=et.iconSizeData,zc=null;xw.kind==="source"?(zc=[ks*Ut.layout.get("icon-size").evaluate(vn,{},Ar)],zc[0]>Rl&&Jn(`${et.layerIds[0]}: Value for "icon-size" is >= ${Sd}. Reduce your "icon-size".`)):xw.kind==="composite"&&(zc=[ks*Sr.compositeIconSizes[0].evaluate(vn,{},Ar),ks*Sr.compositeIconSizes[1].evaluate(vn,{},Ar)],(zc[0]>Rl||zc[1]>Rl)&&Jn(`${et.layerIds[0]}: Value for "icon-size" is >= ${Sd}. Reduce your "icon-size".`)),et.addSymbols(et.icon,Bd,zc,hr,Mr,vn,!1,zt,xt,Kr.lineStartIndex,Kr.lineLength,-1,Oi,Ar),L_=et.icon.placedSymbolArray.length-1,V_&&(gw=4*V_.length,et.addSymbols(et.icon,V_,zc,hr,Mr,vn,Ao.vertical,zt,xt,Kr.lineStartIndex,Kr.lineLength,-1,Oi,Ar),F_=et.icon.placedSymbolArray.length-1)}for(let io in Bt.horizontal){let oo=Bt.horizontal[io];jr||(vw=Pg(oo.text),pr?qu=b_(oo):jr=bp(zn,Nc,xt,Hn,qn,Bn,oo,ar,Ut.layout.get("text-rotate").evaluate(vn,{},Ar),Ir));let Bd=oo.positionedLines.length===1;if(_w+=Lb(et,zt,xt,oo,Xn,Ut,pr,vn,Ir,Kr,Bt.vertical?Ao.horizontal:Ao.horizontalOnly,Bd?Object.keys(Bt.horizontal):[io],ya,L_,Sr,Oi,Ar),Bd)break}Bt.vertical&&(yw+=Lb(et,zt,xt,Bt.vertical,Xn,Ut,pr,vn,Ir,Kr,Ao.vertical,["vertical"],ya,F_,Sr,Oi,Ar));let zl=-1,B_=(io,oo)=>io?Math.max(io,oo):oo;zl=B_(qu,zl),zl=B_(Nd,zl),zl=B_(zd,zl);let YM=zl>-1?1:0;et.glyphOffsetArray.length>=kl.MAX_GLYPHS&&Jn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vn.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,vn.sortKey),et.symbolInstances.emplaceBack(Nc.x,Nc.y,Nc.z,xt.x,xt.y,ya.right>=0?ya.right:-1,ya.center>=0?ya.center:-1,ya.left>=0?ya.left:-1,ya.vertical>=0?ya.vertical:-1,L_,F_,vw,jr!==void 0?jr:et.collisionBoxArray.length,jr!==void 0?jr+1:et.collisionBoxArray.length,Ur!==void 0?Ur:et.collisionBoxArray.length,Ur!==void 0?Ur+1:et.collisionBoxArray.length,ki!==void 0?ki:et.collisionBoxArray.length,ki!==void 0?ki+1:et.collisionBoxArray.length,Ns||et.collisionBoxArray.length,Ns?Ns+1:et.collisionBoxArray.length,Hn,_w,yw,mw,gw,YM,0,N_,z_,zl)})(t,gt,Nt,st,n,a,c,Qe,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,le,Fe,x,0,Me,We,z,e,f,b,D,M)};if(Pe==="line")for(let st of Sb(e.geometry,0,0,bt,bt)){let gt=pM(st,ue,Te,n.vertical||H,a,se,oe,t.overscaling,bt);for(let lt of gt)H&&EM(t,H.text,je,lt)||ke(st,lt,M)}else if(Pe==="line-center"){for(let st of e.geometry)if(st.length>1){let gt=fM(st,Te,n.vertical||H,a,se,oe);gt&&ke(st,gt,M)}}else if(e.type==="Polygon")for(let st of a_(e.geometry,0)){let gt=yM(st,16);ke(st[0],new el(gt.x,gt.y,0,0,void 0),M)}else if(e.type==="LineString")for(let st of e.geometry)ke(st,new el(st[0].x,st[0].y,0,0,void 0),M);else if(e.type==="Point")for(let st of e.geometry)for(let gt of st)ke([gt],new el(gt.x,gt.y,0,0,void 0),M)}let Sd=255,Rl=Sd*ks;function Lb(t,e,n,a,c,f,m,y,x,b,D,M,S,k,L,z,H){let K=function(oe,ue,le,Me,Te,Fe,We,Pe){let je=[];if(ue.positionedLines.length===0)return je;let Ue=Me.layout.get("text-rotate").evaluate(Fe,{})*Math.PI/180,Ge=function(lt){let Nt=lt[0],et=lt[1],xt=Nt*et;return xt>0?[Nt,-et]:xt<0?[-Nt,et]:Nt===0?[et,Nt]:[et,-Nt]}(le),Qe=Math.abs(ue.top-ue.bottom);for(let lt of ue.positionedLines)Qe-=lt.lineOffset;let ke=ue.positionedLines.length,st=Qe/ke,gt=ue.top-le[1];for(let lt=0;lt<ke;++lt){let Nt=ue.positionedLines[lt];gt=mM(ue,st,gt,lt);for(let et of Nt.positionedGlyphs){if(!et.rect)continue;let xt=et.rect||{},zt=mb+1,pn=!0,Bt=1,Tt=0;if(et.imageName){let Wn=We[et.imageName];if(!Wn)continue;if(Wn.sdf){Jn("SDF images are not supported in formatted text and will be ignored.");continue}pn=!1,Bt=Wn.pixelRatio,zt=Hi/Bt}let Xn=(Te||Pe)&&et.vertical,jt=et.metrics.advance*et.scale/2,Ut=et.metrics,zn=et.rect;if(zn===null)continue;Pe&&ue.verticalizable&&(Tt=et.imageName?jt-et.metrics.width*et.scale/2:0);let Hn=Te?[et.x+jt,et.y]:[0,0],qn=[0,0],Bn=[0,0],ar=!1;Te||(Xn?(Bn=[et.x+jt+Ge[0],et.y+Ge[1]-Tt],ar=!0):qn=[et.x+jt+le[0],et.y+le[1]-Tt]);let pr=zn.w*et.scale/(Bt*(et.localGlyph?Ls:1)),Ir=zn.h*et.scale/(Bt*(et.localGlyph?Ls:1)),Vn,Lr,Mr,hr;if(Xn){let Wn=et.y-gt,Oi=new rt(-jt,jt-Wn),Ar=-Math.PI/2,Kr=new rt(...Bn);Vn=new rt(-jt+qn[0],qn[1]),Vn._rotateAround(Ar,Oi)._add(Kr),Vn.x+=-Wn+jt,Vn.y-=(Ut.left-zt)*et.scale;let jr=et.imageName?Ut.advance*et.scale:Yr*et.scale,ki=String.fromCharCode(et.glyph);YI(ki)?Vn.x+=(1-zt)*et.scale:KI(ki)?Vn.x+=jr-Ut.height*et.scale+(-zt-1)*et.scale:Vn.x+=et.imageName||Ut.width+2*zt===zn.w&&Ut.height+2*zt===zn.h?(jr-Ir)/2:(jr-(Ut.height+2*zt)*et.scale)/2,Lr=new rt(Vn.x,Vn.y-pr),Mr=new rt(Vn.x+Ir,Vn.y),hr=new rt(Vn.x+Ir,Vn.y-pr)}else{let Wn=(Ut.left-zt)*et.scale-jt+qn[0],Oi=(-Ut.top-zt)*et.scale+qn[1],Ar=Wn+pr,Kr=Oi+Ir;Vn=new rt(Wn,Oi),Lr=new rt(Ar,Oi),Mr=new rt(Wn,Kr),hr=new rt(Ar,Kr)}if(Ue){let Wn;Wn=Te?new rt(0,0):ar?new rt(Ge[0],Ge[1]):new rt(le[0],le[1]),Vn._rotateAround(Ue,Wn),Lr._rotateAround(Ue,Wn),Mr._rotateAround(Ue,Wn),hr._rotateAround(Ue,Wn)}let vn=new rt(0,0),Sr=new rt(0,0);je.push({tl:Vn,tr:Lr,bl:Mr,br:hr,tex:xt,writingMode:ue.writingMode,glyphOffset:Hn,sectionIndex:et.sectionIndex,isSDF:pn,pixelOffsetTL:vn,pixelOffsetBR:Sr,minFontScaleX:0,minFontScaleY:0})}}return je}(0,a,x,f,m,y,c,t.allowVerticalPlacement),se=t.textSizeData,J=null;se.kind==="source"?(J=[ks*f.layout.get("text-size").evaluate(y,{},H)],J[0]>Rl&&Jn(`${t.layerIds[0]}: Value for "text-size" is >= ${Sd}. Reduce your "text-size".`)):se.kind==="composite"&&(J=[ks*L.compositeTextSizes[0].evaluate(y,{},H),ks*L.compositeTextSizes[1].evaluate(y,{},H)],(J[0]>Rl||J[1]>Rl)&&Jn(`${t.layerIds[0]}: Value for "text-size" is >= ${Sd}. Reduce your "text-size".`)),t.addSymbols(t.text,K,J,x,m,y,D,e,n,b.lineStartIndex,b.lineLength,k,z,H);for(let oe of M)S[oe]=t.text.placedSymbolArray.length-1;return 4*K.length}function Fb(t){for(let e in t)return t[e];return null}function bp(t,e,n,a,c,f,m,y,x,b){let D=m.top,M=m.bottom,S=m.left,k=m.right,L=m.collisionPadding;if(L&&(S-=L[0],D-=L[1],k+=L[2],M+=L[3]),x){let z=new rt(S,D),H=new rt(k,D),K=new rt(S,M),se=new rt(k,M),J=At(x),oe=new rt(0,0);b&&(oe=new rt(b[0],b[1])),z._rotateAround(J,oe),H._rotateAround(J,oe),K._rotateAround(J,oe),se._rotateAround(J,oe),S=Math.min(z.x,H.x,K.x,se.x),k=Math.max(z.x,H.x,K.x,se.x),D=Math.min(z.y,H.y,K.y,se.y),M=Math.max(z.y,H.y,K.y,se.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,S,D,k,M,y,a,c,f),t.length-1}function b_(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function EM(t,e,n,a){let c=t.compareText;if(e in c){let f=c[e];for(let m=f.length-1;m>=0;m--)if(a.dist(f[m])<n)return!0}else c[e]=[];return c[e].push(a),!1}function Nb(t,e){let n=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),f=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),m=Math.sin(t._pitch)*f+c;return Math.min(1.01*m,c*(1/t._horizonShift))}function Lc(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),a=t.x*n,c=(t.x+1)*n,f=t.y*n,m=(t.y+1)*n,y=So(a),x=So(c),b=ci(f),D=ci(m),M=e.project(y,b),S=e.project(x,b),k=e.project(x,D),L=e.project(y,D),z=Math.min(M.x,S.x,k.x,L.x),H=Math.min(M.y,S.y,k.y,L.y),K=Math.max(M.x,S.x,k.x,L.x),se=Math.max(M.y,S.y,k.y,L.y),J=n/16;function oe(le,Me,Te,Fe,We,Pe){let je=(Te+We)/2,Ue=(Fe+Pe)/2,Ge=e.project(So(je),ci(Ue)),Qe=Math.max(0,z-Ge.x,H-Ge.y,Ge.x-K,Ge.y-se);z=Math.min(z,Ge.x),K=Math.max(K,Ge.x),H=Math.min(H,Ge.y),se=Math.max(se,Ge.y),Qe>J&&(oe(le,Ge,Te,Fe,je,Ue),oe(Ge,Me,je,Ue,We,Pe))}oe(M,S,a,f,c,f),oe(S,k,c,f,c,m),oe(k,L,c,m,a,m),oe(L,M,a,m,a,f),z-=J,H-=J,K+=J,se+=J;let ue=1/Math.max(K-z,se-H);return{scale:ue,x:z*ue,y:H*ue,x2:K*ue,y2:se*ue,projection:e}}let CM=Ps(new Float32Array(16));class Ol{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Nn(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return Os(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return Nb(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,c){let f=e.horizonLineFromTop(!1),m=new rt(n,Math.max(f,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,c))}pointCoordinate3D(e,n,a){let c=new rt(n,a);if(e.elevation)return e.elevation.pointCoordinate(c);{let f=this.pointCoordinate(e,c.x,c.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);let a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return CM}createTileMatrix(e,n,a){let c,f,m,y=a.canonical,x=Ps(new Float64Array(16));if(this.isReprojectedInTileSpace){let b=Lc(y,this);c=1,f=b.x+a.wrap*b.scale,m=b.y,Mc(x,x,[c/b.scale,c/b.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*a.wrap)*c,m=y.y*c;return sd(x,x,[f,m,0]),Mc(x,x,[c/bt,c/bt,1]),x}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class TM extends Ol{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(At(n));this.n=(c+Math.sin(At(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:a,c,r0:f}=this,m=At(e-this.center[0]),y=At(n),x=Math.sqrt(c-2*a*Math.sin(y))/a;return{x:x*Math.sin(m*a),y:x*Math.cos(m*a)-f,z:0}}unproject(e,n){let{n:a,c,r0:f}=this,m=f+n,y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));let x=At(this.center[0])*a;y=mr(y,-Math.PI-x,Math.PI-x);let b=Ht(Pr(y/a)+this.center[0],-180,180),D=Math.asin(Ht((c-(e*e+m*m)*a*a)/(2*a),-1,1)),M=Ht(Pr(D),-ui,ui);return new Nn(b,M)}}let Ad=1.340264,Pd=-.081106,Rd=893e-6,Od=.003796,wp=Math.sqrt(3)/2;class DM extends Ol{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(wp*Math.sin(n)),c=a*a,f=c*c*c;return{x:.5*(e*Math.cos(a)/(wp*(Ad+3*Pd*c+f*(7*Rd+9*Od*c)))/Math.PI+.5),y:1-.5*(a*(Ad+Pd*c+f*(Rd+Od*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=a*a,f=c*c*c;for(let D,M,S,k=0;k<12&&(M=a*(Ad+Pd*c+f*(Rd+Od*c))-n,S=Ad+3*Pd*c+f*(7*Rd+9*Od*c),D=M/S,a=Ht(a-D,-Math.PI/3,Math.PI/3),c=a*a,f=c*c*c,!(Math.abs(D)<1e-12));++k);let m=wp*e*(Ad+3*Pd*c+f*(7*Rd+9*Od*c))/Math.cos(a),y=Math.asin(Math.sin(a)/wp),x=Ht(180*m/Math.PI,-180,180),b=Ht(180*y/Math.PI,-ui,ui);return new Nn(x,b)}}class IM extends Ol{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let a=360*(e-.5),c=Ht(360*(.5-n),-ui,ui);return new Nn(a,c)}}let Gu=Math.PI/2;function Ep(t){return Math.tan((Gu+t)/2)}class MM extends Ol{constructor(e){super(e),this.center=e.center||[0,30];let[n,a]=this.parallels=e.parallels||[30,30],c=At(n),f=At(a);this.southernCenter=c+f<0,this.southernCenter&&(c=-c,f=-f);let m=Math.cos(c),y=Ep(c);this.n=c===f?Math.sin(c):Math.log(m/Math.cos(f))/Math.log(Ep(f)/y),this.f=m*Math.pow(Ep(c),this.n)/this.n}project(e,n){n=At(n),this.southernCenter&&(n=-n),e=At(e-this.center[0]);let a=1e-6,{n:c,f}=this;f>0?n<-Gu+a&&(n=-Gu+a):n>Gu-a&&(n=Gu-a);let m=f/Math.pow(Ep(n),c),y=m*Math.sin(c*e),x=f-m*Math.cos(c*e);return y=.5*(y/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:y,y:this.southernCenter?x:1-x,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:a,f:c}=this,f=c-n,m=Math.sign(f),y=Math.sign(a)*Math.sqrt(e*e+f*f),x=Math.atan2(e,Math.abs(f))*m;f*a<0&&(x-=Math.PI*Math.sign(e)*m);let b=Ht(Pr(x/a)+this.center[0],-180,180),D=Ht(Pr(2*Math.atan(Math.pow(c/y,1/a))-Gu),-ui,ui);return new Nn(b,this.southernCenter?-D:D)}}class zb extends Ol{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:fa(e),y:pa(n),z:0}}unproject(e,n){let a=So(e),c=ci(n);return new Nn(a,c)}}let Bb=At(ui);class SM extends Ol{project(e,n){let a=(n=At(n))*n,c=a*a;return{x:.5*((e=At(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=25,f=0,m=a*a;do{m=a*a;let b=m*m;f=(a*(1.007226+m*(.015085+b*(.028874*m-.044475-.005916*b)))-n)/(1.007226+m*(.045255+b*(.259866*m-.311325-.005916*11*b))),a=Ht(a-f,-Bb,Bb)}while(Math.abs(f)>1e-6&&--c>0);m=a*a;let y=Ht(Pr(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),x=Pr(a);return new Nn(y,x)}}let Vb=At(ui);class AM extends Ol{project(e,n){n=At(n),e=At(e);let a=Math.cos(n),c=2/Math.PI,f=Math.acos(a*Math.cos(e/2)),m=Math.sin(f)/f,y=.5*(e*c+2*a*Math.sin(e/2)/m)||0,x=.5*(n+Math.sin(n)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,f=25,m=1e-6,y=0,x=0;do{let b=Math.cos(c),D=Math.sin(c),M=2*D*b,S=D*D,k=b*b,L=Math.cos(a/2),z=Math.sin(a/2),H=2*L*z,K=z*z,se=1-k*L*L,J=se?1/se:0,oe=se?Math.acos(b*L)*Math.sqrt(1/se):0,ue=.5*(2*oe*b*z+2*a/Math.PI)-e,le=.5*(oe*D+c)-n,Me=.5*J*(k*K+oe*b*L*S)+1/Math.PI,Te=J*(H*M/4-oe*D*z),Fe=.125*J*(M*z-oe*D*k*H),We=.5*J*(S*L+oe*K*b)+.5,Pe=Te*Fe-We*Me;y=(le*Te-ue*We)/Pe,x=(ue*Fe-le*Me)/Pe,a=Ht(a-y,-Math.PI,Math.PI),c=Ht(c-x,-Vb,Vb)}while((Math.abs(y)>m||Math.abs(x)>m)&&--f>0);return new Nn(Pr(a),Pr(c))}}class jb extends Ol{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(At(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:a,cosPhi:c}=this;return{x:At(e)*c*a+.5,y:-Math.sin(At(n))/c*a+.5,z:0}}unproject(e,n){let{scale:a,cosPhi:c}=this,f=-(n-.5)/a,m=Ht(Pr((e-.5)/a)/c,-180,180),y=Math.asin(Ht(f*c,-1,1)),x=Ht(Pr(y),-ui,ui);return new Nn(m,x)}}class PM extends zb{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){let c=pd(e,n,a);return vr(c,c,md(da(a))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){let a=Su(n.lat,n.lng),c=Ai([],a),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;ud(a,a,c,Os(1,0)*bt*f);let m=Ps(new Float64Array(16));return Ic(m,e.pixelMatrix,e.globeMatrix),vr(a,a,m),new rt(a[0],a[1])}pixelsPerMeter(e,n){return Os(1,0)*n}pixelSpaceConversion(e,n,a){let c=Os(1,e)*n,f=Xt(Os(1,45)*n,c,a);return this.pixelsPerMeter(e,n)/f}createTileMatrix(e,n,a){let c=Hg(da(a.canonical));return Ic(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){let{center:a}=e,c=md(da(n));return Kf(c,c,At(a.lng)),Lg(c,c,At(a.lat)),Mc(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,a,c){return px(e,n,a,!0)||new Pu(0,0)}pointCoordinate3D(e,n,a){let c=this.pointCoordinate(e,n,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!px(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(c,f){let m=c.cameraToCenterDistance,y=c._centerAltitude*f,x=c._camera,b=c._camera.forward(),D=Ya([],Mo([],b,-m),[0,0,y]),M=c.worldSize/(2*Math.PI),S=[0,0,-M],k=c.width/c.height,L=Math.tan(c.fovAboveCenter),z=Mo([],x.up(),L),H=Mo([],x.right(),L*k),K=Ai([],Ya([],Ya([],b,z),H)),se=[],J;if(new Bg(D,K).closestPointOnSphere(S,M,se)){let oe=Ya([],se,S),ue=Rs([],oe,D);J=Math.cos(c.fovAboveCenter)*ad(ue)}else{let oe=Rs([],D,S),ue=Rs([],S,D);Ai(ue,ue);let le=ad(oe)-M;J=Math.sqrt(le*(le+2*M));let Me=Math.acos(J/(M+le))-Math.acos(ns(b,ue));J*=Math.cos(Me)}return 1.01*J}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Au(e.zoom);if(a>0){let c=Nb(e,Os(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Xt(n,c+f*(1-Math.cos(m)),Math.pow(a,10))}return n}upVector(e,n,a){return pd(n,a,e,1)}upVectorScale(e){return{metersToTile:Jf(ep(da(e)))}}}function Ub(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new zb(t);case"equirectangular":return new IM(t);case"naturalEarth":return new SM(t);case"equalEarth":return new DM(t);case"winkelTripel":return new AM(t);case"albers":return n?new jb(t):new TM(t);case"lambertConformalConic":return n?new jb(t):new MM(t);case"globe":return new PM(t)}throw new Error(`Invalid projection name: ${t.name}`)}let RM=up.types,OM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Cp(t,e,n,a,c,f,m,y,x,b,D,M,S){let k=y?Math.min(Rl,Math.round(y[0])):0,L=y?Math.min(Rl,Math.round(y[1])):0;t.emplaceBack(e,n,Math.round(32*a),Math.round(32*c),f,m,(k<<1)+(x?1:0),L,16*b,16*D,256*M,256*S)}function Tp(t,e,n,a,c,f,m){t.emplaceBack(e,n,a,c,f,m)}function Dp(t,e,n,a,c){t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c)}function kM(t){for(let e of t.sections)if(Ag(e.text))return!0;return!1}class w_{constructor(e){this.layoutVertexArray=new $e,this.indexArray=new _t,this.programConfigurations=e,this.segments=new Tr,this.dynamicLayoutVertexArray=new He,this.opacityVertexArray=new vt,this.placedSymbolArray=new Cr,this.globeExtVertexArray=new Je}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,UI.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,GI.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,OM,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$I.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}pt(w_,"SymbolBuffers");class E_{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new Tr,this.collisionVertexArray=new Qt,this.collisionVertexArrayExt=new Kt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,HI.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,qI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}pt(E_,"CollisionBuffers");class kl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ps([]),this.placementViewportMatrix=Ps([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=h_(this.zoom,n["text-size"]),this.iconSizeData=h_(this.zoom,n["icon-size"]);let a=this.layers[0].layout,c=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(m=>Ao[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new w_(new Dc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new w_(new Dc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Si,this.lineVertexArray=new Cu,this.symbolInstances=new er}calculateGlyphDependencies(e,n,a,c,f){for(let m=0;m<e.length;m++)if(n[e.charCodeAt(m)]=!0,c&&f){let y=Dd[e.charAt(m)];y&&(n[y.charCodeAt(0)]=!0)}}populate(e,n,a,c){let f=this.layers[0],m=f.layout,y=this.projection.name==="globe",x=m.get("text-font"),b=m.get("text-field"),D=m.get("icon-image"),M=(b.value.kind!=="constant"||b.value.value instanceof Tn&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),S=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,k=m.get("symbol-sort-key");if(this.features=[],!M&&!S)return;let L=n.iconDependencies,z=n.glyphDependencies,H=n.availableImages,K=new I(this.zoom);for(let{feature:se,id:J,index:oe,sourceLayerIndex:ue}of e){let le=f._featureFilter.needGeometry,Me=Rc(se,le);if(!f._featureFilter.filter(K,Me,a))continue;if(le||(Me.geometry=Ka(se,a,c)),y&&se.type!==1&&a.z<=5){let Pe=Me.geometry,je=.98078528056,Ue=(Ge,Qe)=>ns(pd(Ge.x,Ge.y,a,1),pd(Qe.x,Qe.y,a,1))<je;for(let Ge=0;Ge<Pe.length;Ge++)Pe[Ge]=GD(Pe[Ge],Ue)}let Te,Fe;if(M){let Pe=f.getValueAndResolveTokens("text-field",Me,a,H),je=Tn.factory(Pe);kM(je)&&(this.hasRTLText=!0),(!this.hasRTLText||v()==="unavailable"||this.hasRTLText&&T.isParsed())&&(Te=XI(je,f,Me))}if(S){let Pe=f.getValueAndResolveTokens("icon-image",Me,a,H);Fe=Pe instanceof Dn?Pe:Dn.fromString(Pe)}if(!Te&&!Fe)continue;let We=this.sortFeaturesByKey?k.evaluate(Me,{},a):void 0;if(this.features.push({id:J,text:Te,icon:Fe,index:oe,sourceLayerIndex:ue,geometry:Me.geometry,properties:se.properties,type:RM[se.type],sortKey:We}),Fe&&(L[Fe.name]=!0),Te){let Pe=x.evaluate(Me,{},a).join(","),je=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ao.vertical)>=0;for(let Ue of Te.sections)if(Ue.image)L[Ue.image.name]=!0;else{let Ge=Qh(Te.toString()),Qe=Ue.fontStack||Pe,ke=z[Qe]=z[Qe]||{};this.calculateGlyphDependencies(Ue.text,ke,je,this.allowVerticalPlacement,Ge)}}}m.get("symbol-placement")==="line"&&(this.features=function(se){let J={},oe={},ue=[],le=0;function Me(Pe){ue.push(se[Pe]),le++}function Te(Pe,je,Ue){let Ge=oe[Pe];return delete oe[Pe],oe[je]=Ge,ue[Ge].geometry[0].pop(),ue[Ge].geometry[0]=ue[Ge].geometry[0].concat(Ue[0]),Ge}function Fe(Pe,je,Ue){let Ge=J[je];return delete J[je],J[Pe]=Ge,ue[Ge].geometry[0].shift(),ue[Ge].geometry[0]=Ue[0].concat(ue[Ge].geometry[0]),Ge}function We(Pe,je,Ue){let Ge=Ue?je[0][je[0].length-1]:je[0][0];return`${Pe}:${Ge.x}:${Ge.y}`}for(let Pe=0;Pe<se.length;Pe++){let je=se[Pe],Ue=je.geometry,Ge=je.text?je.text.toString():null;if(!Ge){Me(Pe);continue}let Qe=We(Ge,Ue),ke=We(Ge,Ue,!0);if(Qe in oe&&ke in J&&oe[Qe]!==J[ke]){let st=Fe(Qe,ke,Ue),gt=Te(Qe,ke,ue[st].geometry);delete J[Qe],delete oe[ke],oe[We(Ge,ue[gt].geometry,!0)]=gt,ue[st].geometry=null}else Qe in oe?Te(Qe,ke,Ue):ke in J?Fe(Qe,ke,Ue):(Me(Pe),J[Qe]=le-1,oe[ke]=le-1)}return ue.filter(Pe=>Pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,J)=>se.sortKey-J.sortKey)}update(e,n,a,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,a,c),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,a,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Ub(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:c,y:f}of n)this.lineVertexArray.emplaceBack(c,f);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,c,f,m,y,x,b,D,M,S,k,L){let z=e.indexArray,H=e.layoutVertexArray,K=e.globeExtVertexArray,se=e.segments.prepareSegment(4*n.length,H,z,this.canOverlap?m.sortKey:void 0),J=this.glyphOffsetArray.length,oe=se.vertexLength,ue=this.allowVerticalPlacement&&y===Ao.vertical?Math.PI/2:0,le=m.text&&m.text.sections;for(let Te=0;Te<n.length;Te++){let{tl:Fe,tr:We,bl:Pe,br:je,tex:Ue,pixelOffsetTL:Ge,pixelOffsetBR:Qe,minFontScaleX:ke,minFontScaleY:st,glyphOffset:gt,isSDF:lt,sectionIndex:Nt}=n[Te],et=se.vertexLength,xt=gt[1];if(Cp(H,b.x,b.y,Fe.x,xt+Fe.y,Ue.x,Ue.y,a,lt,Ge.x,Ge.y,ke,st),Cp(H,b.x,b.y,We.x,xt+We.y,Ue.x+Ue.w,Ue.y,a,lt,Qe.x,Ge.y,ke,st),Cp(H,b.x,b.y,Pe.x,xt+Pe.y,Ue.x,Ue.y+Ue.h,a,lt,Ge.x,Qe.y,ke,st),Cp(H,b.x,b.y,je.x,xt+je.y,Ue.x+Ue.w,Ue.y+Ue.h,a,lt,Qe.x,Qe.y,ke,st),x){let{x:zt,y:pn,z:Bt}=x.anchor,[Tt,Xn,jt]=x.up;Tp(K,zt,pn,Bt,Tt,Xn,jt),Tp(K,zt,pn,Bt,Tt,Xn,jt),Tp(K,zt,pn,Bt,Tt,Xn,jt),Tp(K,zt,pn,Bt,Tt,Xn,jt),Dp(e.dynamicLayoutVertexArray,zt,pn,Bt,ue)}else Dp(e.dynamicLayoutVertexArray,b.x,b.y,b.z,ue);z.emplaceBack(et,et+1,et+2),z.emplaceBack(et+1,et+2,et+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),Te!==n.length-1&&Nt===n[Te+1].sectionIndex||e.programConfigurations.populatePaintArrays(H.length,m,m.index,{},k,L,le&&le[Nt])}let Me=x?x.anchor:b;e.placedSymbolArray.emplaceBack(Me.x,Me.y,Me.z,b.x,b.y,J,this.glyphOffsetArray.length-J,oe,D,M,b.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],y,0,!1,0,S,0)}_commitLayoutVertex(e,n,a,c,f,m,y){e.emplaceBack(n,a,c,f,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,n,a,c,f,m,y){let x=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),b=x.vertexLength,D=y.tileAnchorX,M=y.tileAnchorY;for(let k=0;k<4;k++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,c,f,m,D,M,new rt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,f,m,D,M,new rt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,f,m,D,M,new rt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,f,m,D,M,new rt(e.x1,e.y2)),x.vertexLength+=4;let S=a.indexArray;S.emplaceBack(b,b+1),S.emplaceBack(b+1,b+2),S.emplaceBack(b+2,b+3),S.emplaceBack(b+3,b),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,c,f,m){for(let y=c;y<f;y++){let x=a.get(y),b=this.getSymbolInstanceTextSize(e,m,n,y);this._addCollisionDebugVertices(x,b,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,n,a,c,f,m){for(let y=c;y<f;y++){let x=a.get(y),b=this.getSymbolInstanceIconSize(e,n,m.placedIconSymbolIndex);this._addCollisionDebugVertices(x,b,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new E_(mt,ab.members,Vr),this.iconCollisionBox=new E_(mt,ab.members,Vr);let a=Fu(this.iconSizeData,e),c=Fu(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){let m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(c,e,n,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(c,e,n,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,n,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,n,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,n,a,c){let f=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),m=pp(this.textSizeData,e,f)/Yr;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,n,a){let c=this.icon.placedSymbolArray.get(a),f=pp(this.iconSizeData,e,c);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,n,a){e.emplaceBack(n,-a,-a),e.emplaceBack(n,a,-a),e.emplaceBack(n,a,a),e.emplaceBack(n,-a,a)}_updateTextDebugCollisionBoxes(e,n,a,c,f,m){for(let y=c;y<f;y++){let x=a.get(y),b=this.getSymbolInstanceTextSize(e,m,n,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,x.padding)}}_updateIconDebugCollisionBoxes(e,n,a,c,f,m){for(let y=c;y<f;y++){let x=a.get(y),b=this.getSymbolInstanceIconSize(e,n,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,x.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=Fu(this.iconSizeData,e),c=Fu(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){let m=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(c,e,n,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(c,e,n,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(a,e,n,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,e,n,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,c,f,m,y,x,b){let D={};if(n<a){let{x1:M,y1:S,x2:k,y2:L,padding:z,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:J,tileAnchorY:oe,featureIndex:ue}=e.get(n);D.textBox={x1:M,y1:S,x2:k,y2:L,padding:z,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:J,tileAnchorY:oe},D.textFeatureIndex=ue}if(c<f){let{x1:M,y1:S,x2:k,y2:L,padding:z,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:J,tileAnchorY:oe,featureIndex:ue}=e.get(c);D.verticalTextBox={x1:M,y1:S,x2:k,y2:L,padding:z,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:J,tileAnchorY:oe},D.verticalTextFeatureIndex=ue}if(m<y){let{x1:M,y1:S,x2:k,y2:L,padding:z,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:J,tileAnchorY:oe,featureIndex:ue}=e.get(m);D.iconBox={x1:M,y1:S,x2:k,y2:L,padding:z,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:J,tileAnchorY:oe},D.iconFeatureIndex=ue}if(x<b){let{x1:M,y1:S,x2:k,y2:L,padding:z,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:J,tileAnchorY:oe,featureIndex:ue}=e.get(x);D.verticalIconBox={x1:M,y1:S,x2:k,y2:L,padding:z,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:J,tileAnchorY:oe},D.verticalIconFeatureIndex=ue}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){let a=e.placedSymbolArray.get(n),c=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<c;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),a=Math.cos(e),c=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);let x=this.symbolInstances.get(y);c.push(0|Math.round(n*x.tileAnchorX+a*x.tileAnchorY)),f.push(x.featureIndex)}return m.sort((y,x)=>c[y]-c[x]||f[x]-f[y]),m}addToSortKeyRanges(e,n){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:b}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),f>=0&&f!==c&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==c&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}pt(kl,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),kl.MAX_GLYPHS=65535,kl.addDynamicAttributes=Dp;let LM=new te({"symbol-placement":new N(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new N(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new N(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new q(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new N(Oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new N(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new N(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new N(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new N(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new q(Oe.layout_symbol["icon-size"]),"icon-text-fit":new N(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new N(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new q(Oe.layout_symbol["icon-image"]),"icon-rotate":new q(Oe.layout_symbol["icon-rotate"]),"icon-padding":new N(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new N(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new q(Oe.layout_symbol["icon-offset"]),"icon-anchor":new q(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new N(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new N(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new N(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new q(Oe.layout_symbol["text-field"]),"text-font":new q(Oe.layout_symbol["text-font"]),"text-size":new q(Oe.layout_symbol["text-size"]),"text-max-width":new q(Oe.layout_symbol["text-max-width"]),"text-line-height":new q(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new q(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new q(Oe.layout_symbol["text-justify"]),"text-radial-offset":new q(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new N(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new q(Oe.layout_symbol["text-anchor"]),"text-max-angle":new N(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new N(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new q(Oe.layout_symbol["text-rotate"]),"text-padding":new N(Oe.layout_symbol["text-padding"]),"text-keep-upright":new N(Oe.layout_symbol["text-keep-upright"]),"text-transform":new q(Oe.layout_symbol["text-transform"]),"text-offset":new q(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new N(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new N(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new N(Oe.layout_symbol["text-optional"])});var C_={paint:new te({"icon-opacity":new q(Oe.paint_symbol["icon-opacity"]),"icon-color":new q(Oe.paint_symbol["icon-color"]),"icon-halo-color":new q(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new q(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new q(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new N(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new N(Oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new q(Oe.paint_symbol["text-opacity"]),"text-color":new q(Oe.paint_symbol["text-color"],{runtimeType:fi,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new q(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new q(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new q(Oe.paint_symbol["text-halo-blur"]),"text-translate":new N(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new N(Oe.paint_symbol["text-translate-anchor"])}),layout:LM};class $b{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:$o,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt($b,"FormatSectionOverride",{omit:["defaultValue"]});class Ip extends As{constructor(e){super(e,C_)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let c=[];for(let f of a)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,a,c){let f=this.layout.get(e).evaluate(n,{},a,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||To(m.value)||!f?f:function(y,x){return x.replace(/{([^{}]+)}/g,(b,D)=>D in y?String(y[D]):"")}(n.properties,f)}createBucket(e){return new kl(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of C_.paint.overridableProperties){if(!Ip.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),a=new $b(n),c=new Is(a,n.property.specification),f=null;f=n.value.kind==="constant"||n.value.kind==="source"?new Uh("source",c):new _c("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Z(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Ip.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let a=e.get("text-field"),c=C_.paint.properties[n],f=!1,m=y=>{for(let x of y)if(c.overrides&&c.overrides.hasOverride(x))return void(f=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Tn)m(a.value.value.sections);else if(a.value.kind==="source"){let y=b=>{f||(b instanceof qr&&Ft(b.value)===A?m(b.value.sections):b instanceof go?m(b.sections):b.eachChild(y))},x=a.value;x._styleExpression&&y(x._styleExpression.expression)}return f}getProgramConfiguration(e){return new Sl(this,e)}}var FM={paint:new te({"background-color":new N(Oe.paint_background["background-color"]),"background-pattern":new N(Oe.paint_background["background-pattern"]),"background-opacity":new N(Oe.paint_background["background-opacity"])})},NM={paint:new te({"raster-opacity":new N(Oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new N(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new N(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new N(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new N(Oe.paint_raster["raster-saturation"]),"raster-contrast":new N(Oe.paint_raster["raster-contrast"]),"raster-resampling":new N(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new N(Oe.paint_raster["raster-fade-duration"])})};class zM extends As{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var BM={paint:new te({"sky-type":new N(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new N(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new N(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new N(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new N(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Q(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new N(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new N(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new N(Oe.paint_sky["sky-opacity"])})};function T_(t,e,n){let a=[0,0,1],c=lx([]);return ux(c,c,n?-At(t)+Math.PI:At(t)),cx(c,c,-At(e)),ix(a,a,c),Ai(a,a)}let VM={circle:class extends As{constructor(t){super(t,KD)}createBucket(t){return new Kg(t)}queryRadius(t){let e=t;return Ru("circle-radius",this,e)+Ru("circle-stroke-width",this,e)+rp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,a,c,f,m,y){let x=Rx(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Ox(t,a,f,m,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,b)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Sl(this,t)}},heatmap:class extends As{createBucket(t){return new Lx(t)}constructor(t){super(t,tI),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=t_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Ru("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,a,c,f,m,y){let x=this.paint.get("heatmap-radius").evaluate(e,n);return Ox(t,a,f,m,y,!0,!0,new rt(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Sl(this,t)}},hillshade:class extends As{constructor(t){super(t,nI)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends As{constructor(t){super(t,yI)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new Sl(this,t)}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new lp(t)}queryRadius(){return rp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,a,c,f){return!t.queryGeometry.isAboveHorizon&&Ix(Px(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends As{constructor(t){super(t,kI)}createBucket(t){return new Ed(t)}queryRadius(){return rp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Sl(this,t)}queryIntersectsFeature(t,e,n,a,c,f,m,y,x){let b=Rx(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),D=this.paint.get("fill-extrusion-height").evaluate(e,n),M=this.paint.get("fill-extrusion-base").evaluate(e,n),S=[0,0],k=y&&f.elevation,L=f.elevation?f.elevation.exaggeration():1,z=t.tile.getBucket(this);if(k&&z instanceof Ed){let oe=z.centroidVertexArray,ue=x+1;ue<oe.length&&(S[0]=oe.geta_centroid_pos0(ue),S[1]=oe.geta_centroid_pos1(ue))}if(S[0]===0&&S[1]===1)return!1;f.projection.name==="globe"&&(a=Qx([a],[new rt(0,0),new rt(bt,bt)],t.tileID.canonical).map(oe=>oe.polygon).flat());let H=k?y:null,[K,se]=function(oe,ue,le,Me,Te,Fe,We,Pe,je,Ue,Ge){return oe.projection.name==="globe"?function(Qe,ke,st,gt,lt,Nt,et,xt,zt,pn,Bt){let Tt=[],Xn=[],jt=Qe.projection.upVectorScale(Bt,Qe.center.lat,Qe.worldSize).metersToTile,Ut=[0,0,0,1],zn=[0,0,0,1],Hn=(Bn,ar,pr,Ir)=>{Bn[0]=ar,Bn[1]=pr,Bn[2]=Ir,Bn[3]=1},qn=Jx();st>0&&(st+=qn),gt+=qn;for(let Bn of ke){let ar=[],pr=[];for(let Ir of Bn){let Vn=Ir.x+lt.x,Lr=Ir.y+lt.y,Mr=Qe.projection.projectTilePoint(Vn,Lr,Bt),hr=Qe.projection.upVector(Bt,Ir.x,Ir.y),vn=st,Sr=gt;if(et){let Wn=rb(Vn,Lr,st,gt,et,xt,zt,pn);vn+=Wn.base,Sr+=Wn.top}st!==0?Hn(Ut,Mr.x+hr[0]*jt*vn,Mr.y+hr[1]*jt*vn,Mr.z+hr[2]*jt*vn):Hn(Ut,Mr.x,Mr.y,Mr.z),Hn(zn,Mr.x+hr[0]*jt*Sr,Mr.y+hr[1]*jt*Sr,Mr.z+hr[2]*jt*Sr),vr(Ut,Ut,Nt),vr(zn,zn,Nt),ar.push(new Lu(Ut[0],Ut[1],Ut[2])),pr.push(new Lu(zn[0],zn[1],zn[2]))}Tt.push(ar),Xn.push(pr)}return[Tt,Xn]}(oe,ue,le,Me,Te,Fe,We,Pe,je,Ue,Ge):We?function(Qe,ke,st,gt,lt,Nt,et,xt,zt){let pn=[],Bt=[],Tt=[0,0,0,1];for(let Xn of Qe){let jt=[],Ut=[];for(let zn of Xn){let Hn=zn.x+gt.x,qn=zn.y+gt.y,Bn=rb(Hn,qn,ke,st,Nt,et,xt,zt);Tt[0]=Hn,Tt[1]=qn,Tt[2]=Bn.base,Tt[3]=1,Sc(Tt,Tt,lt),Tt[3]=Math.max(Tt[3],1e-5);let ar=new Lu(Tt[0]/Tt[3],Tt[1]/Tt[3],Tt[2]/Tt[3]);Tt[0]=Hn,Tt[1]=qn,Tt[2]=Bn.top,Tt[3]=1,Sc(Tt,Tt,lt),Tt[3]=Math.max(Tt[3],1e-5);let pr=new Lu(Tt[0]/Tt[3],Tt[1]/Tt[3],Tt[2]/Tt[3]);jt.push(ar),Ut.push(pr)}pn.push(jt),Bt.push(Ut)}return[pn,Bt]}(ue,le,Me,Te,Fe,We,Pe,je,Ue):function(Qe,ke,st,gt,lt){let Nt=[],et=[],xt=lt[8]*ke,zt=lt[9]*ke,pn=lt[10]*ke,Bt=lt[11]*ke,Tt=lt[8]*st,Xn=lt[9]*st,jt=lt[10]*st,Ut=lt[11]*st;for(let zn of Qe){let Hn=[],qn=[];for(let Bn of zn){let ar=Bn.x+gt.x,pr=Bn.y+gt.y,Ir=lt[0]*ar+lt[4]*pr+lt[12],Vn=lt[1]*ar+lt[5]*pr+lt[13],Lr=lt[2]*ar+lt[6]*pr+lt[14],Mr=lt[3]*ar+lt[7]*pr+lt[15],hr=Ir+xt,vn=Vn+zt,Sr=Lr+pn,Wn=Math.max(Mr+Bt,1e-5),Oi=Ir+Tt,Ar=Vn+Xn,Kr=Lr+jt,jr=Math.max(Mr+Ut,1e-5);Hn.push(new Lu(hr/Wn,vn/Wn,Sr/Wn)),qn.push(new Lu(Oi/jr,Ar/jr,Kr/jr))}Nt.push(Hn),et.push(qn)}return[Nt,et]}(ue,le,Me,Te,Fe)}(f,a,M,D,b,m,H,S,L,f.center.lat,t.tileID.canonical),J=t.queryGeometry;return function(oe,ue,le){let Me=1/0;Ix(le,ue)&&(Me=nb(le,ue[0]));for(let Te=0;Te<ue.length;Te++){let Fe=ue[Te],We=oe[Te];for(let Pe=0;Pe<Fe.length-1;Pe++){let je=Fe[Pe],Ue=[je,Fe[Pe+1],We[Pe+1],We[Pe],je];Dx(le,Ue)&&(Me=Math.min(Me,nb(le,Ue)))}}return Me!==1/0&&Me}(K,se,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends As{constructor(t){super(t,ib),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof za,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=ob.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new fp(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Sl(this,t)}queryRadius(t){let e=t,n=sb(Ru("line-width",this,e),Ru("line-gap-width",this,e)),a=Ru("line-offset",this,e);return n/2+Math.abs(a)+rp(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,a,c,f){if(t.queryGeometry.isAboveHorizon)return!1;let m=Px(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),y=t.pixelToTileUnitsFactor/2*sb(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),x=this.paint.get("line-offset").evaluate(e,n);return x&&(a=function(b,D){let M=[],S=new rt(0,0);for(let k=0;k<b.length;k++){let L=b[k],z=[];for(let H=0;H<L.length;H++){let K=L[H],se=L[H+1],J=H===0?S:K.sub(L[H-1])._unit()._perp(),oe=H===L.length-1?S:se.sub(K)._unit()._perp(),ue=J._add(oe)._unit();ue._mult(1/(ue.x*oe.x+ue.y*oe.y)),z.push(ue._mult(D)._add(K))}M.push(z)}return M}(a,x*t.pixelToTileUnitsFactor)),function(b,D,M){for(let S=0;S<D.length;S++){let k=D[S];if(b.length>=3){for(let L=0;L<k.length;L++)if(Oc(b,k[L]))return!0}if(WD(b,k,M))return!0}return!1}(m,a,y)}isTileClipped(){return!0}},symbol:Ip,background:class extends As{constructor(t){super(t,FM)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends As{constructor(t){super(t,NM)}getProgramIds(){return["raster"]}},sky:class extends As{constructor(t){super(t,BM),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=t_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),c=!a,f=t.style.light,m=f.properties.get("position");return c&&f.properties.get("anchor")==="viewport"&&Jn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?T_(m.azimuthal,90-m.polar,e):T_(a[0],90-a[1],e)}let n=this.paint.get("sky-gradient-center");return T_(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class kd{constructor(e,n,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,a){let{width:c,height:f}=e,{context:m}=this,{gl:y}=m,{HTMLImageElement:x,HTMLCanvasElement:b,HTMLVideoElement:D,ImageData:M,ImageBitmap:S}=w;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),a||this.size&&this.size[0]===c&&this.size[1]===f){let{x:k,y:L}=a||{x:0,y:0};e instanceof x||e instanceof b||e instanceof D||e instanceof M||S&&e instanceof S?y.texSubImage2D(y.TEXTURE_2D,0,k,L,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,k,L,c,f,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[c,f],e instanceof x||e instanceof b||e instanceof D||e instanceof M||S&&e instanceof S?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,c,f,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=!!(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,n){let{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class jM{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class UM{constructor(){this.tasks={},this.taskQueue=[],_r(["process"],this),this.invoker=new jM(this.process),this.nextId=0}add(e,n){let a=this.nextId++,c=function({type:f,isSymbolTile:m,zoom:y}){return y=y||0,f==="message"?0:f!=="maybePrepare"||m?f!=="parseTile"||m?f==="parseTile"&&m?300-y:f==="maybePrepare"&&m?400-y:500:200-y:100-y}(n);if(c===0){ho();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:n,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){ho();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){let f=this.tasks[this.taskQueue[c]];f.priority<n&&(n=f.priority,e=c)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class Gb{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let $M=["tile","layer","source","sourceLayer","state"];class Hb{constructor(e,n,a,c,f){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=c,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let n of $M)this[n]!==void 0&&(e[n]=this[n]);return e}}let os=32,ma=33,Ll=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,a=0,c=0,f=0,m=0,y=0;for(1&e?c=f=m=os:n=a=y=os;(e>>=1)>1;){let b=n+c>>1,D=a+f>>1;1&e?(c=n,f=a,n=m,a=y):(n=c,a=f,c=m,f=y),m=b,y=D}let x=4*t;Ll[x+0]=n,Ll[x+1]=a,Ll[x+2]=c,Ll[x+3]=f}let ga=new Uint16Array(2178),Fl=new Uint8Array(1089),Mp=new Uint16Array(1089);function qb(t){return t===0?-.03125:t===32?.03125:0}var Wb=ye([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let Zb={type:2,extent:bt,loadGeometry:()=>[[new rt(0,0),new rt(bt+1,0),new rt(bt+1,bt+1),new rt(0,bt+1),new rt(0,0)]]};class D_{constructor(e,n,a,c,f){this.tileID=e,this.uid=ni(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<Bi.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Lc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,f){let m={};if(!f)return m;for(let y of c){let x=y.layerIds.map(b=>f.getLayer(b)).filter(Boolean);if(x.length!==0){y.layers=x,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(b=>x.filter(D=>D.id===b)[0]));for(let b of x)m[b.id]=y}}return m}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let c in this.buckets){let f=this.buckets[c];if(f instanceof kl){if(this.hasSymbolBuckets=!0,!a)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let c in this.buckets){let f=this.buckets[c];if(f instanceof kl&&f.hasRTLText){this.hasRTLText=!0,T.isLoading()||T.isLoaded()||v()!=="deferred"||E();break}}this.queryPadding=0;for(let c in this.buckets){let f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Fn}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(let a in this.buckets){let c=this.buckets[a];c.uploadPending()&&c.upload(e)}let n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kd(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kd(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new kd(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,a,c,f,m,y,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:y,transform:m,params:f,tileTransform:this.tileTransform},e,n,a):{}}querySourceFeatures(e,n){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let c=a.loadVTLayers(),f=n?n.sourceLayer:"",m=c._geojsonTileLayer||c[f];if(!m)return;let y=xu(n&&n.filter),{z:x,x:b,y:D}=this.tileID.canonical,M={z:x,x:b,y:D};for(let S=0;S<m.length;S++){let k=m.feature(S);if(y.needGeometry){let H=Rc(k,!0);if(!y.filter(new I(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!y.filter(new I(this.tileID.overscaledZ),k))continue;let L=a.getId(k,f),z=new Hb(k,x,b,D,L);z.tile=M,e.push(z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let a=di(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let a=Date.now(),c=!1;if(this.expirationTime>a)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{let f=this.expirationTime-n;f?this.expirationTime=a+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!n)return;let a=this.latestFeatureIndex.loadVTLayers(),c=n.style.listImages();for(let f in this.buckets){if(!n.style.hasLayer(f))continue;let m=this.buckets[f],y=m.layers[0].sourceLayer||"_geojsonTileLayer",x=a[y],b=e[y];if(!x||!b||Object.keys(b).length===0)continue;if(m.update(b,x,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof fp||m instanceof lp){let M=n.style._getSourceCache(m.layers[0].source);n._terrain&&n._terrain.enabled&&M&&m.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(M.id,this.tileID)}let D=n&&n.style&&n.style.getLayer(f);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Bi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Bi.now()+e}setTexture(e,n){let a=n.context,c=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new kd(a,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(e,n){let a={};for(let c of n)a[c]=!0;this.dependencies[e]=a}hasDependency(e,n){for(let a of e){let c=this.dependencies[a];if(c){for(let f of n)if(c[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let a=Ka(Zb,this.tileID.canonical,this.tileTransform)[0],c=new qe,f=new to;for(let m=0;m<a.length;m++){let{x:y,y:x}=a[m];c.emplaceBack(y,x),f.emplaceBack(m)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(c,dd.members),this._tileDebugSegments=Tr.simpleSegment(0,0,c.length,f.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let a=Ka(Zb,this.tileID.canonical,this.tileTransform)[0],c,f;if(this.isRaster){let m=function(y,x){let b=Lc(y,x),D=Math.pow(2,y.z);for(let H=0;H<ma;H++)for(let K=0;K<ma;K++){let se=So((y.x+(K+qb(K))/os)/D),J=ci((y.y+(H+qb(H))/os)/D),oe=x.project(se,J),ue=H*ma+K;ga[2*ue+0]=Math.round((oe.x*b.scale-b.x)*bt),ga[2*ue+1]=Math.round((oe.y*b.scale-b.y)*bt)}Fl.fill(0),Mp.fill(0);for(let H=2045;H>=0;H--){let K=4*H,se=Ll[K+0],J=Ll[K+1],oe=Ll[K+2],ue=Ll[K+3],le=se+oe>>1,Me=J+ue>>1,Te=le+Me-J,Fe=Me+se-le,We=J*ma+se,Pe=ue*ma+oe,je=Me*ma+le,Ue=Math.hypot((ga[2*We+0]+ga[2*Pe+0])/2-ga[2*je+0],(ga[2*We+1]+ga[2*Pe+1])/2-ga[2*je+1])>=16;Fl[je]=Fl[je]||(Ue?1:0),H<1022&&(Fl[je]=Fl[je]||Fl[(J+Fe>>1)*ma+(se+Te>>1)]||Fl[(ue+Fe>>1)*ma+(oe+Te>>1)])}let M=new Ve,S=new _t,k=0;function L(H,K){let se=K*ma+H;return Mp[se]===0&&(M.emplaceBack(ga[2*se+0],ga[2*se+1],H*bt/os,K*bt/os),Mp[se]=++k),Mp[se]-1}function z(H,K,se,J,oe,ue){let le=H+se>>1,Me=K+J>>1;if(Math.abs(H-oe)+Math.abs(K-ue)>1&&Fl[Me*ma+le])z(oe,ue,H,K,le,Me),z(se,J,oe,ue,le,Me);else{let Te=L(H,K),Fe=L(se,J),We=L(oe,ue);S.emplaceBack(Te,Fe,We)}}return z(0,0,os,os,os,0),z(os,os,0,0,0,os),{vertices:M,indices:S}}(this.tileID.canonical,n);c=m.vertices,f=m.indices}else{c=new Ve,f=new _t;for(let{x:y,y:x}of a)c.emplaceBack(y,x,0,0);let m=s_(c.int16,void 0,4);for(let y=0;y<m.length;y+=3)f.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,Wb.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=Tr.simpleSegment(0,0,c.length,f.length)}_makeGlobeTileDebugBuffers(e,n){let a=n.projection;if(!a||a.name!=="globe"||n.freezeTileCoverage)return;let c=this.tileID.canonical,f=md(mx(c,n)),m=Au(n.zoom),y;m>0&&(y=kg(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,n,f,y,m),this._makeGlobeTileDebugTextBuffer(e,c,n,f,y,m)}_globePoint(e,n,a,c,f,m,y){let x=pd(e,n,a);if(m){let b=1<<a.z,D=fa(c.center.lng),M=pa(c.center.lat),S=(a.x+.5)/b-D,k=0;S>.5?k=-1:S<-.5&&(k=1);let L=(e/bt+a.x)/b+k,z=(n/bt+a.y)/b;L=(L-D)*c._pixelsPerMercatorPixel+D,z=(z-M)*c._pixelsPerMercatorPixel+M;let H=[L*c.worldSize,z*c.worldSize,0];vr(H,H,m),x=Pc(x,H,y)}return vr(x,x,f)}_makeGlobeTileDebugBorderBuffer(e,n,a,c,f,m){let y=new qe,x=new to,b=new Ce,D=(S,k,L,z,H)=>{let K=(L-S)/(H-1),se=(z-k)/(H-1),J=y.length;for(let oe=0;oe<H;oe++){let ue=S+oe*K,le=k+oe*se;y.emplaceBack(ue,le);let Me=this._globePoint(ue,le,n,a,c,f,m);b.emplaceBack(Me[0],Me[1],Me[2]),x.emplaceBack(J+oe)}},M=bt;D(0,0,M,0,16),D(M,0,M,M,16),D(M,M,0,M,16),D(0,M,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(y,dd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,dx.members),this._tileDebugSegments=Tr.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugTextBuffer(e,n,a,c,f,m){let y=bt/4,x=new qe,b=new _t,D=new Ce,M=25;b.reserve(32),x.reserve(M),D.reserve(M);let S=(k,L)=>M*k+L;for(let k=0;k<M;k++){let L=k*y;for(let z=0;z<M;z++){let H=z*y;x.emplaceBack(H,L);let K=this._globePoint(H,L,n,a,c,f,m);D.emplaceBack(K[0],K[1],K[2])}}for(let k=0;k<4;k++)for(let L=0;L<4;L++){let z=S(k,L),H=S(k,L+1),K=S(k+1,L),se=S(k+1,L+1);b.emplaceBack(z,H,K),b.emplaceBack(K,H,se)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(x,dd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(D,dx.members),this._tileDebugTextSegments=Tr.simpleSegment(0,0,M,32)}}class GM{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){let c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},un(this.stateChanges[e][c],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(let f in this.state[e])f!==c&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(let f in this.state[e][c])a[f]||(this.deletedStates[e][c][f]=null)}else for(let f in a)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][f]===null&&delete this.deletedStates[e][c][f]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;let c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){let a=String(n),c=un({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let f=this.deletedStates[e][n];if(f===null)return{};for(let m in f)delete c[m]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let a={};for(let c in this.stateChanges){this.state[c]=this.state[c]||{};let f={};for(let m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),un(this.state[c][m],this.stateChanges[c][m]),f[m]=this.state[c][m];a[c]=f}for(let c in this.deletedStates){this.state[c]=this.state[c]||{};let f={};if(this.deletedStates[c]===null)for(let m in this.state[c])f[m]={},this.state[c][m]={};else for(let m in this.deletedStates[c]){if(this.deletedStates[c][m]===null)this.state[c][m]={};else if(this.state[c][m])for(let y of Object.keys(this.deletedStates[c][m]))delete this.state[c][m][y];f[m]=this.state[c][m]}a[c]=a[c]||{},un(a[c],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let c in e)e[c].setFeatureState(a,n)}}class Xb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Yb(t,e,n,a){let c=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(a[m])<1e-15){if(n[m]<t[m]||n[m]>e[m])return null}else{let y=1/a[m],x=(t[m]-n[m])*y,b=(e[m]-n[m])*y;if(x>b){let D=x;x=b,b=D}if(x>c&&(c=x),b<f&&(f=b),c>f)return null}return c}function Kb(t,e,n,a,c,f,m,y,x,b,D){let M=a-t,S=c-e,k=f-n,L=m-t,z=y-e,H=x-n,K=D[1]*H-D[2]*z,se=D[2]*L-D[0]*H,J=D[0]*z-D[1]*L,oe=M*K+S*se+k*J;if(Math.abs(oe)<1e-15)return null;let ue=1/oe,le=b[0]-t,Me=b[1]-e,Te=b[2]-n,Fe=(le*K+Me*se+Te*J)*ue;if(Fe<0||Fe>1)return null;let We=Me*k-Te*S,Pe=Te*M-le*k,je=le*S-Me*M,Ue=(D[0]*We+D[1]*Pe+D[2]*je)*ue;return Ue<0||Fe+Ue>1?null:(L*We+z*Pe+H*je)*ue}function Jb(t,e,n){return(t-e)/(n-e)}function Qb(t,e,n,a,c,f,m,y,x){let b=1<<n,D=f-a,M=m-c,S=(t+1)/b*D+a,k=(e+0)/b*M+c,L=(e+1)/b*M+c;y[0]=(t+0)/b*D+a,y[1]=k,x[0]=S,x[1]=L}class ew{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(f){let m=Math.ceil(Math.log2(f.dim/8)),y=[],x=Math.ceil(Math.pow(2,m)),b=1/x,D=(k,L,z,H,K)=>{let se=H?1:0,J=(k+1)*z-se,oe=L*z,ue=(L+1)*z-se;K[0]=k*z,K[1]=oe,K[2]=J,K[3]=ue},M=new Xb(x),S=[];for(let k=0;k<x*x;k++){D(k%x,Math.floor(k/x),b,!1,S);let L=Nl(S[0],S[1],f),z=Nl(S[2],S[1],f),H=Nl(S[2],S[3],f),K=Nl(S[0],S[3],f);M.minimums.push(Math.min(L,z,H,K)),M.maximums.push(Math.max(L,z,H,K)),M.leaves.push(1)}for(y.push(M),x/=2;x>=1;x/=2){let k=y[y.length-1];M=new Xb(x);for(let L=0;L<x*x;L++){D(L%x,Math.floor(L/x),2,!0,S);let z=k.getElevation(S[0],S[1]),H=k.getElevation(S[2],S[1]),K=k.getElevation(S[2],S[3]),se=k.getElevation(S[0],S[3]),J=k.isLeaf(S[0],S[1]),oe=k.isLeaf(S[2],S[1]),ue=k.isLeaf(S[2],S[3]),le=k.isLeaf(S[0],S[3]),Me=Math.min(z.min,H.min,K.min,se.min),Te=Math.max(z.max,H.max,K.max,se.max),Fe=J&&oe&&ue&&le;M.maximums.push(Te),M.minimums.push(Me),M.leaves.push(Te-Me<=5&&Fe?1:0)}y.push(M)}return y}(this.dem),a=n.length-1,c=n[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,c,f,m,y=1){return Yb([e,n,-100],[a,c,this.maximums[0]*y],f,m)}raycast(e,n,a,c,f,m,y=1){if(!this.nodeCount)return null;let x=this.raycastRoot(e,n,a,c,f,m,y);if(x==null)return null;let b=[],D=[],M=[],S=[],k=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;k.length>0;){let{idx:L,t:z,nodex:H,nodey:K,depth:se}=k.pop();if(this.leaves[L]){Qb(H,K,se,e,n,a,c,M,S);let oe=1<<se,ue=(H+0)/oe,le=(H+1)/oe,Me=(K+0)/oe,Te=(K+1)/oe,Fe=Nl(ue,Me,this.dem)*y,We=Nl(le,Me,this.dem)*y,Pe=Nl(le,Te,this.dem)*y,je=Nl(ue,Te,this.dem)*y,Ue=Kb(M[0],M[1],Fe,S[0],M[1],We,S[0],S[1],Pe,f,m),Ge=Kb(S[0],S[1],Pe,M[0],S[1],je,M[0],M[1],Fe,f,m),Qe=Math.min(Ue!==null?Ue:Number.MAX_VALUE,Ge!==null?Ge:Number.MAX_VALUE);if(Qe!==Number.MAX_VALUE)return Qe;{let ke=ud([],f,m,z);if(tw(Fe,We,je,Pe,Jb(ke[0],M[0],S[0]),Jb(ke[1],M[1],S[1]))>=ke[2])return z}continue}let J=0;for(let oe=0;oe<this._siblingOffset.length;oe++){Qb((H<<1)+this._siblingOffset[oe][0],(K<<1)+this._siblingOffset[oe][1],se+1,e,n,a,c,M,S),M[2]=-100,S[2]=this.maximums[this.childOffsets[L]+oe]*y;let ue=Yb(M,S,f,m);if(ue!=null){let le=ue;b[oe]=le;let Me=!1;for(let Te=0;Te<J&&!Me;Te++)le>=b[D[Te]]&&(D.splice(Te,0,oe),Me=!0);Me||(D[J]=oe),J++}}for(let oe=0;oe<J;oe++){let ue=D[oe];k.push({idx:this.childOffsets[L]+ue,t:b[ue],nodex:(H<<1)+this._siblingOffset[ue][0],nodey:(K<<1)+this._siblingOffset[ue][1],depth:se+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,c,f){if(e[c].isLeaf(n,a)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);let m=c-1,y=e[m],x=0,b=0;for(let D=0;D<this._siblingOffset.length;D++){let M=2*n+this._siblingOffset[D][0],S=2*a+this._siblingOffset[D][1],k=y.getElevation(M,S),L=y.isLeaf(M,S),z=this._addNode(k.min,k.max,L);L&&(x|=1<<D),b||(b=z)}for(let D=0;D<this._siblingOffset.length;D++)x&1<<D||this._construct(e,2*n+this._siblingOffset[D][0],2*a+this._siblingOffset[D][1],m,b+D)}}function tw(t,e,n,a,c,f){return Xt(Xt(t,n,f),Xt(e,a,f),c)}function Nl(t,e,n){let a=n.dim,c=Ht(t*a-.5,0,a-1),f=Ht(e*a-.5,0,a-1),m=Math.floor(c),y=Math.floor(f),x=Math.min(m+1,a-1),b=Math.min(y+1,a-1);return tw(n.get(m,y),n.get(x,y),n.get(m,b),n.get(x,b),c-m,f-y)}let nw={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function HM(t,e,n){return(256*t*256+256*e+n)/10-1e4}function qM(t,e,n){return 256*t+e+n/256-32768}class Sp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,c=!1,f=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return Jn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let m=this.dim=n.height-2,y=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=a||"mapbox",this.borderReady=c,!c){for(let x=0;x<m;x++)y[this._idx(-1,x)]=y[this._idx(0,x)],y[this._idx(m,x)]=y[this._idx(m-1,x)],y[this._idx(x,-1)]=y[this._idx(x,0)],y[this._idx(x,m)]=y[this._idx(x,m-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(m,-1)]=y[this._idx(m-1,0)],y[this._idx(-1,m)]=y[this._idx(0,m-1)],y[this._idx(m,m)]=y[this._idx(m-1,m-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new ew(this)}get(e,n,a=!1){a&&(e=Ht(e,-1,this.dim),n=Ht(n,-1,this.dim));let c=4*this._idx(e,n);return(this.encoding==="terrarium"?qM:HM)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return nw[e]}get unpackVector(){return nw[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let a=[0,0,0,0],c=Sp.getUnpackVector(n),f=Math.floor((e+c[3])/c[2]);return a[2]=f%256,f=Math.floor(f/256),a[1]=f%256,f=Math.floor(f/256),a[0]=f,a}getPixels(){return new ro({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,f=n*this.dim+this.dim,m=a*this.dim,y=a*this.dim+this.dim;switch(n){case-1:c=f-1;break;case 1:f=c+1}switch(a){case-1:m=y-1;break;case 1:y=m+1}let x=-n*this.dim,b=-a*this.dim;for(let D=m;D<y;D++)for(let M=c;M<f;M++){let S=4*this._idx(M,D),k=4*this._idx(M+x,D+b);this.pixels[S+0]=e.pixels[k+0],this.pixels[S+1]=e.pixels[k+1],this.pixels[S+2]=e.pixels[k+2],this.pixels[S+3]=e.pixels[k+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}pt(Sp,"DEMData"),pt(ew,"DemMinMaxQuadTree",{omit:["dem"]});class WM{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){let c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);let f={value:n,timeout:void 0};if(a!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},a)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){let m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let a=e.wrapped().key,c=n===void 0?0:this.data[a].indexOf(n),f=this.data[a][c];return this.data[a].splice(c,1),f.timeout&&clearTimeout(f.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(f.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let a in this.data)for(let c of this.data[a])e(c.value)||n.push(c);for(let a of n)this.remove(a.value.tileID,a)}}class Hu{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}Hu.ReadOnly=!1,Hu.ReadWrite=!0,Hu.disabled=new Hu(519,Hu.ReadOnly,[0,1]);let I_=7680;class M_{constructor(e,n,a,c,f,m){this.test=e,this.ref=n,this.mask=a,this.fail=c,this.depthFail=f,this.pass=m}}M_.disabled=new M_({func:519,mask:0},0,0,I_,I_,I_);class _a{constructor(e,n,a){this.blendFunction=e,this.blendColor=n,this.mask=a}}_a.Replace=[1,0],_a.disabled=new _a(_a.Replace,Ne.transparent,[!1,!1,!1,!1]),_a.unblended=new _a(_a.Replace,Ne.transparent,[!0,!0,!0,!0]),_a.alphaBlended=new _a([1,771],Ne.transparent,[!0,!0,!0,!0]);let S_=1029,A_=2305;class Fs{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}Fs.disabled=new Fs(!1,S_,A_),Fs.backCCW=new Fs(!0,S_,A_),Fs.backCW=new Fs(!0,S_,2304),Fs.frontCW=new Fs(!0,1028,2304),Fs.frontCCW=new Fs(!0,1028,A_);class Fc extends ii{constructor(e,n,a){super(),this.id=e,this._onlySymbols=a,n.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new WM(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new GM,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Zi(this._tiles).map(e=>e.tileID).sort(rw).map(e=>e.key)}getRenderableIds(e){let n=[];for(let a in this._tiles)this._isIdRenderable(+a,e)&&n.push(this._tiles[a]);return e?n.sort((a,c)=>{let f=a.tileID,m=c.tileID,y=new rt(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),x=new rt(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-m.overscaledZ||x.y-y.y||x.x-y.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(rw).map(a=>a.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,e,n)))}_tileLoaded(e,n,a,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new zr(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Bi.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Uo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let c=0;c<n.length;c++){let f=n[c];if(e.neighboringTiles&&e.neighboringTiles[f]){let m=this.getTileByID(f);a(e,m),a(m,e)}}function a(c,f){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let m=f.tileID.canonical.x-c.tileID.canonical.x,y=f.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),b=f.tileID.key;m===0&&y===0||Math.abs(y)>1||(Math.abs(m)>1&&(Math.abs(m+x)===1?m+=x:Math.abs(m-x)===1&&(m-=x)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,m,y),c.neighboringTiles&&c.neighboringTiles[b]&&(c.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,c){for(let f in this._tiles){let m=this._tiles[f];if(c[f]||!m.hasData()||m.tileID.overscaledZ<=n||m.tileID.overscaledZ>a)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>n+1;){let b=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[b.key],m&&m.hasData()&&(y=b)}let x=y;for(;x.overscaledZ>n;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){c[y.key]=y;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){let c=e.scaledTo(a),f=this._getLoadedTile(c);if(f)return f}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let a=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,f=Math.floor(a*c*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let a={};for(let c in this._tiles){let f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),a[f.tileID.key]=f}this._tiles=a;for(let c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(let c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let c;this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Ri(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(c=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(y=>this._source.hasTile(y)))):c=[];let f=this._updateRetainedTiles(c);if(iw(this._source.type)&&c.length!==0){let y={},x={},b=Object.keys(f);for(let M of b){let S=f[M],k=this._tiles[M];if(!k||k.fadeEndTime&&k.fadeEndTime<=Bi.now())continue;let L=this.findLoadedParent(S,Math.max(S.overscaledZ-Fc.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),y[L.tileID.key]=L.tileID),x[M]=S}let D=c[c.length-1].overscaledZ;for(let M in this._tiles){let S=this._tiles[M];if(f[M]||!S.hasData())continue;let k=S.tileID;for(;k.overscaledZ>D;){k=k.scaledTo(k.overscaledZ-1);let L=this._tiles[k.key];if(L&&L.hasData()&&x[k.key]){f[M]=S.tileID;break}}}for(let M in y)f[M]||(this._coveredTiles[M]=!0,f[M]=y[M])}for(let y in f)this._tiles[y].clearFadeHold();let m=function(y,x){let b=[];for(let D in y)D in x||b.push(D);return b}(this._tiles,f);for(let y of m){let x=this._tiles[y];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let a={},c=e.reduce((b,D)=>Math.min(b,D.overscaledZ),1/0),f=e[0].overscaledZ,m=Math.max(f-Fc.maxOverzooming,this._source.minzoom),y=Math.max(f+Fc.maxUnderzooming,this._source.minzoom),x={};for(let b of e){let D=this._addTile(b);n[b.key]=b,D.hasData()||c<this._source.maxzoom&&(x[b.key]=b)}this._retainLoadedChildren(x,c,y,n);for(let b of e){let D=this._tiles[b.key];if(D.hasData())continue;if(b.canonical.z>=this._source.maxzoom){let S=b.children(this._source.maxzoom)[0],k=this.getTile(S);if(k&&k.hasData()){n[S.key]=S;continue}}else{let S=b.children(this._source.maxzoom);if(n[S[0].key]&&n[S[1].key]&&n[S[2].key]&&n[S[3].key])continue}let M=D.wasRequested();for(let S=b.overscaledZ-1;S>=m;--S){let k=b.scaledTo(S);if(a[k.key]||(a[k.key]=!0,D=this.getTile(k),!D&&M&&(D=this._addTile(k)),D&&(n[k.key]=k,M=D.wasRequested(),D.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],a,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}n.push(c.key);let f=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(f),a)break;c=f}for(let f of n)this._loadedParentTiles[f]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let a=!!n;if(!a){let c=this.map?this.map.painter:null;n=new D_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,a||this._source.fire(new Uo("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,a){let c=[],f=this.transform;if(!f)return c;let m=f.projection.name==="globe",y=fa(f.center.lng);for(let x in this._tiles){let b=this._tiles[x];if(a&&b.clearQueryDebugViz(),b.holdingForFade())continue;let D;if(m){let M=b.tileID.canonical;if(M.z===0){let S=[Math.abs(Ht(y,...Ld(M,-1))-y),Math.abs(Ht(y,...Ld(M,1))-y)];D=[0,2*S.indexOf(Math.min(...S))-1]}else{let S=[Math.abs(Ht(y,...Ld(M,-1))-y),Math.abs(Ht(y,...Ld(M,0))-y),Math.abs(Ht(y,...Ld(M,1))-y)];D=[S.indexOf(Math.min(...S))-1]}}else D=[0];for(let M of D){let S=e.containsTile(b,f,n,M);S&&c.push(S)}}return c}getVisibleCoordinates(e){let n=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(let a of n)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(iw(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Bi.now())return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){let c=this._tiles[e];c&&c.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(let a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,n))};return void this._source.on("data",y)}let a=new Map,c=Array.isArray(e)?e:[e],f=this.map.painter.terrain,m=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(let y of c){let x=y.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let b of x)a.set(b.key,b);this.usedForTerrain&&y.updateElevation(!1)}gr(Array.from(a.values()),(y,x)=>{let b=new D_(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,D=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),x(D,b)})},n)}}function rw(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function iw(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Ld(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Fc.maxOverzooming=10,Fc.maxUnderzooming=3;class Ap{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){let c=a||e.findDEMTileFor(n);if(!c||!c.dem)return;let f=c.dem,m=c.tileID,y=1<<n.canonical.z-m.canonical.z;return new Ap(c,c.tileSize/bt/y,[(n.canonical.x/y-m.canonical.x)*f.dim,(n.canonical.y/y-m.canonical.y)*f.dim])}tileCoordToPixel(e,n){let a=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(a);return new rt(c,f)}getElevationAt(e,n,a,c){let f=e*this._scale+this._offset[0],m=n*this._scale+this._offset[1],y=Math.floor(f),x=Math.floor(m),b=this._dem;return c=!!c,a?Xt(Xt(b.get(y,x,c),b.get(y,x+1,c),m-x),Xt(b.get(y+1,x,c),b.get(y+1,x+1,c),m-x),f-y):b.get(y,x,c)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Os(1,e)*this._dem.stride}}class ow{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ga(bt,16,0),this.featureIndexArray=new Cc,this.promoteId=n}insert(e,n,a,c,f,m=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,f,m);let x=this.grid;for(let b=0;b<n.length;b++){let D=n[b],M=[1/0,1/0,-1/0,-1/0];for(let S=0;S<D.length;S++){let k=D[S];M[0]=Math.min(M[0],k.x),M[1]=Math.min(M[1],k.y),M[2]=Math.max(M[2],k.x),M[3]=Math.max(M[3],k.y)}M[0]<bt&&M[1]<bt&&M[2]>=0&&M[3]>=0&&x.insert(y,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new u_(new gp(this.rawTileData)).layers,this.sourceLayerCoder=new Gb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,a,c){this.loadVTLayers();let f=e.params||{},m=xu(f.filter),y=e.tileResult,x=e.transform,b=y.bufferedTilespaceBounds,D=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(L,z,H,K)=>Ax(y.bufferedTilespaceGeometry,L,z,H,K));D.sort(ZM);let M=null;x.elevation&&D.length>0&&(M=Ap.create(x.elevation,this.tileID));let S={},k;for(let L=0;L<D.length;L++){let z=D[L];if(z===k)continue;k=z;let H=this.featureIndexArray.get(z),K=null;this.loadMatchingFeature(S,H,m,f.layers,f.availableImages,n,a,c,(se,J,oe,ue=0)=>(K||(K=Ka(se,this.tileID.canonical,e.tileTransform)),J.queryIntersectsFeature(y,se,oe,K,this.z,e.transform,e.pixelPosMatrix,M,ue)))}return S}loadMatchingFeature(e,n,a,c,f,m,y,x,b){let{featureIndex:D,bucketIndex:M,sourceLayerIndex:S,layoutVertexArrayOffset:k}=n,L=this.bucketLayerIDs[M];if(c&&!function(se,J){for(let oe=0;oe<se.length;oe++)if(J.indexOf(se[oe])>=0)return!0;return!1}(c,L))return;let z=this.sourceLayerCoder.decode(S),H=this.vtLayers[z].feature(D);if(a.needGeometry){let se=Rc(H,!0);if(!a.filter(new I(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!a.filter(new I(this.tileID.overscaledZ),H))return;let K=this.getId(H,z);for(let se=0;se<L.length;se++){let J=L[se];if(c&&c.indexOf(J)<0)continue;let oe=m[J];if(!oe)continue;let ue={};K!==void 0&&x&&(ue=x.getState(oe.sourceLayer||"_geojsonTileLayer",K));let le=un({},y[J]);le.paint=sw(le.paint,oe.paint,H,ue,f),le.layout=sw(le.layout,oe.layout,H,ue,f);let Me=!b||b(H,oe,ue,k);if(!Me)continue;let Te=new Hb(H,this.z,this.x,this.y,K);Te.layer=le;let Fe=e[J];Fe===void 0&&(Fe=e[J]=[]),Fe.push({featureIndex:D,feature:Te,intersectionZ:Me})}}lookupSymbolFeatures(e,n,a,c,f,m,y,x){let b={};this.loadVTLayers();let D=xu(f);for(let M of e)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:c,featureIndex:M,layoutVertexArrayOffset:0},D,m,y,x,n);return b}loadFeature(e){let{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();let c=this.sourceLayerCoder.decode(a),f=this.vtFeatures[c];if(f[n])return f[n];let m=this.vtLayers[c].feature(n);return f[n]=m,m}hasLayer(e){for(let n of this.bucketLayerIDs)for(let a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){let c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];c!=null&&(a=e.properties[c]),typeof a=="boolean"&&(a=Number(a))}return a}}function sw(t,e,n,a,c){return Jt(t,(f,m)=>{let y=e instanceof Y?e.get(m):null;return y&&y.evaluate?y.evaluate(n,a,c):y})}function ZM(t,e){return e-t}pt(ow,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class aw{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Ja({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let a=this.getKey(e,n);return this.positions[a]}trim(){let e=this.width,n=this.height=co(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){let c=[],f=e.length%2==1?-e[e.length-1]*a:0,m=e[0]*a,y=!0;c.push({left:f,right:m,isDash:y,zeroLength:e[0]===0});let x=e[0];for(let b=1;b<e.length;b++){y=!y;let D=e[b];f=x*a,x+=D,m=x*a,c.push({left:f,right:m,isDash:y,zeroLength:D===0})}return c}addRoundDash(e,n,a){let c=n/2;for(let f=-a;f<=a;f++){let m=this.width*(this.nextRow+a+f),y=0,x=e[y];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++y]);let D=Math.abs(b-x.left),M=Math.abs(b-x.right),S=Math.min(D,M),k,L=f/a*(c+1);if(x.isDash){let z=c-Math.abs(L);k=Math.sqrt(S*S+z*z)}else k=c-Math.sqrt(S*S+L*L);this.image.data[m+b]=Math.max(0,Math.min(255,k+128))}}}addRegularDash(e,n){for(let x=e.length-1;x>=0;--x){let b=e[x],D=e[x+1];b.zeroLength?e.splice(x,1):D&&D.isDash===b.isDash&&(D.left=b.left,e.splice(x,1))}let a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);let f=this.width*this.nextRow,m=0,y=e[m];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++m]);let b=Math.abs(x-y.left),D=Math.abs(x-y.right),M=Math.min(b,D);this.image.data[f+x]=Math.max(0,Math.min(255,(y.isDash?M:-M)+n+128))}}addDash(e,n){let a=this.getKey(e,n);if(this.positions[a])return this.positions[a];let c=n==="round",f=c?7:0,m=2*f+1;if(this.nextRow+m>this.height)return Jn("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let D=0;D<e.length;D++)e[D]<0&&(Jn("Negative value is found in line dasharray, replacing values with 0"),e[D]=0),y+=e[D];if(y!==0){let D=this.width/y,M=this.getDashRanges(e,this.width,D);c?this.addRoundDash(M,D,f):this.addRegularDash(M,n==="square"?.5*D:0)}let x=this.nextRow+f;this.nextRow+=m;let b={tl:[x,f],br:[y,0]};return this.positions[a]=b,b}}pt(aw,"LineAtlas");let lw=1*Ls;class cw{constructor(e){let n={},a=[];for(let y in e){let x=e[y],b=n[y]={};for(let D in x.glyphs){let M=x.glyphs[+D];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;let S=M.metrics.localGlyph?lw:1,k={x:0,y:0,w:M.bitmap.width+2*S,h:M.bitmap.height+2*S};a.push(k),b[D]=k}}let{w:c,h:f}=p_(a),m=new Ja({width:c||1,height:f||1});for(let y in e){let x=e[y];for(let b in x.glyphs){let D=x.glyphs[+b];if(!D||D.bitmap.width===0||D.bitmap.height===0)continue;let M=n[y][b],S=D.metrics.localGlyph?lw:1;Ja.copy(D.bitmap,m,{x:0,y:0},{x:M.x+S,y:M.y+S},D.bitmap)}}this.image=m,this.positions=n}}pt(cw,"GlyphAtlas");class XM{constructor(e){this.tileID=new Ri(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Lc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,a,c,f){this.status="parsing",this.data=e,this.collisionBoxArray=new Fn;let m=new Gb(Object.keys(e.layers).sort()),y=new ow(this.tileID,this.promoteId);y.bucketLayerIDs=[];let x={},b=new aw(256,256),D={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:b,availableImages:a},M=n.familiesBySource[this.source];for(let ue in M){let le=e.layers[ue];if(!le)continue;let Me=!1,Te=!1;for(let Pe of M[ue])Pe[0].type==="symbol"?Me=!0:Te=!0;if(this.isSymbolTile===!0&&!Me||this.isSymbolTile===!1&&!Te)continue;le.version===1&&Jn(`Vector tile source "${this.source}" layer "${ue}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Fe=m.encode(ue),We=[];for(let Pe=0;Pe<le.length;Pe++){let je=le.feature(Pe),Ue=y.getId(je,ue);We.push({feature:je,id:Ue,index:Pe,sourceLayerIndex:Fe})}for(let Pe of M[ue]){let je=Pe[0];this.isSymbolTile!==void 0&&je.type==="symbol"!==this.isSymbolTile||je.minzoom&&this.zoom<Math.floor(je.minzoom)||je.maxzoom&&this.zoom>=je.maxzoom||je.visibility!=="none"&&(P_(Pe,this.zoom,a),(x[je.id]=je.createBucket({index:y.bucketLayerIDs.length,layers:Pe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(We,D,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Pe.map(Ue=>Ue.id)))}}let S,k,L,z;b.trim();let H={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},K=()=>{if(S)return f(S);if(k&&L&&z){let ue=new cw(k),le=new gb(L,z);for(let Me in x){let Te=x[Me];Te instanceof kl?(P_(Te.layers,this.zoom,a),bM(Te,k,ue.positions,L,le.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Te.hasPattern&&(Te instanceof fp||Te instanceof lp||Te instanceof Ed)&&(P_(Te.layers,this.zoom,a),Te.addFeatures(D,this.tileID.canonical,le.patternPositions,a,this.tileTransform))}this.status="done",f(null,{buckets:Zi(x).filter(Me=>!Me.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ue.image,lineAtlas:b,imageAtlas:le,glyphMap:this.returnDependencies?k:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?ue.positions:null})}},se=Jt(D.glyphDependencies,ue=>Object.keys(ue).map(Number));Object.keys(se).length?c.send("getGlyphs",{uid:this.uid,stacks:se},(ue,le)=>{S||(S=ue,k=le,K())},void 0,!1,H):k={};let J=Object.keys(D.iconDependencies);J.length?c.send("getImages",{icons:J,source:this.source,tileID:this.tileID,type:"icons"},(ue,le)=>{S||(S=ue,L=le,K())},void 0,!1,H):L={};let oe=Object.keys(D.patternDependencies);oe.length?c.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"patterns"},(ue,le)=>{S||(S=ue,z=le,K())},void 0,!1,H):z={},K()}}function P_(t,e,n){let a=new I(e);for(let c of t)c.recalculate(a,n)}class uw{constructor(e){this.entries={},this.scheduler=e}request(e,n,a,c){let f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){let[m,y]=f.result;return this.scheduler?this.scheduler.add(()=>{c(m,y)},n):c(m,y),()=>{}}return f.callbacks.push(c),f.cancel||(f.cancel=a((m,y)=>{f.result=[m,y];for(let x of f.callbacks)this.scheduler?this.scheduler.add(()=>{x(m,y)},n):x(m,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(m=>m!==c),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function hw(t,e,n){let a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{let f=Ks(t.request,(m,y,x,b)=>{m?c(m):y&&c(null,{vectorTile:n?void 0:new u_(new gp(y)),rawData:y,cacheControl:x,expires:b})});return()=>{f.cancel(),c()}},e)}let dw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class R_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let f=dw[15&a];if(!f)throw new Error("Unrecognized array type.");let[m]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new R_(y,m,f,e)}constructor(e,n=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let f=dw.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return O_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:f,coords:m,nodeSize:y}=this,x=[0,f.length-1,0],b=[];for(;x.length;){let D=x.pop()||0,M=x.pop()||0,S=x.pop()||0;if(M-S<=y){for(let H=S;H<=M;H++){let K=m[2*H],se=m[2*H+1];K>=e&&K<=a&&se>=n&&se<=c&&b.push(f[H])}continue}let k=S+M>>1,L=m[2*k],z=m[2*k+1];L>=e&&L<=a&&z>=n&&z<=c&&b.push(f[k]),(D===0?e<=L:n<=z)&&(x.push(S),x.push(k-1),x.push(1-D)),(D===0?a>=L:c>=z)&&(x.push(k+1),x.push(M),x.push(1-D))}return b}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:f,nodeSize:m}=this,y=[0,c.length-1,0],x=[],b=a*a;for(;y.length;){let D=y.pop()||0,M=y.pop()||0,S=y.pop()||0;if(M-S<=m){for(let H=S;H<=M;H++)pw(f[2*H],f[2*H+1],e,n)<=b&&x.push(c[H]);continue}let k=S+M>>1,L=f[2*k],z=f[2*k+1];pw(L,z,e,n)<=b&&x.push(c[k]),(D===0?e-a<=L:n-a<=z)&&(y.push(S),y.push(k-1),y.push(1-D)),(D===0?e+a>=L:n+a>=z)&&(y.push(k+1),y.push(M),y.push(1-D))}return x}}function O_(t,e,n,a,c,f){if(c-a<=n)return;let m=a+c>>1;fw(t,e,m,a,c,f),O_(t,e,n,a,m-1,1-f),O_(t,e,n,m+1,c,1-f)}function fw(t,e,n,a,c,f){for(;c>a;){if(c-a>600){let b=c-a+1,D=n-a+1,M=Math.log(b),S=.5*Math.exp(2*M/3),k=.5*Math.sqrt(M*S*(b-S)/b)*(D-b/2<0?-1:1);fw(t,e,n,Math.max(a,Math.floor(n-D*S/b+k)),Math.min(c,Math.floor(n+(b-D)*S/b+k)),f)}let m=e[2*n+f],y=a,x=c;for(Fd(t,e,a,n),e[2*c+f]>m&&Fd(t,e,a,c);y<x;){for(Fd(t,e,y,x),y++,x--;e[2*y+f]<m;)y++;for(;e[2*x+f]>m;)x--}e[2*a+f]===m?Fd(t,e,a,x):(x++,Fd(t,e,x,c)),x<=n&&(a=x+1),n<=x&&(c=x-1)}}function Fd(t,e,n,a){k_(t,n,a),k_(e,2*n,2*a),k_(e,2*n+1,2*a+1)}function k_(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}function pw(t,e,n,a){let c=t-n,f=e-a;return c*c+f*f}i.ARRAY_TYPE=no,i.AUTH_ERR_MSG=ce,i.Aabb=Pi,i.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},_r(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ho()?t:w,this.scheduler=new UM}send(t,e,n,a,c=!1,f){let m=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=f,this.callbacks[m]=n);let y=Ys(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:t,hasCallback:!!n,targetMapId:a,mustQueue:c,sourceMapId:this.mapId,data:Dl(e,y)},y),{cancel:()=>{n&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(t){let e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){let a=this.cancelCallbacks[n];delete this.cancelCallbacks[n],a&&a.cancel()}else if(e.mustQueue||ho()){let a=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),a&&a.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if(e.type==="<response>"){let n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(Ha(e.error)):n(null,Ha(e.data)))}else{let n=Ys(this.globalScope)?void 0:[],a=e.hasCallback?(f,m)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:f?Dl(f):null,data:Dl(m,n)},n)}:f=>{},c=Ha(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,a);else if(this.parent.getWorkerSource){let f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],c.source)[f[1]](c,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},i.CanonicalTileID=dp,i.Color=Ne,i.ColorMode=_a,i.CullFaceMode=Fs,i.DEMData=Sp,i.DataConstantProperty=N,i.DedupedRequest=uw,i.DepthMode=Hu,i.EXTENT=bt,i.Elevation=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,a=1<<n,c=Math.floor(t.x),f=Math.floor((t.x-c)*a),m=Math.floor(t.y*a),y=this.findDEMTileFor(new Ri(n,c,n,f,m));return!(!y||!y.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||t.y<0||t.y>1)return e;let c=a.getSource().maxzoom,f=1<<c,m=Math.floor(t.x),y=t.x-m,x=new Ri(c,m,c,Math.floor(y*f),Math.floor(t.y*f)),b=this.findDEMTileFor(x);if(!b||!b.dem)return e;let D=b.dem,M=1<<b.tileID.canonical.z,S=(y*M-b.tileID.canonical.x)*D.dim,k=(t.y*M-b.tileID.canonical.y)*D.dim,L=Math.floor(S),z=Math.floor(k);return(n?this.exaggeration():1)*Xt(Xt(D.get(L,z),D.get(L,z+1),k-z),Xt(D.get(L+1,z),D.get(L+1,z+1),k-z),S-L)}getAtTileOffset(t,e,n){let a=1<<t.canonical.z;return this.getAtPointOrZero(new Pu(t.wrap+(t.canonical.x+e/bt)/a,(t.canonical.y+n/bt)/a))}getAtTileOffsetFunc(t,e,n,a){return c=>{let f=this.getAtTileOffset(t,c.x,c.y),m=a.upVector(t.canonical,c.x,c.y);return Mo(m,m,f*a.upVectorScale(t.canonical,e,n).metersToTile),m}}getForTilePoints(t,e,n,a){if(this.isUsingMockSource())return!1;let c=Ap.create(this,t,a);return!!c&&(e.forEach(f=>{f[2]=this.exaggeration()*c.getElevationAt(f[0],f[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,a=e.tileID,c=1<<t.canonical.z-a.canonical.z,f=t.canonical.x/c-a.canonical.x,m=t.canonical.y/c-a.canonical.y,y=0;for(let x=0;x<t.canonical.z-a.canonical.z&&!n.leaves[y];x++){f*=2,m*=2;let b=2*Math.floor(m)+Math.floor(f);y=n.childOffsets[y]+b,f%=1,m%=1}return{min:this.exaggeration()*n.minimums[y],max:this.exaggeration()*n.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},i.ErrorEvent=zr,i.EvaluationParameters=I,i.Event=Uo,i.Evented=ii,i.FillExtrusionBucket=Ed,i.Frustum=jg,i.FrustumCorners=Vg,i.GLOBE_RADIUS=ha,i.GLOBE_SCALE_MATCH_LATITUDE=45,i.GLOBE_ZOOM_THRESHOLD_MAX=fx,i.GLOBE_ZOOM_THRESHOLD_MIN=Ug,i.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(let t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){let n=new qe,a=new _t,c=[],f=t+1+2,m=e[0]+1,y=e[0]+1+(1+e.length),x=(b,D,M)=>{let S=b===f-1?b-2:b===0?b:b-1;return S+=M?24575:0,[S,D]};for(let b=0;b<f;++b)n.emplaceBack(...x(b,0,!0));for(let b=0;b<m;++b)for(let D=0;D<f;++D)n.emplaceBack(...x(D,b,(D===0||D===f-1)&&!0));for(let b=0;b<e.length;++b){let D=e[b];for(let M=0;M<f;++M)n.emplaceBack(...x(M,D,!0))}for(let b=0;b<e.length;++b){let D=a.length,M=e[b]+1+2,S=new _t;for(let z=0;z<M-1;z++){let H=z===M-2,K=H?f*(y-e.length+b-z):f;for(let se=0;se<f-1;se++){let J=z*f+se;z===0||H||se===0||se===f-2?(S.emplaceBack(J+1,J,J+K),S.emplaceBack(J+K,J+K+1,J+1)):(a.emplaceBack(J+1,J,J+K),a.emplaceBack(J+K,J+K+1,J+1))}}let k=Tr.simpleSegment(0,D,n.length,a.length-D);for(let z=0;z<S.uint16.length;z+=3)a.emplaceBack(S.uint16[z],S.uint16[z+1],S.uint16[z+2]);let L=Tr.simpleSegment(0,D,n.length,a.length-D);c.push({withoutSkirts:k,withSkirts:L})}return{vertices:n,indices:a,segments:c}}_createGrid(t){let e=this._fillGridMeshWithLods(Ac,fd);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,dd.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new _t;for(let c=0;c<=Ac;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new Ln,a=new Ln;this._poleSegments=[];for(let c=0,f=0;c<Ug;c++){let m=360/(1<<c);n.emplaceBack(0,-ha,0,.5,0),a.emplaceBack(0,-ha,0,.5,1);for(let y=0;y<=Ac;y++){let x=y/Ac,b=Xt(0,m,x),[D,M,S]=Mu(UD,$D,b,ha);n.emplaceBack(D,M,S,x,0),a.emplaceBack(D,M,S,x,1)}this._poleSegments.push(Tr.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,hx,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,hx,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){let n=new Vr,a=Ac,c=a+1+2,f=1;this._wireframeSegments=[];for(let m=0,y=0;m<fd.length;m++){let x=fd[m];for(let D=f;D<x+f;D++)for(let M=f;M<a+f;M++){let S=D*c+M;n.emplaceBack(S,S+1),n.emplaceBack(S,S+c),n.emplaceBack(S,S+c+1)}let b=x*a*3;this._wireframeSegments.push(Tr.simpleSegment(0,y,(x+1)*c,b)),y+=b}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},i.GlyphManager=Vu,i.ImagePosition=m_,i.KDBush=R_,i.LivePerformanceUtils=Bh,i.LngLat=Nn,i.LngLatBounds=Al,i.LocalGlyphMode=y_,i.MAX_MERCATOR_LATITUDE=ui,i.MercatorCoordinate=Pu,i.ONE_EM=Yr,i.OverscaledTileID=Ri,i.PerformanceMarkers=Qs,i.Point=rt,i.Properties=te,i.RGBAImage=ro,i.Ray=Bg,i.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",En,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!pe(t))return t;let n=it(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!pe(t))return t;let n=it(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,a){if(!pe(t))return t;let c=it(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),a&&c.params.push(`worldview=${a}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,a){let c=it(t);return pe(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||a)):(c.path+=`${e}${n}`,Ze(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!pe(t))return t;let a=it(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&a.authority!=="raster"&&n===512?"@2x":""}${ie.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${j.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${j.TILE_URL_VERSION}${a.path}`);let c=this._customAccessToken||function(f){for(let m of f){let y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||j.ACCESS_TOKEN;return j.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,c)}canonicalizeTileURL(t,e){let n=it(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${j.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${j.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(f=>!f.match(/^access_token=/))),c.length&&(a+=`?${c.join("&")}`),a}canonicalizeTileset(t,e){let n=!!e&&pe(e),a=[];for(let c of t.tiles||[])Ee(c)?a.push(this.canonicalizeTileURL(c,n)):a.push(c);return a}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=it(j.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){let c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!j.REQUIRE_ACCESS_TOKEN)return Ze(t);if(e=e||j.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Ze(t)}},i.ResourceType=Yi,i.SegmentVector=Tr,i.SourceCache=Fc,i.StencilMode=M_,i.StructArrayLayout1ui2=to,i.StructArrayLayout2f1f2i16=Et,i.StructArrayLayout2i4=qe,i.StructArrayLayout2ui4=Vr,i.StructArrayLayout3f12=Kt,i.StructArrayLayout3ui6=_t,i.StructArrayLayout4i8=Ve,i.StructArrayLayout5f20=Ln,i.Texture=kd,i.Tile=D_,i.Transitionable=F,i.Uniform1f=Xf,i.Uniform1i=class extends Za{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},i.Uniform2f=class extends Za{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},i.Uniform3f=class extends Za{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},i.Uniform4f=Z0,i.UniformColor=X0,i.UniformMatrix2f=class extends Za{constructor(t){super(t),this.current=DD}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let a=0;a<4;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}},i.UniformMatrix3f=class extends Za{constructor(t){super(t),this.current=TD}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},i.UniformMatrix4f=class extends Za{constructor(t){super(t),this.current=CD}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let a=1;a<16;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},i.UnwrappedTileID=tb,i.ValidationError=dt,i.VectorTileFeature=up,i.VectorTileWorkerSource=class extends ii{constructor(t,e,n,a,c){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=c||hw,this.loading={},this.loaded={},this.deduped=new uw(t.scheduler),this.isSpriteLoaded=a,this.scheduler=t.scheduler}loadTile(t,e){let n=t.uid,a=t&&t.request,c=a&&a.collectResourceTiming,f=this.loading[n]=new XM(t);f.abort=this.loadVectorData(t,(m,y)=>{let x=!this.loading[n];if(delete this.loading[n],x||m||!y)return f.status="done",x||(this.loaded[n]=f),e(m);let b=y.rawData,D={};y.expires&&(D.expires=y.expires),y.cacheControl&&(D.cacheControl=y.cacheControl),f.vectorTile=y.vectorTile||new u_(new gp(b));let M=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(S,k)=>{if(S||!k)return e(S);let L={};if(c){let z=Ql(a);z.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(z)))}e(null,un({rawTileData:b.slice(0)},k,D,L))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[n]=f})}reloadTile(t,e){let n=this.loaded,a=t.uid,c=this;if(n&&n[a]){let f=n[a];f.showCollisionBoxes=t.showCollisionBoxes,f.enableTerrain=!!t.enableTerrain,f.projection=t.projection,f.tileTransform=Lc(t.tileID.canonical,t.projection);let m=(y,x)=>{let b=f.reloadCallback;b&&(delete f.reloadCallback,f.parse(f.vectorTile,c.layerIndex,this.availableImages,c.actor,b)),e(y,x)};f.status==="parsing"?f.reloadCallback=m:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(t,e){let n=t.uid,a=this.loading[n];a&&(a.abort&&a.abort(),delete this.loading[n]),e()}removeTile(t,e){let n=this.loaded,a=t.uid;n&&n[a]&&delete n[a],e()}},i.WritingMode=Ao,i.ZoomDependentExpression=_c,i.add=Ya,i.addDynamicAttributes=Dp,i.adjoint=function(t,e){var n=e[0],a=e[1],c=e[2],f=e[3],m=e[4],y=e[5],x=e[6],b=e[7],D=e[8];return t[0]=m*D-y*b,t[1]=c*b-a*D,t[2]=a*y-c*m,t[3]=y*x-f*D,t[4]=n*D-c*x,t[5]=c*f-n*y,t[6]=f*b-m*x,t[7]=a*x-n*b,t[8]=n*m-a*f,t},i.asyncAll=gr,i.bezier=zo,i.bindAll=_r,i.boundsAttributes=Wb,i.bufferConvexPolygon=function(t,e){let n=[];for(let a=0;a<t.length;a++){let c=mr(a-1,-1,t.length-1),f=mr(a+1,-1,t.length-1),m=t[a],y=t[f],x=t[c].sub(m).unit(),b=y.sub(m).unit(),D=b.angleWithSep(x.x,x.y),M=x.add(b).unit().mult(-1*e/Math.sin(D/2));n.push(m.add(M))}return n},i.cacheEntryPossiblyAdded=function(t){Vo++,Vo>Xi&&(t.getActor().send("enforceCacheSizeLimit",Pa),Vo=0)},i.calculateGlobeLabelMatrix=function(t,e){let{x:n,y:a}=t.point,c=yx(n,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Ic(c,c,Hg(da(e)))},i.calculateGlobeMatrix=function(t){let{x:e,y:n}=t.point,{lng:a,lat:c}=t._center;return yx(e,n,t.worldSize,a,c)},i.calculateGlobeMercatorMatrix=function(t){let e=t.pixelsPerMeter,n=e/Os(1,t.center.lat),a=Ps(new Float64Array(16));return sd(a,a,[t.point.x,t.point.y,0]),Mc(a,a,[n,n,e]),Float32Array.from(a)},i.circumferenceAtLatitude=Wg,i.clamp=Ht,i.clearTileCache=function(t){if(!gs())return;let e=w.caches.delete(po);t&&e.catch(t).then(()=>t())},i.clipLine=Sb,i.clone=function(t){var e=new no(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},i.clone$1=hi,i.collisionCircleLayout=WI,i.config=j,i.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},i.create=function(){var t=new no(16);return no!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},i.create$1=J0,i.createExpression=El,i.createLayout=ye,i.createStyleLayer=function(t){return t.type==="custom"?new zM(t):new VM[t.type](t)},i.cross=zg,i.degToRad=At,i.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},i.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},i.dot=ns,i.earthRadius=gd,i.ease=Zs,i.easeCubicInOut=Ma,i.ecefToLatLng=function([t,e,n]){let a=Math.hypot(t,e,n),c=Math.atan2(t,n),f=.5*Math.PI-Math.acos(-e/a);return new Nn(Pr(c),Pr(f))},i.emitValidationErrors=$f,i.endsWith=qt,i.enforceCacheSizeLimit=function(t){zi(),ri&&ri.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-t;a++)e.delete(n[a])})})},i.evaluateSizeForFeature=pp,i.evaluateSizeForZoom=Fu,i.evaluateVariableOffset=kb,i.evented=_,i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},i.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},i.exported=Bi,i.exported$1=ie,i.extend=un,i.extend$1=Hr,i.fillExtrusionHeightLift=Jx,i.filterObject=Xs,i.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},i.fromQuat=function(t,e){var n=e[0],a=e[1],c=e[2],f=e[3],m=n+n,y=a+a,x=c+c,b=n*m,D=a*m,M=a*y,S=c*m,k=c*y,L=c*x,z=f*m,H=f*y,K=f*x;return t[0]=1-M-L,t[1]=D+K,t[2]=S-H,t[3]=0,t[4]=D-K,t[5]=1-b-L,t[6]=k+z,t[7]=0,t[8]=S+H,t[9]=k-z,t[10]=1-b-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=-n,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.fromScaling=ex,i.furthestTileCorner=function(t){let e=Math.round((t+45+360)%360/90)%4;return No[e]},i.getAABBPointSquareDist=function(t,e,n){let a=0;for(let c=0;c<2;++c){let f=n?n[c]:0;t[c]>f&&(a+=(t[c]-f)*(t[c]-f)),e[c]<f&&(a+=(f-e[c])*(f-e[c]))}return a},i.getAnchorAlignment=__,i.getAnchorJustification=x_,i.getBounds=function(t){let e=1/0,n=1/0,a=-1/0,c=-1/0;for(let f of t)e=Math.min(e,f.x),n=Math.min(n,f.y),a=Math.max(a,f.x),c=Math.max(c,f.y);return{min:new rt(e,n),max:new rt(a,c)}},i.getColumn=fo,i.getDefaultExportFromCjs=Ct,i.getGridMatrix=function(t,e,n,a){let c=e.getNorth(),f=e.getSouth(),m=e.getWest(),y=e.getEast(),x=1<<t.z,b=y-m,D=c-f,M=b/Ac,S=-D/fd[n],k=[0,M,0,S,0,0,c,m,0];if(t.z>0){let L=180/a;Q0(k,k,[L/b+1,0,0,0,L/D+1,0,-.5*L/M,.5*L/S,1])}return k[2]=x,k[5]=t.x,k[8]=t.y,k},i.getImage=ee,i.getJSON=function(t,e){return wi(un(t,{type:"json"}),e)},i.getLatitudinalLod=function(t){let e=ui-5;t=Ht(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(At(t))),3);return Math.round(n*(fd.length-1))},i.getMapSessionAPI=Rr,i.getPerformanceMeasurement=Ql,i.getProjection=Ub,i.getRTLTextPluginStatus=v,i.getReferrer=_s,i.getTilePoint=function(t,{x:e,y:n},a=0){return new rt(((e-a)*t.scale-t.x)*bt,(n*t.scale-t.y)*bt)},i.getTileVec3=function(t,e,n=0){return Iu(((e.x-n)*t.scale-t.x)*bt,(e.y*t.scale-t.y)*bt,wx(e.z,e.y))},i.getVideo=function(t,e){let n=w.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<t.length;a++){let c=w.document.createElement("source");Js(t[a])||(n.crossOrigin="Anonymous"),c.src=t[a],n.appendChild(c)}return{cancel:()=>{}}},i.globeCenterToScreenPoint=function(t){let e=[0,0,0],n=Ps(new Float64Array(16));return Ic(n,t.pixelMatrix,t.globeMatrix),vr(e,e,n),new rt(e[0],e[1])},i.globeDenormalizeECEF=Hg,i.globeECEFOrigin=function(t,e){let n=[0,0,0];return vr(n,n,md(da(e.canonical))),vr(n,n,t),n},i.globeMetersToEcef=Jf,i.globeNormalizeECEF=md,i.globePixelsToTileUnits=function(t,e){return bt/(512*Math.pow(2,t))*ep(da(e))},i.globePoleMatrixForTile=function(t,e,n){let a=Ps(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return Kf(a,n.globeMatrix,c),Float32Array.from(a)},i.globeTileBounds=da,i.globeTiltAtLngLat=vx,i.globeToMercatorTransition=Au,i.globeUseCustomAntiAliasing=function(t,e,n){let a=Au(n.zoom),c=t.style.map._antialias,f=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!c&&!m&&f},i.identity=Ps,i.identity$1=lx,i.invert=kg,i.isFullscreen=function(){return!!w.document.fullscreenElement||!!w.document.webkitFullscreenElement},i.isLngLatBehindGlobe=qg,i.isMapAuthenticated=function(t){return Rn.has(t)},i.isMapboxURL=pe,i.isSafariWithAntialiasingBug=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!Ys(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.latFromMercatorY=ci,i.latLngToECEF=Su,i.len=LD,i.length=ad,i.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},i.lngFromMercatorX=So,i.loadVectorTile=hw,i.makeRequest=wi,i.mapValue=function(t,e,n,a,c){return Ht((t-e)/(n-e)*(c-a)+a,a,c)},i.mercatorScale=Ex,i.mercatorXfromLng=fa,i.mercatorYfromLat=pa,i.mercatorZfromAltitude=Os,i.mul=OD,i.mul$1=kD,i.multiply=Ic,i.multiply$1=Q0,i.multiply$2=rx,i.nextPowerOfTwo=co,i.normalize=Ai,i.normalize$1=FD,i.normalize$2=sx,i.number=Xt,i.ortho=function(t,e,n,a,c,f,m){var y=1/(e-n),x=1/(a-c),b=1/(f-m);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+n)*y,t[13]=(c+a)*x,t[14]=(m+f)*b,t[15]=1,t},i.pbf=lb,i.perspective=function(t,e,n,a,c){var f,m=1/Math.tan(e/2);return t[0]=m/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+a)*(f=1/(a-c)),t[14]=2*c*a*f):(t[10]=-1,t[14]=-2*a),t},i.pick=function(t,e){let n={};for(let a=0;a<e.length;a++){let c=e[a];c in t&&(n[c]=t[c])}return n},i.plugin=T,i.pointGeometry=ei,i.polesInViewport=function(t){let e=Ps(new Float64Array(16));Ic(e,t.pixelMatrix,t.globeMatrix);let n=[0,rs,0],a=[0,is,0];return vr(n,n,e),vr(a,a,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!qg(t,new Nn(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!qg(t,new Nn(t.center.lat,-90))]},i.polygonContainsPoint=Oc,i.polygonIntersectsBox=Ax,i.polygonIntersectsPolygon=Dx,i.polygonizeBounds=function(t,e,n=0,a=!0){let c=new rt(n,n),f=t.sub(c),m=e.add(c),y=[f,new rt(m.x,f.y),m,new rt(f.x,m.y)];return a&&y.push(f.clone()),y},i.posAttributes=dd,i.postMapLoadEvent=cr,i.postPerformanceEvent=or,i.postTurnstileEvent=Wt,i.potpack=p_,i.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},i.radToDeg=Pr,i.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.registerForPluginStateChange=function(t){return t({pluginStatus:d,pluginURL:r}),_.on("pluginStateChange",t),t},i.removeAuthState=function(t){Rn.delete(t)},i.renderColorRamp=t_,i.resample=Cx,i.rotateX=Lg,i.rotateX$1=cx,i.rotateY=Kf,i.rotateY$1=ux,i.rotateZ=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),f=e[0],m=e[1],y=e[2],x=e[3],b=e[4],D=e[5],M=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*c+b*a,t[1]=m*c+D*a,t[2]=y*c+M*a,t[3]=x*c+S*a,t[4]=b*c-f*a,t[5]=D*c-m*a,t[6]=M*c-y*a,t[7]=S*c-x*a,t},i.rotateZ$1=function(t,e,n){n*=.5;var a=e[0],c=e[1],f=e[2],m=e[3],y=Math.sin(n),x=Math.cos(n);return t[0]=a*x+c*y,t[1]=c*x-a*y,t[2]=f*x+m*y,t[3]=m*x-f*y,t},i.scale=Mc,i.scale$1=ox,i.scale$2=Mo,i.scaleAndAdd=ud,i.set=function(t,e,n,a){return t[0]=e,t[1]=n,t[2]=a,t},i.setCacheLimits=function(t,e){Pa=t,Xi=e},i.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},i.setRTLTextPlugin=function(t,e,n=!1){if(d===td||d===nd||d===rd)throw new Error("setRTLTextPlugin cannot be called multiple times.");r=Bi.resolveURL(t),d=td,Il=e,p(),n||E()},i.smoothstep=Bo,i.spec=Oe,i.squaredLength=function(t){var e=t[0],n=t[1],a=t[2];return e*e+n*n+a*a},i.storeAuthState=function(t,e){e?Rn.add(t):Rn.delete(t)},i.sub=Rs,i.subtract=Ng,i.symbolSize=ZI,i.tileAABB=function(t,e,n,a,c,f,m,y,x){if(x.name==="globe")return jD(t,e,new dp(n,a,c));let b=Lc({z:n,x:a,y:c},x);return new Pi([(f+b.x/b.scale)*e,e*(b.y/b.scale),m],[(f+b.x2/b.scale)*e,e*(b.y2/b.scale),y])},i.tileCornersToBounds=Qf,i.tileTransform=Lc,i.transformMat3=function(t,e,n){var a=e[0],c=e[1],f=e[2];return t[0]=a*n[0]+c*n[3]+f*n[6],t[1]=a*n[1]+c*n[4]+f*n[7],t[2]=a*n[2]+c*n[5]+f*n[8],t},i.transformMat4=vr,i.transformMat4$1=Sc,i.transformQuat=ix,i.transitionTileAABBinECEF=mx,i.translate=sd,i.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=a,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},i.triggerPluginCompletionEvent=l,i.uniqueId=ni,i.updateGlobeVertexNormal=function(t,e,n,a,c){let f=5*e+2;t.float32[f+0]=n,t.float32[f+1]=a,t.float32[f+2]=c},i.validateCustomStyleLayer=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},i.validateFilter=t=>eo(wc(t)),i.validateFog=t=>eo(Vf(t)),i.validateLayer=t=>eo(Ff(t)),i.validateLight=t=>eo(Bf(t)),i.validateSource=t=>eo(zf(t)),i.validateStyle=Uf,i.validateTerrain=t=>eo(Yh(t)),i.values=Zi,i.vectorTile=cp,i.version=O,i.warnOnce=Jn,i.window=w,i.wrap=mr}),u(["./shared"],function(i){"use strict";function w(re){if(typeof re=="number"||typeof re=="boolean"||typeof re=="string"||re==null)return JSON.stringify(re);if(Array.isArray(re)){let U="[";for(let ee of re)U+=`${w(ee)},`;return`${U}]`}let V="{";for(let U of Object.keys(re).sort())V+=`${U}:${w(re[U])},`;return`${V}}`}function O(re){let V="";for(let U of i.refProperties)V+=`/${w(re[U])}`;return V}class B{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,U){for(let ce of V)this._layerConfigs[ce.id]=ce,(this._layers[ce.id]=i.createStyleLayer(ce)).compileFilter(),this.keyCache[ce.id]&&delete this.keyCache[ce.id];for(let ce of U)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};let ee=function(ce,pe){let Ee={};for(let me=0;me<ce.length;me++){let Se=pe&&pe[ce[me].id]||O(ce[me]);pe&&(pe[ce[me].id]=Se);let Ke=Ee[Se];Ke||(Ke=Ee[Se]=[]),Ke.push(ce[me])}let we=[];for(let me in Ee)we.push(Ee[me]);return we}(i.values(this._layerConfigs),this.keyCache);for(let ce of ee){let pe=ce.map(it=>this._layers[it.id]),Ee=pe[0];if(Ee.visibility==="none")continue;let we=Ee.source||"",me=this.familiesBySource[we];me||(me=this.familiesBySource[we]={});let Se=Ee.sourceLayer||"_geojsonTileLayer",Ke=me[Se];Ke||(Ke=me[Se]=[]),Ke.push(pe)}}}class j{loadTile(V,U){let{uid:ee,encoding:ce,rawImageData:pe,padding:Ee,buildQuadTree:we}=V,me=i.window.ImageBitmap&&pe instanceof i.window.ImageBitmap?this.getImageData(pe,Ee):pe;U(null,new i.DEMData(ee,me,ce,Ee<1,we))}getImageData(V,U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);let ee=this.offscreenCanvasContext.getImageData(-U,-U,V.width+2*U,V.height+2*U);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ee}}function ie(re,V){if(re.length!==0){_e(re[0],V);for(var U=1;U<re.length;U++)_e(re[U],!V)}}function _e(re,V){for(var U=0,ee=0,ce=0,pe=re.length,Ee=pe-1;ce<pe;Ee=ce++){var we=(re[ce][0]-re[Ee][0])*(re[Ee][1]+re[ce][1]),me=U+we;ee+=Math.abs(U)>=Math.abs(we)?U-me+we:we-me+U,U=me}U+ee>=0!=!!V&&re.reverse()}var Be=i.getDefaultExportFromCjs(function re(V,U){var ee,ce=V&&V.type;if(ce==="FeatureCollection")for(ee=0;ee<V.features.length;ee++)re(V.features[ee],U);else if(ce==="GeometryCollection")for(ee=0;ee<V.geometries.length;ee++)re(V.geometries[ee],U);else if(ce==="Feature")re(V.geometry,U);else if(ce==="Polygon")ie(V.coordinates,U);else if(ce==="MultiPolygon")for(ee=0;ee<V.coordinates.length;ee++)ie(V.coordinates[ee],U);return V});let Re=i.VectorTileFeature.prototype.toGeoJSON;var tt={exports:{}},Mt=i.pointGeometry,En=i.vectorTile.VectorTileFeature,Ct=gn;function gn(re,V){this.options=V||{},this.features=re,this.length=re.length}function Un(re,V){this.id=typeof re.id=="number"?re.id:void 0,this.type=re.type,this.rawGeometry=re.type===1?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=V||4096}gn.prototype.feature=function(re){return new Un(this.features[re],this.options.extent)},Un.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var V=0;V<re.length;V++){for(var U=re[V],ee=[],ce=0;ce<U.length;ce++)ee.push(new Mt(U[ce][0],U[ce][1]));this.geometry.push(ee)}return this.geometry},Un.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,V=1/0,U=-1/0,ee=1/0,ce=-1/0,pe=0;pe<re.length;pe++)for(var Ee=re[pe],we=0;we<Ee.length;we++){var me=Ee[we];V=Math.min(V,me.x),U=Math.max(U,me.x),ee=Math.min(ee,me.y),ce=Math.max(ce,me.y)}return[V,ee,U,ce]},Un.prototype.toGeoJSON=En.prototype.toGeoJSON;var xr=i.pbf,ei=Ct;function nr(re){var V=new xr;return function(U,ee){for(var ce in U.layers)ee.writeMessage(3,rt,U.layers[ce])}(re,V),V.finish()}function rt(re,V){var U;V.writeVarintField(15,re.version||1),V.writeStringField(1,re.name||""),V.writeVarintField(5,re.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<re.length;U++)ee.feature=re.feature(U),V.writeMessage(2,Fo,ee);var ce=ee.keys;for(U=0;U<ce.length;U++)V.writeStringField(3,ce[U]);var pe=ee.values;for(U=0;U<pe.length;U++)V.writeMessage(4,Ma,pe[U])}function Fo(re,V){var U=re.feature;U.id!==void 0&&V.writeVarintField(1,U.id),V.writeMessage(2,Ws,re),V.writeVarintField(3,U.type),V.writeMessage(4,No,U)}function Ws(re,V){var U=re.feature,ee=re.keys,ce=re.values,pe=re.keycache,Ee=re.valuecache;for(var we in U.properties){var me=U.properties[we],Se=pe[we];if(me!==null){Se===void 0&&(ee.push(we),pe[we]=Se=ee.length-1),V.writeVarint(Se);var Ke=typeof me;Ke!=="string"&&Ke!=="boolean"&&Ke!=="number"&&(me=JSON.stringify(me));var it=Ke+":"+me,Ze=Ee[it];Ze===void 0&&(ce.push(me),Ee[it]=Ze=ce.length-1),V.writeVarint(Ze)}}}function At(re,V){return(V<<3)+(7&re)}function Pr(re){return re<<1^re>>31}function No(re,V){for(var U=re.loadGeometry(),ee=re.type,ce=0,pe=0,Ee=U.length,we=0;we<Ee;we++){var me=U[we],Se=1;ee===1&&(Se=me.length),V.writeVarint(At(1,Se));for(var Ke=ee===3?me.length-1:me.length,it=0;it<Ke;it++){it===1&&ee!==1&&V.writeVarint(At(2,Ke-1));var Ze=me[it].x-ce,Lt=me[it].y-pe;V.writeVarint(Pr(Ze)),V.writeVarint(Pr(Lt)),ce+=Ze,pe+=Lt}ee===3&&V.writeVarint(At(7,1))}}function Ma(re,V){var U=typeof re;U==="string"?V.writeStringField(1,re):U==="boolean"?V.writeBooleanField(7,re):U==="number"&&(re%1!=0?V.writeDoubleField(3,re):re<0?V.writeSVarintField(6,re):V.writeVarintField(5,re))}tt.exports=nr,tt.exports.fromVectorTileJs=nr,tt.exports.fromGeojsonVt=function(re,V){V=V||{};var U={};for(var ee in re)U[ee]=new ei(re[ee].features,V),U[ee].name=ee,U[ee].version=V.version,U[ee].extent=V.extent;return nr({layers:U})},tt.exports.GeoJSONWrapper=ei;var zo=i.getDefaultExportFromCjs(tt.exports);let Zs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:re=>re},Ht=Math.fround||(Bo=new Float32Array(1),re=>(Bo[0]=+re,Bo[0]));var Bo;let mr=3,gr=5,Zi=6;class un{constructor(V){this.options=Object.assign(Object.create(Zs),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){let{log:U,minZoom:ee,maxZoom:ce}=this.options;U&&console.time("total time");let pe=`prepare ${V.length} points`;U&&console.time(pe),this.points=V;let Ee=[];for(let me=0;me<V.length;me++){let Se=V[me];if(!Se.geometry)continue;let[Ke,it]=Se.geometry.coordinates,Ze=Ht(br(Ke)),Lt=Ht(co(it));Ee.push(Ze,Lt,1/0,me,-1,1),this.options.reduce&&Ee.push(0)}let we=this.trees[ce+1]=this._createTree(Ee);U&&console.timeEnd(pe);for(let me=ce;me>=ee;me--){let Se=+Date.now();we=this.trees[me]=this._createTree(this._cluster(we,me)),U&&console.log("z%d: %d clusters in %dms",me,we.numItems,+Date.now()-Se)}return U&&console.timeEnd("total time"),this}getClusters(V,U){let ee=((V[0]+180)%360+360)%360-180,ce=Math.max(-90,Math.min(90,V[1])),pe=V[2]===180?180:((V[2]+180)%360+360)%360-180,Ee=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ee=-180,pe=180;else if(ee>pe){let it=this.getClusters([ee,ce,180,Ee],U),Ze=this.getClusters([-180,ce,pe,Ee],U);return it.concat(Ze)}let we=this.trees[this._limitZoom(U)],me=we.range(br(ee),co(Ee),br(pe),co(ce)),Se=we.data,Ke=[];for(let it of me){let Ze=this.stride*it;Ke.push(Se[Ze+gr]>1?ti(Se,Ze,this.clusterProps):this.points[Se[Ze+mr]])}return Ke}getChildren(V){let U=this._getOriginId(V),ee=this._getOriginZoom(V),ce="No cluster with the specified id.",pe=this.trees[ee];if(!pe)throw new Error(ce);let Ee=pe.data;if(U*this.stride>=Ee.length)throw new Error(ce);let we=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),me=pe.within(Ee[U*this.stride],Ee[U*this.stride+1],we),Se=[];for(let Ke of me){let it=Ke*this.stride;Ee[it+4]===V&&Se.push(Ee[it+gr]>1?ti(Ee,it,this.clusterProps):this.points[Ee[it+mr]])}if(Se.length===0)throw new Error(ce);return Se}getLeaves(V,U,ee){let ce=[];return this._appendLeaves(ce,V,U=U||10,ee=ee||0,0),ce}getTile(V,U,ee){let ce=this.trees[this._limitZoom(V)],pe=Math.pow(2,V),{extent:Ee,radius:we}=this.options,me=we/Ee,Se=(ee-me)/pe,Ke=(ee+1+me)/pe,it={features:[]};return this._addTileFeatures(ce.range((U-me)/pe,Se,(U+1+me)/pe,Ke),ce.data,U,ee,pe,it),U===0&&this._addTileFeatures(ce.range(1-me/pe,Se,1,Ke),ce.data,pe,ee,pe,it),U===pe-1&&this._addTileFeatures(ce.range(0,Se,me/pe,Ke),ce.data,-1,ee,pe,it),it.features.length?it:null}getClusterExpansionZoom(V){let U=this._getOriginZoom(V)-1;for(;U<=this.options.maxZoom;){let ee=this.getChildren(V);if(U++,ee.length!==1)break;V=ee[0].properties.cluster_id}return U}_appendLeaves(V,U,ee,ce,pe){let Ee=this.getChildren(U);for(let we of Ee){let me=we.properties;if(me&&me.cluster?pe+me.point_count<=ce?pe+=me.point_count:pe=this._appendLeaves(V,me.cluster_id,ee,ce,pe):pe<ce?pe++:V.push(we),V.length===ee)break}return pe}_createTree(V){let U=new i.KDBush(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<V.length;ee+=this.stride)U.add(V[ee],V[ee+1]);return U.finish(),U.data=V,U}_addTileFeatures(V,U,ee,ce,pe,Ee){for(let we of V){let me=we*this.stride,Se=U[me+gr]>1,Ke,it,Ze;if(Se)Ke=ni(U,me,this.clusterProps),it=U[me],Ze=U[me+1];else{let Ot=this.points[U[me+mr]];Ke=Ot.properties;let[$t,Wt]=Ot.geometry.coordinates;it=br($t),Ze=co(Wt)}let Lt={type:1,geometry:[[Math.round(this.options.extent*(it*pe-ee)),Math.round(this.options.extent*(Ze*pe-ce))]],tags:Ke},St;St=Se||this.options.generateId?U[me+mr]:this.points[U[me+mr]].id,St!==void 0&&(Lt.id=St),Ee.features.push(Lt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,U){let{radius:ee,extent:ce,reduce:pe,minPoints:Ee}=this.options,we=ee/(ce*Math.pow(2,U)),me=V.data,Se=[],Ke=this.stride;for(let it=0;it<me.length;it+=Ke){if(me[it+2]<=U)continue;me[it+2]=U;let Ze=me[it],Lt=me[it+1],St=V.within(me[it],me[it+1],we),Ot=me[it+gr],$t=Ot;for(let Wt of St){let Sn=Wt*Ke;me[Sn+2]>U&&($t+=me[Sn+gr])}if($t>Ot&&$t>=Ee){let Wt,Sn=Ze*Ot,cr=Lt*Ot,wr=-1,or=((it/Ke|0)<<5)+(U+1)+this.points.length;for(let Ki of St){let Rr=Ki*Ke;if(me[Rr+2]<=U)continue;me[Rr+2]=U;let Rn=me[Rr+gr];Sn+=me[Rr]*Rn,cr+=me[Rr+1]*Rn,me[Rr+4]=or,pe&&(Wt||(Wt=this._map(me,it,!0),wr=this.clusterProps.length,this.clusterProps.push(Wt)),pe(Wt,this._map(me,Rr)))}me[it+4]=or,Se.push(Sn/$t,cr/$t,1/0,or,-1,$t),pe&&Se.push(wr)}else{for(let Wt=0;Wt<Ke;Wt++)Se.push(me[it+Wt]);if($t>1)for(let Wt of St){let Sn=Wt*Ke;if(!(me[Sn+2]<=U)){me[Sn+2]=U;for(let cr=0;cr<Ke;cr++)Se.push(me[Sn+cr])}}}}return Se}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,U,ee){if(V[U+gr]>1){let Ee=this.clusterProps[V[U+Zi]];return ee?Object.assign({},Ee):Ee}let ce=this.points[V[U+mr]].properties,pe=this.options.map(ce);return ee&&pe===ce?Object.assign({},pe):pe}}function ti(re,V,U){return{type:"Feature",id:re[V+mr],properties:ni(re,V,U),geometry:{type:"Point",coordinates:[(ee=re[V],360*(ee-.5)),ms(re[V+1])]}};var ee}function ni(re,V,U){let ee=re[V+gr],ce=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,pe=re[V+Zi],Ee=pe===-1?{}:Object.assign({},U[pe]);return Object.assign(Ee,{cluster:!0,cluster_id:re[V+mr],point_count:ee,point_count_abbreviated:ce})}function br(re){return re/360+.5}function co(re){let V=Math.sin(re*Math.PI/180),U=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return U<0?0:U>1?1:U}function ms(re){let V=(180-360*re)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function _r(re,V,U,ee){for(var ce,pe=ee,Ee=U-V>>1,we=U-V,me=re[V],Se=re[V+1],Ke=re[U],it=re[U+1],Ze=V+3;Ze<U;Ze+=3){var Lt=qt(re[Ze],re[Ze+1],me,Se,Ke,it);if(Lt>pe)ce=Ze,pe=Lt;else if(Lt===pe){var St=Math.abs(Ze-Ee);St<we&&(ce=Ze,we=St)}}pe>ee&&(ce-V>3&&_r(re,V,ce,ee),re[ce+2]=pe,U-ce>3&&_r(re,ce,U,ee))}function qt(re,V,U,ee,ce,pe){var Ee=ce-U,we=pe-ee;if(Ee!==0||we!==0){var me=((re-U)*Ee+(V-ee)*we)/(Ee*Ee+we*we);me>1?(U=ce,ee=pe):me>0&&(U+=Ee*me,ee+=we*me)}return(Ee=re-U)*Ee+(we=V-ee)*we}function Jt(re,V,U,ee){var ce={id:re===void 0?null:re,type:V,geometry:U,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pe){var Ee=pe.geometry,we=pe.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")Xs(pe,Ee);else if(we==="Polygon"||we==="MultiLineString")for(var me=0;me<Ee.length;me++)Xs(pe,Ee[me]);else if(we==="MultiPolygon")for(me=0;me<Ee.length;me++)for(var Se=0;Se<Ee[me].length;Se++)Xs(pe,Ee[me][Se])}(ce),ce}function Xs(re,V){for(var U=0;U<V.length;U+=3)re.minX=Math.min(re.minX,V[U]),re.minY=Math.min(re.minY,V[U+1]),re.maxX=Math.max(re.maxX,V[U]),re.maxY=Math.max(re.maxY,V[U+1])}function hi(re,V,U,ee){if(V.geometry){var ce=V.geometry.coordinates,pe=V.geometry.type,Ee=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),we=[],me=V.id;if(U.promoteId?me=V.properties[U.promoteId]:U.generateId&&(me=ee||0),pe==="Point")uo(ce,we);else if(pe==="MultiPoint")for(var Se=0;Se<ce.length;Se++)uo(ce[Se],we);else if(pe==="LineString")Jn(ce,we,Ee,!1);else if(pe==="MultiLineString"){if(U.lineMetrics){for(Se=0;Se<ce.length;Se++)Jn(ce[Se],we=[],Ee,!1),re.push(Jt(me,"LineString",we,V.properties));return}cn(ce,we,Ee,!1)}else if(pe==="Polygon")cn(ce,we,Ee,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(Se=0;Se<V.geometry.geometries.length;Se++)hi(re,{id:me,geometry:V.geometry.geometries[Se],properties:V.properties},U,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Se=0;Se<ce.length;Se++){var Ke=[];cn(ce[Se],Ke,Ee,!0),we.push(Ke)}}re.push(Jt(me,pe,we,V.properties))}}function uo(re,V){V.push(Sa(re[0])),V.push(ho(re[1])),V.push(0)}function Jn(re,V,U,ee){for(var ce,pe,Ee=0,we=0;we<re.length;we++){var me=Sa(re[we][0]),Se=ho(re[we][1]);V.push(me),V.push(Se),V.push(0),we>0&&(Ee+=ee?(ce*Se-me*pe)/2:Math.sqrt(Math.pow(me-ce,2)+Math.pow(Se-pe,2))),ce=me,pe=Se}var Ke=V.length-3;V[2]=1,_r(V,0,Ke,U),V[Ke+2]=1,V.size=Math.abs(Ee),V.start=0,V.end=V.size}function cn(re,V,U,ee){for(var ce=0;ce<re.length;ce++){var pe=[];Jn(re[ce],pe,U,ee),V.push(pe)}}function Sa(re){return re/360+.5}function ho(re){var V=Math.sin(re*Math.PI/180),U=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return U<0?0:U>1?1:U}function di(re,V,U,ee,ce,pe,Ee,we){if(ee/=V,pe>=(U/=V)&&Ee<ee)return re;if(Ee<U||pe>=ee)return null;for(var me=[],Se=0;Se<re.length;Se++){var Ke=re[Se],it=Ke.geometry,Ze=Ke.type,Lt=ce===0?Ke.minX:Ke.minY,St=ce===0?Ke.maxX:Ke.maxY;if(Lt>=U&&St<ee)me.push(Ke);else if(!(St<U||Lt>=ee)){var Ot=[];if(Ze==="Point"||Ze==="MultiPoint")bi(it,Ot,U,ee,ce);else if(Ze==="LineString")Ys(it,Ot,U,ee,ce,!1,we.lineMetrics);else if(Ze==="MultiLineString")fo(it,Ot,U,ee,ce,!1);else if(Ze==="Polygon")fo(it,Ot,U,ee,ce,!0);else if(Ze==="MultiPolygon")for(var $t=0;$t<it.length;$t++){var Wt=[];fo(it[$t],Wt,U,ee,ce,!0),Wt.length&&Ot.push(Wt)}if(Ot.length){if(we.lineMetrics&&Ze==="LineString"){for($t=0;$t<Ot.length;$t++)me.push(Jt(Ke.id,Ze,Ot[$t],Ke.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(Ot.length===1?(Ze="LineString",Ot=Ot[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=Ot.length===3?"Point":"MultiPoint"),me.push(Jt(Ke.id,Ze,Ot,Ke.tags))}}}return me.length?me:null}function bi(re,V,U,ee,ce){for(var pe=0;pe<re.length;pe+=3){var Ee=re[pe+ce];Ee>=U&&Ee<=ee&&(V.push(re[pe]),V.push(re[pe+1]),V.push(re[pe+2]))}}function Ys(re,V,U,ee,ce,pe,Ee){for(var we,me,Se=Aa(re),Ke=ce===0?Pa:Xi,it=re.start,Ze=0;Ze<re.length-3;Ze+=3){var Lt=re[Ze],St=re[Ze+1],Ot=re[Ze+2],$t=re[Ze+3],Wt=re[Ze+4],Sn=ce===0?Lt:St,cr=ce===0?$t:Wt,wr=!1;Ee&&(we=Math.sqrt(Math.pow(Lt-$t,2)+Math.pow(St-Wt,2))),Sn<U?cr>U&&(me=Ke(Se,Lt,St,$t,Wt,U),Ee&&(Se.start=it+we*me)):Sn>ee?cr<ee&&(me=Ke(Se,Lt,St,$t,Wt,ee),Ee&&(Se.start=it+we*me)):po(Se,Lt,St,Ot),cr<U&&Sn>=U&&(me=Ke(Se,Lt,St,$t,Wt,U),wr=!0),cr>ee&&Sn<=ee&&(me=Ke(Se,Lt,St,$t,Wt,ee),wr=!0),!pe&&wr&&(Ee&&(Se.end=it+we*me),V.push(Se),Se=Aa(re)),Ee&&(it+=we)}var or=re.length-3;Lt=re[or],St=re[or+1],Ot=re[or+2],(Sn=ce===0?Lt:St)>=U&&Sn<=ee&&po(Se,Lt,St,Ot),or=Se.length-3,pe&&or>=3&&(Se[or]!==Se[0]||Se[or+1]!==Se[1])&&po(Se,Se[0],Se[1],Se[2]),Se.length&&V.push(Se)}function Aa(re){var V=[];return V.size=re.size,V.start=re.start,V.end=re.end,V}function fo(re,V,U,ee,ce,pe){for(var Ee=0;Ee<re.length;Ee++)Ys(re[Ee],V,U,ee,ce,pe,!1)}function po(re,V,U,ee){re.push(V),re.push(U),re.push(ee)}function Pa(re,V,U,ee,ce,pe){var Ee=(pe-V)/(ee-V);return re.push(pe),re.push(U+(ce-U)*Ee),re.push(1),Ee}function Xi(re,V,U,ee,ce,pe){var Ee=(pe-U)/(ce-U);return re.push(V+(ee-V)*Ee),re.push(pe),re.push(1),Ee}function ri(re,V){for(var U=[],ee=0;ee<re.length;ee++){var ce,pe=re[ee],Ee=pe.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")ce=Ni(pe.geometry,V);else if(Ee==="MultiLineString"||Ee==="Polygon"){ce=[];for(var we=0;we<pe.geometry.length;we++)ce.push(Ni(pe.geometry[we],V))}else if(Ee==="MultiPolygon")for(ce=[],we=0;we<pe.geometry.length;we++){for(var me=[],Se=0;Se<pe.geometry[we].length;Se++)me.push(Ni(pe.geometry[we][Se],V));ce.push(me)}U.push(Jt(pe.id,Ee,ce,pe.tags))}return U}function Ni(re,V){var U=[];U.size=re.size,re.start!==void 0&&(U.start=re.start,U.end=re.end);for(var ee=0;ee<re.length;ee+=3)U.push(re[ee]+V,re[ee+1],re[ee+2]);return U}function gs(re,V){if(re.transformed)return re;var U,ee,ce,pe=1<<re.z,Ee=re.x,we=re.y;for(U=0;U<re.features.length;U++){var me=re.features[U],Se=me.geometry,Ke=me.type;if(me.geometry=[],Ke===1)for(ee=0;ee<Se.length;ee+=2)me.geometry.push(zi(Se[ee],Se[ee+1],V,pe,Ee,we));else for(ee=0;ee<Se.length;ee++){var it=[];for(ce=0;ce<Se[ee].length;ce+=2)it.push(zi(Se[ee][ce],Se[ee][ce+1],V,pe,Ee,we));me.geometry.push(it)}}return re.transformed=!0,re}function zi(re,V,U,ee,ce,pe){return[Math.round(U*(re*ee-ce)),Math.round(U*(V*ee-pe))]}function mo(re,V,U,ee,ce){for(var pe=V===ce.maxZoom?0:ce.tolerance/((1<<V)*ce.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:ee,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},we=0;we<re.length;we++){Ee.numFeatures++,Vo(Ee,re[we],pe,ce);var me=re[we].minX,Se=re[we].minY,Ke=re[we].maxX,it=re[we].maxY;me<Ee.minX&&(Ee.minX=me),Se<Ee.minY&&(Ee.minY=Se),Ke>Ee.maxX&&(Ee.maxX=Ke),it>Ee.maxY&&(Ee.maxY=it)}return Ee}function Vo(re,V,U,ee){var ce=V.geometry,pe=V.type,Ee=[];if(pe==="Point"||pe==="MultiPoint")for(var we=0;we<ce.length;we+=3)Ee.push(ce[we]),Ee.push(ce[we+1]),re.numPoints++,re.numSimplified++;else if(pe==="LineString")Yi(Ee,ce,re,U,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(we=0;we<ce.length;we++)Yi(Ee,ce[we],re,U,pe==="Polygon",we===0);else if(pe==="MultiPolygon")for(var me=0;me<ce.length;me++){var Se=ce[me];for(we=0;we<Se.length;we++)Yi(Ee,Se[we],re,U,!0,we===0)}if(Ee.length){var Ke=V.tags||null;if(pe==="LineString"&&ee.lineMetrics){for(var it in Ke={},V.tags)Ke[it]=V.tags[it];Ke.mapbox_clip_start=ce.start/ce.size,Ke.mapbox_clip_end=ce.end/ce.size}var Ze={geometry:Ee,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Ke};V.id!==null&&(Ze.id=V.id),re.features.push(Ze)}}function Yi(re,V,U,ee,ce,pe){var Ee=ee*ee;if(ee>0&&V.size<(ce?Ee:ee))U.numPoints+=V.length/3;else{for(var we=[],me=0;me<V.length;me+=3)(ee===0||V[me+2]>Ee)&&(U.numSimplified++,we.push(V[me]),we.push(V[me+1])),U.numPoints++;ce&&function(Se,Ke){for(var it=0,Ze=0,Lt=Se.length,St=Lt-2;Ze<Lt;St=Ze,Ze+=2)it+=(Se[Ze]-Se[St])*(Se[Ze+1]+Se[St+1]);if(it>0===Ke)for(Ze=0,Lt=Se.length;Ze<Lt/2;Ze+=2){var Ot=Se[Ze],$t=Se[Ze+1];Se[Ze]=Se[Lt-2-Ze],Se[Ze+1]=Se[Lt-1-Ze],Se[Lt-2-Ze]=Ot,Se[Lt-1-Ze]=$t}}(we,pe),re.push(we)}}function jo(re,V){var U=(V=this.options=function(ce,pe){for(var Ee in pe)ce[Ee]=pe[Ee];return ce}(Object.create(this.options),V)).debug;if(U&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(ce,pe){var Ee=[];if(ce.type==="FeatureCollection")for(var we=0;we<ce.features.length;we++)hi(Ee,ce.features[we],pe,we);else hi(Ee,ce.type==="Feature"?ce:{geometry:ce},pe);return Ee}(re,V);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(ce,pe){var Ee=pe.buffer/pe.extent,we=ce,me=di(ce,1,-1-Ee,Ee,0,-1,2,pe),Se=di(ce,1,1-Ee,2+Ee,0,-1,2,pe);return(me||Se)&&(we=di(ce,1,-Ee,1+Ee,0,-1,2,pe)||[],me&&(we=ri(me,1).concat(we)),Se&&(we=we.concat(ri(Se,-1)))),we}(ee,V),ee.length&&this.splitTile(ee,0,0,0),U&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _s(re,V,U){return 32*((1<<re)*U+V)+re}function wi(re,V){let U=re.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);let ee=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!ee)return V(null,null);let ce=new class{constructor(Ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.EXTENT,this.length=Ee.length,this._features=Ee}feature(Ee){return new class{constructor(we){this._feature=we,this.extent=i.EXTENT,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){let we=[];for(let me of this._feature.geometry)we.push([new i.Point(me[0],me[1])]);return we}{let we=[];for(let me of this._feature.geometry){let Se=[];for(let Ke of me)Se.push(new i.Point(Ke[0],Ke[1]));we.push(Se)}return we}}toGeoJSON(we,me,Se){return Re.call(this,we,me,Se)}}(this._features[Ee])}}(ee.features),pe=zo(ce);pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),V(null,{vectorTile:ce,rawData:pe.buffer})}jo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},jo.prototype.splitTile=function(re,V,U,ee,ce,pe,Ee){for(var we=[re,V,U,ee],me=this.options,Se=me.debug;we.length;){ee=we.pop(),U=we.pop(),V=we.pop(),re=we.pop();var Ke=1<<V,it=_s(V,U,ee),Ze=this.tiles[it];if(!Ze&&(Se>1&&console.time("creation"),Ze=this.tiles[it]=mo(re,V,U,ee,me),this.tileCoords.push({z:V,x:U,y:ee}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,U,ee,Ze.numFeatures,Ze.numPoints,Ze.numSimplified),console.timeEnd("creation"));var Lt="z"+V;this.stats[Lt]=(this.stats[Lt]||0)+1,this.total++}if(Ze.source=re,ce){if(V===me.maxZoom||V===ce)continue;var St=1<<ce-V;if(U!==Math.floor(pe/St)||ee!==Math.floor(Ee/St))continue}else if(V===me.indexMaxZoom||Ze.numPoints<=me.indexMaxPoints)continue;if(Ze.source=null,re.length!==0){Se>1&&console.time("clipping");var Ot,$t,Wt,Sn,cr,wr,or=.5*me.buffer/me.extent,Ki=.5-or,Rr=.5+or,Rn=1+or;Ot=$t=Wt=Sn=null,cr=di(re,Ke,U-or,U+Rr,0,Ze.minX,Ze.maxX,me),wr=di(re,Ke,U+Ki,U+Rn,0,Ze.minX,Ze.maxX,me),re=null,cr&&(Ot=di(cr,Ke,ee-or,ee+Rr,1,Ze.minY,Ze.maxY,me),$t=di(cr,Ke,ee+Ki,ee+Rn,1,Ze.minY,Ze.maxY,me),cr=null),wr&&(Wt=di(wr,Ke,ee-or,ee+Rr,1,Ze.minY,Ze.maxY,me),Sn=di(wr,Ke,ee+Ki,ee+Rn,1,Ze.minY,Ze.maxY,me),wr=null),Se>1&&console.timeEnd("clipping"),we.push(Ot||[],V+1,2*U,2*ee),we.push($t||[],V+1,2*U,2*ee+1),we.push(Wt||[],V+1,2*U+1,2*ee),we.push(Sn||[],V+1,2*U+1,2*ee+1)}}},jo.prototype.getTile=function(re,V,U){var ee=this.options,ce=ee.extent,pe=ee.debug;if(re<0||re>24)return null;var Ee=1<<re,we=_s(re,V=(V%Ee+Ee)%Ee,U);if(this.tiles[we])return gs(this.tiles[we],ce);pe>1&&console.log("drilling down to z%d-%d-%d",re,V,U);for(var me,Se=re,Ke=V,it=U;!me&&Se>0;)Se--,Ke=Math.floor(Ke/2),it=Math.floor(it/2),me=this.tiles[_s(Se,Ke,it)];return me&&me.source?(pe>1&&console.log("found parent tile z%d-%d-%d",Se,Ke,it),pe>1&&console.time("drilling down"),this.splitTile(me.source,Se,Ke,it,re,V,U),pe>1&&console.timeEnd("drilling down"),this.tiles[we]?gs(this.tiles[we],ce):null):null};class Ks extends i.VectorTileWorkerSource{constructor(V,U,ee,ce,pe){super(V,U,ee,ce,wi),pe&&(this.loadGeoJSON=pe)}loadData(V,U){let ee=V&&V.request,ce=ee&&ee.collectResourceTiming;this.loadGeoJSON(V,(pe,Ee)=>{if(pe||!Ee)return U(pe);if(typeof Ee!="object")return U(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{Be(Ee,!0);try{if(V.filter){let me=i.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(me.result==="error")throw new Error(me.value.map(Ke=>`${Ke.key}: ${Ke.message}`).join(", "));Ee={type:"FeatureCollection",features:Ee.features.filter(Ke=>me.value.evaluate({zoom:0},Ke))}}this._geoJSONIndex=V.cluster?new un(function({superclusterOptions:me,clusterProperties:Se}){if(!Se||!me)return me;let Ke={},it={},Ze={accumulated:null,zoom:0},Lt={properties:null},St=Object.keys(Se);for(let Ot of St){let[$t,Wt]=Se[Ot],Sn=i.createExpression(Wt),cr=i.createExpression(typeof $t=="string"?[$t,["accumulated"],["get",Ot]]:$t);Ke[Ot]=Sn.value,it[Ot]=cr.value}return me.map=Ot=>{Lt.properties=Ot;let $t={};for(let Wt of St)$t[Wt]=Ke[Wt].evaluate(Ze,Lt);return $t},me.reduce=(Ot,$t)=>{Lt.properties=$t;for(let Wt of St)Ze.accumulated=Ot[Wt],Ot[Wt]=it[Wt].evaluate(Ze,Lt)},me}(V)).load(Ee.features):function(me,Se){return new jo(me,Se)}(Ee,V.geojsonVtOptions)}catch(me){return U(me)}this.loaded={};let we={};if(ce){let me=i.getPerformanceMeasurement(ee);me&&(we.resourceTiming={},we.resourceTiming[V.source]=JSON.parse(JSON.stringify(me)))}U(null,we)}})}reloadTile(V,U){let ee=this.loaded;return ee&&ee[V.uid]?super.reloadTile(V,U):this.loadTile(V,U)}loadGeoJSON(V,U){if(V.request)i.getJSON(V.request,U);else{if(typeof V.data!="string")return U(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return U(null,JSON.parse(V.data))}catch{return U(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ee){U(ee)}}getClusterChildren(V,U){try{U(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ee){U(ee)}}getClusterLeaves(V,U){try{U(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ee){U(ee)}}}class Js{constructor(V){this.self=V,this.actor=new i.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.getProjection({name:"mercator"}),this.workerSourceTypes={vector:i.VectorTileWorkerSource,geojson:Ks},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,ee)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=ee},this.self.registerRTLTextPlugin=U=>{if(i.plugin.isParsed())throw new Error("RTL text plugin already registered.");i.plugin.applyArabicShaping=U.applyArabicShaping,i.plugin.processBidirectionalText=U.processBidirectionalText,i.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}clearCaches(V,U,ee){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],ee()}checkIfReady(V,U,ee){ee()}setReferrer(V,U){this.referrer=U}spriteLoaded(V,U){this.isSpriteLoaded[V]=U;for(let ee in this.workerSources[V]){let ce=this.workerSources[V][ee];for(let pe in ce)ce[pe]instanceof i.VectorTileWorkerSource&&(ce[pe].isSpriteLoaded=U,ce[pe].fire(new i.Event("isSpriteLoaded")))}}setImages(V,U,ee){this.availableImages[V]=U;for(let ce in this.workerSources[V]){let pe=this.workerSources[V][ce];for(let Ee in pe)pe[Ee].availableImages=U}ee()}enableTerrain(V,U,ee){this.terrain=U,ee()}setProjection(V,U){this.projections[V]=i.getProjection(U)}setLayers(V,U,ee){this.getLayerIndex(V).replace(U),ee()}updateLayers(V,U,ee){this.getLayerIndex(V).update(U.layers,U.removedIds),ee()}loadTile(V,U,ee){let ce=this.enableTerrain?i.extend({enableTerrain:this.terrain},U):U;ce.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,U.type,U.source).loadTile(ce,ee)}loadDEMTile(V,U,ee){let ce=this.enableTerrain?i.extend({buildQuadTree:this.terrain},U):U;this.getDEMWorkerSource(V,U.source).loadTile(ce,ee)}reloadTile(V,U,ee){let ce=this.enableTerrain?i.extend({enableTerrain:this.terrain},U):U;ce.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,U.type,U.source).reloadTile(ce,ee)}abortTile(V,U,ee){this.getWorkerSource(V,U.type,U.source).abortTile(U,ee)}removeTile(V,U,ee){this.getWorkerSource(V,U.type,U.source).removeTile(U,ee)}removeSource(V,U,ee){if(!this.workerSources[V]||!this.workerSources[V][U.type]||!this.workerSources[V][U.type][U.source])return;let ce=this.workerSources[V][U.type][U.source];delete this.workerSources[V][U.type][U.source],ce.removeSource!==void 0?ce.removeSource(U,ee):ee()}loadWorkerSource(V,U,ee){try{this.self.importScripts(U.url),ee()}catch(ce){ee(ce.toString())}}syncRTLPluginState(V,U,ee){try{i.plugin.setState(U);let ce=i.plugin.getPluginURL();if(i.plugin.isLoaded()&&!i.plugin.isParsed()&&ce!=null){this.self.importScripts(ce);let pe=i.plugin.isParsed();ee(pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ce}`),pe)}}catch(ce){ee(ce.toString())}}getAvailableImages(V){let U=this.availableImages[V];return U||(U=[]),U}getLayerIndex(V){let U=this.layerIndexes[V];return U||(U=this.layerIndexes[V]=new B),U}getWorkerSource(V,U,ee){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][U]||(this.workerSources[V][U]={}),!this.workerSources[V][U][ee]){let ce={send:(pe,Ee,we,me,Se,Ke)=>{this.actor.send(pe,Ee,we,V,Se,Ke)},scheduler:this.actor.scheduler};this.workerSources[V][U][ee]=new this.workerSourceTypes[U](ce,this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])}return this.workerSources[V][U][ee]}getDEMWorkerSource(V,U){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][U]||(this.demWorkerSources[V][U]=new j),this.demWorkerSources[V][U]}enforceCacheSizeLimit(V,U){i.enforceCacheSizeLimit(U)}getWorkerPerformanceMetrics(V,U,ee){ee(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Js(self)),Js}),u(["./shared"],function(i){"use strict";function w(d,r){if(Array.isArray(d)){if(!Array.isArray(r)||d.length!==r.length)return!1;for(let l=0;l<d.length;l++)if(!w(d[l],r[l]))return!1;return!0}if(typeof d=="object"&&d!==null&&r!==null){if(typeof r!="object"||Object.keys(d).length!==Object.keys(r).length)return!1;for(let l in d)if(!w(d[l],r[l]))return!1;return!0}return d===r}var O=B;function B(d){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(v);try{_=new Worker(E),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(E),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()?(j[l=r&&r.failIfMajorPerformanceCaveat]===void 0&&(j[l]=function(p){var _,v=function(E){var T=document.createElement("canvas"),I=Object.create(B.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=E,T.getContext("webgl",I)||T.getContext("experimental-webgl",I)}(p);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(l)),j[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(d)}var j={};function ie(d,r,l){let p=i.window.document.createElement(d);return r!==void 0&&(p.className=r),l&&l.appendChild(p),p}function _e(d,r,l){let p=i.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(let _ of Object.keys(r))p.setAttributeNS(null,_,r[_]);return l&&l.appendChild(p),p}B.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let Be=i.window.document&&i.window.document.documentElement.style,Re=Be&&Be.userSelect!==void 0?"userSelect":"WebkitUserSelect",tt;function Mt(){Be&&Re&&(tt=Be[Re],Be[Re]="none")}function En(){Be&&Re&&(Be[Re]=tt)}function Ct(d){d.preventDefault(),d.stopPropagation(),i.window.removeEventListener("click",Ct,!0)}function gn(){i.window.addEventListener("click",Ct,!0),i.window.setTimeout(()=>{i.window.removeEventListener("click",Ct,!0)},0)}function Un(d,r){let l=d.getBoundingClientRect();return nr(d,l,r)}function xr(d,r){let l=d.getBoundingClientRect(),p=[];for(let _=0;_<r.length;_++)p.push(nr(d,l,r[_]));return p}function ei(d){return i.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&i.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function nr(d,r,l){let p=d.offsetWidth===r.width?1:d.offsetWidth/r.width;return new i.Point((l.clientX-r.left)*p,(l.clientY-r.top)*p)}function rt(d,r){var l=r[0],p=r[1],_=r[2],v=r[3],E=l*v-_*p;return E?(d[0]=v*(E=1/E),d[1]=-p*E,d[2]=-_*E,d[3]=l*E,d):null}function Fo(d){let{userImage:r}=d;return!!(r&&r.render&&r.render())&&(d.data.replace(new Uint8Array(r.data.buffer)),!0)}class Ws extends i.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new i.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(let{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new i.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new i.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new i.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,l){if(!r)return!0;let p=0;for(let _ of r){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(r,l){return!(r&&(r.length!==4||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){let l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let p=!0;if(!this.isLoaded())for(let _ of r)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){let p={};for(let _ of r){this.images[_]||this.fire(new i.Event("styleimagemissing",{id:_}));let v=this.images[_];v?p[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:i.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){let{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){let l=this.patterns[r],p=this.getImage(r);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{let _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new i.ImagePosition(_,p);this.patterns[r]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){let l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new i.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture&&this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){let r=[];for(let v in this.patterns)r.push(this.patterns[v].bin);let{w:l,h:p}=i.potpack(r),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(let v in this.patterns){let{bin:E}=this.patterns[v],T=E.x+1,I=E.y+1,R=this.images[v].data,P=R.width,F=R.height;i.RGBAImage.copy(R,_,{x:0,y:0},{x:T,y:I},{width:P,height:F}),i.RGBAImage.copy(R,_,{x:0,y:F-1},{x:T,y:I-1},{width:P,height:1}),i.RGBAImage.copy(R,_,{x:0,y:0},{x:T,y:I+F},{width:P,height:1}),i.RGBAImage.copy(R,_,{x:P-1,y:0},{x:T-1,y:I},{width:1,height:F}),i.RGBAImage.copy(R,_,{x:0,y:0},{x:T+P,y:I},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(let l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;let p=this.images[l];Fo(p)&&this.updateImage(l,p)}}}let At=new i.Properties({anchor:new i.DataConstantProperty(i.spec.light.anchor),position:new class{constructor(){this.specification=i.spec.light.position}possiblyEvaluate(d,r){return function([l,p,_]){let v=i.degToRad(p+90),E=i.degToRad(_);return{x:l*Math.cos(v)*Math.sin(E),y:l*Math.sin(v)*Math.sin(E),z:l*Math.cos(E),azimuthal:p,polar:_}}(d.expression.evaluate(r))}interpolate(d,r,l){return{x:i.number(d.x,r.x,l),y:i.number(d.y,r.y,l),z:i.number(d.z,r.z,l),azimuthal:i.number(d.azimuthal,r.azimuthal,l),polar:i.number(d.polar,r.polar,l)}}},color:new i.DataConstantProperty(i.spec.light.color),intensity:new i.DataConstantProperty(i.spec.light.intensity)});class Pr extends i.Evented{constructor(r){super(),this._transitionable=new i.Transitionable(At),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(i.validateLight,r,l))for(let p in r){let _=r[p];i.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&i.emitValidationErrors(this,r.call(i.validateStyle,i.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}let No=new i.Properties({source:new i.DataConstantProperty(i.spec.terrain.source),exaggeration:new i.DataConstantProperty(i.spec.terrain.exaggeration)}),Ma=class extends i.Evented{constructor(d,r){super(),this._transitionable=new i.Transitionable(No),this.set(d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(d){for(let r in d){let l=d[r];i.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-11),l):this._transitionable.setValue(r,l)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}};function zo(d,r,l,p){let _=i.smoothstep(45,65,l),[v,E]=Zs(d,p),T=i.length(r),I=1-Math.min(1,Math.exp((T-v)/(E-v)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*_*d.alpha}function Zs(d,r){let l=.5/Math.tan(.5*r);return[d.range[0]+l,d.range[1]+l]}let Ht=new i.Properties({range:new i.DataConstantProperty(i.spec.fog.range),color:new i.DataConstantProperty(i.spec.fog.color),"high-color":new i.DataConstantProperty(i.spec.fog["high-color"]),"space-color":new i.DataConstantProperty(i.spec.fog["space-color"]),"horizon-blend":new i.DataConstantProperty(i.spec.fog["horizon-blend"]),"star-intensity":new i.DataConstantProperty(i.spec.fog["star-intensity"])});class Bo extends i.Evented{constructor(r,l){super(),this._transitionable=new i.Transitionable(Ht),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){let r=this._transform,l=r.projection.name==="globe",p=i.globeToMercatorTransition(r.zoom),_=this.properties.get("range"),v=[.5,3];return{range:l?[i.number(v[0],_[0],p),i.number(v[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(i.validateFog,r,l)){for(let p of Object.keys(i.spec.fog))r&&r[p]===void 0&&(r[p]=i.spec.fog[p].default);for(let p in r){let _=r[p];i.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;let l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.smoothstep(45,65,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(p,_,v){let E=i.MercatorCoordinate.fromLngLat(_),T=v.elevation?v.elevation.getAtPointOrZero(E):0,I=[E.x,E.y,T];return i.transformMat4(I,I,v.mercatorFogMatrix),zo(p,I,v.pitch,v._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Zs(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&i.emitValidationErrors(this,r.call(i.validateStyle,i.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}class mr{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=i.uniqueId();let p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){let v=new mr.Actor(p[_],l,this.id);v.name=`Worker ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,p){i.asyncAll(this.actors,(_,v)=>{_.send(r,l,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function gr(d,r,l){return r*(i.EXTENT/(d.tileSize*Math.pow(2,l-d.tileID.overscaledZ)))}mr.Actor=i.Actor;class Zi{constructor(r,l,p,_){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,l){let p,_;if(r instanceof i.Point||typeof r[0]=="number"){let v=i.Point.convert(r);p=[v],_=l.isPointAboveHorizon(v)}else{let v=i.Point.convert(r[0]),E=i.Point.convert(r[1]);p=[v,E],_=i.polygonizeBounds(v,E).every(T=>l.isPointAboveHorizon(T))}return new Zi(p,l.getCameraPoint(),_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return i.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){let l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.Point(1,1)):this.screenBounds[1],_=i.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),i.bufferConvexPolygon(_,r)}bufferedCameraGeometryGlobe(r){let l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.Point(1,1)):this.screenBounds[1],_=i.polygonizeBounds(l,p,r),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>p.y))+((v.x>l.x)+(v.x>p.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(r,l,p,_=0){let v=r.queryPadding/l._pixelsPerMercatorPixel+1,E=p?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l),T=r.tileID.wrap+(E.unwrapped?_:0),I=E.polygon.map(Y=>i.getTilePoint(r.tileTransform,Y,T));if(!i.polygonIntersectsBox(I,0,0,i.EXTENT,i.EXTENT))return;T=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);let R=this.screenGeometryMercator.polygon.map(Y=>i.getTileVec3(r.tileTransform,Y,T)),P=R.map(Y=>new i.Point(Y[0],Y[1])),F=l.getFreeCameraOptions().position||new i.MercatorCoordinate(0,0,0),G=i.getTileVec3(r.tileTransform,F,T),W=R.map(Y=>{let N=i.sub(Y,Y,G);return i.normalize(N,N),new i.Ray(G,N)}),X=gr(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:W,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(Z=i.getBounds(I),Z.min.x=i.clamp(Z.min.x,0,i.EXTENT),Z.min.y=i.clamp(Z.min.y,0,i.EXTENT),Z.max.x=i.clamp(Z.max.x,0,i.EXTENT),Z.max.y=i.clamp(Z.max.y,0,i.EXTENT),Z),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:X};var Z}_bufferedScreenMercator(r,l){let p=ni(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(r,l){let p=ni(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(r,l){let p=function(v,E){let T=i.multiply([],E.pixelMatrix,E.globeMatrix),I=[0,-i.GLOBE_RADIUS,0,1],R=[0,i.GLOBE_RADIUS,0,1],P=[0,0,0,1];i.transformMat4$1(I,I,T),i.transformMat4$1(R,R,T),i.transformMat4$1(P,P,T);let F=new i.Point(I[0]/I[3],I[1]/I[3]),G=new i.Point(R[0]/R[3],R[1]/R[3]),W=i.polygonContainsPoint(v,F)&&I[3]<P[3],X=i.polygonContainsPoint(v,G)&&R[3]<P[3];if(!W&&!X)return null;let Z=function(de,xe,ye){for(let Ie=1;Ie<de.length;Ie++){let qe=ti(xe.pointCoordinate3D(de[Ie-1]).x),Ce=ti(xe.pointCoordinate3D(de[Ie]).x);if(ye<0){if(qe<Ce)return{idx:Ie,t:-qe/(Ce-1-qe)}}else if(Ce<qe)return{idx:Ie,t:(1-qe)/(Ce+1-qe)}}return null}(v,E,W?-1:1);if(!Z)return null;let{idx:Y,t:N}=Z,q=Y>1?un(v.slice(0,Y),E):[],Q=Y<v.length?un(v.slice(Y),E):[];q=q.map(de=>new i.Point(ti(de.x),de.y)),Q=Q.map(de=>new i.Point(ti(de.x),de.y));let te=[...q];te.length===0&&te.push(Q[Q.length-1]);let he=i.number(te[te.length-1].y,(Q.length===0?q[0]:Q[0]).y,N),fe;return fe=W?[new i.Point(0,he),new i.Point(0,0),new i.Point(1,0),new i.Point(1,he)]:[new i.Point(1,he),new i.Point(1,1),new i.Point(0,1),new i.Point(0,he)],te.push(...fe),Q.length===0?te.push(q[0]):te.push(...Q),{polygon:te.map(de=>new i.MercatorCoordinate(de.x,de.y)),unwrapped:!1}}(r,l);if(p)return p;let _=function(v,E){let T=!1,I=-1/0,R=0;for(let F=0;F<v.length-1;F++)v[F].x>I&&(I=v[F].x,R=F);for(let F=0;F<v.length-1;F++){let G=(R+F)%(v.length-1),W=v[G],X=v[G+1];Math.abs(W.x-X.x)>.5&&(W.x<X.x?(W.x+=1,G===0&&(v[v.length-1].x+=1)):(X.x+=1,G+1===v.length-1&&(v[0].x+=1)),T=!0)}let P=i.mercatorXfromLng(E.center.lng);return T&&P<Math.abs(P-1)&&v.forEach(F=>{F.x-=1}),{polygon:v,unwrapped:T}}(un(r,l).map(v=>new i.Point(ti(v.x),v.y)),l);return{polygon:_.polygon.map(v=>new i.MercatorCoordinate(v.x,v.y)),unwrapped:_.unwrapped}}}function un(d,r){return i.resample(d,l=>{let p=r.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function ti(d){return d<0?1+d%1:d%1}function ni(d){return 100*d|0}function br(d,r,l,p,_){let v=function(E,T){if(E)return _(E);if(T){d.url&&T.tiles&&d.tiles&&delete d.tiles;let I=i.pick(i.extend(T,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(I.vectorLayers=T.vector_layers,I.vectorLayerIds=I.vectorLayers.map(R=>R.id)),I.tiles=r.canonicalizeTileset(I,d.url),_(null,I)}};return d.url?i.getJSON(r.transformRequest(r.normalizeSourceURL(d.url,null,l,p),i.ResourceType.Source),v):i.exported.frame(()=>v(null,d))}class co{constructor(r,l,p){this.bounds=i.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){let l=Math.pow(2,r.z),p=Math.floor(i.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(i.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(i.mercatorXfromLng(this.bounds.getEast())*l),E=Math.ceil(i.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=p&&r.x<v&&r.y>=_&&r.y<E}}class ms{constructor(r,l,p){this.context=r;let _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){let l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let _r={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qt{constructor(r,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=r;let v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){let l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let p=0;p<this.attributes.length;p++){let _=l.attributes[this.attributes[p].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,l,p){for(let _=0;_<this.attributes.length;_++){let v=this.attributes[_],E=l.attributes[v.name];E!==void 0&&r.vertexAttribPointer(E,v.components,r[_r[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xs extends Jt{getDefault(){return i.Color.transparent}set(r){let l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class hi extends Jt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class uo extends Jt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Jn extends Jt{getDefault(){return[!0,!0,!0,!0]}set(r){let l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class cn extends Jt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Sa extends Jt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class ho extends Jt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){let l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class di extends Jt{getDefault(){let r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){let l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class bi extends Jt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class Ys extends Jt{getDefault(){return[0,1]}set(r){let l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Aa extends Jt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class fo extends Jt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class po extends Jt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class Pa extends Jt{getDefault(){let r=this.gl;return[r.ONE,r.ZERO]}set(r){let l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Xi extends Jt{getDefault(){return i.Color.transparent}set(r){let l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ri extends Jt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Ni extends Jt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class gs extends Jt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class zi extends Jt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let mo,Vo=class extends Jt{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Yi extends Jt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class jo extends Jt{getDefault(){let r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){let l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class _s extends Jt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class wi extends Jt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Ks extends Jt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Js extends Jt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class re extends Jt{getDefault(){return null}set(r){let l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class V extends Jt{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class U extends Jt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class ee extends Jt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class ce extends Jt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class pe extends Jt{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class Ee extends pe{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class we extends pe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class me extends we{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Se{constructor(r,l,p,_){this.context=r,this.width=l,this.height=p;let v=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Ee(r,v),_&&(this.depthAttachment=new we(r,v))}destroy(){let r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){let p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class Ke{constructor(r,l=!1){if(this.gl=r,this.isWebGL2=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),l){let p=r;this.extVertexArrayObject={createVertexArrayOES:p.createVertexArray.bind(r),deleteVertexArrayOES:p.deleteVertexArray.bind(r),bindVertexArrayOES:p.bindVertexArray.bind(r)}}this.clearColor=new Xs(this),this.clearDepth=new hi(this),this.clearStencil=new uo(this),this.colorMask=new Jn(this),this.depthMask=new cn(this),this.stencilMask=new Sa(this),this.stencilFunc=new ho(this),this.stencilOp=new di(this),this.stencilTest=new bi(this),this.depthRange=new Ys(this),this.depthTest=new Aa(this),this.depthFunc=new fo(this),this.blend=new po(this),this.blendFunc=new Pa(this),this.blendColor=new Xi(this),this.blendEquation=new ri(this),this.cullFace=new Ni(this),this.cullFaceSide=new gs(this),this.frontFace=new zi(this),this.program=new Vo(this),this.activeTexture=new Yi(this),this.viewport=new jo(this),this.bindFramebuffer=new _s(this),this.bindRenderbuffer=new wi(this),this.bindTexture=new Ks(this),this.bindVertexBuffer=new Js(this),this.bindElementBuffer=new re(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new V(this),this.pixelStoreUnpack=new U(this),this.pixelStoreUnpackPremultiplyAlpha=new ee(this),this.pixelStoreUnpackFlipY=new ce(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),l||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(l||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new ms(this,r,l)}createVertexBuffer(r,l,p){return new qt(this,r,l,p)}createRenderbuffer(r,l,p){let _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,r,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(r,l,p){return new Se(this,r,l,p)}clear({color:r,depth:l,stencil:p}){let _=this.gl,v=0;r&&(v|=_.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(v|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(v|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(v)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){w(r.blendFunction,i.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class it extends i.Evented{constructor(r,l,p,_){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.extend(this,i.pick(l,["url","scheme","tileSize","promoteId"])),this._options=i.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new i.DedupedRequest}load(r){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"}));let l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=br(this._options,this.map._requestManager,l,p,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new i.ErrorEvent(_))):v&&(i.extend(this,v),v.bounds&&(this.tileBounds=new co(v.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(_)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.extend({},this._options)}loadTile(r,l){let p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(p,i.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=l:r.request=r.actor.send("reloadTile",_,v.bind(this));else if(r.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",_,v.bind(this),void 0,!0);else{let E=i.loadVectorTile.call({deduped:this._deduped},_,(T,I)=>{T||!I?v.call(this,T):(_.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},r.actor&&r.actor.send("loadTile",_,v.bind(this),void 0,!0))},!0);r.request={cancel:E}}function v(E,T){return delete r.request,r.aborted?l(null):E&&E.status!==404?l(E):(T&&T.resourceTiming&&(r.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&r.setExpiryData(T),r.loadVectorData(T,this.map.painter),i.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ze extends i.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.extend({type:"raster"},l),i.extend(this,i.pick(l,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=br(this._options,this.map._requestManager,null,null,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new i.ErrorEvent(l)):p&&(i.extend(this,p),p.bounds&&(this.tileBounds=new co(p.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(p.tiles),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(l)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){let p=i.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=i.getImage(this.map._requestManager.transformRequest(_,i.ResourceType.Tile),(v,E,T,I)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):v?(r.state="errored",l(v)):E?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:T,expires:I}),r.setTexture(E,this.map.painter),r.state="loaded",i.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(r,l,p){r.setTexture(l,p)}static unloadTileData(r,l){r.texture&&l.saveTileTexture(r.texture)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Lt(d,r,l,p,_,v,E,T){let I=[d,l,_,r,p,v,1,1,1],R=[E,T,1],P=i.adjoint([],I),[F,G,W]=i.transformMat3(R,R,i.transpose(P,P));return i.multiply$1(I,[F,0,0,0,G,0,0,0,W],I)}class St extends i.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l,this._dirty=!1}load(r,l){this._loaded=l||!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=i.getImage(this.map._requestManager.transformRequest(this.url,i.ResourceType.Image),(p,_)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new i.ErrorEvent(p));else if(_){let{HTMLImageElement:v}=i.window;this.image=_ instanceof v?i.exported.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;let l=r.map(i.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,v=1/0,E=-1/0,T=-1/0;for(let F of p)_=Math.min(_,F.x),v=Math.min(v,F.y),E=Math.max(E,F.x),T=Math.max(T,F.y);let I=Math.max(E-_,T-v),R=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),P=Math.pow(2,R);return new i.CanonicalTileID(R,Math.floor((_+E)/2*P),Math.floor((v+T)/2*P))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(let I in this.tiles){let R=this.tiles[I];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;let l=i.tileTransform(this.tileID,this.map.transform.projection),[p,_,v,E]=this.coordinates.map(I=>{let R=l.projection.project(I[0],I[1]);return i.getTilePoint(l,R)._round()});this.perspectiveTransform=function(I,R,P,F,G,W,X,Z,Y,N){let q=Lt(0,0,I,0,0,R,I,R),Q=Lt(P,F,G,W,X,Z,Y,N);return i.multiply$1(Q,i.adjoint(q,q),Q),[Q[6]/Q[8]*I/i.EXTENT,Q[7]/Q[8]*R/i.EXTENT]}(this.width,this.height,p.x,p.y,_.x,_.y,E.x,E.y,v.x,v.y);let T=this._boundsArray=new i.StructArrayLayout4i8;T.emplaceBack(p.x,p.y,0,0),T.emplaceBack(_.x,_.y,i.EXTENT,0),T.emplaceBack(E.x,E.y,0,i.EXTENT),T.emplaceBack(v.x,v.y,i.EXTENT,i.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(T,i.boundsAttributes.members),this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let r=this.map.painter.context,l=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new i.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}let Ot={vector:it,raster:Ze,"raster-dem":class extends Ze{constructor(d,r,l,p){super(d,r,l,p),this.type="raster-dem",this.maxzoom=22,this._options=i.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(d,r){let l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,v){_&&(d.state="errored",r(_)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",r(null))}d.request=i.getImage(this.map._requestManager.transformRequest(l,i.ResourceType.Tile),(function(_,v,E,T){if(delete d.request,d.aborted)d.state="unloaded",r(null);else if(_)d.state="errored",r(_);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:E,expires:T});let I=i.window.ImageBitmap&&v instanceof i.window.ImageBitmap&&(mo==null&&(mo=i.window.OffscreenCanvas&&new i.window.OffscreenCanvas(1,1).getContext("2d")&&typeof i.window.createImageBitmap=="function"),mo),R=1-(v.width-i.prevPowerOfTwo(v.width))/2;R<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));let P=I?v:i.exported.getImageData(v,R),F={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:P,encoding:this.encoding,padding:R};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",F,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){let r=d.canonical,l=Math.pow(2,r.z),p=(r.x-1+l)%l,_=r.x===0?d.wrap-1:d.wrap,v=(r.x+1+l)%l,E=r.x+1===l?d.wrap+1:d.wrap,T={};return T[new i.OverscaledTileID(d.overscaledZ,_,r.z,p,r.y).key]={backfilled:!1},T[new i.OverscaledTileID(d.overscaledZ,E,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(T[new i.OverscaledTileID(d.overscaledZ,_,r.z,p,r.y-1).key]={backfilled:!1},T[new i.OverscaledTileID(d.overscaledZ,d.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new i.OverscaledTileID(d.overscaledZ,E,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<l&&(T[new i.OverscaledTileID(d.overscaledZ,_,r.z,p,r.y+1).key]={backfilled:!1},T[new i.OverscaledTileID(d.overscaledZ,d.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new i.OverscaledTileID(d.overscaledZ,E,r.z,v,r.y+1).key]={backfilled:!1}),T}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends i.Evented{constructor(d,r,l,p){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=r.data,this._options=i.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;let _=i.EXTENT/this.tileSize;this.workerOptions=i.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:i.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:i.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},r),this}getClusterChildren(d,r){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},r),this}getClusterLeaves(d,r,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:r,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.Event("dataloading",{dataType:"source"})),this._loaded=!1;let d=i.extend({},this.workerOptions),r=this._data;typeof r=="string"?(d.request=this.map._requestManager.transformRequest(i.exported.resolveURL(r),i.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new i.ErrorEvent(l));else{let _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new i.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,r){let l=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(l,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete d.request,d.unloadVectorData(),d.aborted?r(null):p?r(p):(d.loadVectorData(_,this.map.painter,l==="reloadTile"),r(null))),void 0,l==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends St{constructor(d,r,l,p){super(d,r,l,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;let d=this.options;this.urls=[];for(let r of d.urls)this.urls.push(this.map._requestManager.transformRequest(r,i.ResourceType.Source).url);i.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new i.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){let r=this.video.seekable;d<r.start(0)||d>r.end(0)?this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let d=this.map.painter.context,r=d.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new i.Texture(d,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:St,canvas:class extends St{constructor(d,r,l,p){super(d,r,l,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof i.window.HTMLCanvasElement||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof i.window.HTMLCanvasElement?this.options.canvas:i.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let r=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends i.Evented{constructor(d,r,l,p){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new co(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),i.extend(this,i.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){let{x:r,y:l,z:p}=d.canonical;return this._implementation.hasTile({x:r,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,r){let{x:l,y:p,z:_}=d.tileID.canonical,v=new i.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:_},{signal:v.signal})).then((function(E){return delete d.request,d.aborted?(d.state="unloaded",r(null)):E===void 0?(d.state="errored",r(null)):E===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",r(null)):function(T){return T instanceof i.window.ImageData||T instanceof i.window.HTMLCanvasElement||T instanceof i.window.ImageBitmap||T instanceof i.window.HTMLImageElement}(E)?(this.loadTileData(d,E),d.state="loaded",void r(null)):(d.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.code!==20&&(d.state="errored",r(E))}),d.request.cancel=()=>v.abort()}loadTileData(d,r){Ze.loadTileData(d,r,this._map.painter)}unloadTileData(d){Ze.unloadTileData(d,this._map.painter)}unloadTile(d,r){if(this.unloadTileData(d),this._implementation.unloadTile){let{x:l,y:p,z:_}=d.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}r()}abortTile(d,r){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))}}},$t=function(d,r,l,p){let _=new Ot[r.type](d,r,l,p);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return i.bindAll(["load","abort","unload","serialize","prepare"],_),_};function Wt(d,r){let l=i.identity([]);return i.scale(l,l,[.5*d.width,.5*-d.height,1]),i.translate(l,l,[1,-1,0]),i.multiply(l,l,d.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function Sn(d,r,l,p,_,v,E,T=!1){let I=d.tilesIn(p,E,T);I.sort(wr);let R=[];for(let F of I)R.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(r,l,d._state,F,_,v,Wt(d.transform,F.tile.tileID),T)});let P=function(F){let G={},W={};for(let X of F){let Z=X.queryResults,Y=X.wrappedTileID,N=W[Y]=W[Y]||{};for(let q in Z){let Q=Z[q],te=N[q]=N[q]||{},he=G[q]=G[q]||[];for(let fe of Q)te[fe.featureIndex]||(te[fe.featureIndex]=!0,he.push(fe))}}return G}(R);for(let F in P)P[F].forEach(G=>{let W=G.feature,X=W.layer;X&&X.type!=="background"&&X.type!=="sky"&&(W.source=X.source,X["source-layer"]&&(W.sourceLayer=X["source-layer"]),W.state=W.id!==void 0?d.getFeatureState(X["source-layer"],W.id):{})});return P}function cr(d,r){let l=d.getRenderableIds().map(v=>d.getTileByID(v)),p=[],_={};for(let v=0;v<l.length;v++){let E=l[v],T=E.tileID.canonical.key;_[T]||(_[T]=!0,E.querySourceFeatures(p,r))}return p}function wr(d,r){let l=d.tileID,p=r.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function or(){return Il.workerClass!=null?new Il.workerClass:new i.window.Worker(Il.workerUrl)}let Ki="mapboxgl_preloaded_worker_pool";class Rr{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Rr.workerCount;)this.workers.push(new or);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ki]}numActive(){return Object.keys(this.active).length}}let Rn;function Qs(){return Rn||(Rn=new Rr),Rn}function Bh(d,r){let l={};for(let p in d)p!=="ref"&&(l[p]=d[p]);return i.refProperties.forEach(p=>{p in r&&(l[p]=r[p])}),l}function au(d){d=d.slice();let r=Object.create(null);for(let l=0;l<d.length;l++)r[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=Bh(d[l],r[d[l].ref]));return d}Rr.workerCount=2;let hn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ql(d,r,l){l.push({command:hn.addSource,args:[d,r[d]]})}function ys(d,r,l){r.push({command:hn.removeSource,args:[d]}),l[d]=!0}function ec(d,r,l,p){ys(d,l,p),Ql(d,r,l)}function vs(d,r,l){let p;for(p in d[l])if(d[l].hasOwnProperty(p)&&p!=="data"&&!w(d[l][p],r[l][p]))return!1;for(p in r[l])if(r[l].hasOwnProperty(p)&&p!=="data"&&!w(d[l][p],r[l][p]))return!1;return!0}function Ei(d,r,l,p,_,v){let E;for(E in r=r||{},d=d||{})d.hasOwnProperty(E)&&(w(d[E],r[E])||l.push({command:v,args:[p,E,r[E],_]}));for(E in r)r.hasOwnProperty(E)&&!d.hasOwnProperty(E)&&(w(d[E],r[E])||l.push({command:v,args:[p,E,r[E],_]}))}function Bi(d){return d.id}function fr(d,r){return d[r.id]=r,d}class ul{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=i.clamp(r,0,1);let l=1,p=this._distances[l],_=r*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];let v=l-1,E=this._distances[v],T=p-E,I=T>0?(_-E)/T:0;return this.points[v].mult(1-I).add(this.points[l].mult(I))}}class Uo{constructor(r,l,p){let _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(l/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,p,_,v){this._forEachCell(l,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(r,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(r,l,p,_,v,E){this.boxCells[v].push(E)}_insertCircleCell(r,l,p,_,v,E){this.circleCells[v].push(E)}_query(r,l,p,_,v,E){if(p<0||r>this.width||_<0||l>this.height)return!v&&[];let T=[];if(r<=0&&l<=0&&this.width<=p&&this.height<=_){if(v)return!0;for(let I=0;I<this.boxKeys.length;I++)T.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){let R=this.circles[3*I],P=this.circles[3*I+1],F=this.circles[3*I+2];T.push({key:this.circleKeys[I],x1:R-F,y1:P-F,x2:R+F,y2:P+F})}return E?T.filter(E):T}return this._forEachCell(r,l,p,_,this._queryCell,T,{hitTest:v,seenUids:{box:{},circle:{}}},E),v?T.length>0:T}_queryCircle(r,l,p,_,v){let E=r-p,T=r+p,I=l-p,R=l+p;if(T<0||E>this.width||R<0||I>this.height)return!_&&[];let P=[];return this._forEachCell(E,I,T,R,this._queryCellCircle,P,{hitTest:_,circle:{x:r,y:l,radius:p},seenUids:{box:{},circle:{}}},v),_?P.length>0:P}query(r,l,p,_,v){return this._query(r,l,p,_,!1,v)}hitTest(r,l,p,_,v){return this._query(r,l,p,_,!0,v)}hitTestCircle(r,l,p,_){return this._queryCircle(r,l,p,!0,_)}_queryCell(r,l,p,_,v,E,T,I){let R=T.seenUids,P=this.boxCells[v];if(P!==null){let G=this.bboxes;for(let W of P)if(!R.box[W]){R.box[W]=!0;let X=4*W;if(r<=G[X+2]&&l<=G[X+3]&&p>=G[X+0]&&_>=G[X+1]&&(!I||I(this.boxKeys[W]))){if(T.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[W],x1:G[X],y1:G[X+1],x2:G[X+2],y2:G[X+3]})}}}let F=this.circleCells[v];if(F!==null){let G=this.circles;for(let W of F)if(!R.circle[W]){R.circle[W]=!0;let X=3*W;if(this._circleAndRectCollide(G[X],G[X+1],G[X+2],r,l,p,_)&&(!I||I(this.circleKeys[W]))){if(T.hitTest)return E.push(!0),!0;{let Z=G[X],Y=G[X+1],N=G[X+2];E.push({key:this.circleKeys[W],x1:Z-N,y1:Y-N,x2:Z+N,y2:Y+N})}}}}}_queryCellCircle(r,l,p,_,v,E,T,I){let R=T.circle,P=T.seenUids,F=this.boxCells[v];if(F!==null){let W=this.bboxes;for(let X of F)if(!P.box[X]){P.box[X]=!0;let Z=4*X;if(this._circleAndRectCollide(R.x,R.y,R.radius,W[Z+0],W[Z+1],W[Z+2],W[Z+3])&&(!I||I(this.boxKeys[X])))return E.push(!0),!0}}let G=this.circleCells[v];if(G!==null){let W=this.circles;for(let X of G)if(!P.circle[X]){P.circle[X]=!0;let Z=3*X;if(this._circlesCollide(W[Z],W[Z+1],W[Z+2],R.x,R.y,R.radius)&&(!I||I(this.circleKeys[X])))return E.push(!0),!0}}}_forEachCell(r,l,p,_,v,E,T,I){let R=this._convertToXCellCoord(r),P=this._convertToYCellCoord(l),F=this._convertToXCellCoord(p),G=this._convertToYCellCoord(_);for(let W=R;W<=F;W++)for(let X=P;X<=G;X++)if(v.call(this,r,l,p,_,this.xCellCount*X+W,E,T,I))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,p,_,v,E){let T=_-r,I=v-l,R=p+E;return R*R>T*T+I*I}_circleAndRectCollide(r,l,p,_,v,E,T){let I=(E-_)/2,R=Math.abs(r-(_+I));if(R>I+p)return!1;let P=(T-v)/2,F=Math.abs(l-(v+P));if(F>P+p)return!1;if(R<=I||F<=P)return!0;let G=R-I,W=F-P;return G*G+W*W<=p*p}}let zr={unknown:0,flipRequired:1,flipNotRequired:2},ii=Math.tan(85*Math.PI/180);function Oe(d,r,l,p,_,v,E){let T=i.create();if(l)if(v.name==="globe"){let I=i.calculateGlobeLabelMatrix(_,r);i.multiply(T,T,I)}else{let I=rt([],E);T[0]=I[0],T[1]=I[1],T[4]=I[2],T[5]=I[3],p||i.rotateZ(T,T,_.angle)}else i.multiply(T,_.labelPlaneMatrix,d);return T}function Hr(d,r,l,p,_,v,E){let T=Oe(d,r,l,p,_,v,E);return v.name==="globe"&&l||(T[2]=T[6]=T[10]=T[14]=0),T}function $n(d,r,l,p,_,v,E){if(l){if(v.name==="globe"){let T=Oe(d,r,l,p,_,v,E);return i.invert(T,T),i.multiply(T,d,T),T}{let T=i.clone(d),I=i.identity([]);return I[0]=E[0],I[1]=E[1],I[4]=E[2],I[5]=E[3],i.multiply(T,T,I),p||i.rotateZ(T,T,-_.angle),T}}return _.glCoordMatrix}function Er(d,r,l,p){let _=[d,r,l,1];l?i.transformMat4$1(_,_,p):Vt(_,_,p);let v=_[3];return _[0]/=v,_[1]/=v,_[2]/=v,_}function lu(d,r){return Math.min(.5+d/r*.5,1.5)}function Ji(d,r){let l=d[0]/d[3],p=d[1]/d[3];return l>=-r[0]&&l<=r[0]&&p>=-r[1]&&p<=r[1]}function tc(d,r,l,p,_,v,E,T,I,R){let P=l.transform,F=p?d.textSizeData:d.iconSizeData,G=i.evaluateSizeForZoom(F,l.transform.zoom),W=P.projection.name==="globe",X=[256/l.width*2+1,256/l.height*2+1],Z=p?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Z.clear();let Y=null;W&&(Y=p?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);let N=d.lineVertexArray,q=p?d.text.placedSymbolArray:d.icon.placedSymbolArray,Q=l.transform.width/l.transform.height,te,he=!1;for(let fe=0;fe<q.length;fe++){let de=q.get(fe),{numGlyphs:xe,writingMode:ye}=de;if(ye!==i.WritingMode.vertical||he||te===i.WritingMode.horizontal||(he=!0),te=ye,(de.hidden||ye===i.WritingMode.vertical)&&!he){Vi(xe,Z);continue}he=!1;let Ie=new i.Point(de.tileAnchorX,de.tileAnchorY),{x:qe,y:Ce,z:Ve}=P.projection.projectTilePoint(Ie.x,Ie.y,R.canonical);if(I){let[Rt,mt,Et]=I(Ie);qe+=Rt,Ce+=mt,Ve+=Et}let Ae=[qe,Ce,Ve,1];if(i.transformMat4$1(Ae,Ae,r),!Ji(Ae,X)){Vi(xe,Z);continue}let He=lu(l.transform.cameraToCenterDistance,Ae[3]),De=i.evaluateSizeForFeature(F,G,de),ze=E?De/He:De*He,Ye=Er(qe,Ce,Ve,_);if(Ye[3]<=0){Vi(xe,Z);continue}let $e={},Je=E?null:I,vt=at(de,ze,!1,T,r,_,v,d.glyphOffsetArray,N,Z,Y,Ye,Ie,$e,Q,Je,P.projection,R,E);he=vt.useVertical,Je&&vt.needsFlipping&&($e={}),(vt.notEnoughRoom||he||vt.needsFlipping&&at(de,ze,!0,T,r,_,v,d.glyphOffsetArray,N,Z,Y,Ye,Ie,$e,Q,Je,P.projection,R,E).notEnoughRoom)&&Vi(xe,Z)}p?(d.text.dynamicLayoutVertexBuffer.updateData(Z),Y&&d.text.globeExtVertexBuffer.updateData(Y)):(d.icon.dynamicLayoutVertexBuffer.updateData(Z),Y&&d.icon.globeExtVertexBuffer.updateData(Y))}function nc(d,r,l,p,_,v,E,T,I,R,P,F,G,W,X,Z){let{lineStartIndex:Y,glyphStartIndex:N,segment:q}=T,Q=N+T.numGlyphs,te=Y+T.lineLength,he=r.getoffsetX(N),fe=r.getoffsetX(Q-1),de=fi(d*he,l,p,_,v,E,q,Y,te,I,R,P,F,G,!0,W,X,Z);if(!de)return null;let xe=fi(d*fe,l,p,_,v,E,q,Y,te,I,R,P,F,G,!0,W,X,Z);return xe?{first:de,last:xe}:null}function $o(d,r,l,p){return d===i.WritingMode.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:d===i.WritingMode.vertical?p>0?{needsFlipping:!0}:null:r!==zr.unknown&&function(_,v){return _===0||Math.abs(v/_)>ii}(l,p)?r===zr.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function at(d,r,l,p,_,v,E,T,I,R,P,F,G,W,X,Z,Y,N,q){let Q=r/24,te=d.lineOffsetX*Q,he=d.lineOffsetY*Q,{lineStartIndex:fe,glyphStartIndex:de,numGlyphs:xe,segment:ye,writingMode:Ie,flipState:qe}=d,Ce=fe+d.lineLength,Ve=Ae=>{if(P){let[Ye,$e,Je]=Ae.up,vt=R.length;i.updateGlobeVertexNormal(P,vt+0,Ye,$e,Je),i.updateGlobeVertexNormal(P,vt+1,Ye,$e,Je),i.updateGlobeVertexNormal(P,vt+2,Ye,$e,Je),i.updateGlobeVertexNormal(P,vt+3,Ye,$e,Je)}let[He,De,ze]=Ae.point;i.addDynamicAttributes(R,He,De,ze,Ae.angle)};if(xe>1){let Ae=nc(Q,T,te,he,l,F,G,d,I,v,W,Z,!1,Y,N,q);if(!Ae)return{notEnoughRoom:!0};if(p&&!l){let[He,De,ze]=Ae.first.point,[Ye,$e,Je]=Ae.last.point;[He,De]=Er(He,De,ze,E),[Ye,$e]=Er(Ye,$e,Je,E);let vt=$o(Ie,qe,(Ye-He)*X,$e-De);if(d.flipState=vt&&vt.needsFlipping?zr.flipRequired:zr.flipNotRequired,vt)return vt}Ve(Ae.first);for(let He=de+1;He<de+xe-1;He++){let De=fi(Q*T.getoffsetX(He),te,he,l,F,G,ye,fe,Ce,I,v,W,Z,!1,!1,Y,N,q);if(!De)return R.length-=4*(He-de),{notEnoughRoom:!0};Ve(De)}Ve(Ae.last)}else{if(p&&!l){let He=Er(G.x,G.y,0,_),De=fe+ye+1,ze=new i.Point(I.getx(De),I.gety(De)),Ye=Er(ze.x,ze.y,0,_),$e=Ye[3]>0?Ye:Zt(G,ze,He,1,_,void 0,Y,N.canonical),Je=$o(Ie,qe,($e[0]-He[0])*X,$e[1]-He[1]);if(d.flipState=Je&&Je.needsFlipping?zr.flipRequired:zr.flipNotRequired,Je)return Je}let Ae=fi(Q*T.getoffsetX(de),te,he,l,F,G,ye,fe,Ce,I,v,W,Z,!1,!1,Y,N,q);if(!Ae)return{notEnoughRoom:!0};Ve(Ae)}return{}}function Yt(d,r,l,p,_){let{x:v,y:E,z:T}=p.projectTilePoint(d.x,d.y,r);if(!_)return Er(v,E,T,l);let[I,R,P]=_(d);return Er(v+I,E+R,T+P,l)}function Zt(d,r,l,p,_,v,E,T){let I=Yt(d.sub(r)._unit()._add(d),T,_,E,v);return i.sub(I,l,I),i.normalize(I,I),i.scaleAndAdd(I,l,I,p)}function fi(d,r,l,p,_,v,E,T,I,R,P,F,G,W,X,Z,Y,N){let q=p?d-r:d+r,Q=q>0?1:-1,te=0;p&&(Q*=-1,te=Math.PI),Q<0&&(te+=Math.PI);let he=T+E+(Q>0?0:1)|0,fe=_,de=_,xe=0,ye=0,Ie=Math.abs(q),qe=[],Ce=[],Ve=v,Ae=Ve,He=()=>Zt(Ae,Ve,de,Ie-xe+1,P,G,Z,Y.canonical);for(;xe+ye<=Ie;){if(he+=Q,he<T||he>=I)return null;if(de=fe,Ae=Ve,qe.push(de),W&&Ce.push(Ae),Ve=new i.Point(R.getx(he),R.gety(he)),fe=F[he],!fe){let Et=Yt(Ve,Y.canonical,P,Z,G);fe=Et[3]>0?F[he]=Et:He()}xe+=ye,ye=i.distance(de,fe)}X&&G&&(F[he]&&(fe=He(),ye=i.distance(de,fe)),F[he]=fe);let De=(Ie-xe)/ye,ze=Ve.sub(Ae)._mult(De)._add(Ae),Ye=i.sub([],fe,de),$e=i.scaleAndAdd([],de,Ye,De),Je=[0,0,1],vt=Ye[0],Rt=Ye[1];if(N&&(Je=Z.upVector(Y.canonical,ze.x,ze.y),Je[0]!==0||Je[1]!==0||Je[2]!==1)){let Et=[Je[2],0,-Je[0]],Qt=i.cross([],Je,Et);i.normalize(Et,Et),i.normalize(Qt,Qt),vt=i.dot(Ye,Et),Rt=i.dot(Ye,Qt)}if(l){let Et=i.cross([],Je,Ye);i.normalize(Et,Et),i.scaleAndAdd($e,$e,Et,l*Q)}let mt=te+Math.atan2(Rt,vt);return qe.push($e),W&&Ce.push(ze),{point:$e,angle:mt,path:qe,tilePath:Ce,up:Je}}function Vi(d,r){let l=r.length,p=l+4*d;r.resize(p),r.float32.fill(-1/0,4*l,4*p)}function Vt(d,r,l){let p=r[0],_=r[1];return d[0]=l[0]*p+l[4]*_+l[12],d[1]=l[1]*p+l[5]*_+l[13],d[3]=l[3]*p+l[7]*_+l[15],d}let C=100;class A{constructor(r,l,p=new Uo(r.width+200,r.height+200,25),_=new Uo(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+C,this.screenBottomBoundary=r.height+C,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,p,_,v,E,T,I){let R=p.projectedAnchorX,P=p.projectedAnchorY,F=p.projectedAnchorZ,G=p.elevation,W=p.tileID,X=r.getProjection();if(G&&W){let[fe,de,xe]=X.upVector(W.canonical,p.tileAnchorX,p.tileAnchorY),ye=X.upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=fe*G*ye,P+=de*G*ye,F+=xe*G*ye}let Z=this.projectAndGetPerspectiveRatio(T,R,P,F,p.tileID,X.name==="globe"||!!G||this.transform.pitch>0,X),Y=E*Z.perspectiveRatio,N=(p.x1*l+_.x-p.padding)*Y+Z.point.x,q=(p.y1*l+_.y-p.padding)*Y+Z.point.y,Q=(p.x2*l+_.x+p.padding)*Y+Z.point.x,te=(p.y2*l+_.y+p.padding)*Y+Z.point.y,he=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(N,q,Q,te)||!v&&this.grid.hitTest(N,q,Q,te,I)||he?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[N,q,Q,te],offscreen:this.isOffscreen(N,q,Q,te),occluded:!1}}placeCollisionCircles(r,l,p,_,v,E,T,I,R,P,F,G,W,X,Z){let Y=[],N=this.transform.elevation,q=r.getProjection(),Q=N?N.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,q):null,te=new i.Point(p.tileAnchorX,p.tileAnchorY),{x:he,y:fe,z:de}=q.projectTilePoint(te.x,te.y,Z.canonical);if(Q){let[ze,Ye,$e]=Q(te);he+=ze,fe+=Ye,de+=$e}let xe=q.name==="globe",ye=this.projectAndGetPerspectiveRatio(T,he,fe,de,Z,xe||!!N||this.transform.pitch>0,q),{perspectiveRatio:Ie}=ye,qe=(F?E/Ie:E*Ie)/i.ONE_EM,Ce=Er(he,fe,de,I),Ve=ye.signedDistanceFromCamera>0?nc(qe,v,p.lineOffsetX*qe,p.lineOffsetY*qe,!1,Ce,te,p,_,I,{},N&&!F?Q:null,F&&!!N,q,Z,F):null,Ae=!1,He=!1,De=!0;if(Ve&&!ye.occluded){let ze=.5*W*Ie+X,Ye=new i.Point(-100,-100),$e=new i.Point(this.screenRightBoundary,this.screenBottomBoundary),Je=new ul,{first:vt,last:Rt}=Ve,mt=vt.path.length,Et=[];for(let _t=mt-1;_t>=1;_t--)Et.push(vt.path[_t]);for(let _t=1;_t<Rt.path.length;_t++)Et.push(Rt.path[_t]);let Qt=2.5*ze;R&&(Et=Et.map(([_t,In,On],kn)=>(Q&&!xe&&(On=Q(kn<mt-1?vt.tilePath[mt-1-kn]:Rt.tilePath[kn-mt+2])[2]),Er(_t,In,On,R))),Et.some(_t=>_t[3]<=0)&&(Et=[]));let Kt=[];if(Et.length>0){let _t=1/0,In=-1/0,On=1/0,kn=-1/0;for(let Ln of Et)_t=Math.min(_t,Ln[0]),On=Math.min(On,Ln[1]),In=Math.max(In,Ln[0]),kn=Math.max(kn,Ln[1]);In>=Ye.x&&_t<=$e.x&&kn>=Ye.y&&On<=$e.y&&(Kt=[Et.map(Ln=>new i.Point(Ln[0],Ln[1]))],(_t<Ye.x||In>$e.x||On<Ye.y||kn>$e.y)&&(Kt=i.clipLine(Kt,Ye.x,Ye.y,$e.x,$e.y)))}for(let _t of Kt){Je.reset(_t,.25*ze);let In=0;In=Je.length<=.5*ze?1:Math.ceil(Je.paddedLength/Qt)+1;for(let On=0;On<In;On++){let kn=On/Math.max(In-1,1),Ln=Je.lerp(kn),li=Ln.x+C,Vr=Ln.y+C;Y.push(li,Vr,ze,0);let to=li-ze,ts=Vr-ze,ir=li+ze,Fn=Vr+ze;if(De=De&&this.isOffscreen(to,ts,ir,Fn),He=He||this.isInsideGrid(to,ts,ir,Fn),!l&&this.grid.hitTestCircle(li,Vr,ze,G)&&(Ae=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Ae,occluded:!1}}}}return{circles:!P&&Ae||!He?[]:Y,offscreen:De,collisionDetected:Ae,occluded:ye.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let l=[],p=1/0,_=1/0,v=-1/0,E=-1/0;for(let P of r){let F=new i.Point(P.x+C,P.y+C);p=Math.min(p,F.x),_=Math.min(_,F.y),v=Math.max(v,F.x),E=Math.max(E,F.y),l.push(F)}let T=this.grid.query(p,_,v,E).concat(this.ignoredGrid.query(p,_,v,E)),I={},R={};for(let P of T){let F=P.key;if(I[F.bucketInstanceId]===void 0&&(I[F.bucketInstanceId]={}),I[F.bucketInstanceId][F.featureIndex])continue;let G=[new i.Point(P.x1,P.y1),new i.Point(P.x2,P.y1),new i.Point(P.x2,P.y2),new i.Point(P.x1,P.y2)];i.polygonIntersectsPolygon(l,G)&&(I[F.bucketInstanceId][F.featureIndex]=!0,R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]=[]),R[F.bucketInstanceId].push(F.featureIndex))}return R}insertCollisionBox(r,l,p,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,p,_,v){let E=l?this.ignoredGrid:this.grid,T={bucketInstanceId:p,featureIndex:_,collisionGroupID:v};for(let I=0;I<r.length;I+=4)E.insertCircle(T,r[I],r[I+1],r[I+2])}projectAndGetPerspectiveRatio(r,l,p,_,v,E,T){let I=[l,p,_,1],R=!1;_||this.transform.pitch>0?(i.transformMat4$1(I,I,r),this.fogState&&v&&T.name!=="globe"&&(R=function(G,W,X,Z,Y,N){let q=N.calculateFogTileMatrix(Y),Q=[W,X,Z];return i.transformMat4(Q,Q,q),zo(G,Q,N.pitch,N._fov)}(this.fogState,l,p,_,v.toUnwrapped(),this.transform)>.9)):Vt(I,I,r);let P=I[3];return{point:new i.Point((I[0]/P+1)/2*this.transform.width+C,(-I[1]/P+1)/2*this.transform.height+C),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/P*.5,1.5),signedDistanceFromCamera:P,occluded:E&&I[2]>P||R}}isOffscreen(r,l,p,_){return p<C||r>=this.screenRightBoundary||_<C||l>this.screenBottomBoundary}isInsideGrid(r,l,p,_){return p>=0&&r<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){let r=i.identity([]);return i.translate(r,r,[-100,-100,0]),r}}function $(d,r,l){let p=r.createTileMatrix(d,d.worldSize,l.toUnwrapped());return i.multiply(new Float32Array(16),d.projMatrix,p)}function ne(d,r,l){if(r.projection.name===l.projection.name)return d.projMatrix;let p=l.clone();return p.setProjection(r.projection),$(p,r.getProjection(),d)}function ae(d,r,l){return r.name===l.projection.name?d.projMatrix:$(l,r,d)}class ge{constructor(r,l,p,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class ve{constructor(r,l,p,_,v,E=!1){this.text=new ge(r?r.text:null,l,p,v),this.icon=new ge(r?r.icon:null,l,_,v),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xe{constructor(r,l,p,_=!1){this.text=r,this.icon=l,this.skipFade=p,this.clipped=_}}class nt{constructor(){this.invProjMatrix=i.create(),this.viewportMatrix=i.create(),this.circles=[]}}class ht{constructor(r,l,p,_,v){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class ft{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){let l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[r]}}function ot(d,r,l,p,_){let{horizontalAlign:v,verticalAlign:E}=i.getAnchorAlignment(d),T=-(v-.5)*r,I=-(E-.5)*l,R=i.evaluateVariableOffset(d,p);return new i.Point(T+R[0]*_,I+R[1]*_)}function Pt(d,r,l,p,_){let v=new i.Point(d,r);return l&&v._rotate(p?_:-_),v}class Zn{constructor(r,l,p,_,v){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new A(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ft(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,p,_){let v=p.getBucket(l),E=p.latestFeatureIndex;if(!v||!E||l.id!==v.layerIds[0])return;let T=v.layers[0].layout,I=p.collisionBoxArray,R=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),P=p.tileSize/i.EXTENT,F=p.tileID.toUnwrapped();this.transform.setProjection(v.projection);let G=(W=p.tileID,X=v.getProjection(),Z=this.transform,X.name===this.projection?Z.calculateProjMatrix(W.toUnwrapped()):$(Z,X,W));var W,X,Z;let Y=T.get("text-pitch-alignment")==="map",N=T.get("text-rotation-alignment")==="map";l.compileFilter();let q=l.dynamicFilter(),Q=l.dynamicFilterNeedsFeature(),te=this.transform.calculatePixelsToTileUnitsMatrix(p),he=Hr(G,p.tileID.canonical,Y,N,this.transform,v.getProjection(),te),fe=null;if(Y){let ye=$n(G,p.tileID.canonical,Y,N,this.transform,v.getProjection(),te);fe=i.multiply([],this.transform.labelPlaneMatrix,ye)}let de=null;q&&p.latestFeatureIndex&&(de={unwrappedTileID:F,dynamicFilter:q,dynamicFilterNeedsFeature:Q,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new ht(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,p.tileID);let xe={bucket:v,layout:T,posMatrix:G,textLabelPlaneMatrix:he,labelToScreenMatrix:fe,clippingData:de,scale:R,textPixelRatio:P,holdingForFade:p.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:i.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(let ye of v.sortKeyRanges){let{sortKey:Ie,symbolInstanceStart:qe,symbolInstanceEnd:Ce}=ye;r.push({sortKey:Ie,symbolInstanceStart:qe,symbolInstanceEnd:Ce,parameters:xe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:xe})}attemptAnchorPlacement(r,l,p,_,v,E,T,I,R,P,F,G,W,X,Z,Y,N,q){let{textOffset0:Q,textOffset1:te,crossTileID:he}=G,fe=[Q,te],de=ot(r,p,_,fe,v),xe=this.collisionIndex.placeCollisionBox(X,v,l,Pt(de.x,de.y,E,T,this.transform.angle),F,I,R,P.predicate);if(Y){let ye=X.getSymbolInstanceIconSize(q,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,ye,Y,Pt(de.x,de.y,E,T,this.transform.angle),F,I,R,P.predicate).box.length===0)return}if(xe.box.length>0){let ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[he]&&this.prevPlacement.placements[he]&&this.prevPlacement.placements[he].text&&(ye=this.prevPlacement.variableOffsets[he].anchor),this.variableOffsets[he]={textOffset:fe,width:p,height:_,anchor:r,textScale:v,prevAnchor:ye},this.markUsedJustification(X,r,G,Z),X.allowVerticalPlacement&&(this.markUsedOrientation(X,Z,G),this.placedOrientations[he]=Z),{shift:de,placedGlyphBoxes:xe}}}placeLayerBucketPart(r,l,p,_){let{bucket:v,layout:E,posMatrix:T,textLabelPlaneMatrix:I,labelToScreenMatrix:R,clippingData:P,textPixelRatio:F,holdingForFade:G,collisionBoxArray:W,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:Z,collisionGroup:Y}=r.parameters,N=E.get("text-optional"),q=E.get("icon-optional"),Q=E.get("text-allow-overlap"),te=E.get("icon-allow-overlap"),he=E.get("text-rotation-alignment")==="map",fe=E.get("text-pitch-alignment")==="map",de=E.get("icon-text-fit")!=="none",xe=E.get("symbol-z-order")==="viewport-y";this.transform.setProjection(v.projection);let ye=Q&&(te||!v.hasIconData()||q),Ie=te&&(Q||!v.hasTextData()||N);!v.collisionArrays&&W&&v.deserializeCollisionBoxes(W),p&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,W);let qe=(Ce,Ve,Ae)=>{let{crossTileID:He,numVerticalGlyphVertices:De}=Ce;if(P){let ir={zoom:this.transform.zoom,pitch:this.transform.pitch},Fn=null;if(P.dynamicFilterNeedsFeature){let yn=this.retainedQueryData[v.bucketInstanceId];Fn=P.featureIndex.loadFeature({featureIndex:Ce.featureIndex,bucketIndex:yn.bucketIndex,sourceLayerIndex:yn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)(ir,Fn,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new i.Point(Ce.tileAnchorX,Ce.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[He]=new Xe(!1,!1,!1,!0),void l.add(He)}if(l.has(He))return;if(G)return void(this.placements[He]=new Xe(!1,!1,!1));let ze=!1,Ye=!1,$e=!0,Je=!1,vt=!1,Rt=null,mt={box:null,offscreen:null,occluded:null},Et={box:null,offscreen:null,occluded:null},Qt=null,Kt=null,_t=null,In=0,On=0,kn=0;Ae.textFeatureIndex?In=Ae.textFeatureIndex:Ce.useRuntimeCollisionCircles&&(In=Ce.featureIndex),Ae.verticalTextFeatureIndex&&(On=Ae.verticalTextFeatureIndex);let Ln=ir=>{ir.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;let Fn=this.transform.elevation;(Fn||ir.elevation)&&(ir.elevation=Fn?Fn.getAtTileOffset(ir.tileID,ir.tileAnchorX,ir.tileAnchorY):0)},li=Ae.textBox;if(li){Ln(li);let ir=yn=>{let Cr=i.WritingMode.horizontal;if(v.allowVerticalPlacement&&!yn&&this.prevPlacement){let gi=this.prevPlacement.placedOrientations[He];gi&&(this.placedOrientations[He]=gi,Cr=gi,this.markUsedOrientation(v,Cr,Ce))}return Cr},Fn=(yn,Cr)=>{if(v.allowVerticalPlacement&&De>0&&Ae.verticalTextBox){for(let gi of v.writingModes)if(gi===i.WritingMode.vertical?(mt=Cr(),Et=mt):mt=yn(),mt&&mt.box&&mt.box.length)break}else mt=yn()};if(E.get("text-variable-anchor")){let yn=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[He]){let er=this.prevPlacement.variableOffsets[He];yn.indexOf(er.anchor)>0&&(yn=yn.filter(Si=>Si!==er.anchor),yn.unshift(er.anchor))}let Cr=(er,Si,Cu)=>{let qa=v.getSymbolInstanceTextSize(X,Ce,this.transform.zoom,Ve),Cc=(er.x2-er.x1)*qa+2*er.padding,Ms=(er.y2-er.y1)*qa+2*er.padding,ua=de&&!te?Si:null;ua&&Ln(ua);let Wa={box:[],offscreen:!1,occluded:!1},Tu=Q?2*yn.length:yn.length;for(let Tc=0;Tc<Tu;++Tc){let id=this.attemptAnchorPlacement(yn[Tc%yn.length],er,Cc,Ms,qa,he,fe,F,T,Y,Tc>=yn.length,Ce,Ve,v,Cu,ua,X,Z);if(id&&(Wa=id.placedGlyphBoxes,Wa&&Wa.box&&Wa.box.length)){ze=!0,Rt=id.shift;break}}return Wa};Fn(()=>Cr(li,Ae.iconBox,i.WritingMode.horizontal),()=>{let er=Ae.verticalTextBox;return er&&Ln(er),v.allowVerticalPlacement&&!(mt&&mt.box&&mt.box.length)&&De>0&&er?Cr(er,Ae.verticalIconBox,i.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),mt&&(ze=mt.box,$e=mt.offscreen,Je=mt.occluded);let gi=ir(!(!mt||!mt.box));if(!ze&&this.prevPlacement){let er=this.prevPlacement.variableOffsets[He];er&&(this.variableOffsets[He]=er,this.markUsedJustification(v,er.anchor,Ce,gi))}}else{let yn=(Cr,gi)=>{let er=v.getSymbolInstanceTextSize(X,Ce,this.transform.zoom,Ve),Si=this.collisionIndex.placeCollisionBox(v,er,Cr,new i.Point(0,0),Q,F,T,Y.predicate);return Si&&Si.box&&Si.box.length&&(this.markUsedOrientation(v,gi,Ce),this.placedOrientations[He]=gi),Si};Fn(()=>yn(li,i.WritingMode.horizontal),()=>{let Cr=Ae.verticalTextBox;return v.allowVerticalPlacement&&De>0&&Cr?(Ln(Cr),yn(Cr,i.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ir(!!(mt&&mt.box&&mt.box.length))}}if(Qt=mt,ze=Qt&&Qt.box&&Qt.box.length>0,$e=Qt&&Qt.offscreen,Je=Qt&&Qt.occluded,Ce.useRuntimeCollisionCircles){let ir=v.text.placedSymbolArray.get(Ce.centerJustifiedTextSymbolIndex>=0?Ce.centerJustifiedTextSymbolIndex:Ce.verticalPlacedTextSymbolIndex),Fn=i.evaluateSizeForFeature(v.textSizeData,X,ir),yn=E.get("text-padding");Kt=this.collisionIndex.placeCollisionCircles(v,Q,ir,v.lineVertexArray,v.glyphOffsetArray,Fn,T,I,R,p,fe,Y.predicate,Ce.collisionCircleDiameter*Fn/i.ONE_EM,yn,this.retainedQueryData[v.bucketInstanceId].tileID),ze=Q||Kt.circles.length>0&&!Kt.collisionDetected,$e=$e&&Kt.offscreen,Je=Kt.occluded}if(Ae.iconFeatureIndex&&(kn=Ae.iconFeatureIndex),Ae.iconBox){let ir=Fn=>{Ln(Fn);let yn=de&&Rt?Pt(Rt.x,Rt.y,he,fe,this.transform.angle):new i.Point(0,0),Cr=v.getSymbolInstanceIconSize(Z,this.transform.zoom,Ce.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,Cr,Fn,yn,te,F,T,Y.predicate)};Et&&Et.box&&Et.box.length&&Ae.verticalIconBox?(_t=ir(Ae.verticalIconBox),Ye=_t.box.length>0):(_t=ir(Ae.iconBox),Ye=_t.box.length>0),$e=$e&&_t.offscreen,vt=_t.occluded}let Vr=N||Ce.numHorizontalGlyphVertices===0&&De===0,to=q||Ce.numIconVertices===0;if(Vr||to?to?Vr||(Ye=Ye&&ze):ze=Ye&&ze:Ye=ze=Ye&&ze,ze&&Qt&&Qt.box&&this.collisionIndex.insertCollisionBox(Qt.box,E.get("text-ignore-placement"),v.bucketInstanceId,Et&&Et.box&&On?On:In,Y.ID),Ye&&_t&&this.collisionIndex.insertCollisionBox(_t.box,E.get("icon-ignore-placement"),v.bucketInstanceId,kn,Y.ID),Kt&&(ze&&this.collisionIndex.insertCollisionCircles(Kt.circles,E.get("text-ignore-placement"),v.bucketInstanceId,In,Y.ID),p)){let ir=v.bucketInstanceId,Fn=this.collisionCircleArrays[ir];Fn===void 0&&(Fn=this.collisionCircleArrays[ir]=new nt);for(let yn=0;yn<Kt.circles.length;yn+=4)Fn.circles.push(Kt.circles[yn+0]),Fn.circles.push(Kt.circles[yn+1]),Fn.circles.push(Kt.circles[yn+2]),Fn.circles.push(Kt.collisionDetected?1:0)}let ts=v.projection.name!=="globe";ye=ye&&(ts||!Je),Ie=Ie&&(ts||!vt),this.placements[He]=new Xe(ze||ye,Ye||Ie,$e||v.justReloaded),l.add(He)};if(xe){let Ce=v.getSortedSymbolIndexes(this.transform.angle);for(let Ve=Ce.length-1;Ve>=0;--Ve){let Ae=Ce[Ve];qe(v.symbolInstances.get(Ae),Ae,v.collisionArrays[Ae])}}else for(let Ce=r.symbolInstanceStart;Ce<r.symbolInstanceEnd;Ce++)qe(v.symbolInstances.get(Ce),Ce,v.collisionArrays[Ce]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){let Ce=this.collisionCircleArrays[v.bucketInstanceId];i.invert(Ce.invProjMatrix,T),Ce.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,l,p,_){let{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:I,crossTileID:R}=p,P=i.getAnchorJustification(l),F=_===i.WritingMode.vertical?I:P==="left"?v:P==="center"?E:P==="right"?T:-1;v>=0&&(r.text.placedSymbolArray.get(v).crossTileID=F>=0&&v!==F?0:R),E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=F>=0&&E!==F?0:R),T>=0&&(r.text.placedSymbolArray.get(T).crossTileID=F>=0&&T!==F?0:R),I>=0&&(r.text.placedSymbolArray.get(I).crossTileID=F>=0&&I!==F?0:R)}markUsedOrientation(r,l,p){let _=l===i.WritingMode.horizontal||l===i.WritingMode.horizontalOnly?l:0,v=l===i.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:R}=p,P=r.text.placedSymbolArray;E>=0&&(P.get(E).placedOrientation=_),T>=0&&(P.get(T).placedOrientation=_),I>=0&&(P.get(I).placedOrientation=_),R>=0&&(P.get(R).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;let l=this.prevPlacement,p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;let _=l?l.symbolFadeChange(r):1,v=l?l.opacities:{},E=l?l.variableOffsets:{},T=l?l.placedOrientations:{};for(let I in this.placements){let R=this.placements[I],P=v[I];P?(this.opacities[I]=new ve(P,_,R.text,R.icon,null,R.clipped),p=p||R.text!==P.text.placed||R.icon!==P.icon.placed):(this.opacities[I]=new ve(null,_,R.text,R.icon,R.skipFade,R.clipped),p=p||R.text||R.icon)}for(let I in v){let R=v[I];if(!this.opacities[I]){let P=new ve(R,_,!1,!1);P.isHidden()||(this.opacities[I]=P,p=p||R.text.placed||R.icon.placed)}}for(let I in E)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=E[I]);for(let I in T)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=T[I]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){let p=new Set;for(let _ of l){let v=_.getBucket(r);v&&_.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,_.collisionBoxArray)}}updateBucketOpacities(r,l,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();let _=r.layers[0].layout,v=!!r.layers[0].dynamicFilter(),E=new ve(null,0,!1,!1,!0),T=_.get("text-allow-overlap"),I=_.get("icon-allow-overlap"),R=_.get("text-variable-anchor"),P=_.get("text-rotation-alignment")==="map",F=_.get("text-pitch-alignment")==="map",G=_.get("icon-text-fit")!=="none",W=new ve(null,0,T&&(I||!r.hasIconData()||_.get("icon-optional")),I&&(T||!r.hasTextData()||_.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);let X=(Y,N,q)=>{for(let Q=0;Q<N/4;Q++)Y.opacityVertexArray.emplaceBack(q)},Z=0;for(let Y=0;Y<r.symbolInstances.length;Y++){let N=r.symbolInstances.get(Y),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:Q,crossTileID:te,numIconVertices:he}=N,fe=l.has(te),de=this.opacities[te];fe?de=E:de||(de=W,this.opacities[te]=de),l.add(te);let xe=q>0||Q>0,ye=he>0,Ie=this.placedOrientations[te],qe=Ie===i.WritingMode.vertical,Ce=Ie===i.WritingMode.horizontal||Ie===i.WritingMode.horizontalOnly;if(!xe&&!ye||de.isHidden()||Z++,xe){let Ve=Ra(de.text);X(r.text,q,qe?Ft:Ve),X(r.text,Q,Ce?Ft:Ve);let Ae=de.text.isHidden(),{leftJustifiedTextSymbolIndex:He,centerJustifiedTextSymbolIndex:De,rightJustifiedTextSymbolIndex:ze,verticalPlacedTextSymbolIndex:Ye}=N,$e=r.text.placedSymbolArray,Je=Ae||qe?1:0;He>=0&&($e.get(He).hidden=Je),De>=0&&($e.get(De).hidden=Je),ze>=0&&($e.get(ze).hidden=Je),Ye>=0&&($e.get(Ye).hidden=Ae||Ce?1:0);let vt=this.variableOffsets[te];vt&&this.markUsedJustification(r,vt.anchor,N,Ie);let Rt=this.placedOrientations[te];Rt&&(this.markUsedJustification(r,"left",N,Rt),this.markUsedOrientation(r,Rt,N))}if(ye){let Ve=Ra(de.icon),{placedIconSymbolIndex:Ae,verticalPlacedIconSymbolIndex:He}=N,De=r.icon.placedSymbolArray,ze=de.icon.isHidden()?1:0;Ae>=0&&(X(r.icon,he,qe?Ft:Ve),De.get(Ae).hidden=ze),He>=0&&(X(r.icon,N.numVerticalIconVertices,Ce?Ft:Ve),De.get(He).hidden=ze)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){let Ve=r.collisionArrays[Y];if(Ve){let Ae=new i.Point(0,0),He=!0;if(Ve.textBox||Ve.verticalTextBox){if(R){let ze=this.variableOffsets[te];ze?(Ae=ot(ze.anchor,ze.width,ze.height,ze.textOffset,ze.textScale),P&&Ae._rotate(F?this.transform.angle:-this.transform.angle)):He=!1}v&&(He=!de.clipped),Ve.textBox&&kt(r.textCollisionBox.collisionVertexArray,de.text.placed,!He||qe,Ae.x,Ae.y),Ve.verticalTextBox&&kt(r.textCollisionBox.collisionVertexArray,de.text.placed,!He||Ce,Ae.x,Ae.y)}let De=He&&!!(!Ce&&Ve.verticalIconBox);Ve.iconBox&&kt(r.iconCollisionBox.collisionVertexArray,de.icon.placed,De,G?Ae.x:0,G?Ae.y:0),Ve.verticalIconBox&&kt(r.iconCollisionBox.collisionVertexArray,de.icon.placed,!De,G?Ae.x:0,G?Ae.y:0)}}}if(r.fullyClipped=Z===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){let Y=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Y.invProjMatrix,r.placementViewportMatrix=Y.viewportMatrix,r.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){let p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function kt(d,r,l,p,_){d.emplaceBack(r?1:0,l?1:0,p||0,_||0),d.emplaceBack(r?1:0,l?1:0,p||0,_||0),d.emplaceBack(r?1:0,l?1:0,p||0,_||0),d.emplaceBack(r?1:0,l?1:0,p||0,_||0)}let _n=Math.pow(2,25),Ne=Math.pow(2,24),yt=Math.pow(2,17),Cn=Math.pow(2,16),Tn=Math.pow(2,9),Dn=Math.pow(2,8),hl=Math.pow(2,1);function Ra(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let r=d.placed?1:0,l=Math.floor(127*d.opacity);return l*_n+r*Ne+l*yt+r*Cn+l*Tn+r*Dn+l*hl+r}let Ft=0;class ea{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,l,p,_,v){let E=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(E,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((T,I)=>T.sortKey-I.sortKey));this._currentPartIndex<E.length;){let T=E[this._currentPartIndex];if(l.placeLayerBucketPart(T,this._seenCrossTileIDs,p,T.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class rc{constructor(r,l,p,_,v,E,T,I){this.placement=new Zn(r,v,E,T,I),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,l,p){let _=i.exported.now(),v=()=>{let E=i.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){let E=l[r[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=T)&&(!E.maxzoom||E.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new ea(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}let qr=512/i.EXTENT/2;class Or{constructor(r,l,p){this.tileID=r,this.bucketInstanceId=p,this.index=new i.KDBush(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let _=r.canonical.x*i.EXTENT,v=r.canonical.y*i.EXTENT;for(let E=0;E<l.length;E++){let{key:T,crossTileID:I,tileAnchorX:R,tileAnchorY:P}=l.get(E),F=Math.floor((_+R)*qr),G=Math.floor((v+P)*qr);this.index.add(F,G),this.keys.push(T),this.crossTileIDs.push(I)}this.index.finish()}findMatches(r,l,p){let _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),v=qr/Math.pow(2,l.canonical.z-this.tileID.canonical.z),E=l.canonical.x*i.EXTENT,T=l.canonical.y*i.EXTENT;for(let I=0;I<r.length;I++){let R=r.get(I);if(R.crossTileID)continue;let{key:P,tileAnchorX:F,tileAnchorY:G}=R,W=Math.floor((E+F)*v),X=Math.floor((T+G)*v),Z=this.index.range(W-_,X-_,W+_,X+_);for(let Y of Z){let N=this.crossTileIDs[Y];if(this.keys[Y]===P&&!p.has(N)){p.add(N),R.crossTileID=N;break}}}}}class dl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){let l=Math.round((r-this.lng)/360);if(l!==0)for(let p in this.indexes){let _=this.indexes[p],v={};for(let E in _){let T=_[E];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+l),v[T.tileID.key]=T}this.indexes[p]=v}this.lng=r}addBucket(r,l,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);let _=this.usedCrossTileIDs[r.overscaledZ];for(let v in this.indexes){let E=this.indexes[v];if(Number(v)>r.overscaledZ)for(let T in E){let I=E[T];I.tileID.isChildOf(r)&&I.findMatches(l.symbolInstances,r,_)}else{let T=E[r.scaledTo(Number(v)).key];T&&T.findMatches(l.symbolInstances,r,_)}}for(let v=0;v<l.symbolInstances.length;v++){let E=l.symbolInstances.get(v);E.crossTileID||(E.crossTileID=p.generate(),_.add(E.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Or(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(let p of l.crossTileIDs)this.usedCrossTileIDs[r].delete(p)}removeStaleBuckets(r){let l=!1;for(let p in this.indexes){let _=this.indexes[p];for(let v in _)r[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],l=!0)}return l}}class ji{constructor(){this.layerIndexes={},this.crossTileIDs=new dl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,p,_){let v=this.layerIndexes[r.id];v===void 0&&(v=this.layerIndexes[r.id]=new fl);let E=!1,T={};_.name!=="globe"&&v.handleWrapJump(p);for(let I of l){let R=I.getBucket(r);R&&r.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(I.tileID,R,this.crossTileIDs)&&(E=!0),T[R.bucketInstanceId]=!0)}return v.removeStaleBuckets(T)&&(E=!0),E}pruneUnusedLayers(r){let l={};r.forEach(p=>{l[p]=!0});for(let p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}let go=(d,r)=>i.emitValidationErrors(d,r&&r.filter(l=>l.identifier!=="source.canvas")),Oa=i.pick(hn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Vh=i.pick(hn,["setCenter","setZoom","setBearing","setPitch"]),ic={version:8,layers:[],sources:{}},ta={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ui extends i.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new mr(Qs(),this),this.imageManager=new Ws,this.imageManager.setEventedParent(this),this.glyphManager=new i.GlyphManager(r._requestManager,l.localFontFamily?i.LocalGlyphMode.all:l.localIdeographFontFamily?i.LocalGlyphMode.ideographs:i.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new ji,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",i.getReferrer());let p=this;this._rtlTextPluginCallback=Ui.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,E)=>{if(i.triggerPluginCompletionEvent(v),E&&E.every(T=>T))for(let T in p._sourceCaches){let I=p._sourceCaches[T],R=I.getSource().type;R!=="vector"&&R!=="geojson"||I.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let v=this.getSource(_.sourceId);if(v&&v.vectorLayerIds)for(let E in this._layers){let T=this._layers[E];T.source===v.id&&this._validateLayer(T)}})}loadURL(r,l={}){this.fire(new i.Event("dataloading",{dataType:"style"}));let p=typeof l.validate=="boolean"?l.validate:!i.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);let _=this.map._requestManager.transformRequest(r,i.ResourceType.Style);this._request=i.getJSON(_,(v,E)=>{this._request=null,v?this.fire(new i.ErrorEvent(v)):E&&this._load(E,p)})}loadJSON(r,l={}){this.fire(new i.Event("dataloading",{dataType:"style"})),this._request=i.exported.frame(()=>{this._request=null,this._load(r,l.validate!==!1)})}loadEmpty(){this.fire(new i.Event("dataloading",{dataType:"style"})),this._load(ic,!1)}_updateLayerCount(r,l){let p=l?1:-1;r.is3D()&&(this._num3DLayers+=p),r.type==="circle"&&(this._numCircleLayers+=p),r.type==="symbol"&&(this._numSymbolLayers+=p)}_load(r,l){if(l&&go(this,i.validateStyle(r)))return;this._loaded=!0,this.stylesheet=i.clone$1(r),this._updateMapProjection();for(let _ in r.sources)this.addSource(_,r.sources[_],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);let p=au(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p){let v=i.createStyleLayer(_);v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Pr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new i.Event("data",{dataType:"style"})),this.fire(new i.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(l,p,_){let v,E,T,I=i.exported.devicePixelRatio>1?"@2x":"",R=i.getJSON(p.transformRequest(p.normalizeSpriteURL(l,I,".json"),i.ResourceType.SpriteJSON),(G,W)=>{R=null,T||(T=G,v=W,F())}),P=i.getImage(p.transformRequest(p.normalizeSpriteURL(l,I,".png"),i.ResourceType.SpriteImage),(G,W)=>{P=null,T||(T=G,E=W,F())});function F(){if(T)_(T);else if(v&&E){let G=i.exported.getImageData(E),W={};for(let X in v){let{width:Z,height:Y,x:N,y:q,sdf:Q,pixelRatio:te,stretchX:he,stretchY:fe,content:de}=v[X],xe=new i.RGBAImage({width:Z,height:Y});i.RGBAImage.copy(G,xe,{x:N,y:q},{x:0,y:0},{width:Z,height:Y}),W[X]={data:xe,pixelRatio:te,sdf:Q,stretchX:he,stretchY:fe,content:de}}_(null,W)}}return{cancel(){R&&(R.cancel(),R=null),P&&(P.cancel(),P=null)}}}(r,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new i.ErrorEvent(l));else if(p)for(let _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new i.Event("data",{dataType:"style"}))})}_validateLayer(r){let l=this.getSource(r.source);if(!l)return;let p=r.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new i.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){let l=[];for(let p of r){let _=this._layers[p];_.type!=="custom"&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(let r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(let r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&(typeof r.isLayerDraped=="function"?r.isLayerDraped():ta[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;let l=this._changed;if(this._changed){let _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(let E in this._updatedSources){let T=this._updatedSources[E];T==="reload"?this._reloadSource(E):T==="clear"&&this._clearSource(E)}this._updateTilesForChangedImages();for(let E in this._updatedPaintProps)this._layers[E].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}let p={};for(let _ in this._sourceCaches){let v=this._sourceCaches[_];p[_]=v.used,v.used=!1}for(let _ of this._order){let v=this._layers[_];if(v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)){let T=this._getLayerSourceCache(v);T&&(T.used=!0)}let E=this.map.painter;if(E){let T=v.getProgramIds();if(!T)continue;let I=v.getProgramConfiguration(r.zoom);for(let R of T)E.useProgram(R,I)}}for(let _ in p){let v=this._sourceCaches[_];p[_]!==v.used&&v.getSource().fire(new i.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new i.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let r=Object.keys(this._changedImages);if(r.length){for(let l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),go(this,i.validateStyle(r)))return!1;(r=i.clone$1(r)).layers=au(r.layers);let l=function(_,v){if(!_)return[{command:hn.setStyle,args:[v]}];let E=[];try{if(!w(_.version,v.version))return[{command:hn.setStyle,args:[v]}];w(_.center,v.center)||E.push({command:hn.setCenter,args:[v.center]}),w(_.zoom,v.zoom)||E.push({command:hn.setZoom,args:[v.zoom]}),w(_.bearing,v.bearing)||E.push({command:hn.setBearing,args:[v.bearing]}),w(_.pitch,v.pitch)||E.push({command:hn.setPitch,args:[v.pitch]}),w(_.sprite,v.sprite)||E.push({command:hn.setSprite,args:[v.sprite]}),w(_.glyphs,v.glyphs)||E.push({command:hn.setGlyphs,args:[v.glyphs]}),w(_.transition,v.transition)||E.push({command:hn.setTransition,args:[v.transition]}),w(_.light,v.light)||E.push({command:hn.setLight,args:[v.light]}),w(_.fog,v.fog)||E.push({command:hn.setFog,args:[v.fog]}),w(_.projection,v.projection)||E.push({command:hn.setProjection,args:[v.projection]});let T={},I=[];(function(F,G,W,X){let Z;for(Z in G=G||{},F=F||{})F.hasOwnProperty(Z)&&(G.hasOwnProperty(Z)||ys(Z,W,X));for(Z in G){if(!G.hasOwnProperty(Z))continue;let Y=G[Z];F.hasOwnProperty(Z)?w(F[Z],Y)||(F[Z].type==="geojson"&&Y.type==="geojson"&&vs(F,G,Z)?W.push({command:hn.setGeoJSONSourceData,args:[Z,Y.data]}):ec(Z,G,W,X)):Ql(Z,G,W)}})(_.sources,v.sources,I,T);let R=[];_.layers&&_.layers.forEach(F=>{F.source&&T[F.source]?E.push({command:hn.removeLayer,args:[F.id]}):R.push(F)});let P=_.terrain;P&&T[P.source]&&(E.push({command:hn.setTerrain,args:[void 0]}),P=void 0),E=E.concat(I),w(P,v.terrain)||E.push({command:hn.setTerrain,args:[v.terrain]}),function(F,G,W){G=G||[];let X=(F=F||[]).map(Bi),Z=G.map(Bi),Y=F.reduce(fr,{}),N=G.reduce(fr,{}),q=X.slice(),Q=Object.create(null),te,he,fe,de,xe,ye,Ie;for(te=0,he=0;te<X.length;te++)fe=X[te],N.hasOwnProperty(fe)?he++:(W.push({command:hn.removeLayer,args:[fe]}),q.splice(q.indexOf(fe,he),1));for(te=0,he=0;te<Z.length;te++)fe=Z[Z.length-1-te],q[q.length-1-te]!==fe&&(Y.hasOwnProperty(fe)?(W.push({command:hn.removeLayer,args:[fe]}),q.splice(q.lastIndexOf(fe,q.length-he),1)):he++,ye=q[q.length-te],W.push({command:hn.addLayer,args:[N[fe],ye]}),q.splice(q.length-te,0,fe),Q[fe]=!0);for(te=0;te<Z.length;te++)if(fe=Z[te],de=Y[fe],xe=N[fe],!Q[fe]&&!w(de,xe))if(w(de.source,xe.source)&&w(de["source-layer"],xe["source-layer"])&&w(de.type,xe.type)){for(Ie in Ei(de.layout,xe.layout,W,fe,null,hn.setLayoutProperty),Ei(de.paint,xe.paint,W,fe,null,hn.setPaintProperty),w(de.filter,xe.filter)||W.push({command:hn.setFilter,args:[fe,xe.filter]}),w(de.minzoom,xe.minzoom)&&w(de.maxzoom,xe.maxzoom)||W.push({command:hn.setLayerZoomRange,args:[fe,xe.minzoom,xe.maxzoom]}),de)de.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?Ei(de[Ie],xe[Ie],W,fe,Ie.slice(6),hn.setPaintProperty):w(de[Ie],xe[Ie])||W.push({command:hn.setLayerProperty,args:[fe,Ie,xe[Ie]]}));for(Ie in xe)xe.hasOwnProperty(Ie)&&!de.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?Ei(de[Ie],xe[Ie],W,fe,Ie.slice(6),hn.setPaintProperty):w(de[Ie],xe[Ie])||W.push({command:hn.setLayerProperty,args:[fe,Ie,xe[Ie]]}))}else W.push({command:hn.removeLayer,args:[fe]}),ye=q[q.lastIndexOf(fe)+1],W.push({command:hn.addLayer,args:[xe,ye]})}(R,v.layers,E)}catch(T){console.warn("Unable to compute style diff:",T),E=[{command:hn.setStyle,args:[v]}]}return E}(this.serialize(),r).filter(_=>!(_.command in Vh));if(l.length===0)return!1;let p=l.filter(_=>!(_.command in Oa));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{_.command!=="setTransition"&&_.command!=="setProjection"&&this[_.command].apply(this,_.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,l){return this.getImage(r)?this.fire(new i.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new i.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,p={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(i.validateSource,`sources.${r}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);let _=$t(r,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:_.serialize(),sourceId:r}));let v=E=>{let T=(E?"symbol:":"other:")+r,I=this._sourceCaches[T]=new i.SourceCache(T,_,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[r]=I,I.style=this,I.onAdd(this.map)};v(!1),l.type!=="vector"&&l.type!=="geojson"||v(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();let l=this.getSource(r);if(!l)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===r)return this.fire(new i.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new i.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));let p=this._getSourceCaches(r);for(let _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new i.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){let l=this._getSourceCache(r);return l&&l.getSource()}_getSources(){let r=[];for(let l in this._otherSourceCaches){let p=this._getSourceCache(l);p&&r.push(p.getSource())}return r}addLayer(r,l,p={}){this._checkLoaded();let _=r.id;if(this.getLayer(_))return void this.fire(new i.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let v;if(r.type==="custom"){if(go(this,i.validateCustomStyleLayer(r)))return;v=i.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=i.clone$1(r),r=i.extend(r,{source:_})),this._validate(i.validateLayer,`layers.${_}`,r,{arrayIndex:-1},p))return;v=i.createStyleLayer(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}let E=l?this._order.indexOf(l):this._order.length;if(l&&E===-1)return void this.fire(new i.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=v;let T=this._getLayerSourceCache(v);if(this._removedLayers[_]&&v.source&&T&&v.type!=="custom"){let I=this._removedLayers[_];delete this._removedLayers[_],I.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",T.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new i.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;let p=this._order.indexOf(r);this._order.splice(p,1);let _=l?this._order.indexOf(l):this._order.length;l&&_===-1?this.fire(new i.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();let l=this._layers[r];if(!l)return void this.fire(new i.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);let p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(let l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,p){this._checkLoaded();let _=this.getLayer(r);_?_.minzoom===l&&_.maxzoom===p||(l!=null&&(_.minzoom=l),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new i.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,p={}){this._checkLoaded();let _=this.getLayer(r);if(_){if(!w(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(i.validateFilter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=i.clone$1(l),this._updateLayer(_)))}else this.fire(new i.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){let l=this.getLayer(r);return l&&i.clone$1(l.filter)}setLayoutProperty(r,l,p,_={}){this._checkLoaded();let v=this.getLayer(r);v?w(v.getLayoutProperty(l),p)||(v.setLayoutProperty(l,p,_),this._updateLayer(v)):this.fire(new i.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){let p=this.getLayer(r);if(p)return p.getLayoutProperty(l);this.fire(new i.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,p,_={}){this._checkLoaded();let v=this.getLayer(r);v?w(v.getPaintProperty(l),p)||(v.setPaintProperty(l,p,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new i.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){let p=this.getLayer(r);return p&&p.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();let p=r.source,_=r.sourceLayer,v=this.getSource(p);if(!v)return void this.fire(new i.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));let E=v.type;if(E==="geojson"&&_)return void this.fire(new i.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!_)return void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided.")));let T=this._getSourceCaches(p);for(let I of T)I.setFeatureState(_,r.id,l)}removeFeatureState(r,l){this._checkLoaded();let p=r.source,_=this.getSource(p);if(!_)return void this.fire(new i.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));let v=_.type,E=v==="vector"?r.sourceLayer:void 0;if(v==="vector"&&!E)return void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new i.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));let T=this._getSourceCaches(p);for(let I of T)I.removeFeatureState(E,r.id,l)}getFeatureState(r){this._checkLoaded();let l=r.source,p=r.sourceLayer,_=this.getSource(l);if(_){if(_.type!=="vector"||p)return r.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,r.id);this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new i.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return i.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){let r={};for(let l in this._sourceCaches){let p=this._sourceCaches[l].getSource();r[p.id]||(r[p.id]=p.serialize())}return i.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;let l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){let l=E=>this._layers[E].type==="fill-extrusion",p={},_=[];for(let E=this._order.length-1;E>=0;E--){let T=this._order[E];if(l(T)){p[T]=E;for(let I of r){let R=I[T];if(R)for(let P of R)_.push(P)}}}_.sort((E,T)=>T.intersectionZ-E.intersectionZ);let v=[];for(let E=this._order.length-1;E>=0;E--){let T=this._order[E];if(l(T))for(let I=_.length-1;I>=0;I--){let R=_[I].feature;if(p[R.layer.id]<E)break;v.push(R),_.pop()}else for(let I of r){let R=I[T];if(R)for(let P of R)v.push(P.feature)}}return v}queryRenderedFeatures(r,l,p){l&&l.filter&&this._validate(i.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);let _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new i.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(let I of l.layers){let R=this._layers[I];if(!R)return this.fire(new i.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];_[R.source]=!0}}let v=[];l.availableImages=this._availableImages;let E=l&&l.layers?l.layers.some(I=>{let R=this.getLayer(I);return R&&R.is3D()}):this.has3DLayers(),T=Zi.createFromScreenPoints(r,p);for(let I in this._sourceCaches){let R=this._sourceCaches[I].getSource().id;l.layers&&!_[R]||v.push(Sn(this._sourceCaches[I],this._layers,this._serializedLayers,T,l,p,E,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(I,R,P,F,G,W,X){let Z={},Y=W.queryRenderedSymbols(F),N=[];for(let q of Object.keys(Y).map(Number))N.push(X[q]);N.sort(wr);for(let q of N){let Q=q.featureIndex.lookupSymbolFeatures(Y[q.bucketInstanceId],R,q.bucketIndex,q.sourceLayerIndex,G.filter,G.layers,G.availableImages,I);for(let te in Q){let he=Z[te]=Z[te]||[],fe=Q[te];fe.sort((de,xe)=>{let ye=q.featureSortOrder;if(ye){let Ie=ye.indexOf(de.featureIndex);return ye.indexOf(xe.featureIndex)-Ie}return xe.featureIndex-de.featureIndex});for(let de of fe)he.push(de)}}for(let q in Z)Z[q].forEach(Q=>{let te=Q.feature,he=P(I[q]);if(!he)return;let fe=he.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=fe});return Z}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,l){l&&l.filter&&this._validate(i.validateFilter,"querySourceFeatures.filter",l.filter,null,l);let p=this._getSourceCaches(r),_=[];for(let v of p)_=_.concat(cr(v,l));return _}addSourceType(r,l,p){return Ui.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Ui.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();let p=this.light.getLight(),_=!1;for(let E in r)if(!w(r[E],p[E])){_=!0;break}if(!_)return;let v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,l),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let p=r;if(l===1){if(typeof p.source=="object"){let _="terrain-dem-src";this.addSource(_,p.source),p=i.clone$1(p),p=i.extend(p,{source:_})}if(this._validate(i.validateTerrain,"terrain",p))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l)}else{let _=this.terrain,v=_.get();for(let E of Object.keys(i.spec.terrain))!p.hasOwnProperty(E)&&i.spec.terrain[E].default&&(p[E]=i.spec.terrain[E].default);for(let E in p)if(!w(p[E],v[E])){_.set(p),this.stylesheet.terrain=p;let T=this._setTransitionParameters({duration:0});_.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){let l=this.fog=new Bo(r,this.map.transform);this.stylesheet.fog=r;let p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let l=this.fog,p=l.get();Object.keys(r).length===0&&l.set(r);for(let _ in r)if(!w(r[_],p[_])){l.set(r),this.stylesheet.fog=r;let v=this._setTransitionParameters({duration:0});l.updateTransitions(v);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:i.exported.now(),transition:i.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;let r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){let p=this.terrain=new Ma(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();let _=this._setTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(let r in this._layers){let l=this._layers[r];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(let r in this._layers){let l=this._layers[r];l.type==="symbol"&&this._updateLayer(l)}}_validate(r,l,p,_,v={}){return(!v||v.validate!==!1)&&go(this,r.call(i.validateStyle,i.extend({key:l,style:this.serialize(),value:p,styleSpec:i.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(let r in this._layers)this._layers[r].setEventedParent(null);for(let r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){let l=this._getSourceCaches(r);for(let p of l)p.clearTiles()}_reloadSource(r){let l=this._getSourceCaches(r);for(let p of l)p.resume(),p.reload()}_reloadSources(){for(let r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(let l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(let r in this._sourceCaches){let l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,p,_,v=!1){let E=!1,T=!1,I={};for(let R of this._order){let P=this._layers[R];if(P.type!=="symbol")continue;if(!I[P.source]){let G=this._getLayerSourceCache(P);if(!G)continue;I[P.source]=G.getRenderableIds(!0).map(W=>G.getTileByID(W)).sort((W,X)=>X.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(X.tileID)?-1:1))}let F=this.crossTileSymbolIndex.addLayer(P,I[P.source],r.center.lng,r.projection);E=E||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new i.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.exported.now(),r.zoom))&&(this.pauseablePlacement=new rc(r,this._order,v,l,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.exported.now()),T=!0),E&&this.pauseablePlacement.placement.setStale()),T||E)for(let R of this._order){let P=this._layers[R];P.type==="symbol"&&this.placement.updateLayerOpacities(P,I[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.exported.now())}_releaseSymbolFadeTiles(){for(let r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();let _=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(r,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(r,l,p){return i.makeRequest(l,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){let l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){let l=this._getSourceCaches(r);return l.length===0?(this.fire(new i.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ui.getSourceType=function(d){return Ot[d]},Ui.setSourceType=function(d,r){Ot[d]=r},Ui.registerForPluginStateChange=i.registerForPluginStateChange;var pl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Go="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",_o=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,ka=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ci=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let na={},xs={},oi=[];yo(pl,oi),yo(_o,oi),yo(ka,oi),yo(Ci,oi),na=dn("",_o),xs=dn(Ci,ka);let oc=dn(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),La=pl,sc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var ml={background:dn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:dn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:dn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:dn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:dn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:dn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:dn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:dn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:dn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:dn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:dn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:dn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:dn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:dn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:dn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:dn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:dn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:dn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:dn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:dn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:dn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:dn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:dn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:dn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:dn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Go),skyboxGradient:dn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Go),skyboxCapture:dn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:dn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:dn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function yo(d,r){let l=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let _=p.split(" ");for(let v of _)r.includes(v)||r.push(v)}}function dn(d,r){let l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},v=[...oi];return yo(d,v),yo(r,v),{fragmentSource:d=d.replace(l,(E,T,I,R,P)=>(_[P]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${P}
varying ${I} ${R} ${P};
#else
uniform ${I} ${R} u_${P};
#endif
`:`
#ifdef HAS_UNIFORM_u_${P}
    ${I} ${R} ${P} = u_${P};
#endif
`)),vertexSource:r=r.replace(l,(E,T,I,R,P)=>{let F=R==="float"?"vec2":"vec4",G=P.match(/color/)?"color":F;return _[P]?T==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
attribute ${I} ${F} a_${P};
varying ${I} ${R} ${P};
#else
uniform ${I} ${R} u_${P};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = a_${P};
#else
    ${I} ${R} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = unpack_mix_${G}(a_${P}, u_${P}_t);
#else
    ${I} ${R} ${P} = u_${P};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
attribute ${I} ${F} a_${P};
#else
uniform ${I} ${R} u_${P};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${I} ${R} ${P} = a_${P};
#else
    ${I} ${R} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${I} ${R} ${P} = unpack_mix_${G}(a_${P}, u_${P}_t);
#else
    ${I} ${R} ${P} = u_${P};
#endif
`}),staticAttributes:p,usedDefines:v}}class cu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,p,_,v,E,T){this.context=r;let I=this.boundPaintVertexBuffers.length!==_.length;for(let P=0;!I&&P<_.length;P++)this.boundPaintVertexBuffers[P]!==_[P]&&(I=!0);let R=this.boundDynamicVertexBuffers.length!==T.length;for(let P=0;!R&&P<T.length;P++)this.boundDynamicVertexBuffers[P]!==T[P]&&(R=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||I||R||this.boundIndexBuffer!==v||this.boundVertexOffset!==E)this.freshBind(l,p,_,v,E,T);else{r.bindVertexArrayOES.set(this.vao);for(let P of T)P&&P.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(r,l,p,_,v,E){let T,I=r.numAttributes,R=this.context,P=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),T=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=E;else{T=R.currentNumAttributes||0;for(let F=I;F<T;F++)P.disableVertexAttribArray(F)}l.enableAttributes(P,r),l.bind(),l.setVertexAttribPointers(P,r,v);for(let F of p)F.enableAttributes(P,r),F.bind(),F.setVertexAttribPointers(P,r,v);for(let F of E)F&&(F.enableAttributes(P,r),F.bind(),F.setVertexAttribPointers(P,r,v));_&&_.bind(),R.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ac(d,r){let l=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new i.MercatorCoordinate(0,p/l).toLngLat().lat,new i.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function Ho(d,r,l,p,_,v,E){let T=d.context,I=T.gl,R=l.fbo;if(!R)return;d.prepareDrawTile();let P=d.useProgram("hillshade");T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,R.colorAttachment.get());let F=((Z,Y,N,q)=>{let Q=N.paint.get("hillshade-shadow-color"),te=N.paint.get("hillshade-highlight-color"),he=N.paint.get("hillshade-accent-color"),fe=N.paint.get("hillshade-illumination-direction")*(Math.PI/180);N.paint.get("hillshade-illumination-anchor")==="viewport"&&(fe-=Z.transform.angle);let de=!Z.options.moving;return{u_matrix:q||Z.transform.calculateProjMatrix(Y.tileID.toUnwrapped(),de),u_image:0,u_latrange:ac(0,Y.tileID),u_light:[N.paint.get("hillshade-exaggeration"),fe],u_shadow:Q,u_highlight:te,u_accent:he}})(d,l,p,d.terrain?r.projMatrix:null);d.prepareDrawProgram(T,P,r.toUnwrapped());let{tileBoundsBuffer:G,tileBoundsIndexBuffer:W,tileBoundsSegments:X}=d.getTileBoundsBuffers(l);P.draw(T,I.TRIANGLES,_,v,E,i.CullFaceMode.disabled,F,p.id,G,W,X)}function gl(d,r,l){if(!r.needsDEMTextureUpload)return;let p=d.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||d.getTileTexture(l.stride);let v=l.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new i.Texture(p,v,_.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function uu(d,r,l,p,_,v){let E=d.context,T=E.gl;if(!r.dem)return;let I=r.dem;if(E.activeTexture.set(T.TEXTURE1),gl(d,r,I),!r.demTexture)return;r.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);let R=I.dim;E.activeTexture.set(T.TEXTURE0);let P=r.fbo;if(!P){let X=new i.Texture(E,{width:R,height:R,data:null},T.RGBA);X.bind(T.LINEAR,T.CLAMP_TO_EDGE),P=r.fbo=E.createFramebuffer(R,R,!0),P.colorAttachment.set(X.texture)}E.bindFramebuffer.set(P.framebuffer),E.viewport.set([0,0,R,R]);let{tileBoundsBuffer:F,tileBoundsIndexBuffer:G,tileBoundsSegments:W}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(E,T.TRIANGLES,p,_,v,i.CullFaceMode.disabled,((X,Z)=>{let Y=Z.stride,N=i.create();return i.ortho(N,0,i.EXTENT,-i.EXTENT,0,0,1),i.translate(N,N,[0,-i.EXTENT,0]),{u_matrix:N,u_image:1,u_dimension:[Y,Y],u_zoom:X.overscaledZ,u_unpack:Z.unpackVector}})(r.tileID,I),l.id,F,G,W),r.needsHillshadePrepare=!1}let lc=d=>({u_matrix:new i.UniformMatrix4f(d),u_image0:new i.Uniform1i(d),u_skirt_height:new i.Uniform1f(d)}),qo=(d,r)=>({u_matrix:d,u_image0:0,u_skirt_height:r}),Wo=(d,r,l,p,_,v,E,T,I,R,P,F,G,W,X)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:E,u_frustum_tr:T,u_frustum_br:I,u_frustum_bl:R,u_globe_pos:P,u_globe_radius:F,u_viewport:G,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:W});function Zo(d,r){return d!=null&&r!=null&&!(!d.hasData()||!r.hasData())&&d.demTexture!=null&&r.demTexture!=null&&d.tileID.key!==r.tileID.key}let $i=new class{constructor(){this.operations={}}newMorphing(d,r,l,p,_){if(d in this.operations){let v=this.operations[d];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[d]={startTime:p,phase:0,duration:_,from:r,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;let r=this.operations[d];return{from:r.from,to:r.to,phase:r.phase}}update(d){for(let r in this.operations){let l=this.operations[r];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[r];break}}}_nextOp(d,r){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=r,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},vo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Xo(d){return 6*Math.pow(1.5,22-d)}function hu(d,r){let l=1<<d.z;return!r&&(d.x===0||d.x===l-1)||d.y===0||d.y===l-1}let Fa=d=>({u_matrix:d});function cc(d,r,l,p,_){if(_>0){let v=i.exported.now(),E=(v-d.timeAdded)/_,T=r?(v-r.timeAdded)/_:-1,I=l.getSource(),R=p.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),P=!r||Math.abs(r.tileID.overscaledZ-R)>Math.abs(d.tileID.overscaledZ-R),F=P&&d.refreshedUponExpiration?1:i.clamp(P?E:1-T,0,1);return d.refreshedUponExpiration&&E>=1&&(d.refreshedUponExpiration=!1),r?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class uc extends i.SourceCache{constructor(r){let l={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new mr(Qs(),null),_=$t("mock-dem",l,p,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class _l extends i.SourceCache{constructor(r){let l=$t("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new mr(Qs(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,p){if(r.freezeTileCoverage)return;this.transform=r;let _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,E)=>{if(v[E.key]="",!this._tiles[E.key]){let T=new i.Tile(E,this._source.tileSize*E.overscaleFactor(),r.tileZoom);T.state="loaded",this._tiles[E.key]=T}return v},{});for(let v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){let l=this.proxyCachedFBO[r];if(l!==void 0){let p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Na extends i.OverscaledTileID{constructor(r,l,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class za extends i.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[p,_,v]=function(I){let R=new i.StructArrayLayout2i4,P=new i.StructArrayLayout3ui6,F=131;R.reserve(17161),P.reserve(33800);let G=i.EXTENT/128,W=i.EXTENT+G/2,X=W+G;for(let Y=-G;Y<X;Y+=G)for(let N=-G;N<X;N+=G){let q=N<0||N>W||Y<0||Y>W?24575:0,Q=i.clamp(Math.round(N),0,i.EXTENT),te=i.clamp(Math.round(Y),0,i.EXTENT);R.emplaceBack(Q+q,te)}let Z=(Y,N)=>{let q=N*F+Y;P.emplaceBack(q+1,q,q+F),P.emplaceBack(q+F,q+F+1,q+1)};for(let Y=1;Y<129;Y++)for(let N=1;N<129;N++)Z(N,Y);return[0,129].forEach(Y=>{for(let N=0;N<130;N++)Z(N,Y),Z(Y,N)}),[R,P,32768]}(),E=r.context;this.gridBuffer=E.createVertexBuffer(p,i.posAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(_),this.gridSegments=i.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=i.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new _l(l.map),this.orthoMatrix=i.create(),i.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.EXTENT,0,i.EXTENT,0,1);let T=E.gl;this._overlapStencilMode=new i.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new uc(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,l,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;let _=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");let v=()=>{this.sourceCache.used&&i.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let E=this.getScaledDemTileSize();this.sourceCache.update(l,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){let r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&i.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let _=this.proxyCoords=l.getIds().map(I=>{let R=l.getTileByID(I).tileID;return R.projMatrix=p.calculateProjMatrix(R.toUnwrapped()),R});(function(I,R){let P=R.transform.pointCoordinate(R.transform.getCameraPoint()),F=new i.Point(P.x,P.y);I.sort((G,W)=>{if(W.overscaledZ-G.overscaledZ)return W.overscaledZ-G.overscaledZ;let X=new i.Point(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),Z=new i.Point(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),Y=F.mult(1<<G.canonical.z);return Y.x-=.5,Y.y-=.5,Y.distSqr(X)-Y.distSqr(Z)})})(_,this.painter),this._previousZoom=p.zoom;let v=this.proxyToSource||{};this.proxyToSource={},_.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};let E=this._style._sourceCaches;for(let I in E){let R=E[I];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,r[I],v),R.usedForTerrain))continue;let P=r[I];R.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[l.id]=_.map(I=>new Na(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=i.exported.now();let T={};this._visibleDemTiles=[];for(let I of this.proxyCoords){let R=this.terrainTileForTile[I.key];if(!R)continue;let P=R.tileID.key;P in T||(this._visibleDemTiles.push(R),T[P]=P)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;let p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){let r=this.painter.context,l=r.gl;for(let p in this.terrainTileForTile){let _=this.terrainTileForTile[p],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),gl(this.painter,_,v))}}_prepareDemTileUniforms(r,l,p,_){if(!l||l.demTexture==null)return!1;let v=r.tileID.canonical,E=Math.pow(2,l.tileID.canonical.z-v.z),T=_||"";return p[`u_dem_tl${T}`]=[v.x*E%1,v.y*E%1],p[`u_dem_scale${T}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){let p=new i.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.Texture(r,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0,l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;let v=_.dem.tree.minimums[0];return v>0&&r++,p+v},0);return r?l/r:0}_updateEmptyDEMTexture(){let r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);let p=this._getLoadedAreaMinimum(),_=new i.RGBAImage({width:1,height:1},new Uint8Array(i.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new i.Texture(r,_,l.RGBA,{premultiply:!1}),v}setupElevationDraw(r,l,p){let _=this.painter.context,v=_.gl,E=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:i.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var T;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();let I=null,R=null,P=1;if(p&&p.morphing&&this._useVertexMorphing){let F=p.morphing.srcDemTile,G=p.morphing.dstDemTile;P=p.morphing.phase,F&&G&&(this._prepareDemTileUniforms(r,F,E,"_prev")&&(R=F),this._prepareDemTileUniforms(r,G,E)&&(I=G))}if(R&&I?(_.activeTexture.set(v.TEXTURE2),I.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),_.activeTexture.set(v.TEXTURE4),R.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),E.u_dem_lerp=P):(I=this.terrainTileForTile[r.tileID.key],_.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(r,I,E)?I.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),_.activeTexture.set(v.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&I){let F=(1<<I.tileID.canonical.z)*i.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=F}if(p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,E),this.painter.transform.projection.name==="globe"){let F=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(_,F)}}globeUniformValues(r,l,p){let _=r.projection;return{u_tile_tl_up:_.upVector(l,0,0),u_tile_tr_up:_.upVector(l,i.EXTENT,0),u_tile_br_up:_.upVector(l,i.EXTENT,i.EXTENT),u_tile_bl_up:_.upVector(l,0,i.EXTENT),u_tile_up_scale:p?i.globeMetersToEcef(1):_.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){let l=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,v,E,T,I){if(_.transform.projection.name==="globe")(function(R,P,F,G,W){let X=R.context,Z=X.gl,Y,N,q=R.options.showTerrainWireframe?2:0,Q=R.transform,te=i.globeUseCustomAntiAliasing(R,X,Q),he=(He,De)=>{if(N===He)return;let ze=[vo[He],"PROJECTION_GLOBE_VIEW"];te&&ze.push("CUSTOM_ANTIALIASING"),De&&ze.push(vo[q]),Y=R.useProgram("globeRaster",null,ze),N=He},fe=R.colorModeForRenderPass(),de=new i.DepthMode(Z.LEQUAL,i.DepthMode.ReadWrite,R.depthRangeFor3D);$i.update(W);let xe=i.calculateGlobeMercatorMatrix(Q),ye=[i.mercatorXfromLng(Q.center.lng),i.mercatorYfromLat(Q.center.lat)],Ie=q?[!1,!0]:[!1],qe=R.globeSharedBuffers,Ce=[Q.width*i.exported.devicePixelRatio,Q.height*i.exported.devicePixelRatio],Ve=Float32Array.from(Q.globeMatrix),Ae={useDenormalizedUpVectorScale:!0};if(Ie.forEach(He=>{let De=R.transform,ze=Xo(De.zoom)*P.exaggeration();N=-1;let Ye=He?Z.LINES:Z.TRIANGLES;for(let $e of G){let Je=F.getTile($e),vt=i.StencilMode.disabled,Rt=P.prevTerrainTileForTile[$e.key],mt=P.terrainTileForTile[$e.key];Zo(Rt,mt)&&$i.newMorphing($e.key,Rt,mt,W,250),X.activeTexture.set(Z.TEXTURE0),Je.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let Et=$i.getMorphValuesForProxy($e.key),Qt=Et?1:0;Et&&i.extend$1(Ae,{morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:i.easeCubicInOut(Et.phase)}});let Kt=i.tileCornersToBounds($e.canonical),_t=i.getLatitudinalLod(Kt.getCenter().lat),In=i.getGridMatrix($e.canonical,Kt,_t,De.worldSize/De._pixelsPerMercatorPixel),On=i.globeNormalizeECEF(i.globeTileBounds($e.canonical)),kn=Wo(De.projMatrix,Ve,xe,On,i.globeToMercatorTransition(De.zoom),ye,De.frustumCorners.TL,De.frustumCorners.TR,De.frustumCorners.BR,De.frustumCorners.BL,De.globeCenterInViewSpace,De.globeRadius,Ce,ze,In);if(he(Qt,He),P.setupElevationDraw(Je,Y,Ae),R.prepareDrawProgram(X,Y,$e.toUnwrapped()),qe){let[Ln,li,Vr]=He?qe.getWirefameBuffers(R.context,_t):qe.getGridBuffers(_t,ze!==0);Y.draw(X,Ye,de,vt,fe,i.CullFaceMode.backCCW,kn,"globe_raster",Ln,li,Vr)}}}),qe){let He=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&He.push("CUSTOM_ANTIALIASING"),Y=R.useProgram("globeRaster",null,He);for(let De of G){let{x:ze,y:Ye,z:$e}=De.canonical,Je=Ye===0,vt=Ye===(1<<$e)-1,[Rt,mt,Et,Qt]=qe.getPoleBuffers($e);if(Qt&&(Je||vt)){let Kt=F.getTile(De);X.activeTexture.set(Z.TEXTURE0),Kt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let _t=i.globePoleMatrixForTile($e,ze,Q),In=i.globeNormalizeECEF(i.globeTileBounds(De.canonical)),On=(kn,Ln)=>kn.draw(X,Z.TRIANGLES,de,i.StencilMode.disabled,fe,i.CullFaceMode.disabled,Wo(Q.projMatrix,_t,_t,In,0,ye,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,Ce,0),"globe_pole_raster",Ln,Et,Qt);P.setupElevationDraw(Kt,Y,Ae),R.prepareDrawProgram(X,Y,De.toUnwrapped()),Je&&On(Y,Rt),vt&&(_t=i.scale(i.create(),_t,[1,-1,1]),On(Y,mt))}}}})(_,v,E,T,I);else{let R=_.context,P=R.gl,F,G,W=_.options.showTerrainWireframe?2:0,X=(Q,te)=>{if(G===Q)return;let he=[vo[Q]];te&&he.push(vo[W]),F=_.useProgram("terrainRaster",null,he),G=Q},Z=_.colorModeForRenderPass(),Y=new i.DepthMode(P.LEQUAL,i.DepthMode.ReadWrite,_.depthRangeFor3D);$i.update(I);let N=_.transform,q=Xo(N.zoom)*v.exaggeration();(W?[!1,!0]:[!1]).forEach(Q=>{G=-1;let te=Q?P.LINES:P.TRIANGLES,[he,fe]=Q?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(let de of T){let xe=E.getTile(de),ye=i.StencilMode.disabled,Ie=v.prevTerrainTileForTile[de.key],qe=v.terrainTileForTile[de.key];Zo(Ie,qe)&&$i.newMorphing(de.key,Ie,qe,I,250),R.activeTexture.set(P.TEXTURE0),xe.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);let Ce=$i.getMorphValuesForProxy(de.key),Ve=Ce?1:0,Ae;Ce&&(Ae={morphing:{srcDemTile:Ce.from,dstDemTile:Ce.to,phase:i.easeCubicInOut(Ce.phase)}});let He=qo(de.projMatrix,hu(de.canonical,N.renderWorldCopies)?q/10:q);X(Ve,Q),v.setupElevationDraw(xe,F,Ae),_.prepareDrawProgram(R,F,de.toUnwrapped()),F.draw(R,te,Y,ye,Z,i.CullFaceMode.backCCW,He,"terrain_raster",v.gridBuffer,he,fe)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;let l=this.painter,p=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],E=this._drapedRenderBatches.shift(),T=[],I=l.style.order,R=0;for(let P of v){let F=_.getTileByID(P.proxyTileKey),G=_.proxyCachedFBO[P.key]?_.proxyCachedFBO[P.key][r]:void 0,W=G!==void 0?_.renderCache[G]:this.pool[R++],X=G!==void 0;if(F.texture=W.tex,X&&!W.dirty){T.push(F.tileID);continue}let Z;p.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(p.clear({color:i.Color.transparent,stencil:0}),W.dirty=!1);for(let Y=E.start;Y<=E.end;++Y){let N=l.style._layers[I[Y]];if(N.isHidden(l.transform.zoom))continue;let q=l.style._getLayerSourceCache(N),Q=q?this.proxyToSource[P.key][q.id]:[P];if(!Q)continue;let te=Q;p.viewport.set([0,0,W.fb.width,W.fb.height]),Z!==(q?q.id:null)&&(this._setupStencil(W,Q,N,q),Z=q?q.id:null),l.renderLayer(l,q,N,te)}this.renderedToTile?(W.dirty=!0,T.push(F.tileID)):X||--R,R===5&&(R=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),E.end+1}postRender(){}renderCacheEfficiency(r){let l=r.order.length;if(l===0)return{efficiency:100};let p,_=0,v=0,E=!1;for(let T=0;T<l;++T){let I=r._layers[r.order[T]];this._style.isLayerDraped(I)?(E&&++_,++v):E||(E=!0,p=I.id)}return v===0?{efficiency:100}:{efficiency:100*(1-_/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,l,p){if(!this._visibleDemTiles)return null;let _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{let E=v.tileID,T=1<<E.overscaledZ,{x:I,y:R}=E.canonical,P=I/T,F=(I+1)/T,G=R/T,W=(R+1)/T;return{minx:P,miny:G,maxx:F,maxy:W,t:v.dem.tree.raycastRoot(P,G,F,W,r,l,p),tile:v}});_.sort((v,E)=>(v.t!==null?v.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(let v of _){if(v.t==null)return null;let E=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,l,p);if(E!=null)return E}return null}_createFBO(){let r=this.painter.context,l=r.gl,p=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);let _=new i.Texture(r,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);let v=r.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(_.texture),v.depthAttachment=new me(r,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(let r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{let l=this._style._layers[r],p=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(let p of this._style._getSources())if(p instanceof it){r=!0;break}if(!r)return;let l={};for(let p=0;p<this._style.order.length;++p){let _=this._style._layers[this._style.order[p]],v=this._style._getLayerSourceCache(_);if(v&&!l[v.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof i.ZoomDependentExpression){l[v.id]=!0;for(let E of this.proxyCoords){let T=this.proxyToSource[E.key][v.id];if(T)for(let I of T)this._clearRenderCacheForTile(v.id,I)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(let p in this._style._sourceCaches)if(this._style._sourceCaches[p]._source instanceof Ze){r=!0;break}if(!r)return;let l={};for(let p=0;p<this._style.order.length;++p){let _=this._style._layers[this._style.order[p]],v=this._style._getLayerSourceCache(_);if(!v||l[v.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;let E=_.paint.get("raster-fade-duration");for(let T of this.proxyCoords){let I=this.proxyToSource[T.key][v.id];if(I)for(let R of I){let P=cc(v.getTile(R),v.findLoadedParent(R,0),v,this.painter.transform,E);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(v.id,R)}}}}_setupDrapedRenderBatches(){let r=this._style.order,l=r.length;if(l===0)return;let p=[],_,v=0,E=this._style._layers[r[v]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++v<l;)E=this._style._layers[r[v]];for(;v<l;++v){let T=this._style._layers[r[v]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?_===void 0&&(_=v):_!==void 0&&(p.push({start:_,end:v-1}),_=void 0))}_!==void 0&&p.push({start:_,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(r){let l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){let E=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let T=0;T<E.length;++T){let I=Object.values(E[T]);l.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();let p=this.proxyCoords,_=this._tilesDirty;for(let E=p.length-1;E>=0;E--){let T=p[E];if(l.getTileByID(T.key),l.proxyCachedFBO[T.key]!==void 0){let I=r[T.key],R=this.proxyToSource[T.key],P=0;for(let F in R){let G=R[F],W=I[F];if(!W||W.length!==G.length||G.some((X,Z)=>X!==W[Z]||_[F]&&_[F].hasOwnProperty(X.key))){P=-1;break}++P}for(let F in l.proxyCachedFBO[T.key])l.renderCache[l.proxyCachedFBO[T.key][F]].dirty=P<0||P!==Object.values(I).length}}let v=[...this._drapedRenderBatches];v.sort((E,T)=>T.end-T.start-(E.end-E.start));for(let E of v)for(let T of p){if(l.proxyCachedFBO[T.key])continue;let I=l.renderCachePool.pop();I===void 0&&l.renderCache.length<50&&(I=l.renderCache.length,l.renderCache.push(this._createFBO())),I!==void 0&&(l.proxyCachedFBO[T.key]={},l.proxyCachedFBO[T.key][E.start]=I,l.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let v=this.painter.context,E=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let T;if(p.isTileClipped())T=l.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):i.StencilMode.disabled}_renderTileClippingMasks(r,l){let p=this.painter,_=this.painter.context,v=_.gl;p._tileClippingMaskIDs={},_.setColorMode(i.ColorMode.disabled),_.setDepthMode(i.DepthMode.disabled);let E=p.useProgram("clippingMask");for(let T of r){let I=p._tileClippingMaskIDs[T.key]=--l;E.draw(_,v.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:v.ALWAYS,mask:0},I,255,v.KEEP,v.KEEP,v.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,Fa(T.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){let l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;let p=[r.x,r.y,1,1];i.transformMat4$1(p,p,l.pixelMatrixInverse),i.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;let _=l._camera.position,v=i.mercatorZfromAltitude(1,l.center.lat),E=[_[0],_[1],_[2]/v,0],T=i.subtract([],p.slice(0,3),E);i.normalize(T,T);let I=this.raycast(E,T,this._exaggeration);return I!==null&&I?(i.scaleAndAdd(E,E,T,I),E[3]=E[2],E[2]*=v,E):null}drawDepth(){let r=this.painter,l=r.context,p=this.proxySourceCache,_=Math.ceil(r.width),v=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let E=l.gl,T=l.createFramebuffer(_,v,!0);l.activeTexture.set(E.TEXTURE0);let I=new i.Texture(l,{width:_,height:v,data:null},E.RGBA);I.bind(E.NEAREST,E.CLAMP_TO_EDGE),T.colorAttachment.set(I.texture);let R=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,v);T.depthAttachment.set(R),this._depthFBO=T,this._depthTexture=I}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,v]),function(E,T,I,R){if(E.transform.projection.name==="globe")return;let P=E.context,F=P.gl;P.clear({depth:1});let G=E.useProgram("terrainDepth"),W=new i.DepthMode(F.LESS,i.DepthMode.ReadWrite,E.depthRangeFor3D);for(let X of R){let Z=I.getTile(X),Y=qo(X.projMatrix,0);T.setupElevationDraw(Z,G),G.draw(P,F.TRIANGLES,W,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.backCCW,Y,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,p){if(r.getSource()instanceof St)return this._setupProxiedCoordsForImageSource(r,l,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};let _=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let T=0;T<v.length;T++){let I=v[T],R=this._findTileCoveringTileID(I,r);if(R){let P=this._createProxiedId(I,R,p[I.key]&&p[I.key][r.id]);_.push(P),this.proxyToSource[I.key][r.id]=[P]}}let E=!1;for(let T=0;T<l.length;T++){let I=r.getTile(l[T]);if(!I||!I.hasData())continue;let R=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==I.tileID.canonical.z){let P=this.proxyToSource[R.tileID.key][r.id],F=this._createProxiedId(R.tileID,I,p[R.tileID.key]&&p[R.tileID.key][r.id]);P?P.splice(P.length-1,0,F):this.proxyToSource[R.tileID.key][r.id]=[F],_.push(F),E=!0}}this._sourceTilesOverlap[r.id]=E}_setupProxiedCoordsForImageSource(r,l,p){if(!r.getSource().loaded())return;let _=this.proxiedCoords[r.id]=[],v=this.proxyCoords,E=r.getSource(),T=new i.Point(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),I=E.coordinates.map(i.MercatorCoordinate.fromLngLat).reduce((P,F)=>(P.min.x=Math.min(P.min.x,F.x-T.x),P.min.y=Math.min(P.min.y,F.y-T.y),P.max.x=Math.max(P.max.x,F.x-T.x),P.max.y=Math.max(P.max.y,F.y-T.y),P),{min:new i.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(P,F)=>{let G=P.wrap+P.canonical.x/(1<<P.canonical.z),W=P.canonical.y/(1<<P.canonical.z),X=i.EXTENT/(1<<P.canonical.z),Z=F.wrap+F.canonical.x/(1<<F.canonical.z),Y=F.canonical.y/(1<<F.canonical.z);return G+X<Z+I.min.x||G>Z+I.max.x||W+X<Y+I.min.y||W>Y+I.max.y};for(let P=0;P<v.length;P++){let F=v[P];for(let G=0;G<l.length;G++){let W=r.getTile(l[G]);if(!W||!W.hasData()||R(F,W.tileID))continue;let X=this._createProxiedId(F,W,p[F.key]&&p[F.key][r.id]),Z=this.proxyToSource[F.key][r.id];Z?Z.push(X):this.proxyToSource[F.key][r.id]=[X],_.push(X)}}}_createProxiedId(r,l,p){let _=this.orthoMatrix;if(p){let v=p.find(E=>E.key===l.tileID.key);if(v)return v}if(l.tileID.key!==r.key){let v=r.canonical.z-l.tileID.canonical.z,E,T,I;_=i.create();let R=l.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(E=i.EXTENT>>v,T=E*((l.tileID.canonical.x<<v)-r.canonical.x+R),I=E*((l.tileID.canonical.y<<v)-r.canonical.y)):(E=i.EXTENT<<-v,T=i.EXTENT*(l.tileID.canonical.x-(r.canonical.x+R<<-v)),I=i.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-v))),i.ortho(_,0,E,0,E,0,1),i.translate(_,_,[T,I,0])}return new Na(l.tileID,r.key,_)}_findTileCoveringTileID(r,l){let p=l.getTile(r);if(p&&p.hasData())return p;let _=this._findCoveringTileCache[l.id],v=_[r.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||v===null)return p;let E=p?p.tileID:r,T=E.overscaledZ,I=l.getSource().minzoom,R=[];if(!v){let F=l.getSource().maxzoom;if(r.canonical.z>=F){let G=r.canonical.z-F;l.getSource().reparseOverscaled?(T=Math.max(r.canonical.z+2,l.transform.tileZoom),E=new i.OverscaledTileID(T,r.wrap,F,r.canonical.x>>G,r.canonical.y>>G)):G!==0&&(T=F,E=new i.OverscaledTileID(T,r.wrap,F,r.canonical.x>>G,r.canonical.y>>G))}E.key!==r.key&&(R.push(E.key),p=l.getTile(E))}let P=F=>{R.forEach(G=>{_[G]=F}),R.length=0};for(T-=1;T>=I&&(!p||!p.hasData());T--){p&&P(p.tileID.key);let F=E.calculateScaledKey(T);if(p=l.getTileByID(F),p&&p.hasData())break;let G=_[F];if(G===null)break;G===void 0?R.push(F):p=l.getTileByID(G)}return P(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){let r=function(l){let p=0,_=new i.StructArrayLayout2ui4,v=131;for(let E=1;E<129;E++){for(let T=1;T<129;T++)p=E*v+T,_.emplaceBack(p,p+1),_.emplaceBack(p,p+v),_.emplaceBack(p+1,p+v),E===128&&_.emplaceBack(p+v,p+v+1);_.emplaceBack(p+1,p+1+v)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=i.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Xt{static cacheKey(r,l,p,_){let v=`${l}${_?_.cacheKey:""}`;for(let E of p)r.usedDefines.includes(E)&&(v+=`/${E}`);return v}constructor(r,l,p,_,v,E){let T=r.gl;this.program=T.createProgram();let I=function(N){let q=[];for(let Q=0;Q<N.length;Q++){if(N[Q]===null)continue;let te=N[Q].split(" ");q.push(te.pop())}return q}(p.staticAttributes),R=_?_.getBinderAttributes():[],P=I.concat(R),F=_?_.defines():[];F=F.concat(E.map(N=>`#define ${N}`));let G=r.isWebGL2?`#version 300 es
`:"",W=G+F.concat(r.extStandardDerivatives&&G.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(sc):sc,sc,La,oc.fragmentSource,xs.fragmentSource,p.fragmentSource).join(`
`),X=G+F.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,La,oc.vertexSource,xs.vertexSource,na.vertexSource,p.vertexSource).join(`
`),Z=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(Z,W),T.compileShader(Z),T.attachShader(this.program,Z);let Y=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Y,X),T.compileShader(Y),T.attachShader(this.program,Y),this.attributes={},this.numAttributes=P.length;for(let N=0;N<this.numAttributes;N++)P[N]&&(T.bindAttribLocation(this.program,N,P[N]),this.attributes[P[N]]=N);T.linkProgram(this.program),T.deleteShader(Y),T.deleteShader(Z),this.fixedUniforms=v(r),this.binderUniforms=_?_.getUniforms(r):[],E.includes("TERRAIN")&&(this.terrainUniforms=(N=>({u_dem:new i.Uniform1i(N),u_dem_prev:new i.Uniform1i(N),u_dem_unpack:new i.Uniform4f(N),u_dem_tl:new i.Uniform2f(N),u_dem_scale:new i.Uniform1f(N),u_dem_tl_prev:new i.Uniform2f(N),u_dem_scale_prev:new i.Uniform1f(N),u_dem_size:new i.Uniform1f(N),u_dem_lerp:new i.Uniform1f(N),u_exaggeration:new i.Uniform1f(N),u_depth:new i.Uniform1i(N),u_depth_size_inv:new i.Uniform2f(N),u_meter_to_dem:new i.Uniform1f(N),u_label_plane_matrix_inv:new i.UniformMatrix4f(N)}))(r)),E.includes("GLOBE")&&(this.globeUniforms=(N=>({u_tile_tl_up:new i.Uniform3f(N),u_tile_tr_up:new i.Uniform3f(N),u_tile_br_up:new i.Uniform3f(N),u_tile_bl_up:new i.Uniform3f(N),u_tile_up_scale:new i.Uniform1f(N)}))(r)),E.includes("FOG")&&(this.fogUniforms=(N=>({u_fog_matrix:new i.UniformMatrix4f(N),u_fog_range:new i.Uniform2f(N),u_fog_color:new i.Uniform4f(N),u_fog_horizon_blend:new i.Uniform1f(N),u_fog_temporal_offset:new i.Uniform1f(N),u_frustum_tl:new i.Uniform3f(N),u_frustum_tr:new i.Uniform3f(N),u_frustum_br:new i.Uniform3f(N),u_frustum_bl:new i.Uniform3f(N),u_globe_pos:new i.Uniform3f(N),u_globe_radius:new i.Uniform1f(N),u_globe_transition:new i.Uniform1f(N),u_is_globe:new i.Uniform1i(N),u_viewport:new i.Uniform2f(N)}))(r))}}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;let p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;let p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;let p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let _ in l)p[_].set(this.program,_,l[_])}}draw(r,l,p,_,v,E,T,I,R,P,F,G,W,X,Z){let Y=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(_),r.setColorMode(v),r.setCullFace(E);for(let q of Object.keys(this.fixedUniforms))this.fixedUniforms[q].set(this.program,q,T[q]);X&&X.setUniforms(this.program,r,this.binderUniforms,G,{zoom:W});let N={[Y.LINES]:2,[Y.TRIANGLES]:3,[Y.LINE_STRIP]:1}[l];for(let q of F.get()){let Q=q.vaos||(q.vaos={});(Q[I]||(Q[I]=new cu)).bind(r,this,R,X?X.getPaintVertexBuffers():[],P,q.vertexOffset,Z||[]),Y.drawElements(l,q.primitiveLength*N,Y.UNSIGNED_SHORT,q.primitiveOffset*N*2)}}}function pi(d,r){let l=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,d.transform.tileZoom)/l,_=p*(r.tileID.canonical.x+r.tileID.wrap*l),v=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/gr(r,1,d.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v]}}let Yo=i.create(),ra=(d,r,l,p,_,v,E,T,I,R,P)=>{let F=r.style.light,G=F.properties.get("position"),W=[G.x,G.y,G.z],X=i.create$1();F.properties.get("anchor")==="viewport"&&(i.fromRotation(X,-r.transform.angle),i.transformMat3(W,W,X));let Z=F.properties.get("color"),Y=r.transform,N={u_matrix:d,u_lightpos:W,u_lightintensity:F.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yo,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:v};return Y.projection.name==="globe"&&(N.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],N.u_zoom_transition=I,N.u_inv_rot_matrix=P,N.u_merc_center=R,N.u_up_dir=Y.projection.upVector(new i.CanonicalTileID(0,0,0),R[0]*i.EXTENT,R[1]*i.EXTENT),N.u_height_lift=T),N},xo=(d,r,l,p,_,v,E,T,I,R,P,F)=>{let G=ra(d,r,l,p,_,v,E,I,R,P,F),W={u_height_factor:-Math.pow(2,E.overscaledZ)/T.tileSize/8};return i.extend(G,pi(r,T),W)},bs=d=>({u_matrix:d}),ia=(d,r,l)=>i.extend(bs(d),pi(r,l)),Ba=(d,r)=>({u_matrix:d,u_world:r}),du=(d,r,l,p)=>i.extend(ia(d,r,l),{u_world:p}),fu=i.create(),hc=(d,r,l,p,_,v)=>{let E=d.transform,T=E.projection.name==="globe",I;if(v.paint.get("circle-pitch-alignment")==="map")if(T){let P=i.globePixelsToTileUnits(E.zoom,r.canonical)*E._pixelsPerMercatorPixel;I=Float32Array.from([P,0,0,P])}else I=E.calculatePixelsToTileUnitsMatrix(l);else I=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);let R={u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:d.translatePosMatrix(r.projMatrix,l,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:i.exported.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:fu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){R.u_inv_rot_matrix=p,R.u_merc_center=_,R.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],R.u_zoom_transition=i.globeToMercatorTransition(E.zoom);let P=_[0]*i.EXTENT,F=_[1]*i.EXTENT;R.u_up_dir=E.projection.upVector(new i.CanonicalTileID(0,0,0),P,F)}return R},dc=d=>{let r=[];return d.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},yl=(d,r,l,p)=>{let _=i.EXTENT/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},Va=(d,r,l=1)=>({u_matrix:d,u_color:r,u_overlay:0,u_overlay_scale:l}),ja=i.create(),ws=(d,r,l,p,_,v,E)=>{let T=d.transform,I=T.projection.name==="globe",R=I?i.globePixelsToTileUnits(T.zoom,r.canonical)*T._pixelsPerMercatorPixel:gr(l,1,v),P={u_matrix:r.projMatrix,u_extrude_scale:R,u_intensity:E,u_inv_rot_matrix:ja,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){P.u_inv_rot_matrix=p,P.u_merc_center=_,P.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],P.u_zoom_transition=i.globeToMercatorTransition(T.zoom);let F=_[0]*i.EXTENT,G=_[1]*i.EXTENT;P.u_up_dir=T.projection.upVector(new i.CanonicalTileID(0,0,0),F,G)}return P},jh=(d,r,l,p,_,v,E)=>{let T=d.transform,I=T.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:bo(d,r,l,p),u_pixels_to_tile_units:I,u_device_pixel_ratio:v,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:sa(l)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:oa(r,d.transform),u_alpha_discard_threshold:0,u_trim_offset:E}},Ti=(d,r,l,p,_)=>{let v=d.transform;return{u_matrix:bo(d,r,l,p),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:oa(r,v),u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function oa(d,r){return 1/gr(d,1,r.tileZoom)}function bo(d,r,l,p){return d.translatePosMatrix(p||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function sa(d){let r=d.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}let fc=(d,r,l,p,_,v)=>{return{u_matrix:d,u_tl_parent:r,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(T=_.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(E=_.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:mi(_.paint.get("raster-hue-rotate")),u_perspective_transform:v};var E,T};function mi(d){d*=Math.PI/180;let r=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}let aa=i.create(),vl=(d,r,l,p,_,v,E,T,I,R,P,F,G,W,X,Z)=>{let Y=_.transform,N={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Y.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:Y.width/Y.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:T,u_is_text:+I,u_pitch_with_map:+p,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:aa,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:aa,u_up_vector:[0,-1,0]};return Z.name==="globe"&&(N.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],N.u_zoom_transition=F,N.u_inv_rot_matrix=W,N.u_merc_center=G,N.u_camera_forward=Y._camera.forward(),N.u_ecef_origin=i.globeECEFOrigin(Y.globeMatrix,P.toUnwrapped()),N.u_tile_matrix=Float32Array.from(Y.globeMatrix),N.u_up_vector=X),N},Ua=(d,r,l,p,_,v,E,T,I,R,P,F,G,W,X,Z,Y)=>i.extend(vl(d,r,l,p,_,v,E,T,I,R,F,G,W,X,Z,Y),{u_gamma_scale:p?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:i.exported.devicePixelRatio,u_is_halo:+P}),pc=(d,r,l,p,_,v,E,T,I,R,P,F,G,W,X,Z)=>i.extend(Ua(d,r,l,p,_,v,E,T,!0,I,!0,P,F,G,W,X,Z),{u_texsize_icon:R,u_texture_icon:1}),Es=(d,r,l)=>({u_matrix:d,u_opacity:r,u_color:l}),pu=(d,r,l,p,_)=>i.extend(function(v,E,T){let I=E.imageManager.getPattern(v.toString()),{width:R,height:P}=E.imageManager.getPixelSize(),F=Math.pow(2,T.tileID.overscaledZ),G=T.tileSize*Math.pow(2,E.transform.tileZoom)/F,W=G*(T.tileID.canonical.x+T.tileID.wrap*F),X=G*T.tileID.canonical.y;return{u_image:0,u_pattern_tl:I.tl,u_pattern_br:I.br,u_texsize:[R,P],u_pattern_size:I.displaySize,u_tile_units_to_pixels:1/gr(T,1,E.transform.tileZoom),u_pixel_coord_upper:[W>>16,X>>16],u_pixel_coord_lower:[65535&W,65535&X]}}(p,l,_),{u_matrix:d,u_opacity:r}),mc={fillExtrusion:d=>({u_matrix:new i.UniformMatrix4f(d),u_lightpos:new i.Uniform3f(d),u_lightintensity:new i.Uniform1f(d),u_lightcolor:new i.Uniform3f(d),u_vertical_gradient:new i.Uniform1f(d),u_opacity:new i.Uniform1f(d),u_edge_radius:new i.Uniform1f(d),u_ao:new i.Uniform2f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_up_dir:new i.Uniform3f(d),u_height_lift:new i.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new i.UniformMatrix4f(d),u_lightpos:new i.Uniform3f(d),u_lightintensity:new i.Uniform1f(d),u_lightcolor:new i.Uniform3f(d),u_vertical_gradient:new i.Uniform1f(d),u_height_factor:new i.Uniform1f(d),u_edge_radius:new i.Uniform1f(d),u_ao:new i.Uniform2f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_up_dir:new i.Uniform3f(d),u_height_lift:new i.Uniform1f(d),u_image:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_pixel_coord_upper:new i.Uniform2f(d),u_pixel_coord_lower:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d),u_opacity:new i.Uniform1f(d)}),fill:d=>({u_matrix:new i.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new i.UniformMatrix4f(d),u_image:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_pixel_coord_upper:new i.Uniform2f(d),u_pixel_coord_lower:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d)}),fillOutline:d=>({u_matrix:new i.UniformMatrix4f(d),u_world:new i.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new i.UniformMatrix4f(d),u_world:new i.Uniform2f(d),u_image:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_pixel_coord_upper:new i.Uniform2f(d),u_pixel_coord_lower:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new i.Uniform1f(d),u_extrude_scale:new i.UniformMatrix2f(d),u_device_pixel_ratio:new i.Uniform1f(d),u_matrix:new i.UniformMatrix4f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_up_dir:new i.Uniform3f(d)}),collisionBox:d=>({u_matrix:new i.UniformMatrix4f(d),u_camera_to_center_distance:new i.Uniform1f(d),u_extrude_scale:new i.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new i.UniformMatrix4f(d),u_inv_matrix:new i.UniformMatrix4f(d),u_camera_to_center_distance:new i.Uniform1f(d),u_viewport_size:new i.Uniform2f(d)}),debug:d=>({u_color:new i.UniformColor(d),u_matrix:new i.UniformMatrix4f(d),u_overlay:new i.Uniform1i(d),u_overlay_scale:new i.Uniform1f(d)}),clippingMask:d=>({u_matrix:new i.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new i.Uniform1f(d),u_intensity:new i.Uniform1f(d),u_matrix:new i.UniformMatrix4f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_up_dir:new i.Uniform3f(d)}),heatmapTexture:d=>({u_image:new i.Uniform1i(d),u_color_ramp:new i.Uniform1i(d),u_opacity:new i.Uniform1f(d)}),hillshade:d=>({u_matrix:new i.UniformMatrix4f(d),u_image:new i.Uniform1i(d),u_latrange:new i.Uniform2f(d),u_light:new i.Uniform2f(d),u_shadow:new i.UniformColor(d),u_highlight:new i.UniformColor(d),u_accent:new i.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new i.UniformMatrix4f(d),u_image:new i.Uniform1i(d),u_dimension:new i.Uniform2f(d),u_zoom:new i.Uniform1f(d),u_unpack:new i.Uniform4f(d)}),line:d=>({u_matrix:new i.UniformMatrix4f(d),u_pixels_to_tile_units:new i.UniformMatrix2f(d),u_device_pixel_ratio:new i.Uniform1f(d),u_units_to_pixels:new i.Uniform2f(d),u_dash_image:new i.Uniform1i(d),u_gradient_image:new i.Uniform1i(d),u_image_height:new i.Uniform1f(d),u_texsize:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d),u_alpha_discard_threshold:new i.Uniform1f(d),u_trim_offset:new i.Uniform2f(d)}),linePattern:d=>({u_matrix:new i.UniformMatrix4f(d),u_texsize:new i.Uniform2f(d),u_pixels_to_tile_units:new i.UniformMatrix2f(d),u_device_pixel_ratio:new i.Uniform1f(d),u_image:new i.Uniform1i(d),u_units_to_pixels:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d),u_alpha_discard_threshold:new i.Uniform1f(d)}),raster:d=>({u_matrix:new i.UniformMatrix4f(d),u_tl_parent:new i.Uniform2f(d),u_scale_parent:new i.Uniform1f(d),u_fade_t:new i.Uniform1f(d),u_opacity:new i.Uniform1f(d),u_image0:new i.Uniform1i(d),u_image1:new i.Uniform1i(d),u_brightness_low:new i.Uniform1f(d),u_brightness_high:new i.Uniform1f(d),u_saturation_factor:new i.Uniform1f(d),u_contrast_factor:new i.Uniform1f(d),u_spin_weights:new i.Uniform3f(d),u_perspective_transform:new i.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new i.Uniform1i(d),u_is_size_feature_constant:new i.Uniform1i(d),u_size_t:new i.Uniform1f(d),u_size:new i.Uniform1f(d),u_camera_to_center_distance:new i.Uniform1f(d),u_rotate_symbol:new i.Uniform1i(d),u_aspect_ratio:new i.Uniform1f(d),u_fade_change:new i.Uniform1f(d),u_matrix:new i.UniformMatrix4f(d),u_label_plane_matrix:new i.UniformMatrix4f(d),u_coord_matrix:new i.UniformMatrix4f(d),u_is_text:new i.Uniform1i(d),u_pitch_with_map:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_camera_forward:new i.Uniform3f(d),u_tile_matrix:new i.UniformMatrix4f(d),u_up_vector:new i.Uniform3f(d),u_ecef_origin:new i.Uniform3f(d),u_texture:new i.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new i.Uniform1i(d),u_is_size_feature_constant:new i.Uniform1i(d),u_size_t:new i.Uniform1f(d),u_size:new i.Uniform1f(d),u_camera_to_center_distance:new i.Uniform1f(d),u_rotate_symbol:new i.Uniform1i(d),u_aspect_ratio:new i.Uniform1f(d),u_fade_change:new i.Uniform1f(d),u_matrix:new i.UniformMatrix4f(d),u_label_plane_matrix:new i.UniformMatrix4f(d),u_coord_matrix:new i.UniformMatrix4f(d),u_is_text:new i.Uniform1i(d),u_pitch_with_map:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_texture:new i.Uniform1i(d),u_gamma_scale:new i.Uniform1f(d),u_device_pixel_ratio:new i.Uniform1f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_camera_forward:new i.Uniform3f(d),u_tile_matrix:new i.UniformMatrix4f(d),u_up_vector:new i.Uniform3f(d),u_ecef_origin:new i.Uniform3f(d),u_is_halo:new i.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new i.Uniform1i(d),u_is_size_feature_constant:new i.Uniform1i(d),u_size_t:new i.Uniform1f(d),u_size:new i.Uniform1f(d),u_camera_to_center_distance:new i.Uniform1f(d),u_rotate_symbol:new i.Uniform1i(d),u_aspect_ratio:new i.Uniform1f(d),u_fade_change:new i.Uniform1f(d),u_matrix:new i.UniformMatrix4f(d),u_label_plane_matrix:new i.UniformMatrix4f(d),u_coord_matrix:new i.UniformMatrix4f(d),u_is_text:new i.Uniform1i(d),u_pitch_with_map:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_texsize_icon:new i.Uniform2f(d),u_texture:new i.Uniform1i(d),u_texture_icon:new i.Uniform1i(d),u_gamma_scale:new i.Uniform1f(d),u_device_pixel_ratio:new i.Uniform1f(d),u_is_halo:new i.Uniform1i(d)}),background:d=>({u_matrix:new i.UniformMatrix4f(d),u_opacity:new i.Uniform1f(d),u_color:new i.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new i.UniformMatrix4f(d),u_opacity:new i.Uniform1f(d),u_image:new i.Uniform1i(d),u_pattern_tl:new i.Uniform2f(d),u_pattern_br:new i.Uniform2f(d),u_texsize:new i.Uniform2f(d),u_pattern_size:new i.Uniform2f(d),u_pixel_coord_upper:new i.Uniform2f(d),u_pixel_coord_lower:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d)}),terrainRaster:lc,terrainDepth:lc,skybox:d=>({u_matrix:new i.UniformMatrix4f(d),u_sun_direction:new i.Uniform3f(d),u_cubemap:new i.Uniform1i(d),u_opacity:new i.Uniform1f(d),u_temporal_offset:new i.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new i.UniformMatrix4f(d),u_color_ramp:new i.Uniform1i(d),u_center_direction:new i.Uniform3f(d),u_radius:new i.Uniform1f(d),u_opacity:new i.Uniform1f(d),u_temporal_offset:new i.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new i.UniformMatrix3f(d),u_sun_direction:new i.Uniform3f(d),u_sun_intensity:new i.Uniform1f(d),u_color_tint_r:new i.Uniform4f(d),u_color_tint_m:new i.Uniform4f(d),u_luminance:new i.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new i.UniformMatrix4f(d),u_globe_matrix:new i.UniformMatrix4f(d),u_normalize_matrix:new i.UniformMatrix4f(d),u_merc_matrix:new i.UniformMatrix4f(d),u_zoom_transition:new i.Uniform1f(d),u_merc_center:new i.Uniform2f(d),u_image0:new i.Uniform1i(d),u_grid_matrix:new i.UniformMatrix3f(d),u_skirt_height:new i.Uniform1f(d),u_frustum_tl:new i.Uniform3f(d),u_frustum_tr:new i.Uniform3f(d),u_frustum_br:new i.Uniform3f(d),u_frustum_bl:new i.Uniform3f(d),u_globe_pos:new i.Uniform3f(d),u_globe_radius:new i.Uniform1f(d),u_viewport:new i.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new i.Uniform3f(d),u_frustum_tr:new i.Uniform3f(d),u_frustum_br:new i.Uniform3f(d),u_frustum_bl:new i.Uniform3f(d),u_horizon:new i.Uniform1f(d),u_transition:new i.Uniform1f(d),u_fadeout_range:new i.Uniform1f(d),u_color:new i.Uniform4f(d),u_high_color:new i.Uniform4f(d),u_space_color:new i.Uniform4f(d),u_star_intensity:new i.Uniform1f(d),u_star_density:new i.Uniform1f(d),u_star_size:new i.Uniform1f(d),u_temporal_offset:new i.Uniform1f(d),u_horizon_angle:new i.Uniform1f(d),u_rotation_matrix:new i.UniformMatrix4f(d)})},be;function Le(d,r,l,p,_,v,E){let T=d.context,I=T.gl,R=d.transform,P=d.useProgram("collisionBox"),F=[],G=0,W=0;for(let te=0;te<p.length;te++){let he=p[te],fe=r.getTile(he),de=fe.getBucket(l);if(!de)continue;let xe=ne(he,de,R),ye=xe;_[0]===0&&_[1]===0||(ye=d.translatePosMatrix(xe,fe,_,v));let Ie=E?de.textCollisionBox:de.iconCollisionBox,qe=de.collisionCircleArray;if(qe.length>0){let Ce=i.create(),Ve=ye;i.mul(Ce,de.placementInvProjMatrix,R.glCoordMatrix),i.mul(Ce,Ce,de.placementViewportMatrix),F.push({circleArray:qe,circleOffset:W,transform:Ve,invTransform:Ce,projection:de.getProjection()}),G+=qe.length/4,W=G}Ie&&(d.terrain&&d.terrain.setupElevationDraw(fe,P),P.draw(T,I.LINES,i.DepthMode.disabled,i.StencilMode.disabled,d.colorModeForRenderPass(),i.CullFaceMode.disabled,yl(ye,R,fe,de.getProjection()),l.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,R.zoom,null,[Ie.collisionVertexBuffer,Ie.collisionVertexBufferExt]))}if(!E||!F.length)return;let X=d.useProgram("collisionCircle"),Z=new i.StructArrayLayout2f1f2i16;Z.resize(4*G),Z._trim();let Y=0;for(let te of F)for(let he=0;he<te.circleArray.length/4;he++){let fe=4*he,de=te.circleArray[fe+0],xe=te.circleArray[fe+1],ye=te.circleArray[fe+2],Ie=te.circleArray[fe+3];Z.emplace(Y++,de,xe,ye,Ie,0),Z.emplace(Y++,de,xe,ye,Ie,1),Z.emplace(Y++,de,xe,ye,Ie,2),Z.emplace(Y++,de,xe,ye,Ie,3)}(!be||be.length<2*G)&&(be=function(te){let he=2*te,fe=new i.StructArrayLayout3ui6;fe.resize(he),fe._trim();for(let de=0;de<he;de++){let xe=6*de;fe.uint16[xe+0]=4*de+0,fe.uint16[xe+1]=4*de+1,fe.uint16[xe+2]=4*de+2,fe.uint16[xe+3]=4*de+2,fe.uint16[xe+4]=4*de+3,fe.uint16[xe+5]=4*de+0}return fe}(G));let N=T.createIndexBuffer(be,!0),q=T.createVertexBuffer(Z,i.collisionCircleLayout.members,!0);for(let te of F){let he={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(Q=R).getCameraToCenterDistance(te.projection),u_viewport_size:[Q.width,Q.height]};X.draw(T,I.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,d.colorModeForRenderPass(),i.CullFaceMode.disabled,he,l.id,q,N,i.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,R.zoom)}var Q;q.destroy(),N.destroy()}let ut=i.create();function wt({width:d,height:r,anchor:l,textOffset:p,textScale:_},v){let{horizontalAlign:E,verticalAlign:T}=i.getAnchorAlignment(l),I=-(E-.5)*d,R=-(T-.5)*r,P=i.evaluateVariableOffset(l,p);return new i.Point((I/_+P[0])*v,(R/_+P[1])*v)}function Qn(d,r,l,p,_,v,E,T,I,R,P){let F=d.text.placedSymbolArray,G=d.text.dynamicLayoutVertexArray,W=d.icon.dynamicLayoutVertexArray,X={},Z=d.getProjection(),Y=ae(T,Z,v),N=v.elevation,q=Z.upVectorScale(T.canonical,v.center.lat,v.worldSize).metersToTile;G.clear();for(let Q=0;Q<F.length;Q++){let te=F.get(Q),{tileAnchorX:he,tileAnchorY:fe,numGlyphs:de}=te,xe=te.hidden||!te.crossTileID||d.allowVerticalPlacement&&!te.placedOrientation?null:p[te.crossTileID];if(xe){let ye=0,Ie=0,qe=0;if(N){let Je=N?N.getAtTileOffset(T,he,fe):0,[vt,Rt,mt]=Z.upVector(T.canonical,he,fe);ye=Je*vt*q,Ie=Je*Rt*q,qe=Je*mt*q}let[Ce,Ve,Ae,He]=Er(te.projectedAnchorX+ye,te.projectedAnchorY+Ie,te.projectedAnchorZ+qe,l?Y:E),De=lu(v.getCameraToCenterDistance(Z),He),ze=_.evaluateSizeForFeature(d.textSizeData,R,te)*De/i.ONE_EM;l&&(ze*=d.tilePixelRatio/I);let Ye=wt(xe,ze);l?({x:Ce,y:Ve,z:Ae}=Z.projectTilePoint(he+Ye.x,fe+Ye.y,T.canonical),[Ce,Ve,Ae]=Er(Ce+ye,Ve+Ie,Ae+qe,E)):(r&&Ye._rotate(-v.angle),Ce+=Ye.x,Ve+=Ye.y,Ae=0);let $e=d.allowVerticalPlacement&&te.placedOrientation===i.WritingMode.vertical?Math.PI/2:0;for(let Je=0;Je<de;Je++)i.addDynamicAttributes(G,Ce,Ve,Ae,$e);P&&te.associatedIconIndex>=0&&(X[te.associatedIconIndex]={x:Ce,y:Ve,z:Ae,angle:$e})}else Vi(de,G)}if(P){W.clear();let Q=d.icon.placedSymbolArray;for(let te=0;te<Q.length;te++){let he=Q.get(te),{numGlyphs:fe}=he,de=X[te];if(he.hidden||!de)Vi(fe,W);else{let{x:xe,y:ye,z:Ie,angle:qe}=de;for(let Ce=0;Ce<fe;Ce++)i.addDynamicAttributes(W,xe,ye,Ie,qe)}}d.icon.dynamicLayoutVertexBuffer.updateData(W)}d.text.dynamicLayoutVertexBuffer.updateData(G)}function rn(d,r,l){return l.iconsInText&&r?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function sr(d,r,l,p,_,v,E,T,I,R,P,F){let G=d.context,W=G.gl,X=d.transform,Z=T==="map",Y=I==="map",N=Z&&l.layout.get("symbol-placement")!=="point",q=Z&&!Y&&!N,Q=l.layout.get("symbol-sort-key").constantOr(1)!==void 0,te=!1,he=d.depthModeForSublayer(0,i.DepthMode.ReadOnly),fe=[i.mercatorXfromLng(X.center.lng),i.mercatorYfromLat(X.center.lat)],de=l.layout.get("text-variable-anchor"),xe=X.projection.name==="globe",ye=[],Ie=[0,-1,0],qe=Ie;!xe&&!X.mercatorFromTransition||Z||(qe=function(Ce){let Ve=Ce._camera.getWorldToCamera(Ce.worldSize,1),Ae=i.multiply([],Ve,Ce.globeMatrix);i.invert(Ae,Ae);let He=[0,0,0],De=[0,1,0,0];return i.transformMat4$1(De,De,Ae),He[0]=De[0],He[1]=De[1],He[2]=De[2],i.normalize(He,He),He}(X));for(let Ce of p){let Ve=r.getTile(Ce),Ae=Ve.getBucket(l);if(!Ae||Ae.projection.name==="mercator"&&xe)continue;let He=_?Ae.text:Ae.icon;if(!He||Ae.fullyClipped||!He.segments.get().length)continue;let De=He.programConfigurations.get(l.id),ze=_||Ae.sdfIcons,Ye=_?Ae.textSizeData:Ae.iconSizeData,$e=Y||X.pitch!==0,Je=i.evaluateSizeForZoom(Ye,X.zoom),vt,Rt,mt,Et,Qt=[0,0],Kt=null;if(_)Rt=Ve.glyphAtlasTexture,mt=W.LINEAR,vt=Ve.glyphAtlasTexture.size,Ae.iconsInText&&(Qt=Ve.imageAtlasTexture.size,Kt=Ve.imageAtlasTexture,Et=$e||d.options.rotating||d.options.zooming||Ye.kind==="composite"||Ye.kind==="camera"?W.LINEAR:W.NEAREST);else{let Ms=l.layout.get("icon-size").constantOr(0)!==1||Ae.iconsNeedLinear;Rt=Ve.imageAtlasTexture,mt=ze||d.options.rotating||d.options.zooming||Ms||$e?W.LINEAR:W.NEAREST,vt=Ve.imageAtlasTexture.size}let _t=Ae.projection.name==="globe",In=_t?qe:Ie,On=_t?i.globeToMercatorTransition(X.zoom):0,kn=ae(Ce,Ae.getProjection(),X),Ln=X.calculatePixelsToTileUnitsMatrix(Ve),li=Oe(kn,Ve.tileID.canonical,Y,Z,X,Ae.getProjection(),Ln),Vr=d.terrain&&Y&&N?i.invert(i.create(),li):ut,to=$n(kn,Ve.tileID.canonical,Y,Z,X,Ae.getProjection(),Ln),ts=de&&Ae.hasTextData(),ir=l.layout.get("icon-text-fit")!=="none"&&ts&&Ae.hasIconData();if(N){let Ms=X.elevation,ua=Ms?Ms.getAtTileOffsetFunc(Ce,X.center.lat,X.worldSize,Ae.getProjection()):null,Wa=Hr(kn,Ve.tileID.canonical,Y,Z,X,Ae.getProjection(),Ln);tc(Ae,kn,d,_,Wa,to,Y,R,ua,Ce)}let Fn=N||_&&de||ir,yn=d.translatePosMatrix(kn,Ve,v,E),Cr=Fn?ut:li,gi=d.translatePosMatrix(to,Ve,v,E,!0),er=Ae.getProjection().createInversionMatrix(X,Ce.canonical),Si=[];d.terrainRenderModeElevated()&&Y&&Si.push("PITCH_WITH_MAP_TERRAIN"),_t&&Si.push("PROJECTION_GLOBE_VIEW"),Fn&&Si.push("PROJECTED_POS_ON_VIEWPORT");let Cu=ze&&l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0,qa;qa=ze?Ae.iconsInText?pc(Ye.kind,Je,q,Y,d,yn,Cr,gi,vt,Qt,Ce,On,fe,er,In,Ae.getProjection()):Ua(Ye.kind,Je,q,Y,d,yn,Cr,gi,_,vt,!0,Ce,On,fe,er,In,Ae.getProjection()):vl(Ye.kind,Je,q,Y,d,yn,Cr,gi,_,vt,Ce,On,fe,er,In,Ae.getProjection());let Cc={program:d.useProgram(rn(ze,_,Ae),De,Si),buffers:He,uniformValues:qa,atlasTexture:Rt,atlasTextureIcon:Kt,atlasInterpolation:mt,atlasInterpolationIcon:Et,isSDF:ze,hasHalo:Cu,tile:Ve,labelPlaneMatrixInv:Vr};if(Q&&Ae.canOverlap){te=!0;let Ms=He.segments.get();for(let ua of Ms)ye.push({segments:new i.SegmentVector([ua]),sortKey:ua.sortKey,state:Cc})}else ye.push({segments:He.segments,sortKey:0,state:Cc})}te&&ye.sort((Ce,Ve)=>Ce.sortKey-Ve.sortKey);for(let Ce of ye){let Ve=Ce.state;if(d.terrain&&d.terrain.setupElevationDraw(Ve.tile,Ve.program,{useDepthForOcclusion:!xe,labelPlaneMatrixInv:Ve.labelPlaneMatrixInv}),G.activeTexture.set(W.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,W.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(G.activeTexture.set(W.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Ve.isSDF){let Ae=Ve.uniformValues;Ve.hasHalo&&(Ae.u_is_halo=1,rr(Ve.buffers,Ce.segments,l,d,Ve.program,he,P,F,Ae)),Ae.u_is_halo=0}rr(Ve.buffers,Ce.segments,l,d,Ve.program,he,P,F,Ve.uniformValues)}}function rr(d,r,l,p,_,v,E,T,I){let R=p.context,P=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];_.draw(R,R.gl.TRIANGLES,v,E,T,i.CullFaceMode.disabled,I,l.id,d.layoutVertexBuffer,d.indexBuffer,r,l.paint,p.transform.zoom,d.programConfigurations.get(l.id),P)}function Di(d,r,l,p,_,v,E){let T=d.context.gl,I=l.paint.get("fill-pattern"),R=I&&I.constantOr(1),P,F,G,W,X;E?(F=R&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=T.LINES):(F=R?"fillPattern":"fill",P=T.TRIANGLES);for(let Z of p){let Y=r.getTile(Z);if(R&&!Y.patternsLoaded())continue;let N=Y.getBucket(l);if(!N)continue;d.prepareDrawTile();let q=N.programConfigurations.get(l.id),Q=d.useProgram(F,q);R&&(d.context.activeTexture.set(T.TEXTURE0),Y.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),q.updatePaintBuffers());let te=I.constantOr(null);if(te&&Y.imageAtlas){let fe=Y.imageAtlas.patternPositions[te.toString()];fe&&q.setConstantPatternPositions(fe)}let he=d.translatePosMatrix(Z.projMatrix,Y,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(E){W=N.indexBuffer2,X=N.segments2;let fe=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];G=F==="fillOutlinePattern"&&R?du(he,d,Y,fe):Ba(he,fe)}else W=N.indexBuffer,X=N.segments,G=R?ia(he,d,Y):bs(he);d.prepareDrawProgram(d.context,Q,Z.toUnwrapped()),Q.draw(d.context,P,_,d.stencilModeForClipping(Z),v,i.CullFaceMode.disabled,G,l.id,N.layoutVertexBuffer,W,X,l.paint,d.transform.zoom,q)}}function ur(d,r,l,p,_,v,E){let T=d.context,I=T.gl,R=d.transform,P=l.paint.get("fill-extrusion-pattern"),F=P.constantOr(1),G=l.paint.get("fill-extrusion-opacity"),W=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],X=l.layout.get("fill-extrusion-edge-radius"),Z=X>0&&!l.paint.get("fill-extrusion-rounded-roof"),Y=Z?0:X,N=R.projection.name==="globe"?i.fillExtrusionHeightLift():0,q=R.projection.name==="globe",Q=q?i.globeToMercatorTransition(R.zoom):0,te=[i.mercatorXfromLng(R.center.lng),i.mercatorYfromLat(R.center.lat)],he=[];q&&he.push("PROJECTION_GLOBE_VIEW"),W[0]>0&&he.push("FAUX_AO"),Z&&he.push("ZERO_ROOF_RADIUS");for(let fe of p){let de=r.getTile(fe),xe=de.getBucket(l);if(!xe||xe.projection.name!==R.projection.name)continue;let ye=xe.programConfigurations.get(l.id),Ie=d.useProgram(F?"fillExtrusionPattern":"fillExtrusion",ye,he);if(d.terrain){let ze=d.terrain;if(d.style.terrainSetForDrapingOnly())ze.setupElevationDraw(de,Ie,{useMeterToDem:!0});else{if(!xe.enableTerrain)continue;if(ze.setupElevationDraw(de,Ie,{useMeterToDem:!0}),yr(T,r,fe,xe,l,ze),!xe.centroidVertexBuffer){let Ye=Ie.attributes.a_centroid_pos;Ye!==void 0&&I.vertexAttrib2f(Ye,0,0)}}}F&&(d.context.activeTexture.set(I.TEXTURE0),de.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ye.updatePaintBuffers());let qe=P.constantOr(null);if(qe&&de.imageAtlas){let ze=de.imageAtlas.patternPositions[qe.toString()];ze&&ye.setConstantPatternPositions(ze)}let Ce=d.translatePosMatrix(fe.projMatrix,de,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Ve=R.projection.createInversionMatrix(R,fe.canonical),Ae=l.paint.get("fill-extrusion-vertical-gradient"),He=F?xo(Ce,d,Ae,G,W,Y,fe,de,N,Q,te,Ve):ra(Ce,d,Ae,G,W,Y,fe,N,Q,te,Ve);d.prepareDrawProgram(T,Ie,fe.toUnwrapped());let De=[];d.terrain&&De.push(xe.centroidVertexBuffer),q&&De.push(xe.layoutVertexExtBuffer),Ie.draw(T,T.gl.TRIANGLES,_,v,E,i.CullFaceMode.backCCW,He,l.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,l.paint,d.transform.zoom,ye,De)}}function yr(d,r,l,p,_,v){let E=[N=>{let q=N.canonical.x-1,Q=N.wrap;return q<0&&(q=(1<<N.canonical.z)-1,Q--),new i.OverscaledTileID(N.overscaledZ,Q,N.canonical.z,q,N.canonical.y)},N=>{let q=N.canonical.x+1,Q=N.wrap;return q===1<<N.canonical.z&&(q=0,Q++),new i.OverscaledTileID(N.overscaledZ,Q,N.canonical.z,q,N.canonical.y)},N=>new i.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,(N.canonical.y===0?1<<N.canonical.z:N.canonical.y)-1),N=>new i.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y===(1<<N.canonical.z)-1?0:N.canonical.y+1)],T=N=>{let q=r.getSource().minzoom,Q=he=>{let fe=r.getTileByID(he);if(fe&&fe.hasData())return fe.getBucket(_)},te=[0,-1,1];for(let he of te){if(N.overscaledZ+he<q)continue;let fe=Q(N.calculateScaledKey(N.overscaledZ+he));if(fe)return fe}},I=[0,0,0],R=(N,q)=>(I[0]=Math.min(N.min.y,q.min.y),I[1]=Math.max(N.max.y,q.max.y),I[2]=i.EXTENT-q.min.x>N.max.x?q.min.x-i.EXTENT:N.max.x,I),P=(N,q)=>(I[0]=Math.min(N.min.x,q.min.x),I[1]=Math.max(N.max.x,q.max.x),I[2]=i.EXTENT-q.min.y>N.max.y?q.min.y-i.EXTENT:N.max.y,I),F=[(N,q)=>R(N,q),(N,q)=>R(q,N),(N,q)=>P(N,q),(N,q)=>P(q,N)],G=new i.Point(0,0),W,X,Z,Y=(N,q,Q,te,he)=>{let fe=[[te?Q:N,te?N:Q,0],[te?Q:q,te?q:Q,0]],de=he<0?i.EXTENT+he:he,xe=[te?de:(N+q)/2,te?(N+q)/2:de,0];return Q===0&&he<0||Q!==0&&he>0?v.getForTilePoints(Z,[xe],!0,X):fe.push(xe),v.getForTilePoints(l,fe,!0,W),Math.max(fe[0][2],fe[1][2],xe[2])/v.exaggeration()};for(let N=0;N<4;N++){let q=(N<2?1:5)-N,Q=p.borders[N];if(Q.length===0)continue;let te=Z=E[N](l),he=T(te);if(!(he&&he instanceof i.FillExtrusionBucket&&he.enableTerrain)||p.borderDoneWithNeighborZ[N]===he.canonical.z&&he.borderDoneWithNeighborZ[q]===p.canonical.z||(X=v.findDEMTileFor(te),!X||!X.dem))continue;if(!W){let ye=v.findDEMTileFor(l);if(!ye||!ye.dem)return;W=ye}let fe=he.borders[q],de=0,xe=he.borderDoneWithNeighborZ[q]!==p.canonical.z;if(p.canonical.z===he.canonical.z){for(let ye=0;ye<Q.length;ye++){let Ie=p.featuresOnBorder[Q[ye]],qe=Ie.borders[N],Ce;for(;de<fe.length&&(Ce=he.featuresOnBorder[fe[de]],!(Ce.borders[q][1]>qe[0]+3));)xe&&he.encodeCentroid(void 0,Ce,!1),de++;if(Ce&&de<fe.length){let Ve=de,Ae=0;for(;!(Ce.borders[q][0]>qe[1]-3)&&(Ae++,++de!==fe.length);)Ce=he.featuresOnBorder[fe[de]];if(Ce=he.featuresOnBorder[fe[Ve]],Ie.intersectsCount()>1||Ce.intersectsCount()>1||Ae!==1){Ae!==1&&(de=Ve),p.encodeCentroid(void 0,Ie,!1),xe&&he.encodeCentroid(void 0,Ce,!1);continue}let He=F[N](Ie,Ce),De=N%2?i.EXTENT-1:0;G.x=Y(He[0],Math.min(i.EXTENT-1,He[1]),De,N<2,He[2]),G.y=0,p.encodeCentroid(G,Ie,!1),xe&&he.encodeCentroid(G,Ce,!1)}else p.encodeCentroid(void 0,Ie,!1)}p.borderDoneWithNeighborZ[N]=he.canonical.z,p.needsCentroidUpdate=!0,xe&&(he.borderDoneWithNeighborZ[q]=p.canonical.z,he.needsCentroidUpdate=!0)}else{for(let ye of Q)p.encodeCentroid(void 0,p.featuresOnBorder[ye],!1);if(xe){for(let ye of fe)he.encodeCentroid(void 0,he.featuresOnBorder[ye],!1);he.borderDoneWithNeighborZ[q]=p.canonical.z,he.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[N]=he.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(d)}let Wr=new i.Color(1,0,0,1),wo=new i.Color(0,1,0,1),Zr=new i.Color(0,0,1,1),Eo=new i.Color(1,0,1,1),la=new i.Color(0,1,1,1);function xl(d,r,l){let p=d.context,_=d.transform,v=p.gl,E=_.projection.name==="globe",T=E?["PROJECTION_GLOBE_VIEW"]:null,I=l.projMatrix;if(E&&i.globeToMercatorTransition(_.zoom)>0){let Ie=i.transitionTileAABBinECEF(l.canonical,_),qe=i.globeDenormalizeECEF(Ie);I=i.multiply(new Float32Array(16),_.globeMatrix,qe),i.multiply(I,_.projMatrix,I)}let R=d.useProgram("debug",null,T),P=r.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(P,R);let F=i.DepthMode.disabled,G=i.StencilMode.disabled,W=d.colorModeForRenderPass(),X="$debug";p.activeTexture.set(v.TEXTURE0),d.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),E?P._makeGlobeTileDebugBuffers(d.context,_):P._makeDebugTileBoundsBuffers(d.context,_.projection);let Z=P._tileDebugBuffer||d.debugBuffer,Y=P._tileDebugIndexBuffer||d.debugIndexBuffer,N=P._tileDebugSegments||d.debugSegments;R.draw(p,v.LINE_STRIP,F,G,W,i.CullFaceMode.disabled,Va(I,i.Color.red),X,Z,Y,N,null,null,null,[P._globeTileDebugBorderBuffer]);let q=P.latestRawTileData,Q=Math.floor((q&&q.byteLength||0)/1024),te=r.getTile(l).tileSize,he=512/Math.min(te,512)*(l.overscaledZ/_.zoom)*.5,fe=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(fe+=` => ${l.overscaledZ}`),fe+=` ${Q}kb`,function(Ie,qe){Ie.initDebugOverlayCanvas();let Ce=Ie.debugOverlayCanvas,Ve=Ie.context.gl,Ae=Ie.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,Ce.width,Ce.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(qe,5,5),Ae.strokeText(qe,5,5),Ie.debugOverlayTexture.update(Ce),Ie.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(d,fe);let de=P._tileDebugTextBuffer||d.debugBuffer,xe=P._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,ye=P._tileDebugTextSegments||d.debugSegments;R.draw(p,v.TRIANGLES,F,G,i.ColorMode.alphaBlended,i.CullFaceMode.disabled,Va(I,i.Color.transparent,he),X,de,xe,ye,null,null,null,[P._globeTileDebugTextBuffer])}function Cs(d,r,l,p){Ts(d,0,r+l/2,d.transform.width,l,p)}function Ko(d,r,l,p){Ts(d,r-l/2,0,l,d.transform.height,p)}function Ts(d,r,l,p,_,v){let E=d.context,T=E.gl;T.enable(T.SCISSOR_TEST),T.scissor(r*i.exported.devicePixelRatio,l*i.exported.devicePixelRatio,p*i.exported.devicePixelRatio,_*i.exported.devicePixelRatio),E.clear({color:v}),T.disable(T.SCISSOR_TEST)}let mu=i.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:gu}=mu;function fn(d,r,l,p){d.emplaceBack(r,l,p)}class xn{constructor(r){this.vertexArray=new i.StructArrayLayout3f12,this.indices=new i.StructArrayLayout3ui6,fn(this.vertexArray,-1,-1,1),fn(this.vertexArray,1,-1,1),fn(this.vertexArray,-1,1,1),fn(this.vertexArray,1,1,1),fn(this.vertexArray,-1,-1,-1),fn(this.vertexArray,1,-1,-1),fn(this.vertexArray,-1,1,-1),fn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,gu),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=i.SegmentVector.simpleSegment(0,0,36,12)}}function Xr(d,r,l,p,_,v){let E=d.gl,T=r.paint.get("sky-atmosphere-color"),I=r.paint.get("sky-atmosphere-halo-color"),R=r.paint.get("sky-atmosphere-sun-intensity"),P=((F,G,W,X,Z)=>({u_matrix_3f:F,u_sun_direction:G,u_sun_intensity:W,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(i.fromMat4(i.create$1(),p),_,R,T,I);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),l.draw(d,E.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.frontCW,P,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}let Ii=i.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class bl{constructor(r){let l=new i.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);let p=new i.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,Ii.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=i.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let kr={symbol:function(d,r,l,p,_){if(d.renderPass!=="translucent")return;let v=i.StencilMode.disabled,E=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(T,I,R,P,F,G,W){let X=I.transform,Z=F==="map",Y=G==="map";for(let N of T){let q=P.getTile(N),Q=q.getBucket(R);if(!Q||!Q.text||!Q.text.segments.get().length)continue;let te=i.evaluateSizeForZoom(Q.textSizeData,X.zoom),he=ae(N,Q.getProjection(),X),fe=X.calculatePixelsToTileUnitsMatrix(q),de=Oe(he,q.tileID.canonical,Y,Z,X,Q.getProjection(),fe),xe=R.layout.get("icon-text-fit")!=="none"&&Q.hasIconData();if(te){let ye=Math.pow(2,X.zoom-q.tileID.overscaledZ);Qn(Q,Z,Y,W,i.symbolSize,X,de,N,ye,te,xe)}}}(p,d,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),l.paint.get("icon-opacity").constantOr(1)!==0&&sr(d,r,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,E),l.paint.get("text-opacity").constantOr(1)!==0&&sr(d,r,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,E),r.map.showCollisionBoxes&&(Le(d,r,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Le(d,r,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,r,l,p){if(d.renderPass!=="translucent")return;let _=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),E=l.paint.get("circle-stroke-opacity"),T=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(v.constantOr(1)===0||E.constantOr(1)===0))return;let I=d.context,R=I.gl,P=d.transform,F=d.depthModeForSublayer(0,i.DepthMode.ReadOnly),G=i.StencilMode.disabled,W=d.colorModeForRenderPass(),X=P.projection.name==="globe",Z=[i.mercatorXfromLng(P.center.lng),i.mercatorYfromLat(P.center.lat)],Y=[];for(let q=0;q<p.length;q++){let Q=p[q],te=r.getTile(Q),he=te.getBucket(l);if(!he||he.projection.name!==P.projection.name)continue;let fe=he.programConfigurations.get(l.id),de=dc(l);X&&de.push("PROJECTION_GLOBE_VIEW");let xe=d.useProgram("circle",fe,de),ye=he.layoutVertexBuffer,Ie=he.globeExtVertexBuffer,qe=he.indexBuffer,Ce=P.projection.createInversionMatrix(P,Q.canonical),Ve={programConfiguration:fe,program:xe,layoutVertexBuffer:ye,globeExtVertexBuffer:Ie,indexBuffer:qe,uniformValues:hc(d,Q,te,Ce,Z,l),tile:te};if(T){let Ae=he.segments.get();for(let He of Ae)Y.push({segments:new i.SegmentVector([He]),sortKey:He.sortKey,state:Ve})}else Y.push({segments:he.segments,sortKey:0,state:Ve})}T&&Y.sort((q,Q)=>q.sortKey-Q.sortKey);let N={useDepthForOcclusion:!X};for(let q of Y){let{programConfiguration:Q,program:te,layoutVertexBuffer:he,globeExtVertexBuffer:fe,indexBuffer:de,uniformValues:xe,tile:ye}=q.state,Ie=q.segments;d.terrain&&d.terrain.setupElevationDraw(ye,te,N),d.prepareDrawProgram(I,te,ye.tileID.toUnwrapped()),te.draw(I,R.TRIANGLES,F,G,W,i.CullFaceMode.disabled,xe,l.id,he,de,Ie,l.paint,P.zoom,Q,[fe])}},heatmap:function(d,r,l,p){if(l.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){let _=d.context,v=_.gl,E=i.StencilMode.disabled,T=new i.ColorMode([v.ONE,v.ONE],i.Color.transparent,[!0,!0,!0,!0]);(function(W,X,Z,Y){let N=W.gl,q=X.width*Y,Q=X.height*Y;W.activeTexture.set(N.TEXTURE1),W.viewport.set([0,0,q,Q]);let te=Z.heatmapFbo;if(!te||te&&(te.width!==q||te.height!==Q)){te&&te.destroy();let he=N.createTexture();N.bindTexture(N.TEXTURE_2D,he),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),te=Z.heatmapFbo=W.createFramebuffer(q,Q,!1),function(fe,de,xe,ye,Ie,qe){let Ce=fe.gl;Ce.texImage2D(Ce.TEXTURE_2D,0,fe.isWebGL2&&fe.extRenderToTextureHalfFloat?Ce.RGBA16F:Ce.RGBA,Ie,qe,0,Ce.RGBA,fe.extRenderToTextureHalfFloat?fe.isWebGL2?Ce.HALF_FLOAT:fe.extTextureHalfFloat.HALF_FLOAT_OES:Ce.UNSIGNED_BYTE,null),ye.colorAttachment.set(xe)}(W,0,he,te,q,Q)}else N.bindTexture(N.TEXTURE_2D,te.colorAttachment.get()),W.bindFramebuffer.set(te.framebuffer)})(_,d,l,d.transform.projection.name==="globe"?.5:.25),_.clear({color:i.Color.transparent});let I=d.transform,R=I.projection.name==="globe",P=R?["PROJECTION_GLOBE_VIEW"]:null,F=R?i.CullFaceMode.frontCCW:i.CullFaceMode.disabled,G=[i.mercatorXfromLng(I.center.lng),i.mercatorYfromLat(I.center.lat)];for(let W=0;W<p.length;W++){let X=p[W];if(r.hasRenderableParent(X))continue;let Z=r.getTile(X),Y=Z.getBucket(l);if(!Y||Y.projection.name!==I.projection.name)continue;let N=Y.programConfigurations.get(l.id),q=d.useProgram("heatmap",N,P),{zoom:Q}=d.transform;d.terrain&&d.terrain.setupElevationDraw(Z,q),d.prepareDrawProgram(_,q,X.toUnwrapped());let te=I.projection.createInversionMatrix(I,X.canonical);q.draw(_,v.TRIANGLES,i.DepthMode.disabled,E,T,F,ws(d,X,Z,te,G,Q,l.paint.get("heatmap-intensity")),l.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,l.paint,d.transform.zoom,N,R?[Y.globeExtVertexBuffer]:null)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,v){let E=_.context,T=E.gl,I=v.heatmapFbo;if(!I)return;E.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,I.colorAttachment.get()),E.activeTexture.set(T.TEXTURE1);let R=v.colorRampTexture;R||(R=v.colorRampTexture=new i.Texture(E,v.colorRamp,T.RGBA)),R.bind(T.LINEAR,T.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,T.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,_.colorModeForRenderPass(),i.CullFaceMode.disabled,((P,F,G,W)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,v),v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(d,l))},line:function(d,r,l,p){if(d.renderPass!=="translucent")return;let _=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;let E=d.depthModeForSublayer(0,i.DepthMode.ReadOnly),T=d.colorModeForRenderPass(),I=d.terrain&&d.terrain.renderingToTexture?1:i.exported.devicePixelRatio,R=l.paint.get("line-dasharray"),P=R.constantOr(1),F=l.layout.get("line-cap"),G=l.paint.get("line-pattern"),W=G.constantOr(1),X=l.paint.get("line-gradient"),Z=W?"linePattern":"line",Y=d.context,N=Y.gl,q=(te=>{let he=[];sa(te)&&he.push("RENDER_LINE_DASH"),te.paint.get("line-gradient")&&he.push("RENDER_LINE_GRADIENT");let fe=te.paint.get("line-trim-offset");fe[0]===0&&fe[1]===0||he.push("RENDER_LINE_TRIM_OFFSET");let de=te.paint.get("line-pattern").constantOr(1),xe=te.paint.get("line-opacity").constantOr(1)!==1;return!de&&xe&&he.push("RENDER_LINE_ALPHA_DISCARD"),he})(l),Q=q.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Q=!1);for(let te of p){let he=r.getTile(te);if(W&&!he.patternsLoaded())continue;let fe=he.getBucket(l);if(!fe)continue;d.prepareDrawTile();let de=fe.programConfigurations.get(l.id),xe=d.useProgram(Z,de,q),ye=G.constantOr(null);if(ye&&he.imageAtlas){let ze=he.imageAtlas.patternPositions[ye.toString()];ze&&de.setConstantPatternPositions(ze)}let Ie=R.constantOr(null),qe=F.constantOr(null);if(!W&&Ie&&qe&&he.lineAtlas){let ze=he.lineAtlas.getDash(Ie,qe);ze&&de.setConstantPatternPositions(ze)}let[Ce,Ve]=l.paint.get("line-trim-offset");(qe==="round"||qe==="square")&&Ce!==Ve&&(Ce===0&&(Ce-=1),Ve===1&&(Ve+=1));let Ae=d.terrain?te.projMatrix:null,He=W?Ti(d,he,l,Ae,I):jh(d,he,l,Ae,fe.lineClipsArray.length,I,[Ce,Ve]);if(X){let ze=fe.gradients[l.id],Ye=ze.texture;if(l.gradientVersion!==ze.version){let $e=256;if(l.stepInterpolant){let Je=r.getSource().maxzoom,vt=te.canonical.z===Je?Math.ceil(1<<d.transform.maxZoom-te.canonical.z):1;$e=i.clamp(i.nextPowerOfTwo(fe.maxLineLength/i.EXTENT*1024*vt),256,Y.maxTextureSize)}ze.gradient=i.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:$e,image:ze.gradient||void 0,clips:fe.lineClipsArray}),ze.texture?ze.texture.update(ze.gradient):ze.texture=new i.Texture(Y,ze.gradient,N.RGBA),ze.version=l.gradientVersion,Ye=ze.texture}Y.activeTexture.set(N.TEXTURE1),Ye.bind(l.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}P&&(Y.activeTexture.set(N.TEXTURE0),he.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),de.updatePaintBuffers()),W&&(Y.activeTexture.set(N.TEXTURE0),he.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),de.updatePaintBuffers()),d.prepareDrawProgram(Y,xe,te.toUnwrapped());let De=ze=>{xe.draw(Y,N.TRIANGLES,E,ze,T,i.CullFaceMode.disabled,He,l.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,l.paint,d.transform.zoom,de,[fe.layoutVertexBuffer2])};if(Q){let ze=d.stencilModeForClipping(te).ref;ze===0&&d.terrain&&Y.clear({stencil:0});let Ye={func:N.EQUAL,mask:255};He.u_alpha_discard_threshold=.8,De(new i.StencilMode(Ye,ze,255,N.KEEP,N.KEEP,N.INVERT)),He.u_alpha_discard_threshold=0,De(new i.StencilMode(Ye,ze,255,N.KEEP,N.KEEP,N.KEEP))}else De(d.stencilModeForClipping(te))}Q&&(d.resetStencilClippingMasks(),d.terrain&&Y.clear({stencil:0}))},fill:function(d,r,l,p){let _=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(v.constantOr(1)===0)return;let E=d.colorModeForRenderPass(),T=l.paint.get("fill-pattern"),I=d.opaquePassEnabledForLayer()&&!T.constantOr(1)&&_.constantOr(i.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===I){let R=d.depthModeForSublayer(1,d.renderPass==="opaque"?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly);Di(d,r,l,p,R,E,!1)}if(d.renderPass==="translucent"&&l.paint.get("fill-antialias")){let R=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,i.DepthMode.ReadOnly);Di(d,r,l,p,R,E,!0)}},"fill-extrusion":function(d,r,l,p){let _=l.paint.get("fill-extrusion-opacity");if(_!==0&&d.renderPass==="translucent"){let v=new i.DepthMode(d.context.gl.LEQUAL,i.DepthMode.ReadWrite,d.depthRangeFor3D);if(_!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))ur(d,r,l,p,v,i.StencilMode.disabled,i.ColorMode.disabled),ur(d,r,l,p,v,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{let E=d.colorModeForRenderPass();ur(d,r,l,p,v,i.StencilMode.disabled,E)}}},hillshade:function(d,r,l,p){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;let _=d.context,v=d.depthModeForSublayer(0,i.DepthMode.ReadOnly),E=d.colorModeForRenderPass(),T=d.terrain&&d.terrain.renderingToTexture,[I,R]=d.renderPass!=="translucent"||T?[{},p]:d.stencilConfigForOverlap(p);for(let P of R){let F=r.getTile(P);if(F.needsHillshadePrepare&&d.renderPass==="offscreen")uu(d,F,l,v,i.StencilMode.disabled,E);else if(d.renderPass==="translucent"){let G=T&&d.terrain?d.terrain.stencilModeForRTTOverlap(P):I[P.overscaledZ];Ho(d,P,F,l,v,G,E)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,r,l,p,_,v){if(d.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!p.length)return;let E=d.context,T=E.gl,I=r.getSource(),R=d.useProgram("raster"),P=d.colorModeForRenderPass(),F=d.terrain&&d.terrain.renderingToTexture,[G,W]=I instanceof St||F?[{},p]:d.stencilConfigForOverlap(p),X=W[W.length-1].overscaledZ,Z=!d.options.moving;for(let Y of W){let N=F?i.DepthMode.disabled:d.depthModeForSublayer(Y.overscaledZ-X,l.paint.get("raster-opacity")===1?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly,T.LESS),q=Y.toUnwrapped(),Q=r.getTile(Y);if(F&&(!Q||!Q.hasData()))continue;let te=F?Y.projMatrix:d.transform.calculateProjMatrix(q,Z),he=d.terrain&&F?d.terrain.stencilModeForRTTOverlap(Y):G[Y.overscaledZ],fe=v?0:l.paint.get("raster-fade-duration");Q.registerFadeDuration(fe);let de=r.findLoadedParent(Y,0),xe=cc(Q,de,r,d.transform,fe),ye,Ie;d.terrain&&d.terrain.prepareDrawTile();let qe=l.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;E.activeTexture.set(T.TEXTURE0),Q.texture.bind(qe,T.CLAMP_TO_EDGE),E.activeTexture.set(T.TEXTURE1),de?(de.texture.bind(qe,T.CLAMP_TO_EDGE),ye=Math.pow(2,de.tileID.overscaledZ-Q.tileID.overscaledZ),Ie=[Q.tileID.canonical.x*ye%1,Q.tileID.canonical.y*ye%1]):Q.texture.bind(qe,T.CLAMP_TO_EDGE),Q.texture.useMipmap&&E.extTextureFilterAnisotropic&&d.transform.pitch>20&&T.texParameterf(T.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);let Ce=fc(te,Ie||[0,0],ye||1,xe,l,I instanceof St?I.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(E,R,q),I instanceof St)I.boundsBuffer&&I.boundsSegments&&R.draw(E,T.TRIANGLES,N,i.StencilMode.disabled,P,i.CullFaceMode.disabled,Ce,l.id,I.boundsBuffer,d.quadTriangleIndexBuffer,I.boundsSegments);else{let{tileBoundsBuffer:Ve,tileBoundsIndexBuffer:Ae,tileBoundsSegments:He}=d.getTileBoundsBuffers(Q);R.draw(E,T.TRIANGLES,N,he,P,i.CullFaceMode.disabled,Ce,l.id,Ve,Ae,He)}}d.resetStencilClippingMasks()},background:function(d,r,l,p){let _=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(v===0)return;let E=d.context,T=E.gl,I=d.transform,R=I.tileSize,P=l.paint.get("background-pattern");if(d.isPatternMissing(P))return;let F=!P&&_.a===1&&v===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==F)return;let G=i.StencilMode.disabled,W=d.depthModeForSublayer(0,F==="opaque"?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly),X=d.colorModeForRenderPass(),Z=d.useProgram(P?"backgroundPattern":"background"),Y,N=p;N||(Y=d.getBackgroundTiles(),N=Object.values(Y).map(q=>q.tileID)),P&&(E.activeTexture.set(T.TEXTURE0),d.imageManager.bind(d.context));for(let q of N){let Q=q.toUnwrapped(),te=p?q.projMatrix:d.transform.calculateProjMatrix(Q);d.prepareDrawTile();let he=r?r.getTile(q):Y?Y[q.key]:new i.Tile(q,R,I.zoom,d),fe=P?pu(te,v,d,P,{tileID:q,tileSize:R}):Es(te,v,_);d.prepareDrawProgram(E,Z,Q);let{tileBoundsBuffer:de,tileBoundsIndexBuffer:xe,tileBoundsSegments:ye}=d.getTileBoundsBuffers(he);Z.draw(E,T.TRIANGLES,W,G,X,i.CullFaceMode.disabled,fe,l.id,de,xe,ye)}},sky:function(d,r,l){let p=d.transform,_=p.projection.name==="mercator"||p.projection.name==="globe"?1:i.smoothstep(7,8,p.zoom),v=l.paint.get("sky-opacity")*_;if(v===0)return;let E=d.context,T=l.paint.get("sky-type"),I=new i.DepthMode(E.gl.LEQUAL,i.DepthMode.ReadOnly,[0,1]),R=d.frameCounter/1e3%1;T==="atmosphere"?d.renderPass==="offscreen"?l.needsSkyboxCapture(d)&&(function(P,F,G,W){let X=P.context,Z=X.gl,Y=F.skyboxFbo;if(!Y){Y=F.skyboxFbo=X.createFramebuffer(32,32,!1),F.skyboxGeometry=new xn(X),F.skyboxTexture=X.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,F.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let te=0;te<6;++te)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(Y.framebuffer),X.viewport.set([0,0,32,32]);let N=F.getCenter(P,!0),q=P.useProgram("skyboxCapture"),Q=new Float64Array(16);i.identity(Q),i.rotateY(Q,Q,.5*-Math.PI),Xr(X,F,q,Q,N,0),i.identity(Q),i.rotateY(Q,Q,.5*Math.PI),Xr(X,F,q,Q,N,1),i.identity(Q),i.rotateX(Q,Q,.5*-Math.PI),Xr(X,F,q,Q,N,2),i.identity(Q),i.rotateX(Q,Q,.5*Math.PI),Xr(X,F,q,Q,N,3),i.identity(Q),Xr(X,F,q,Q,N,4),i.identity(Q),i.rotateY(Q,Q,Math.PI),Xr(X,F,q,Q,N,5),X.viewport.set([0,0,P.width,P.height])}(d,l),l.markSkyboxValid(d)):d.renderPass==="sky"&&function(P,F,G,W,X){let Z=P.context,Y=Z.gl,N=P.transform,q=P.useProgram("skybox");Z.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,F.skyboxTexture);let Q=((te,he,fe,de,xe)=>({u_matrix:te,u_sun_direction:he,u_cubemap:0,u_opacity:de,u_temporal_offset:xe}))(N.skyboxMatrix,F.getCenter(P,!1),0,W,X);P.prepareDrawProgram(Z,q),q.draw(Z,Y.TRIANGLES,G,i.StencilMode.disabled,P.colorModeForRenderPass(),i.CullFaceMode.backCW,Q,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(d,l,I,v,R):T==="gradient"&&d.renderPass==="sky"&&function(P,F,G,W,X){let Z=P.context,Y=Z.gl,N=P.transform,q=P.useProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new xn(Z)),Z.activeTexture.set(Y.TEXTURE0);let Q=F.colorRampTexture;Q||(Q=F.colorRampTexture=new i.Texture(Z,F.colorRamp,Y.RGBA)),Q.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let te=((he,fe,de,xe,ye)=>({u_matrix:he,u_color_ramp:0,u_center_direction:fe,u_radius:i.degToRad(de),u_opacity:xe,u_temporal_offset:ye}))(N.skyboxMatrix,F.getCenter(P,!1),F.paint.get("sky-gradient-radius"),W,X);P.prepareDrawProgram(Z,q),q.draw(Z,Y.TRIANGLES,G,i.StencilMode.disabled,P.colorModeForRenderPass(),i.CullFaceMode.backCW,te,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(d,l,I,v,R)},debug:function(d,r,l){for(let p=0;p<l.length;p++)xl(d,r,l[p])},custom:function(d,r,l,p){let _=d.context,v=l.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&l.isLayerDraped()){if(d.renderPass==="offscreen"){let E=v.prerender;if(E){if(d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){let T=d.transform.pointMerc;E.call(v,_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.globeToMercatorTransition(d.transform.zoom),[T.x,T.y],d.transform.pixelsPerMeterRatio)}else E.call(v,_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){let T=v.renderToTile;if(T){let I=p[0].canonical,R=new i.MercatorCoordinate(I.x+p[0].wrap*(1<<I.z),I.y,I.z);_.setDepthMode(i.DepthMode.disabled),_.setStencilMode(i.StencilMode.disabled),_.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),T.call(v,_.gl,R),_.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),_.setStencilMode(i.StencilMode.disabled);let E=v.renderingMode==="3d"?new i.DepthMode(d.context.gl.LEQUAL,i.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,i.DepthMode.ReadOnly);if(_.setDepthMode(E),d.transform.projection.name==="globe"){let T=d.transform.pointMerc;v.render(_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.globeToMercatorTransition(d.transform.zoom),[T.x,T.y],d.transform.pixelsPerMeterRatio)}else v.render(_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState(),_.bindFramebuffer.set(null)}}else i.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class si{constructor(r,l,p=!1){this.context=new Ke(r,p),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=i.SourceCache.maxUnderzooming+i.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){let p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new za(this,r));let _=this._terrain;this.transform.elevation=p?_:null,_.update(r,this.transform,l)}_updateFog(r){let l=r.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);let v=p+.78*(_-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*i.exported.devicePixelRatio,this.height=l*i.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let p of this.style.order)this.style._layers[p].resize()}setup(){let r=this.context,l=new i.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(i.EXTENT,0),l.emplaceBack(0,i.EXTENT),l.emplaceBack(i.EXTENT,i.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,i.posAttributes.members),this.tileExtentSegments=i.SegmentVector.simpleSegment(0,0,4,2);let p=new i.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(i.EXTENT,0),p.emplaceBack(0,i.EXTENT),p.emplaceBack(i.EXTENT,i.EXTENT),this.debugBuffer=r.createVertexBuffer(p,i.posAttributes.members),this.debugSegments=i.SegmentVector.simpleSegment(0,0,4,5);let _=new i.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,i.posAttributes.members),this.viewportSegments=i.SegmentVector.simpleSegment(0,0,4,2);let v=new i.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(i.EXTENT,0,i.EXTENT,0),v.emplaceBack(0,i.EXTENT,0,i.EXTENT),v.emplaceBack(i.EXTENT,i.EXTENT,i.EXTENT,i.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(v,i.boundsAttributes.members),this.mercatorBoundsSegments=i.SegmentVector.simpleSegment(0,0,4,2);let E=new i.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(E);let T=new i.StructArrayLayout1ui2;for(let R of[0,1,3,2,0])T.emplaceBack(R);this.debugIndexBuffer=r.createIndexBuffer(T),this.emptyTexture=new i.Texture(r,new i.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=i.create();let I=this.context.gl;this.stencilClearMode=new i.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(i.window.performance.now()),this.atmosphereBuffer=new bl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,i.DepthMode.disabled,this.stencilClearMode,i.ColorMode.disabled,i.CullFaceMode.disabled,Fa(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,p){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(let I of p)if(this._tileClippingMaskIDs[I.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=l.id;let _=this.context,v=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(i.ColorMode.disabled),_.setDepthMode(i.DepthMode.disabled);let E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let T of p){let I=l.getTile(T),R=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:F,tileBoundsSegments:G}=this.getTileBoundsBuffers(I);E.draw(_,v.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,Fa(T.projMatrix),"$clipping",P,F,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let r=this.nextStencilID++,l=this.context.gl;return new i.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);let l=this.context.gl;return new i.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){let l=this.context.gl,p=r.sort((E,T)=>T.overscaledZ-E.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();let E={};for(let T=0;T<v;T++)E[T+_]=new i.StencilMode({func:l.GEQUAL,mask:255},T+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[E,p]}return[{[_]:i.StencilMode.disabled},p]}colorModeForRenderPass(){let r=this.context.gl;return this._showOverdrawInspector?new i.ColorMode([r.CONSTANT_COLOR,r.ONE],new i.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?i.ColorMode.unblended:i.ColorMode.alphaBlended}depthModeForSublayer(r,l,p){if(!this.opaquePassEnabledForLayer())return i.DepthMode.disabled;let _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new i.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(i.exported.now()),this.imageManager.beginFrame();let p=this.style.order,_=this.style._sourceCaches;for(let R in _){let P=_[R];P.used&&P.prepare(this.context)}let v={},E={},T={};for(let R in _){let P=_[R];v[R]=P.getVisibleCoordinates(),E[R]=v[R].slice().reverse(),T[R]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<p.length;R++)if(this.style._layers[p[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.GlobeSharedBuffers(this.context)),!i.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(let R of p){let P=this.style._layers[R],F=r._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;let G=F?E[F.id]:void 0;(P.type==="custom"||P.isSky()||G&&G.length)&&this.renderLayer(this,F,P,G)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon];let I=this.terrain;if(I&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&I.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?i.Color.black:i.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){let R=this.style._layers[p[this.currentLayer]],P=r._getLayerSourceCache(R);if(R.isSky())continue;let F=P?E[P.id]:void 0;this._renderTileClippingMasks(R,P,F),this.renderLayer(this,P,R,F)}if(this.style.fog&&this.transform.projection.supportsFog&&function(R,P){let F=R.context,G=F.gl,W=R.transform,X=new i.DepthMode(G.LEQUAL,i.DepthMode.ReadOnly,[0,1]),Z=R.useProgram("globeAtmosphere",null,W.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Y=i.globeToMercatorTransition(W.zoom),N=P.properties.get("color").toArray01(),q=P.properties.get("high-color").toArray01(),Q=P.properties.get("space-color").toArray01PremultipliedAlpha(),te=i.identity$1([]);i.rotateY$1(te,te,-i.degToRad(W._center.lng)),i.rotateX$1(te,te,i.degToRad(W._center.lat)),i.rotateZ$1(te,te,W.angle),i.rotateX$1(te,te,-W._pitch);let he=i.fromQuat(new Float32Array(16),te),fe=i.mapValue(P.properties.get("star-intensity"),0,1,0,.25),de=5e-4,xe=i.mapValue(P.properties.get("horizon-blend"),0,1,de,.25),ye=i.globeUseCustomAntiAliasing(R,F,W)&&xe===de?W.worldSize/(2*Math.PI*1.025)-1:W.globeRadius,Ie=R.frameCounter/1e3%1,qe=i.length(W.globeCenterInViewSpace),Ce=Math.sqrt(Math.pow(qe,2)-Math.pow(ye,2)),Ve=Math.acos(Ce/qe),Ae=((De,ze,Ye,$e,Je,vt,Rt,mt,Et,Qt,Kt,_t,In,On)=>({u_frustum_tl:De,u_frustum_tr:ze,u_frustum_br:Ye,u_frustum_bl:$e,u_horizon:Je,u_transition:vt,u_fadeout_range:Rt,u_color:mt,u_high_color:Et,u_space_color:Qt,u_star_intensity:Kt,u_star_size:5*i.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:_t,u_horizon_angle:In,u_rotation_matrix:On}))(W.frustumCorners.TL,W.frustumCorners.TR,W.frustumCorners.BR,W.frustumCorners.BL,W.frustumCorners.horizon,Y,xe,N,q,Q,fe,Ie,Ve,he);R.prepareDrawProgram(F,Z);let He=R.atmosphereBuffer;He&&Z.draw(F,G.TRIANGLES,X,i.StencilMode.disabled,i.ColorMode.alphaBlended,i.CullFaceMode.backCW,Ae,"skybox",He.vertexBuffer,He.indexBuffer,He.segments)}(this,this.style.fog),this.renderPass="sky",(i.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){let R=this.style._layers[p[this.currentLayer]],P=r._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,P,R,P?E[P.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){let R=this.style._layers[p[this.currentLayer]],P=r._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}let F=P?(R.type==="symbol"?T:E)[P.id]:void 0;this._renderTileClippingMasks(R,P,P?v[P.id]:void 0),this.renderLayer(this,P,R,F),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let R=null;i.values(this.style._layers).forEach(P=>{let F=r._getLayerSourceCache(P);F&&!P.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<F.getSource().maxzoom)&&(R=F)}),R&&this.options.showTileBoundaries&&kr.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){let P=R.transform.padding;Cs(R,R.transform.height-(P.top||0),3,Wr),Cs(R,P.bottom||0,3,wo),Ko(R,P.left||0,3,Zr),Ko(R,R.transform.width-(P.right||0),3,Eo);let F=R.transform.centerPoint;(function(G,W,X,Z){Ts(G,W-1,X-10,2,20,Z),Ts(G,W-10,X-1,20,2,Z)})(R,F.x,R.transform.height-F.y,la)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(i.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,l,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(p.type)||r.terrain&&p.type==="custom")&&kr[p.type](r,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;let l=this.context.extTimerQuery,p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let r=this.context.extTimerQuery,l=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),r.beginQueryEXT(r.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;let r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){let r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){let r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){let l={};for(let p in r){let _=r[p],v=this.context.extTimerQuery,E=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),l[p]=E}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;let l=this.context.extTimerQuery,p=0;for(let _ of r)p+=l.getQueryObjectEXT(_,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(_);return p}translatePosMatrix(r,l,p,_,v){if(!p[0]&&!p[1])return r;let E=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(E){let R=Math.sin(E),P=Math.cos(E);p=[p[0]*P-p[1]*R,p[0]*R+p[1]*P]}let T=[v?p[0]:gr(l,p[0],this.transform.zoom),v?p[1]:gr(l,p[1],this.transform.zoom),0],I=new Float32Array(16);return i.translate(I,r,T),I}saveTileTexture(r){let l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){let l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){let r=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&this.terrain.exaggeration()===0,p=this.style&&this.style.fog,_=[];return this.terrainRenderModeElevated()&&_.push("TERRAIN"),this.transform.projection.name==="globe"&&_.push("GLOBE"),l&&_.push("ZERO_EXAGGERATION"),p&&!r&&p.getOpacity(this.transform.pitch)!==0&&_.push("FOG"),r&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(r,l,p){this.cache=this.cache||{};let _=p||[],v=this.currentGlobalDefines().concat(_),E=Xt.cacheKey(ml[r],r,v,l);return this.cache[E]||(this.cache[E]=new Xt(this.context,r,ml[r],l,mc[r],v)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=i.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;let _=this.style.fog;if(_){let v=_.getOpacity(this.transform.pitch),E=((T,I,R,P,F,G,W,X,Z,Y,N)=>{let q=T.transform,Q=I.properties.get("color").toArray01();Q[3]=P;let te=T.frameCounter/1e3%1;return{u_fog_matrix:R?q.calculateFogTileMatrix(R):T.identityMat,u_fog_range:I.getFovAdjustedRange(q._fov),u_fog_color:Q,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:te,u_frustum_tl:F,u_frustum_tr:G,u_frustum_br:W,u_frustum_bl:X,u_globe_pos:Z,u_globe_radius:Y,u_viewport:N,u_globe_transition:i.globeToMercatorTransition(q.zoom),u_is_globe:+(q.projection.name==="globe")}})(this,_,p,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.exported.devicePixelRatio,this.transform.height*i.exported.devicePixelRatio]);l.setFogUniformValues(r,E)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){let r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){let r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let r=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(let _ of p)l[_.key]=r[_.key]||new i.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Gi{constructor(r=0,l=0,p=0,_=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=p,this.right=_}interpolate(r,l,p){return l.top!=null&&r.top!=null&&(this.top=i.number(r.top,l.top,p)),l.bottom!=null&&r.bottom!=null&&(this.bottom=i.number(r.bottom,l.bottom,p)),l.left!=null&&r.left!=null&&(this.left=i.number(r.left,l.left,p)),l.right!=null&&r.right!=null&&(this.right=i.number(r.right,l.right,p)),this}getCenter(r,l){let p=i.clamp((this.left+r-this.right)/2,0,r),_=i.clamp((this.top+l-this.bottom)/2,0,l);return new i.Point(p,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Gi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Jo(d,r){let l=i.getColumn(d,3);i.fromQuat(d,r),i.setColumn(d,3,l)}function tn(d,r){let l=i.identity$1([]);return i.rotateZ$1(l,l,-r),i.rotateX$1(l,l,-d),l}function Qi(d,r){let l=[d[0],d[1],0],p=[r[0],r[1],0];if(i.length(l)>=1e-15){let E=i.normalize([],l);i.scale$2(p,E,i.dot(p,E)),r[0]=p[0],r[1]=p[1]}let _=i.cross([],r,d);if(i.len(_)<1e-15)return null;let v=Math.atan2(-_[1],_[0]);return tn(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}class Qo{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){let l=r instanceof i.MercatorCoordinate?r:new i.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=i.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;let p=this.position,_=this._elevation?this._elevation.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(r)):0,v=i.MercatorCoordinate.fromLngLat(r,_),E=[v.x-p.x,v.y-p.y,v.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Qi(E,l)}setPitchBearing(r,l){this.orientation=tn(i.degToRad(r),i.degToRad(-l))}}class $a{constructor(r,l){this._transform=i.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){let r=this.position;return new i.MercatorCoordinate(r[0],r[1],r[2])}get position(){let r=i.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&i.setColumn(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||i.identity$1([]),r&&Jo(this._transform,this._orientation)}getPitchBearing(){let r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=tn(r,l),Jo(this._transform,this._orientation)}forward(){let r=i.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){let r=i.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){let r=i.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){let p=new Float64Array(16);return i.invert(p,this.getWorldToCamera(r,l)),p}getWorldToCameraPosition(r,l,p){let _=this.position;i.scale$2(_,_,-r);let v=new Float64Array(16);return i.fromScaling(v,[p,p,p]),i.translate(v,v,_),v[10]*=l,v}getWorldToCamera(r,l){let p=new Float64Array(16),_=new Float64Array(4),v=this.position;return i.conjugate(_,this._orientation),i.scale$2(v,v,-r),i.fromQuat(p,_),i.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(r,l,p,_){let v=new Float64Array(16);return i.perspective(v,r,l,p,_),v}getDistanceToElevation(r,l=!1){let p=r===0?0:i.mercatorZfromAltitude(r,l?i.latFromMercatorY(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new $a([...this.position],[...this.orientation])}}function Co(d,r){let l=Ds(d.projection,d.zoom,d.width,d.height),p=function(v,E,T,I,R){let P=new i.LngLat(T.lng-180*Mi,T.lat),F=new i.LngLat(T.lng+180*Mi,T.lat),G=v.project(P.lng,P.lat),W=v.project(F.lng,F.lat),X=-Math.atan2(W.y-G.y,W.x-G.x),Z=i.MercatorCoordinate.fromLngLat(T);Z.y=i.clamp(Z.y,-1+Mi,1-Mi);let Y=Z.toLngLat(),N=v.project(Y.lng,Y.lat),q=i.MercatorCoordinate.fromLngLat(Y);q.x+=Mi;let Q=q.toLngLat(),te=v.project(Q.lng,Q.lat),he=Is(te.x-N.x,te.y-N.y,X),fe=i.MercatorCoordinate.fromLngLat(Y);fe.y+=Mi;let de=fe.toLngLat(),xe=v.project(de.lng,de.lat),ye=Is(xe.x-N.x,xe.y-N.y,X),Ie=Math.abs(he.x)/Math.abs(ye.y),qe=i.identity([]);i.rotateZ(qe,qe,-X*(1-(R?0:I)));let Ce=i.identity([]);return i.scale(Ce,Ce,[1,1-(1-Ie)*I,1]),Ce[4]=-ye.x/ye.y*I,i.rotateZ(Ce,Ce,X),i.multiply(Ce,qe,Ce),Ce}(d.projection,0,d.center,l,r),_=wl(d);return i.scale(p,p,[_,_,1]),p}function wl(d){let r=d.projection,l=Ds(d.projection,d.zoom,d.width,d.height),p=gc(r,d.center),_=gc(r,i.LngLat.convert(r.center));return Math.pow(2,p*l+(1-l)*_)}function Ds(d,r,l,p,_=1/0){let v=d.range;if(!v)return 0;let E=Math.min(_,Math.max(l,p)),T=Math.log(E/1024)/Math.LN2;return i.smoothstep(v[0]+T,v[1]+T,r)}let Mi=1/4e4;function gc(d,r){let l=i.clamp(r.lat,-i.MAX_MERCATOR_LATITUDE,i.MAX_MERCATOR_LATITUDE),p=new i.LngLat(r.lng-180*Mi,l),_=new i.LngLat(r.lng+180*Mi,l),v=d.project(p.lng,l),E=d.project(_.lng,l),T=i.MercatorCoordinate.fromLngLat(p),I=i.MercatorCoordinate.fromLngLat(_),R=E.x-v.x,P=E.y-v.y,F=I.x-T.x,G=I.y-T.y,W=Math.sqrt((F*F+G*G)/(R*R+P*P));return Math.log(W)/Math.LN2}function Is(d,r,l){let p=Math.cos(l),_=Math.sin(l);return{x:d*p-r*_,y:d*_+r*p}}class To{constructor(r,l,p,_,v,E,T){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(E),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new i.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Gi,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new $a,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){let r=new To(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,l=!1){let p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return i.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};let l=this.projection?this.getProjection():void 0;this.projection=i.getProjection(this.projectionOptions);let p=!w(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){let r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.getProjection({name:"mercator"});let l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.Point(this.width,this.height)}get bearing(){return i.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){let l=-r*Math.PI/180;var p;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new i.ARRAY_TYPE(4),i.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,v,E){var T=v[0],I=v[1],R=v[2],P=v[3],F=Math.sin(E),G=Math.cos(E);_[0]=T*G+R*F,_[1]=I*G+P*F,_[2]=T*-F+R*G,_[3]=I*-F+P*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){let l=i.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=i.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){let l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop(),_=0,v=0;for(let E=0;E<l.length;E++){let T=new i.Point(l[E][0]*this.width,p+l[E][1]*(this.height-p)),I=r.pointCoordinate(T);if(!I)continue;let R=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);_+=I[3]*R,v+=R}return v===0?NaN:_/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),E=Math.max(_-p,v);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){let l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude())),p;p=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];let _=i.length(i.sub([],this._camera.position,p));return i.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!i.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){let p=[r.position.x,r.position.y,r.position.z];i.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let r=this._camera.position,l=new Qo;return l.position=new i.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!i.length$1(r))return!1;i.normalize$1(r,r);let l=i.transformQuat([],[0,0,-1],r),p=i.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;let _=Qi(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){let l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=i.clamp(r[2],_/p,_/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,p){this._unmodified=!1,this._edgeInsets.interpolate(r,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){let l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){let l=[new i.UnwrappedTileID(0,r)];if(this.renderWorldCopies){let p=this.pointCoordinate(new i.Point(0,0)),_=this.pointCoordinate(new i.Point(this.width,0)),v=this.pointCoordinate(new i.Point(this.width,this.height)),E=this.pointCoordinate(new i.Point(0,this.height)),T=Math.floor(Math.min(p.x,_.x,v.x,E.x)),I=Math.floor(Math.max(p.x,_.x,v.x,E.x)),R=1;for(let P=T-R;P<=I+R;P++)P!==0&&l.push(new i.UnwrappedTileID(P,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r),p=l,_=this.elevation&&!r.isTerrainDEM,v=this.projection.name==="mercator";if(r.minzoom!==void 0&&l<r.minzoom)return[];r.maxzoom!==void 0&&l>r.maxzoom&&(l=r.maxzoom);let E=this.locationCoordinate(this.center),T=this.center.lat,I=1<<l,R=[I*E.x,I*E.y,0],P=this.projection.name==="globe",F=!P,G=i.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,F),W=P?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=I*i.mercatorZfromAltitude(1,this.center.lat),Z=this._camera.position[2]/i.mercatorZfromAltitude(1,this.center.lat),Y=[I*W.x,I*W.y,Z*(F?1:X)],N=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,Q=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,te=r.isTerrainDEM?-Q:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?wl(this):1,fe=De=>{let Ye=new i.MercatorCoordinate(De.x+25e-6,De.y,De.z),$e=new i.MercatorCoordinate(De.x,De.y+25e-6,De.z),Je=De.toLngLat(),vt=Ye.toLngLat(),Rt=$e.toLngLat(),mt=this.locationCoordinate(Je),Et=this.locationCoordinate(vt),Qt=this.locationCoordinate(Rt),Kt=Math.hypot(Et.x-mt.x,Et.y-mt.y),_t=Math.hypot(Qt.x-mt.x,Qt.y-mt.y);return Math.sqrt(Kt*_t)*he/25e-6},de=De=>{let ze=Q,Ye=te;return{aabb:i.tileAABB(this,I,0,0,0,De,Ye,ze,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:ze,wrap:De,fullyVisible:!1}},xe=[],ye=[],Ie=l,qe=r.reparseOverscaled?p:l,Ce=De=>De*De,Ve=Ce((Z-this._centerAltitude)*X),Ae=De=>{if(!this._elevation||!De.tileID||!v)return;let ze=this._elevation.getMinMaxForTile(De.tileID),Ye=De.aabb;ze?(Ye.min[2]=ze.min,Ye.max[2]=ze.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(De.shouldSplit=He(De),De.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},He=De=>{if(De.zoom<q)return!0;if(De.zoom===Ie)return!1;if(De.shouldSplit!=null)return De.shouldSplit;let ze=De.aabb.distanceX(Y),Ye=De.aabb.distanceY(Y),$e=Ve,Je=1;if(P){$e=Ce(De.aabb.distanceZ(Y));let mt=Math.pow(2,De.zoom),Et=i.latFromMercatorY((De.y+1)/mt),Qt=i.latFromMercatorY(De.y/mt),Kt=Math.min(Math.max(T,Et),Qt),_t=i.circumferenceAtLatitude(Kt)/i.circumferenceAtLatitude(T);if(Je=Kt===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,_t/this._mercatorScaleRatio),this.zoom<=i.GLOBE_ZOOM_THRESHOLD_MIN&&De.zoom===Ie-1&&_t>=.9)return!0}else if(_&&($e=Ce(De.aabb.distanceZ(Y)*X)),this.projection.isReprojectedInTileSpace&&p<=5){let mt=Math.pow(2,De.zoom),Et=fe(new i.MercatorCoordinate((De.x+.5)/mt,(De.y+.5)/mt));Je=Et>.85?1:Et}let vt=ze*ze+Ye*Ye+$e,Rt=Ce((1<<Ie-De.zoom)*N*Je*((mt,Et)=>{if(Et*Ce(.707)<mt)return 1;let Qt=Math.sqrt(Et/mt);return Qt/(1.4144271570014144+(Math.pow(1.1,Qt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max($e,Ve),vt));return vt<Rt};if(this.renderWorldCopies)for(let De=1;De<=3;De++)xe.push(de(-De)),xe.push(de(De));for(xe.push(de(0));xe.length>0;){let De=xe.pop(),ze=De.x,Ye=De.y,$e=De.fullyVisible;if(!$e){let Je=De.aabb.intersects(G);if(Je===0)continue;$e=Je===2}if(De.zoom!==Ie&&He(De))for(let Je=0;Je<4;Je++){let vt=(ze<<1)+Je%2,Rt=(Ye<<1)+(Je>>1),mt={aabb:v?De.aabb.quadrant(Je):i.tileAABB(this,I,De.zoom+1,vt,Rt,De.wrap,De.minZ,De.maxZ,this.projection),zoom:De.zoom+1,x:vt,y:Rt,wrap:De.wrap,fullyVisible:$e,tileID:void 0,shouldSplit:void 0,minZ:De.minZ,maxZ:De.maxZ};_&&!P&&(mt.tileID=new i.OverscaledTileID(De.zoom+1===Ie?qe:De.zoom+1,De.wrap,De.zoom+1,vt,Rt),Ae(mt)),xe.push(mt)}else{let Je=De.zoom===Ie?qe:De.zoom;if(r.minzoom&&r.minzoom>Je)continue;let vt=R[0]-(.5+ze+(De.wrap<<De.zoom))*(1<<l-De.zoom),Rt=R[1]-.5-Ye,mt=De.tileID?De.tileID:new i.OverscaledTileID(Je,De.wrap,De.zoom,ze,Ye);ye.push({tileID:mt,distanceSq:vt*vt+Rt*Rt})}}if(this.fogCullDistSq){let De=this.fogCullDistSq,ze=this.horizonLineFromTop();ye=ye.filter(Ye=>{let $e=[0,0,0,1],Je=[i.EXTENT,i.EXTENT,0,1],vt=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());i.transformMat4$1($e,$e,vt),i.transformMat4$1(Je,Je,vt);let Rt=i.getAABBPointSquareDist($e,Je);if(Rt===0)return!0;let mt=!1,Et=this._elevation;if(Et&&Rt>De&&ze!==0){let Qt=this.calculateProjMatrix(Ye.tileID.toUnwrapped()),Kt;r.isTerrainDEM||(Kt=Et.getMinMaxForTile(Ye.tileID)),Kt||(Kt={min:te,max:Q});let _t=i.furthestTileCorner(this.rotation),In=[_t[0]*i.EXTENT,_t[1]*i.EXTENT,Kt.max];i.transformMat4(In,In,Qt),mt=(1-In[1])*this.height*.5<ze}return Rt<De||mt})}return ye.sort((De,ze)=>De.distanceSq-ze.distanceSq).map(De=>De.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){let l=i.clamp(r.lat,-i.MAX_MERCATOR_LATITUDE,i.MAX_MERCATOR_LATITUDE),p=this.projection.project(r.lng,l);return new i.Point(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,l){let p,_,v=this.centerPoint;if(this.projection.name==="globe"){let T=this.worldSize;p=(l.x-v.x)/T,_=(l.y-v.y)/T}else{let T=this.pointCoordinate(l),I=this.pointCoordinate(v);p=T.x-I.x,_=T.y-I.y}let E=this.locationCoordinate(r);this.setLocation(new i.MercatorCoordinate(E.x-p,E.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){let p=l?i.mercatorZfromAltitude(l,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new i.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){let p=l??this._centerAltitude,_=[r.x,r.y,0,1],v=[r.x,r.y,1,1];i.transformMat4$1(_,_,this.pixelMatrixInverse),i.transformMat4$1(v,v,this.pixelMatrixInverse);let E=v[3];i.scale$1(_,_,1/_[3]),i.scale$1(v,v,1/E);let T=_[2],I=v[2];return{p0:_,p1:v,t:T===I?0:(p-T)/(I-T)}}screenPointToMercatorRay(r){let l=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return i.transformMat4$1(l,l,this.pixelMatrixInverse),i.transformMat4$1(p,p,this.pixelMatrixInverse),i.scale$1(l,l,1/l[3]),i.scale$1(p,p,1/p[3]),l[2]=i.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=i.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,i.scale$1(l,l,1/this.worldSize),i.scale$1(p,p,1/this.worldSize),new i.Ray([l[0],l[1],l[2]],i.normalize([],i.sub([],p,l)))}rayIntersectionCoordinate(r){let{p0:l,p1:p,t:_}=r,v=i.mercatorZfromAltitude(l[2],this._center.lat),E=i.mercatorZfromAltitude(p[2],this._center.lat);return new i.MercatorCoordinate(i.number(l[0],p[0],_)/this.worldSize,i.number(l[1],p[1],_)/this.worldSize,i.number(v,E,_))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new i.MercatorCoordinate(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(r.y>_)return this.pointCoordinate(r);let v=.02*_,E=r.clone();for(let T=0;T<10&&_-p>v;T++){E.y=i.number(p,_,.66);let I=this.projection.pointCoordinate3D(this,E.x,E.y);I?(_=E.y,l=I):p=E.y}return l?new i.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(r);let l=this.pointCoordinate(r);return l.y>=0&&l.y<=1}_coordinatePoint(r,l){let p=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return i.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new i.Point(_[0]/_[3],_[1]/_[3]):new i.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:r,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=this.pointLocation3D(new i.Point(l,r)),E=this.pointLocation3D(new i.Point(_,r)),T=this.pointLocation3D(new i.Point(_,p)),I=this.pointLocation3D(new i.Point(l,p)),R=Math.min(v.lng,E.lng,T.lng,I.lng),P=Math.max(v.lng,E.lng,T.lng,I.lng),F=Math.min(v.lat,E.lat,T.lat,I.lat),G=Math.max(v.lat,E.lat,T.lat,I.lat),W=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,Z=(Y,N,q,Q,te)=>{let he=(Y+q)/2,fe=(N+Q)/2,de=new i.Point(he,fe),{lng:xe,lat:ye}=this.pointLocation3D(de),Ie=Math.max(0,R-xe,F-ye,xe-P,ye-G);R=Math.min(R,xe),P=Math.max(P,xe),F=Math.min(F,ye),G=Math.max(G,ye),(te<X||Ie>W)&&(Z(Y,N,he,fe,te+1),Z(he,fe,q,Q,te+1))};if(Z(l,r,_,r,1),Z(_,r,_,p,1),Z(_,p,l,p,1),Z(l,p,l,r,1),this.projection.name==="globe"){let[Y,N]=i.polesInViewport(this);Y?(G=90,P=180,R=-180):N&&(F=-90,P=180,R=-180)}return new i.LngLatBounds(new i.LngLat(R,F),new i.LngLat(P,G))}_getBoundsRectangular(r,l){let{top:p,left:_}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,T=new i.Point(_,p),I=new i.Point(E,p),R=new i.Point(E,v),P=new i.Point(_,v),F=this.pointCoordinate(T,r),G=this.pointCoordinate(I,r),W=this.pointCoordinate(R,l),X=this.pointCoordinate(P,l),Z=(Y,N)=>(N.y-Y.y)/(N.x-Y.x);return F.y>1&&G.y>=0?F=new i.MercatorCoordinate((1-X.y)/Z(X,F)+X.x,1):F.y<0&&G.y<=1&&(F=new i.MercatorCoordinate(-X.y/Z(X,F)+X.x,0)),G.y>1&&F.y>=0?G=new i.MercatorCoordinate((1-W.y)/Z(W,G)+W.x,1):G.y<0&&F.y<=1&&(G=new i.MercatorCoordinate(-W.y/Z(W,G)+W.x,0)),new i.LngLatBounds().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){let r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);let l=r.visibleDemTiles.reduce((p,_)=>{if(_.dem){let v=_.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){let l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-i.MAX_MERCATOR_LATITUDE,this.maxLat=i.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=i.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=i.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=i.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){let l=r.key,p=this._distanceTileDataCache;if(p[l])return p[l];let _=r.canonical,v=1/this.height,E=this.cameraWorldSize,T=E/this.zoomScale(_.z),I=(_.x+Math.pow(2,_.z)*r.wrap)*T,R=_.y*T,P=this.point;P.x*=E/this.worldSize,P.y*=E/this.worldSize;let F=this.angle,G=Math.sin(-F),W=-Math.cos(-F);return p[l]={bearing:[G,W],center:[(P.x-I)*v,(P.y-R)*v],scale:T/i.EXTENT*v},p[l]}calculateFogTileMatrix(r){let l=r.key,p=this._fogTileMatrixCache;if(p[l])return p[l];let _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return i.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(r,l=!1){let p=r.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];let v=this.calculatePosMatrix(r,this.worldSize);return i.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,v),_[p]=new Float32Array(v),_[p]}calculatePixelsToTileUnitsMatrix(r){let l=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];let _=function(v,E){let{scale:T}=v.tileTransform,I=T*i.EXTENT/(v.tileSize*Math.pow(2,E.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return R=new Float32Array(4),G=(P=E.inverseAdjustmentMatrix)[1],W=P[2],X=P[3],Y=(F=[I,I])[1],R[0]=P[0]*(Z=F[0]),R[1]=G*Z,R[2]=W*Y,R[3]=X*Y,R;var R,P,F,G,W,X,Z,Y}(r,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let r=1/this.worldSize,l=i.fromScaling([],[r,r,r]);return i.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let r=this._elevation;this._updateCameraState();let l=i.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),v=i.mercatorZfromAltitude(1,this._center.lat);p[2]/=v,_[2]/=v,i.normalize(_,_);let E=r.raycast(p,_,r.exaggeration());if(E){let T=i.scaleAndAdd([],p,_,E),I=new i.MercatorCoordinate(T[0],T[1],i.mercatorZfromAltitude(T[2],i.latFromMercatorY(T[1]))),R=(I.z+i.length([I.x-p[0],I.y-p[1],I.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;let l=this._elevation,p=i.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),v=l.getAtPointOrZero(new i.MercatorCoordinate(..._)),E=this.pixelsPerMeter/this.worldSize*v,T=this._minimumHeightOverTerrain(),I=_[2]-E;if(I<=T)if(I<0||r){let R=this.locationCoordinate(this._center,this._centerAltitude),P=[_[0],_[1],R.z-_[2]],F=i.length(P);P[2]-=(T-I)/this._pixelsPerMercatorPixel;let G=i.length(P);if(G===0)return;i.scale$2(P,P,F/G*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],R.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){let G=this.center;return G.lat=i.clamp(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(G.lng=i.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}let l=this._unmodified,{x:p,y:_}=this.point,v=0,E=p,T=_,I=this.width/2,R=this.height/2,P=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(_-R<P&&(T=P+R),_+R>F&&(T=F-R),F-P<this.height&&(v=Math.max(v,this.height/(F-P)),T=(F+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let G=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,X=this.worldSize/2-(G+W)/2;E=(p+X+this.worldSize)%this.worldSize-X,E-I<G&&(E=G+I),E+I>W&&(E=W-I),W-G<this.width&&(v=Math.max(v,this.width/(W-G)),E=(W+G)/2)}E===p&&T===_||(this.center=this.unproject(new i.Point(E,T))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let r=this.centerOffset,l=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.mercatorZfromAltitude(1,this.center.lat)/i.mercatorZfromAltitude(1,i.GLOBE_SCALE_MATCH_LATITUDE));let p=Ds(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let _=this.projection.zAxisUnit==="meters"?l:1,v=this._camera.getWorldToCamera(this.worldSize,_),E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);E[8]=2*-r.x/this.width,E[9]=2*r.y/this.height;let T=i.mul([],E,v);if(this.projection.isReprojectedInTileSpace){let fe=this.locationCoordinate(this.center),de=i.identity([]);i.translate(de,de,[fe.x*this.worldSize,fe.y*this.worldSize,0]),i.multiply(de,de,Co(this)),i.translate(de,de,[-fe.x*this.worldSize,-fe.y*this.worldSize,0]),i.multiply(T,T,de),this.inverseAdjustmentMatrix=function(xe){let ye=Co(xe,!0);return rt([],[ye[0],ye[1],ye[4],ye[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=i.scale([],T,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=T,this.invProjMatrix=i.invert(new Float64Array(16),this.projMatrix);let I=i.invert([],E);this.frustumCorners=i.FrustumCorners.fromInvProjectionMatrix(I,this.horizonLineFromTop(),this.height);let R=new Float32Array(16);i.identity(R),i.scale(R,R,[1,-1,1]),i.rotateX(R,R,this._pitch),i.rotateZ(R,R,this.angle);let P=i.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),F=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-r.x/this.width,P[9]=2*(r.y+F)/this.height,this.skyboxMatrix=i.multiply(R,P,R);let G=this.point,W=G.x,X=G.y,Z=this.width%2/2,Y=this.height%2/2,N=Math.cos(this.angle),q=Math.sin(this.angle),Q=W-Math.round(W)+N*Z+q*Y,te=X-Math.round(X)+N*Y+q*Z,he=new Float64Array(T);if(i.translate(he,he,[Q>.5?Q-1:Q,te>.5?te-1:te,0]),this.alignedProjMatrix=he,T=i.create(),i.scale(T,T,[this.width/2,-this.height/2,1]),i.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=i.create(),i.scale(T,T,[1,-1,1]),i.translate(T,T,[-1,-1,0]),i.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=i.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=i.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.calculateGlobeMatrix(this);let fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.transformMat4(fe,fe,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,v=[r,r,l];i.scale$2(v,v,_),i.scale$2(p,p,-1),i.multiply$2(p,p,v);let E=i.create();i.translate(E,E,p),i.scale(E,E,v),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,_)}_computeCameraPosition(r){let l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*v,_.y/this.worldSize-p[1]*v,r/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){let l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=r[2],v=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(v=Math.min((l-p)/_,1)),this._camera.position=i.scaleAndAdd([],this._camera.position,r,v),this._updateStateFromCamera()}_updateStateFromCamera(){let r=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),v=i.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.degToRad(this._maxPitch)),T=Math.max((r[2]-v)/Math.cos(p),E),I=this._zoomFromMercatorZ(T);i.scaleAndAdd(r,r,l,T),this._pitch=i.clamp(p,i.degToRad(this.minPitch),i.degToRad(this.maxPitch)),this.angle=i.wrap(_,-Math.PI,Math.PI),this._setZoom(i.clamp(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){let r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let l=0,p=i.GLOBE_ZOOM_THRESHOLD_MAX,_=0,v=1/0;for(;p-l>1e-6&&p>l;){let E=l+.5*(p-l),T=this.tileSize*Math.pow(2,E),I=this.getCameraToCenterDistance(this.projection,E,T),R=this.scaleZoom(I/(r*this.tileSize)),P=Math.abs(E-R);P<v&&(v=P,_=E),E<R?l=E:p=E}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){let p=Math.min(r.x,l.x),_=Math.max(r.x,l.x),v=Math.min(r.y,l.y),E=Math.max(r.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let T=[new i.Point(p,v),new i.Point(_,E),new i.Point(p,E),new i.Point(_,v)],I=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(let P of T){let F=this.pointRayIntersection(P);if(F.t<0)return!0;let G=this.rayIntersectionCoordinate(F);if(G.x<I||G.y<0||G.x>R||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.Point(0,0),new i.Point(this.width,this.height))}zoomDeltaToMovement(r,l){let p=i.length(i.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){let r=function([l,p,_],v){let E=[l,p,_,1];i.transformMat4$1(E,E,v);let T=E[3]=Math.max(E[3],1e-6);return E[0]/=T,E[1]/=T,E[2]/=T,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.Point(r[0],r[1])}{let r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.Point(0,r))}}getCameraToCenterDistance(r,l=this.zoom,p=this.worldSize){let _=Ds(r,l,this.width,this.height,1024),v=r.pixelSpaceConversion(this.center.lat,p,_);return .5/Math.tan(.5*this._fov)*this.height*v}getWorldToCameraMatrix(){let r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.multiply(r,r,this.globeMatrix),r}}function El(d,r){let l=!1,p=null,_=()=>{p=null,l&&(d(),p=setTimeout(_,r),l=!1)};return()=>(l=!0,p||_(),p)}class Uh{constructor(r){this._hashName=r&&encodeURIComponent(r),i.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=El(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,i.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),i.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let r=this._map;if(!r)return"";let l=_c(r);if(this._hashName){let p=this._hashName,_=!1,v=i.window.location.hash.slice(1).split("&").map(E=>{let T=E.split("=")[0];return T===p?(_=!0,`${T}=${l}`):E}).filter(E=>E);return _||v.push(`${p}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){let r=i.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){let r=this._map;if(!r)return!1;let l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){let p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){let r=i.window.location.href.replace(/(#.+)?$/,this.getHashString());i.window.history.replaceState(i.window.history.state,null,r)}}function _c(d,r){let l=d.getCenter(),p=Math.round(100*d.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),E=Math.round(l.lng*v)/v,T=Math.round(l.lat*v)/v,I=d.getBearing(),R=d.getPitch(),P=r?`/${E}/${T}/${p}`:`${p}/${T}/${E}`;return(I||R)&&(P+="/"+Math.round(10*I)/10),R&&(P+=`/${Math.round(R)}`),P}let yc={linearity:.3,easing:i.bezier(0,0,.3,1)},_u=i.extend({deceleration:2500,maxSpeed:1400},yc),yu=i.extend({deceleration:20,maxSpeed:1400},yc),dt=i.extend({deceleration:1e3,maxSpeed:360},yc),Do=i.extend({deceleration:1e3,maxSpeed:90},yc);class Rf{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.exported.now(),settings:r})}_drainInertiaBuffer(){let r=this._inertiaBuffer,l=i.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let l={zoom:0,bearing:0,pitch:0,pan:new i.Point(0,0),pinchAround:void 0,around:void 0};for(let{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);let p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){let v=xc(l.pan.mag(),p,i.extend({},_u,r||{}));_.offset=l.pan.mult(v.amount/l.pan.mag()),_.center=this._map.transform.center,vc(_,v)}if(l.zoom){let v=xc(l.zoom,p,yu);_.zoom=this._map.transform.zoom+v.amount,vc(_,v)}if(l.bearing){let v=xc(l.bearing,p,dt);_.bearing=this._map.transform.bearing+i.clamp(v.amount,-179,179),vc(_,v)}if(l.pitch){let v=xc(l.pitch,p,Do);_.pitch=this._map.transform.pitch+v.amount,vc(_,v)}if(_.zoom||_.bearing){let v=l.pinchAround===void 0?l.around:l.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function vc(d,r){(!d.duration||d.duration<r.duration)&&(d.duration=r.duration,d.easing=r.easing)}function xc(d,r,l){let{maxSpeed:p,linearity:_,deceleration:v}=l,E=i.clamp(d*_/(r/1e3),-p,p),T=Math.abs(E)/(v*_);return{easing:l.easing,duration:1e3*T,amount:E*(T/2)}}class Br extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p,_={}){let v=Un(l.getCanvasContainer(),p),E=l.unproject(v);super(r,i.extend({point:v,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class bc extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){let _=r==="touchend"?p.changedTouches:p.touches,v=xr(l.getCanvasContainer(),_),E=v.map(I=>l.unproject(I)),T=v.reduce((I,R,P,F)=>I.add(R.div(F.length)),new i.Point(0,0));super(r,{points:v,point:T,lngLats:E,lngLat:l.unproject(T),originalEvent:p}),this._defaultPrevented=!1}}class vu extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class $h{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new vu(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Br(r.type,this._map,r))}mouseup(r){this._map.fire(new Br(r.type,this._map,r))}preclick(r){let l=i.extend({},r);l.type="preclick",this._map.fire(new Br(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Br(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Br(r.type,this._map,r))}mouseover(r){this._map.fire(new Br(r.type,this._map,r))}mouseout(r){this._map.fire(new Br(r.type,this._map,r))}touchstart(r){return this._firePreventable(new bc(r.type,this._map,r))}touchmove(r){this._map.fire(new bc(r.type,this._map,r))}touchend(r){this._map.fire(new bc(r.type,this._map,r))}touchcancel(r){this._map.fire(new bc(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xu{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Br(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Br(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Of{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(Mt(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;let p=l,_=this._startPos,v=this._lastPos;if(!_||!v||v.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=ie("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));let E=Math.min(_.x,p.x),T=Math.max(_.x,p.x),I=Math.min(_.y,p.y),R=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${I}px)`,this._box.style.width=T-E+"px",this._box.style.height=R-I+"px")})}mouseupWindow(r,l){if(!this._active)return;let p=this._startPos,_=l;if(p&&r.button===0){if(this.reset(),gn(),p.x!==_.x||p.y!==_.y)return this._map.fire(new i.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),En(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new i.Event(r,{originalEvent:l}))}}function bu(d,r){let l={};for(let p=0;p<d.length;p++)l[d[p].identifier]=r[p];return l}class Cl{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){let v=new i.Point(0,0);for(let E of _)v._add(E);return v.div(_.length)}(l),this.touches=bu(p,l)))}touchmove(r,l,p){if(this.aborted||!this.centroid)return;let _=bu(p,l);for(let v in this.touches){let E=_[v];(!E||E.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(r,l,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){let _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Gh{constructor(r){this.singleTap=new Cl(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,p){this.singleTap.touchstart(r,l,p)}touchmove(r,l,p){this.singleTap.touchmove(r,l,p)}touchend(r,l,p){let _=this.singleTap.touchend(r,l,p);if(_){let v=r.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(v&&E||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class wg{constructor(){this._zoomIn=new Gh({numTouches:1,numTaps:2}),this._zoomOut=new Gh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,p){this._zoomIn.touchstart(r,l,p),this._zoomOut.touchstart(r,l,p)}touchmove(r,l,p){this._zoomIn.touchmove(r,l,p),this._zoomOut.touchmove(r,l,p)}touchend(r,l,p){let _=this._zoomIn.touchend(r,l,p),v=this._zoomOut.touchend(r,l,p);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let kf={0:1,2:2};class Tl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;let p=ei(r);this._correctButton(r,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(r,l){let p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&function(_,v){let E=kf[v];return _.buttons===void 0||(_.buttons&E)!==E}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(r){this._lastPoint&&ei(r)===this._eventButton&&(this._moved&&gn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hh extends Tl{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return l===0&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class qh extends Tl{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){let p=.8*(l.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class Wh extends Tl{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){let p=-.5*(l.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class wu{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),i.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.Point(0,0)}touchstart(r,l,p){return this._calculateTransform(r,l,p)}touchmove(r,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!i.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,p)}}touchend(r,l,p){this._calculateTransform(r,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,p){p.length>0&&(this._active=!0);let _=bu(p,l),v=new i.Point(0,0),E=new i.Point(0,0),T=0;for(let R in _){let P=_[R],F=this._touches[R];F&&(v._add(P),E._add(P.sub(F)),T++,_[R]=P)}if(this._touches=_,T<this._minTouches||!E.mag())return;let I=E.div(T);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(T),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ie("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class wc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,p){return{}}touchstart(r,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,p){let _=this._firstTwoTouches;if(!_)return;r.preventDefault();let[v,E]=_,T=Ec(p,l,v),I=Ec(p,l,E);if(!T||!I)return;let R=this._aroundCenter?null:T.add(I).div(2);return this._move([T,I],R,r)}touchend(r,l,p){if(!this._firstTwoTouches)return;let[_,v]=this._firstTwoTouches,E=Ec(p,l,_),T=Ec(p,l,v);E&&T||(this._active&&gn(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ec(d,r,l){for(let p=0;p<d.length;p++)if(d[p].identifier===l)return r[p]}function Zh(d,r){return Math.log(d/r)/Math.LN2}class Lf extends wc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){let p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Zh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zh(this._distance,p),pinchAround:l}}}function Xh(d,r){return 180*d.angleWith(r)/Math.PI}class Ff extends wc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){let p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Xh(this._vector,p),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());let l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;let _=Xh(r,p);return Math.abs(_)<l}}function ca(d){return Math.abs(d.y)>Math.abs(d.x)}class Nf extends wc{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,ca(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,p){let _=this._lastPoints;if(!_)return;let v=r[0].sub(_[0]),E=r[1].sub(_[1]);return this._map._cooperativeGestures&&!i.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,E,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+E.y)/2*-.5})}gestureBeginsVertically(r,l,p){if(this._valid!==void 0)return this._valid;let _=r.mag()>=2,v=l.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;let E=r.y>0==l.y>0;return ca(r)&&ca(l)&&E}}let zf={panStep:100,bearingStep:15,pitchStep:10};class Eg{constructor(){let r=zf;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,p=0,_=0,v=0,E=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),E=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:T=>{let I=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:Bf,zoom:l?Math.round(I)+l*(r.shiftKey?2:1):I,bearing:T.getBearing()+p*this._bearingStep,pitch:T.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:T.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bf(d){return d*(2-d)}let Yh=4.000244140625;class Vf{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,i.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||i.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===i.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY,p=i.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%Yh==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let l=Un(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){let I=this._type==="wheel"&&Math.abs(this._delta)>Yh?this._wheelZoomRate:this._defaultZoomRate,R=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&R!==0&&(R=1/R);let P=l(),F=Math.pow(2,P),G=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(G*R))),this._type==="wheel"&&(this._startZoom=P,this._easing=this._smoothOutEasing(200)),this._delta=0}let p=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,v=this._easing,E,T=!1;if(this._type==="wheel"&&_&&v){let I=Math.min((i.exported.now()-this._lastWheelEventTime)/200,1),R=v(I);E=i.number(_,p,R),I<1?this._frameId||(this._frameId=!0):T=!0}else E=p,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:E-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=i.ease;if(this._prevEase){let p=this._prevEase,_=(i.exported.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(v*v+1e-4)*.01,T=Math.sqrt(.0729-E*E);l=i.bezier(E,T,.25,1)}return this._prevEase={start:i.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ie("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(i.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class jf{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ai{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cg{constructor(){this._tap=new Gh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,l,p))}touchmove(r,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;let _=l[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,l,p)}touchend(r,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,l,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uf{constructor(r,l,p){this._el=r,this._mousePan=l,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Tg{constructor(r,l,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Dg{constructor(r,l,p,_){this._el=r,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let eo=d=>d.zoom||d.drag||d.pitch||d.rotate;class $f extends i.Event{}class Ig{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){let p=i.sub([],l,r);this.radius=i.length(p[2]<0?i.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){i.div(r,r,this.constants),i.normalize(r,r),i.mul$1(r,r,this.constants);let l=i.scale$2([],r,this.radius);if(l[2]>0){let p=i.scale$2([],[0,0,1],i.dot(l,[0,0,1])),_=i.scale$2([],i.normalize([],[l[0],l[1],0]),this.radius),v=i.add([],l,i.scale$2([],i.sub([],i.add([],_,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function Io(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class es{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rf(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ig,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),i.bindAll(["handleEvent","handleWindowEvent"],this);let p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[i.window.document,"mousemove",{capture:!0}],[i.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[i.window,"blur",void 0]];for(let[_,v,E]of this._listeners)_.addEventListener(v,_===i.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(let[r,l,p]of this._listeners)r.removeEventListener(l,r===i.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){let l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new $h(l,r));let _=l.boxZoom=new Of(l,r);this._add("boxZoom",_);let v=new wg,E=new ai;l.doubleClickZoom=new jf(E,v),this._add("tapZoom",v),this._add("clickZoom",E);let T=new Cg;this._add("tapDragZoom",T);let I=l.touchPitch=new Nf(l);this._add("touchPitch",I);let R=new qh(r),P=new Wh(r);l.dragRotate=new Tg(r,R,P),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);let F=new Hh(r),G=new wu(l,r);l.dragPan=new Uf(p,F,G),this._add("mousePan",F),this._add("touchPan",G,["touchZoom","touchRotate"]);let W=new Ff,X=new Lf;l.touchZoomRotate=new Dg(p,X,W,T),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new xu(l));let Z=l.scrollZoom=new Vf(l,this);this._add("scrollZoom",Z,["mousePan"]);let Y=l.keyboard=new Eg;this._add("keyboard",Y);for(let N of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[N]&&l[N].enable(r[N])}_add(r,l,p){this._handlers.push({handlerName:r,handler:l,allowed:p}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(let{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(let{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!eo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,p){for(let _ in r)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){let l=[];for(let p of r)this._el.contains(p.target)&&l.push(p);return l}handleEvent(r,l){this._updatingCamera=!0;let p=r.type==="renderFrame",_=p?void 0:r,v={needsRenderFrame:!1},E={},T={},I=r.touches?this._getMapTouches(r.touches):void 0,R=I?xr(this._el,I):p?void 0:Un(this._el,r);for(let{handlerName:G,handler:W,allowed:X}of this._handlers){if(!W.isEnabled())continue;let Z;this._blockedByActive(T,X,G)?W.reset():W[l||r.type]&&(Z=W[l||r.type](r,R,I),this.mergeHandlerResult(v,E,Z,G,_),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||W.isActive())&&(T[G]=W)}let P={};for(let G in this._previousActiveHandlers)T[G]||(P[G]=_);this._previousActiveHandlers=T,(Object.keys(P).length||Io(v))&&(this._changes.push([v,E,P]),this._triggerRenderFrame()),(Object.keys(T).length||Io(v))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=v;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(r,l,p,_,v){if(!p)return;i.extend(r,p);let E={handlerName:_,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(l.zoom=E),p.panDelta!==void 0&&(l.drag=E),p.pitchDelta!==void 0&&(l.pitch=E),p.bearingDelta!==void 0&&(l.rotate=E)}_applyChanges(){let r={},l={},p={};for(let[_,v,E]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new i.Point(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),i.extend(l,v),i.extend(p,E);this._updateMapTransform(r,l,p),this._changes=[]}_updateMapTransform(r,l,p){let _=this._map,v=_.transform,E=q=>[q.x,q.y,q.z];if((q=>{let Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!Io(r)){let q=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",q!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&_._stop(!0),!Io(r))return void this._fireEvents(l,p,!0);let{panDelta:T,zoomDelta:I,bearingDelta:R,pitchDelta:P,around:F,aroundCoord:G,pinchAround:W}=r;v._isCameraConstrained&&(I>0&&(I=0),v._isCameraConstrained=!1),W!==void 0&&(F=W),(I||(q=>l[q]&&!this._eventsInProgress[q])("drag"))&&F&&(this._dragOrigin=E(v.pointCoordinate3D(F)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),F=F||_.transform.centerPoint,R&&(v.bearing+=R),P&&(v.pitch+=P),v._updateCameraState();let X=[0,0,0];if(T)if(v.projection.name==="mercator"){let q=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(F).dir),Q=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(F.sub(T)).dir);X[0]=Q[0]-q[0],X[1]=Q[1]-q[1]}else{let q=v.pointCoordinate(F);if(v.projection.name==="globe"){T=T.rotate(-v.angle);let Q=v._pixelsPerMercatorPixel/v.worldSize;X[0]=-T.x*i.mercatorScale(i.latFromMercatorY(q.y))*Q,X[1]=-T.y*i.mercatorScale(v.center.lat)*Q}else{let Q=v.pointCoordinate(F.sub(T));q&&Q&&(X[0]=Q.x-q.x,X[1]=Q.y-q.y)}}let Z=v.zoom,Y=[0,0,0];if(I){let q=E(G||v.pointCoordinate3D(F)),Q={dir:i.normalize([],i.sub([],q,v._camera.position))};if(Q.dir[2]<0){let te=v.zoomDeltaToMovement(q,I);i.scale$2(Y,Q.dir,te)}}let N=i.add(X,X,Y);v._translateCameraConstrained(N),I&&Math.abs(v.zoom-Z)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,p,!0)}_fireEvents(r,l,p){let _=eo(this._eventsInProgress),v=eo(r),E={};for(let P in r){let{originalEvent:F}=r[P];this._eventsInProgress[P]||(E[`${P}start`]=F),this._eventsInProgress[P]=r[P]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(let P in E)this._fireEvent(P,E[P]);v&&this._fireEvent("move",v.originalEvent);for(let P in r){let{originalEvent:F}=r[P];this._fireEvent(P,F)}let T={},I;for(let P in this._eventsInProgress){let{handlerName:F,originalEvent:G}=this._eventsInProgress[P];this._handlersById[F].isActive()||(delete this._eventsInProgress[P],I=l[F]||G,T[`${P}end`]=I)}for(let P in T)this._fireEvent(P,T[P]);let R=eo(this._eventsInProgress);if(p&&(_||v)&&!R){this._updatingCamera=!0;let P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;P?(F(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:I})):(this._map.fire(new i.Event("moveend",{originalEvent:I})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new i.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new $f("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Ga="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Eu extends i.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,i.bindAll(["_renderFrameCallback"],this)}getCenter(){return new i.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,p){return r=i.Point.convert(r).mult(-1),this.panTo(this.transform.center,i.extend({offset:r},l),p)}panTo(r,l,p){return this.easeTo(i.extend({center:r},l),p)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,p){return this.easeTo(i.extend({zoom:r},l),p)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,p){return this.easeTo(i.extend({bearing:r},l),p)}resetNorth(r,l){return this.rotateTo(0,i.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(i.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=i.LngLatBounds.convert(r);let p=l&&l.bearing||0,_=l&&l.pitch||0,v=r.getNorthWest(),E=r.getSouthEast();return this._cameraForBounds(this.transform,v,E,p,_,l)}_extendCameraOptions(r){let l={top:0,bottom:0,right:0,left:0};if(typeof(r=i.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){let p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=i.extend(l,r.padding),r}_minimumAABBFrustumDistance(r,l){let p=l.max[0]-l.min[0],_=l.max[1]-l.min[1];return p/_>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,p,_,v,E){let T=r.clone(),I=this._extendCameraOptions(E);T.bearing=_,T.pitch=v;let R=i.LngLat.convert(l),P=i.LngLat.convert(p),F=.5*(R.lat+P.lat),G=.5*(R.lng+P.lng),W=i.latLngToECEF(F,G),X=i.normalize([],W),Z=i.normalize([],i.cross([],X,[0,1,0])),Y=i.cross([],Z,X),N=[Z[0],Z[1],Z[2],0,Y[0],Y[1],Y[2],0,X[0],X[1],X[2],0,0,0,0,1],q=[W,i.latLngToECEF(R.lat,R.lng),i.latLngToECEF(P.lat,R.lng),i.latLngToECEF(P.lat,P.lng),i.latLngToECEF(R.lat,P.lng),i.latLngToECEF(F,R.lng),i.latLngToECEF(F,P.lng),i.latLngToECEF(R.lat,G),i.latLngToECEF(P.lat,G)],Q=i.Aabb.fromPoints(q.map($e=>[i.dot(Z,$e),i.dot(Y,$e),i.dot(X,$e)])),te=i.transformMat4([],Q.center,N);i.squaredLength(te)===0&&i.set(te,0,0,1),i.normalize(te,te),i.scale$2(te,te,i.GLOBE_RADIUS),T.center=i.ecefToLatLng(te);let he=T.getWorldToCameraMatrix(),fe=i.invert(new Float64Array(16),he);Q=i.Aabb.applyTransform(Q,i.multiply([],he,N)),i.transformMat4(te,te,he);let de=.5*(Q.max[2]-Q.min[2]),xe=this._minimumAABBFrustumDistance(T,Q),ye=i.scale$2([],[0,0,1],de),Ie=i.add(ye,te,ye),qe=xe+(T.pitch===0?0:i.distance(te,Ie)),Ce=T.globeCenterInViewSpace,Ve=i.sub([],te,[Ce[0],Ce[1],Ce[2]]);i.normalize(Ve,Ve),i.scale$2(Ve,Ve,qe);let Ae=i.add([],te,Ve);i.transformMat4(Ae,Ae,fe);let He=i.earthRadius/i.GLOBE_RADIUS,De=i.length(Ae),ze=i.mercatorZfromAltitude(Math.max(De*He-i.earthRadius,Number.EPSILON),0),Ye=Math.min(T.zoomFromMercatorZAdjusted(ze),I.maxZoom);return Ye>.5*(i.GLOBE_ZOOM_THRESHOLD_MIN+i.GLOBE_ZOOM_THRESHOLD_MAX)?(T.setProjection({name:"mercator"}),T.zoom=Ye,this._cameraForBounds(T,l,p,_,v,E)):{center:T.center,zoom:Ye,bearing:_,pitch:v}}queryTerrainElevation(r,l){let p=this.transform.elevation;return p?(l=i.extend({},{exaggerated:!0},l),p.getAtPoint(i.MercatorCoordinate.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,p,_,v,E){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,l,p,_,v,E);let T=r.clone(),I=this._extendCameraOptions(E),R=T.padding;T.bearing=_,T.pitch=v;let P=i.LngLat.convert(l),F=i.LngLat.convert(p),G=new i.LngLat(P.lng,F.lat),W=new i.LngLat(F.lng,P.lat),X=T.project(P),Z=T.project(F),Y=this.queryTerrainElevation(P),N=this.queryTerrainElevation(F),q=this.queryTerrainElevation(G),Q=this.queryTerrainElevation(W),te=[[X.x,X.y,Math.min(Y||0,N||0,q||0,Q||0)],[Z.x,Z.y,Math.max(Y||0,N||0,q||0,Q||0)]],he=i.Aabb.fromPoints(te),fe=T.getWorldToCameraMatrix(),de=i.invert(new Float64Array(16),fe);he=i.Aabb.applyTransform(he,fe);let xe=i.sub([],he.max,he.min),ye=R.left||0,Ie=R.right||0,qe=R.bottom||0,Ce=R.top||0,{left:Ve,right:Ae,top:He,bottom:De}=I.padding,ze=.5*(ye+Ie),Ye=.5*(Ce+qe),$e=Math.min(T.scaleZoom(T.scale*Math.min((T.width-(ye+Ie+Ve+Ae))/xe[0],(T.height-(qe+Ce+De+He))/xe[1])),I.maxZoom),Je=T.scale/T.zoomScale($e);he=new i.Aabb([he.min[0]-(Ve+ze)*Je,he.min[1]-(De+Ye)*Je,he.min[2]],[he.max[0]+(Ae+ze)*Je,he.max[1]+(He+Ye)*Je,he.max[2]]);let vt=.5*xe[2],Rt=this._minimumAABBFrustumDistance(T,he),mt=[0,0,1,0];i.transformMat4$1(mt,mt,fe),i.normalize$2(mt,mt);let Et=i.scale$2([],mt,Rt+vt),Qt=i.add([],he.center,Et),Kt=(typeof I.offset.x=="number"&&typeof I.offset.y=="number"?new i.Point(I.offset.x,I.offset.y):i.Point.convert(I.offset)).rotate(-i.degToRad(_));he.center[0]-=Kt.x*Je,he.center[1]+=Kt.y*Je,i.transformMat4(he.center,he.center,de),i.transformMat4(Qt,Qt,de);let _t=[he.center[0],he.center[1],Qt[2]*T.pixelsPerMeter];i.scale$2(_t,_t,1/T.worldSize);let In=i.lngFromMercatorX(_t[0]),On=i.latFromMercatorY(_t[1]),kn=Math.min(T._zoomFromMercatorZ(_t[2]),I.maxZoom),Ln=new i.LngLat(In,On);return T.mercatorFromTransition&&kn<.5*(i.GLOBE_ZOOM_THRESHOLD_MIN+i.GLOBE_ZOOM_THRESHOLD_MAX)?(T.setProjection({name:"globe"}),T.zoom=kn,this._cameraForBounds(T,l,p,_,v,E)):{center:Ln,zoom:kn,bearing:_,pitch:v}}fitBounds(r,l,p){let _=this.cameraForBounds(r,l);return this._fitInternal(_,l,p)}fitScreenCoordinates(r,l,p,_,v){let E=i.Point.convert(r),T=i.Point.convert(l),I=new i.Point(Math.min(E.x,T.x),Math.min(E.y,T.y)),R=new i.Point(Math.max(E.x,T.x),Math.max(E.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,T))return this;let P=this.transform.pointLocation3D(I),F=this.transform.pointLocation3D(R),G=this.transform.pointLocation3D(new i.Point(I.x,R.y)),W=this.transform.pointLocation3D(new i.Point(R.x,I.y)),X=[Math.min(P.lng,F.lng,G.lng,W.lng),Math.min(P.lat,F.lat,G.lat,W.lat)],Z=[Math.max(P.lng,F.lng,G.lng,W.lng),Math.max(P.lat,F.lat,G.lat,W.lat)],Y=_&&_.pitch?_.pitch:this.getPitch(),N=this._cameraForBounds(this.transform,X,Z,p,Y,_);return this._fitInternal(N,_,v)}_fitInternal(r,l,p){return r?(delete(l=i.extend(r,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(r,l){this.stop();let p=r.preloadOnly?this.transform.clone():this.transform,_=!1,v=!1,E=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(_=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=i.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(v=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(E=!0,p.pitch=+r.pitch),r.padding==null||p.isPaddingEqual(r.padding)||(p.padding=r.padding),r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new i.Event("movestart",l)).fire(new i.Event("move",l)),_&&this.fire(new i.Event("zoomstart",l)).fire(new i.Event("zoom",l)).fire(new i.Event("zoomend",l)),v&&this.fire(new i.Event("rotatestart",l)).fire(new i.Event("rotate",l)).fire(new i.Event("rotateend",l)),E&&this.fire(new i.Event("pitchstart",l)).fire(new i.Event("pitch",l)).fire(new i.Event("pitchend",l)),this.fire(new i.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.warnOnce(Ga),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){let p=this.transform;if(!p.projection.supportsFreeCamera)return i.warnOnce(Ga),this;this.stop();let _=p.zoom,v=p.pitch,E=p.bearing;p.setFreeCameraOptions(r);let T=_!==p.zoom,I=v!==p.pitch,R=E!==p.bearing;return this.fire(new i.Event("movestart",l)).fire(new i.Event("move",l)),T&&this.fire(new i.Event("zoomstart",l)).fire(new i.Event("zoom",l)).fire(new i.Event("zoomend",l)),R&&this.fire(new i.Event("rotatestart",l)).fire(new i.Event("rotate",l)).fire(new i.Event("rotateend",l)),I&&this.fire(new i.Event("pitchstart",l)).fire(new i.Event("pitch",l)).fire(new i.Event("pitchend",l)),this.fire(new i.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),((r=i.extend({offset:[0,0],duration:500,easing:i.ease},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);let p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),T=this.getPadding(),I="zoom"in r?+r.zoom:_,R="bearing"in r?this._normalizeBearing(r.bearing,v):v,P="pitch"in r?+r.pitch:E,F="padding"in r?r.padding:p.padding,G=i.Point.convert(r.offset),W,X,Z;if(p.projection.name==="globe"){let ye=i.MercatorCoordinate.fromLngLat(p.center),Ie=G.rotate(-p.angle);ye.x+=Ie.x/p.worldSize,ye.y+=Ie.y/p.worldSize;let qe=ye.toLngLat(),Ce=i.LngLat.convert(r.center||qe);this._normalizeCenter(Ce),W=p.centerPoint.add(Ie),X=new i.Point(ye.x,ye.y).mult(p.worldSize),Z=new i.Point(i.mercatorXfromLng(Ce.lng),i.mercatorYfromLat(Ce.lat)).mult(p.worldSize).sub(X)}else{W=p.centerPoint.add(G);let ye=p.pointLocation(W),Ie=i.LngLat.convert(r.center||ye);this._normalizeCenter(Ie),X=p.project(ye),Z=p.project(Ie).sub(X)}let Y=p.zoomScale(I-_),N,q;r.around&&(N=i.LngLat.convert(r.around),q=p.locationPoint(N));let Q=this._zooming||I!==_,te=this._rotating||v!==R,he=this._pitching||P!==E,fe=!p.isPaddingEqual(F),de=ye=>Ie=>{if(Q&&(ye.zoom=i.number(_,I,Ie)),te&&(ye.bearing=i.number(v,R,Ie)),he&&(ye.pitch=i.number(E,P,Ie)),fe&&(ye.interpolatePadding(T,F,Ie),W=ye.centerPoint.add(G)),N)ye.setLocationAtPoint(N,q);else{let qe=ye.zoomScale(ye.zoom-_),Ce=I>_?Math.min(2,Y):Math.max(.5,Y),Ve=Math.pow(Ce,1-Ie),Ae=ye.unproject(X.add(Z.mult(Ie*Ve)).mult(qe));ye.setLocationAtPoint(ye.renderWorldCopies?Ae.wrap():Ae,W)}return r.preloadOnly||this._fireMoveEvents(l),ye};if(r.preloadOnly){let ye=this._emulate(de,r.duration,p);return this._preloadTiles(ye),this}let xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=te,this._pitching=he,this._padding=fe,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,xe),this._ease(de(p),ye=>{p.recenterOnTerrain(),this._afterEase(l,ye)},r),this}_prepareEase(r,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new i.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new i.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new i.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new i.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new i.Event("move",r)),this._zooming&&this.fire(new i.Event("zoom",r)),this._rotating&&this.fire(new i.Event("rotate",r)),this._pitching&&this.fire(new i.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new i.Event("zoomend",r)),_&&this.fire(new i.Event("rotateend",r)),v&&this.fire(new i.Event("pitchend",r)),this.fire(new i.Event("moveend",r))}flyTo(r,l){if(this._prefersReducedMotion(r)){let $e=i.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo($e,l)}this.stop(),r=i.extend({offset:[0,0],speed:1.2,curve:1.42,easing:i.ease},r);let p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),T=this.getPadding(),I="zoom"in r?i.clamp(+r.zoom,p.minZoom,p.maxZoom):_,R="bearing"in r?this._normalizeBearing(r.bearing,v):v,P="pitch"in r?+r.pitch:E,F="padding"in r?r.padding:p.padding,G=p.zoomScale(I-_),W=i.Point.convert(r.offset),X=p.centerPoint.add(W),Z=p.pointLocation(X),Y=i.LngLat.convert(r.center||Z);this._normalizeCenter(Y);let N=p.project(Z),q=p.project(Y).sub(N),Q=r.curve,te=Math.max(p.width,p.height),he=te/G,fe=q.mag();if("minZoom"in r){let $e=i.clamp(Math.min(r.minZoom,_,I),p.minZoom,p.maxZoom),Je=te/p.zoomScale($e-_);Q=Math.sqrt(Je/fe*2)}let de=Q*Q;function xe($e){let Je=(he*he-te*te+($e?-1:1)*de*de*fe*fe)/(2*($e?he:te)*de*fe);return Math.log(Math.sqrt(Je*Je+1)-Je)}function ye($e){return(Math.exp($e)-Math.exp(-$e))/2}function Ie($e){return(Math.exp($e)+Math.exp(-$e))/2}let qe=xe(0),Ce=function($e){return Ie(qe)/Ie(qe+Q*$e)},Ve=function($e){return te*((Ie(qe)*(ye(Je=qe+Q*$e)/Ie(Je))-ye(qe))/de)/fe;var Je},Ae=(xe(1)-qe)/Q;if(Math.abs(fe)<1e-6||!isFinite(Ae)){if(Math.abs(te-he)<1e-6)return this.easeTo(r,l);let $e=he<te?-1:1;Ae=Math.abs(Math.log(he/te))/Q,Ve=function(){return 0},Ce=function(Je){return Math.exp($e*Q*Je)}}r.duration="duration"in r?+r.duration:1e3*Ae/("screenSpeed"in r?+r.screenSpeed/Q:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);let He=v!==R,De=P!==E,ze=!p.isPaddingEqual(F),Ye=$e=>Je=>{let vt=Je*Ae,Rt=1/Ce(vt);$e.zoom=Je===1?I:_+$e.scaleZoom(Rt),He&&($e.bearing=i.number(v,R,Je)),De&&($e.pitch=i.number(E,P,Je)),ze&&($e.interpolatePadding(T,F,Je),X=$e.centerPoint.add(W));let mt=Je===1?Y:$e.unproject(N.add(q.mult(Ve(vt))).mult(Rt));return $e.setLocationAtPoint($e.renderWorldCopies?mt.wrap():mt,X),$e._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),$e};if(r.preloadOnly){let $e=this._emulate(Ye,r.duration,p);return this._preloadTiles($e),this}return this._zooming=!0,this._rotating=He,this._pitching=De,this._padding=ze,this._prepareEase(l,!1),this._ease(Ye(p),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!r){let p=this.handlers;p&&p.stop(!1)}return this}_ease(r,l,p){p.animate===!1||p.duration===0?(r(1),l()):(this._easeStart=i.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let r=Math.min((i.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=i.wrap(r,-180,180);let p=Math.abs(r-l);return Math.abs(r-360-l)<p&&(r-=360),Math.abs(r+360-l)<p&&(r+=360),r}_normalizeCenter(r){let l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;let p=r.lng-l.center.lng;r.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&i.exported.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,l,p){let _=Math.ceil(15*l/1e3),v=[],E=r(p.clone());for(let T=0;T<=_;T++){let I=E(T/_);v.push(I.clone())}return v}}class pt{constructor(r={}){this.options=r,i.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){let l=this.options&&this.options.compact;return this._map=r,this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ie("button","mapboxgl-ctrl-attrib-button",this._container),ie("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ie("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){let p=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",p),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));let l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.config.ACCESS_TOKEN}];if(r){let p=l.reduce((_,v,E)=>(v.value&&(_+=`${v.key}=${v.value}${E<l.length-1?"&":""}`),_),"?");r.href=`${i.config.FEEDBACK_URL}/${p}#${_c(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){let _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}let l=this._map.style._sourceCaches;for(let _ in l){let v=l[_];if(v.used){let E=v.getSource();E.attribution&&r.indexOf(E.attribution)<0&&r.push(E.attribution)}}r.sort((_,v)=>_.length-v.length),r=r.filter((_,v)=>{for(let E=v+1;E<r.length;E++)if(r[E].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));let p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Kh{constructor(){i.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=ie("div","mapboxgl-ctrl");let l=ie("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(let l in r){let p=r[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){let r=this._container.children;if(r.length){let l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Jh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){let l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){let l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(let _ of p)if(_.id===r)return void(_.cancelled=!0)}run(r=0){let l=this._currentlyRunning=this._queue;this._queue=[];for(let p of l)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Dl(d,r,l){if(d=new i.LngLat(d.lng,d.lat),r){let p=new i.LngLat(d.lng-360,d.lat),_=new i.LngLat(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),E=l.locationPoint(d).distSqr(r),T=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(p).distSqr(r)<E&&(T||Math.abs(p.lng-l.center.lng)<v)?d=p:l.locationPoint(_).distSqr(r)<E&&(T||Math.abs(_.lng-l.center.lng)<v)&&(d=_)}for(;Math.abs(d.lng-l.center.lng)>180;){let p=l.locationPoint(d);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}let Ha={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ct extends i.Evented{constructor(r,l){if(super(),(r instanceof i.window.HTMLElement||l)&&(r=i.extend({element:r},l)),i.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=i.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=ie("div");let _=41,v=27,E=_e("svg",{display:"block",height:_*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${_}`},this._element),T=_e("radialGradient",{id:"shadowGradient"},_e("defs",{},E));_e("stop",{offset:"10%","stop-opacity":.4},T),_e("stop",{offset:"100%","stop-opacity":.05},T),_e("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),_e("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),_e("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),_e("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=i.Point.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});let p=this._element.classList;for(let _ in Ha)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){let r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=i.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){let _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){let l=r.code,p=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){let l=r.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let r=this._map,l=this._pos;if(!r||!l)return!1;let p=r.unproject(l),_=r.getFreeCameraOptions();if(!_.position)return!1;let v=_.position.toLngLat();return v.distanceTo(p)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){let r=this._map;if(!r)return;let l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();let p=r.unproject(l),_;r._showingGlobe()&&i.isLngLatBehindGlobe(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let r=this._pos;if(!r||!this._map)return;let l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Ha[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){let r=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!r||p!=="map")return"";if(!l._showingGlobe()){let I=l.getPitch();return I?`rotateX(${I}deg)`:""}let _=i.radToDeg(i.globeTiltAtLngLat(l.transform,this._lngLat)),v=r.sub(i.globeCenterToScreenPoint(l.transform)),E=Math.abs(v.x)+Math.abs(v.y);if(E===0)return"";let T=_/E;return`rotateX(${-v.y*T}deg) rotateY(${v.x*T}deg)`}_calculateZTransform(){let r=this._pos,l=this._map;if(!l||!r)return"";let p=0,_=this.getRotationAlignment();if(_==="map")if(l._showingGlobe()){let v=l.project(new i.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),E=l.project(new i.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);p=i.radToDeg(Math.atan2(E.y,E.x))-90}else p=-l.getBearing();else if(_==="horizon"){let v=i.smoothstep(4,6,l.getZoom()),E=i.globeCenterToScreenPoint(l.transform);E.y+=v*l.transform.height;let T=r.sub(E),I=i.radToDeg(Math.atan2(T.y,T.x));p=(I>90?I-270:I+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){i.window.cancelAnimationFrame(this._updateFrameId);let l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Dl(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),r===!0?this._updateFrameId=i.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=i.Point.convert(r),this._update(),this}_onMove(r){let l=this._map;if(!l)return;let p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){let v=this._clickTolerance||l._clickTolerance;if(r.point.dist(p)<v)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.Event("dragstart"))),this.fire(new i.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.Event("dragend")),this._state="inactive"}_addDragHandler(r){let l=this._map,p=this._pos;l&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;let l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Qh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Mg=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Gf(d=new i.Point(0,0),r="bottom"){if(typeof d=="number"){let l=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(r){case"top":return new i.Point(0,d);case"top-left":return new i.Point(l,l);case"top-right":return new i.Point(-l,l);case"bottom":return new i.Point(0,-d);case"bottom-left":return new i.Point(l,-l);case"bottom-right":return new i.Point(-l,-l);case"left":return new i.Point(d,0);case"right":return new i.Point(-d,0)}return new i.Point(0,0)}return d instanceof i.Point||Array.isArray(d)?i.Point.convert(d):i.Point.convert(d[r]||[0,0])}class ed{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;let l=i.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,p){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+p}}let Hf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},qf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Sg={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ag{constructor(r,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new qh({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new Wh({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),i.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),Mt()}move(r,l){let p=this.map,_=this.mouseRotate.mousemoveWindow(r,l),v=_&&_.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){let E=this.mousePitch.mousemoveWindow(r,l),T=E&&E.pitchDelta;T&&p.setPitch(p.getPitch()+T)}}off(){let r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){En(),i.window.removeEventListener("mousemove",this.mousemove),i.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(i.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Un(this.element,r)),i.window.addEventListener("mousemove",this.mousemove),i.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Un(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=xr(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=xr(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let td={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},nd={maxWidth:100,unit:"metric"},rd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Il={version:i.version,supported:O,setRTLTextPlugin:i.setRTLTextPlugin,getRTLTextPluginStatus:i.getRTLTextPluginStatus,Map:class extends Eu{constructor(d){if(i.LivePerformanceUtils.mark(i.PerformanceMarkers.create),(d=i.extend({},qf,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&i.isSafariWithAntialiasingBug(i.window)&&(d.antialias=!1,i.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new To(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Jh,this._domRenderTaskQueue=new Jh,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.uniqueId(),this._locale=i.extend({},Hf,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ed(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new i.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=i.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof i.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&i.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),i.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),i.window!==void 0&&(i.window.addEventListener("online",this._onWindowOnline,!1),i.window.addEventListener("resize",this._onWindowResize,!1),i.window.addEventListener("orientationchange",this._onWindowResize,!1),i.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),i.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new es(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new Uh(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,i.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new pt({customAttribution:d.customAttribution})),this._logoControl=new Kh,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new i.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new i.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(d,r){if(r===void 0&&(r=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let l=d.onAdd(this);this._controls.push(d);let p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let r=this._controls.indexOf(d);return r>-1&&this._controls.splice(r,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let r=!this._moving;return r&&this.fire(new i.Event("movestart",d)).fire(new i.Event("move",d)),this.fire(new i.Event("resize",d)),r&&this.fire(new i.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(i.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new i.Event("zoomstart")).fire(new i.Event("zoom")).fire(new i.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new i.Event("zoomstart")).fire(new i.Event("zoom")).fire(new i.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new i.Event("pitchstart")).fire(new i.Event("pitch")).fire(new i.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new i.Event("pitchstart")).fire(new i.Event("pitch")).fire(new i.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?i.window.navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(r=>r==="auto"?i.window.navigator.language:r):d}setLanguage(d){let r=this._parseLanguage(d);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(let l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let d=this.transform,r=d.projection.name,l;r==="globe"&&d.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),l=!0):r==="mercator"&&d.zoom<i.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,r){return this._updateProjection(d||r||{name:"mercator"})}_updateProjection(d){let r;if(r=d.name==="globe"&&this.transform.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(let l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(i.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(i.Point.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,r,l){if(d==="mouseenter"||d==="mouseover"){let p=!1,_=E=>{let T=r.filter(R=>this.getLayer(R)),I=T.length?this.queryRenderedFeatures(E.point,{layers:T}):[];I.length?p||(p=!0,l.call(this,new Br(d,this,E.originalEvent,{features:I}))):p=!1},v=()=>{p=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:v}}}if(d==="mouseleave"||d==="mouseout"){let p=!1,_=E=>{let T=r.filter(I=>this.getLayer(I));(T.length?this.queryRenderedFeatures(E.point,{layers:T}):[]).length?p=!0:p&&(p=!1,l.call(this,new Br(d,this,E.originalEvent)))},v=E=>{p&&(p=!1,l.call(this,new Br(d,this,E.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:v}}}{let p=_=>{let v=r.filter(T=>this.getLayer(T)),E=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];E.length&&(_.features=E,l.call(this,_),delete _.features)};return{layers:new Set(r),listener:l,delegates:{[d]:p}}}}on(d,r,l){if(l===void 0)return super.on(d,r);Array.isArray(r)||(r=[r]);let p=this._createDelegatedListener(d,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(p);for(let _ in p.delegates)this.on(_,p.delegates[_]);return this}once(d,r,l){if(l===void 0)return super.once(d,r);Array.isArray(r)||(r=[r]);let p=this._createDelegatedListener(d,r,l);for(let _ in p.delegates)this.once(_,p.delegates[_]);return this}off(d,r,l){if(l===void 0)return super.off(d,r);r=new Set(Array.isArray(r)?r:[r]);let p=(v,E)=>{if(v.size!==E.size)return!1;for(let T of v)if(!E.has(T))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[d]:void 0;return _&&(v=>{for(let E=0;E<v.length;E++){let T=v[E];if(T.listener===l&&p(T.layers,r)){for(let I in T.delegates)this.off(I,T.delegates[I]);return v.splice(E,1),this}}})(_),this}queryRenderedFeatures(d,r){return this.style?(r!==void 0||d===void 0||d instanceof i.Point||Array.isArray(d)||(r=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(d,r){return this.style.querySourceFeatures(d,r)}isPointOnSurface(d){let{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&i.warnOnce(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.Point.convert(d))}setStyle(d,r){return(r=i.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(d,r))}_getUIString(d){let r=this._locale[d];if(r==null)throw new Error(`Missing UI string '${d}'`);return r}_updateStyle(d,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new Ui(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ui(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,r){if(typeof d=="string"){let l=this._requestManager.normalizeStyleURL(d),p=this._requestManager.transformRequest(l,i.ResourceType.Style);i.getJSON(p,(_,v)=>{_?this.fire(new i.ErrorEvent(_)):v&&this._updateDiff(v,r)})}else typeof d=="object"&&this._updateDiff(d,r)}_updateDiff(d,r){try{this.style.setState(d)&&this._update(!0)}catch(l){i.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(d,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.warnOnce("There is no style added to the map."),!1)}addSource(d,r){return this._lazyInitEmptyStyle(),this.style.addSource(d,r),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){let d=this.style&&this.style._sourceCaches;for(let r in d){let l=d[r]._tiles;for(let p in l){let _=l[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(d,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(d,r,l)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,r,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:v,content:E}={}){if(this._lazyInitEmptyStyle(),r instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&r instanceof i.window.ImageBitmap){let{width:T,height:I,data:R}=i.exported.getImageData(r);this.style.addImage(d,{data:new i.RGBAImage({width:T,height:I},R),pixelRatio:l,stretchX:_,stretchY:v,content:E,sdf:p,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:T,height:I}=r,R=r;this.style.addImage(d,{data:new i.RGBAImage({width:T,height:I},new Uint8Array(R.data)),pixelRatio:l,stretchX:_,stretchY:v,content:E,sdf:p,version:0,userImage:R}),R.onAdd&&R.onAdd(this,d)}}updateImage(d,r){let l=this.style.getImage(d);if(!l)return void this.fire(new i.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let p=r instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&r instanceof i.window.ImageBitmap?i.exported.getImageData(r):r,{width:_,height:v}=p;_!==void 0&&v!==void 0?_===l.data.width&&v===l.data.height?(l.data.replace(p.data,!(r instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&r instanceof i.window.ImageBitmap)),this.style.updateImage(d,l)):this.fire(new i.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${v})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new i.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,r){i.getImage(this._requestManager.transformRequest(d,i.ResourceType.Image),(l,p)=>{r(l,p instanceof i.window.HTMLImageElement?i.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(d,r){return this._lazyInitEmptyStyle(),this.style.addLayer(d,r),this._update(!0)}moveLayer(d,r){return this.style.moveLayer(d,r),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,r,l){return this.style.setLayerZoomRange(d,r,l),this._update(!0)}setFilter(d,r,l={}){return this.style.setFilter(d,r,l),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,r,l,p={}){return this.style.setPaintProperty(d,r,l,p),this._update(!0)}getPaintProperty(d,r){return this.style.getPaintProperty(d,r)}setLayoutProperty(d,r,l,p={}){return this.style.setLayoutProperty(d,r,l,p),this._update(!0)}getLayoutProperty(d,r){return this.style.getLayoutProperty(d,r)}setLight(d,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.LngLat.convert(d),this.transform):0}setFeatureState(d,r){return this.style.setFeatureState(d,r),this._update()}removeFeatureState(d,r){return this.style.removeFeatureState(d,r),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;let d=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300,l,p,_,v=this._container;for(;v&&(!p||!_);){let E=i.window.getComputedStyle(v).transform;E&&E!=="none"&&(l=E.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(_=l[3])),v=v.parentElement}this._containerWidth=p?Math.abs(d/p):d,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){i.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=ie("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();let r=this._canvasContainer=ie("div","mapboxgl-canvas-container",d);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=ie("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let l=this._controlContainer=ie("div","mapboxgl-control-container",d),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=ie("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,r){let l=i.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${r}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){let r=this._markers.indexOf(d);r!==-1&&this._markers.splice(r,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){let r=this._popups.indexOf(d);r!==-1&&this._popups.splice(r,1)}_setupPainter(){let d=i.extend({},O.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",d),l=r||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);l?(this._useWebGL2&&!r&&i.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),i.storeAuthState(l,!0),this.painter=new si(l,this.transform,!!r),this.on("data",p=>{p.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.exported$1.testSupport(l)):this.fire(new i.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new i.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let r,l=this.painter.context.extTimerQuery,p=i.exported.now();if(this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],i.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],i.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();let _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let T=this.transform.zoom,I=this.transform.pitch,R=i.exported.now(),P=new i.EvaluationParameters(T,{now:R,fadeDuration:_,pitch:I,transition:this.style.getTransition()});this.style.update(P)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new i.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){let T=i.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{let I=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new i.Event("gpu-timing-frame",{cpuTime:T,gpuTime:I})),i.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:I}})},50)}if(this.listens("gpu-timing-layer")){let T=this.painter.collectGpuTimers();setTimeout(()=>{let I=this.painter.queryGpuTimers(T);this.fire(new i.Event("gpu-timing-layer",{layerTimes:I}))},50)}if(this.listens("gpu-timing-deferred-render")){let T=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let I=this.painter.queryGpuTimeDeferredRender(T);this.fire(new i.Event("gpu-timing-deferred-render",{gpuTime:I}))},50)}let E=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(E||this._repaint)this.triggerRepaint();else{let T=!this.isMoving()&&this.loaded();if(T&&(v=this._updateAverageElevation(p,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),T&&(this.fire(new i.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let I=this._calculateSpeedIndex();this.fire(new i.Event("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,i.LivePerformanceUtils.mark(i.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&i.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(let r of this._markers)d&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(let r of this._popups)!d||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(d,r=!1){let l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((r||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){let p=this.transform.averageElevation,_=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=d;let E=Math.abs(p-_);if(E>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,d,300)}else if(E>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){i.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===i.AUTH_ERR_MSG||d.status===401)){let r=this.painter.context.gl;i.storeAuthState(r,!1),this._logoControl instanceof Kh&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){let d=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());let l=this.painter.context.gl,p=l.createFramebuffer();function _(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);let E=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,E),E}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(d),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(d,r,l){let p=l[1]-l[0],_=d.length/4;for(let v=0;v<r.length;v++){let E=r[v],T=0;for(let I=0;I<E.length;I+=4)E[I]===d[I]&&E[I+1]===d[I+1]&&E[I+2]===d[I+2]&&E[I+3]===d[I+3]&&(T+=1);p+=(l[v+2]-l[v+1])*(1-T/_)}return p}remove(){this._hash&&this._hash.remove();for(let r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),i.window!==void 0&&(i.window.removeEventListener("resize",this._onWindowResize,!1),i.window.removeEventListener("orientationchange",this._onWindowResize,!1),i.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),i.window.removeEventListener("online",this._onWindowOnline,!1),i.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));let d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new i.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=i.exported.frame(r=>{let l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(d){let r=this.style?Object.values(this.style._sourceCaches):[];return i.asyncAll(r,(l,p)=>l._preloadTiles(d,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){i.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,r){i.setCacheLimits(d,r)}get version(){return i.version}},NavigationControl:class{constructor(d){this.options=i.extend({},Sg,d),this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(i.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),ie("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),ie("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{let l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=ie("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let d=this._map;if(!d)return;let r=d.getZoom(),l=r===d.getMaxZoom(),p=r===d.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){let d=this._map;if(!d)return;let r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ag(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){let d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,r){let l=ie("button",d,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(d,r){if(!this._map)return;let l=this._map._getUIString(`NavigationControl.${r}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends i.Evented{constructor(d){super(),this.options=i.extend({geolocation:i.window.navigator.geolocation},td,d),i.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=El(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){let r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,d(l)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):i.window.navigator.permissions!==void 0?i.window.navigator.permissions.query({name:"geolocation"}).then(l=>r(l.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(d){let r=this._map.getMaxBounds(),l=d.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new i.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("geolocate",d)),this._finish()}}_updateCamera(d){let r=new i.LngLat(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,p=this._map.getBearing(),_=i.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),_,{geolocateSource:!0})}_updateMarker(d){if(d){let r=new i.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let d=this._map.transform,r=i.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=ie("button","mapboxgl-ctrl-geolocate",this._container),ie("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){i.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{let r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ie("div","mapboxgl-user-location"),this._dotElement.appendChild(ie("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ie("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ct({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ie("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ct({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let d=()=>{i.window.addEventListener("ondeviceorientationabsolute"in i.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};i.window.DeviceMotionEvent!==void 0&&typeof i.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),i.window.removeEventListener("deviceorientation",this._onDeviceOrientation),i.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:pt,ScaleControl:class{constructor(d){this.options=i.extend({},nd,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let d=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,p=r._containerWidth/2-d/2,_=r.unproject([p,l]),v=r.unproject([p+d,l]),E=_.distanceTo(v);if(this.options.unit==="imperial"){let T=3.2808*E;T>5280?this._setScale(d,T/5280,"mile"):this._setScale(d,T,"foot")}else this.options.unit==="nautical"?this._setScale(d,E/1852,"nautical-mile"):E>=1e3?this._setScale(d,E/1e3,"kilometer"):this._setScale(d,E,"meter")}_setScale(d,r,l){this._map._requestDomTask(()=>{let p=function(v){let E=Math.pow(10,`${Math.floor(v)}`.length-1),T=v/E;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(I){let R=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*R)/R}(T),E*T}(r),_=p/r;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${rd[l]}`,this._container.style.width=d*_+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof i.window.HTMLElement?this._container=d.container:i.warnOnce("Full screen control 'container' must be a DOM element.")),i.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in i.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in i.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,i.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!i.window.document.fullscreenEnabled&&!i.window.document.webkitFullscreenEnabled)}_setupUI(){let d=this._fullscreenButton=ie("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ie("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),i.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(i.window.document.fullscreenElement||i.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?i.window.document.exitFullscreen?i.window.document.exitFullscreen():i.window.document.webkitCancelFullScreen&&i.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.Evented{constructor(d){super(),this.options=i.extend(Object.create(Qh),d),i.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new i.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new i.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=i.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();let r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(i.window.document.createTextNode(d))}setHTML(d){let r=i.window.document.createDocumentFragment(),l=i.window.document.createElement("body"),p;for(l.innerHTML=d;p=l.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=ie("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(d),this.options.closeButton){let l=this._closeButton=ie("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let r;return this._classList.delete(d)?r=!1:(this._classList.add(d),r=!0),this._updateClassList(),r}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;let r=this._map,l=this._container,p=this._pos;if(!r||!l||!p)return"bottom";let _=l.offsetWidth,v=l.offsetHeight,E=p.x<_/2,T=p.x>r.transform.width-_/2;if(p.y+d<v)return E?"top-left":T?"top-right":"top";if(p.y>r.transform.height-v){if(E)return"bottom-left";if(T)return"bottom-right"}return E?"left":T?"right":"bottom"}_updateClassList(){let d=this._container;if(!d)return;let r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),d.className=r.join(" ")}_update(d){let r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=ie("div","mapboxgl-popup",r.getContainer()),this._tip=ie("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Dl(this._lngLat,this._pos,r.transform)),!this._trackPointer||d){let _=this._pos=this._trackPointer&&d?d:r.project(this._lngLat),v=Gf(this.options.offset),E=this._anchor=this._getAnchor(v.y),T=Gf(this.options.offset,E),I=_.add(T).round();r._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Ha[E]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&r._showingGlobe()){let _=i.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(Mg);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:ct,Style:Ui,LngLat:i.LngLat,LngLatBounds:i.LngLatBounds,Point:i.Point,MercatorCoordinate:i.MercatorCoordinate,FreeCameraOptions:Qo,Evented:i.Evented,config:i.config,prewarm:function(){Qs().acquire(Ki)},clearPrewarmedResources:function(){let d=Rn;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Ki),Rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return i.config.ACCESS_TOKEN},set accessToken(d){i.config.ACCESS_TOKEN=d},get baseApiUrl(){return i.config.API_URL},set baseApiUrl(d){i.config.API_URL=d},get workerCount(){return Rr.workerCount},set workerCount(d){Rr.workerCount=d},get maxParallelImageRequests(){return i.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){i.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){i.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:i.exported.setNow,restoreNow:i.exported.restoreNow};return Il});var g=h;return g})});var BT=Cw((F0,N0)=>{(function(o,s){typeof F0=="object"&&typeof N0<"u"?N0.exports=s():typeof define=="function"&&define.amd?define(s):(o=typeof globalThis<"u"?globalThis:o||self).MapboxDraw=s()})(F0,function(){"use strict";var o=function(C,A){var $={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},ne={on:function(ge,ve,Xe){if($[ge]===void 0)throw new Error("Invalid event type: "+ge);$[ge].push({selector:ve,fn:Xe})},render:function(ge){A.store.featureChanged(ge)}},ae=function(ge,ve){for(var Xe=$[ge],nt=Xe.length;nt--;){var ht=Xe[nt];if(ht.selector(ve)){ht.fn.call(ne,ve)||A.store.render(),A.ui.updateMapClasses();break}}};return C.start.call(ne),{render:C.render,stop:function(){C.stop&&C.stop()},trash:function(){C.trash&&(C.trash(),A.store.render())},combineFeatures:function(){C.combineFeatures&&C.combineFeatures()},uncombineFeatures:function(){C.uncombineFeatures&&C.uncombineFeatures()},drag:function(ge){ae("drag",ge)},click:function(ge){ae("click",ge)},mousemove:function(ge){ae("mousemove",ge)},mousedown:function(ge){ae("mousedown",ge)},mouseup:function(ge){ae("mouseup",ge)},mouseout:function(ge){ae("mouseout",ge)},keydown:function(ge){ae("keydown",ge)},keyup:function(ge){ae("keyup",ge)},touchstart:function(ge){ae("touchstart",ge)},touchmove:function(ge){ae("touchmove",ge)},touchend:function(ge){ae("touchend",ge)},tap:function(ge){ae("tap",ge)}}};function s(C){return C&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")?C.default:C}function h(C){if(C.__esModule)return C;var A=C.default;if(typeof A=="function"){var $=function ne(){if(this instanceof ne){var ae=[null];ae.push.apply(ae,arguments);var ge=Function.bind.apply(A,ae);return new ge}return A.apply(this,arguments)};$.prototype=A.prototype}else $={};return Object.defineProperty($,"__esModule",{value:!0}),Object.keys(C).forEach(function(ne){var ae=Object.getOwnPropertyDescriptor(C,ne);Object.defineProperty($,ne,ae.get?ae:{enumerable:!0,get:function(){return C[ne]}})}),$}var u={},g={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},i=g;function w(C){var A=0;if(C&&C.length>0){A+=Math.abs(O(C[0]));for(var $=1;$<C.length;$++)A-=Math.abs(O(C[$]))}return A}function O(C){var A,$,ne,ae,ge,ve,Xe=0,nt=C.length;if(nt>2){for(ve=0;ve<nt;ve++)ve===nt-2?(ne=nt-2,ae=nt-1,ge=0):ve===nt-1?(ne=nt-1,ae=0,ge=1):(ne=ve,ae=ve+1,ge=ve+2),A=C[ne],$=C[ae],Xe+=(B(C[ge][0])-B(A[0]))*Math.sin(B($[1]));Xe=Xe*i.RADIUS*i.RADIUS/2}return Xe}function B(C){return C*Math.PI/180}u.geometry=function C(A){var $,ne=0;switch(A.type){case"Polygon":return w(A.coordinates);case"MultiPolygon":for($=0;$<A.coordinates.length;$++)ne+=w(A.coordinates[$]);return ne;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for($=0;$<A.geometries.length;$++)ne+=C(A.geometries[$]);return ne}},u.ring=O;var j={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},ie={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},_e={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Be={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Re={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},tt={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Mt={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},En={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},Ct={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},gn={ACTIVE:"true",INACTIVE:"false"},Un=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],xr=-85,ei=Object.freeze({__proto__:null,classes:j,sources:ie,cursors:_e,types:Be,geojsonTypes:Re,modes:tt,events:Mt,updateActions:En,meta:Ct,activeStates:gn,interactions:Un,LAT_MIN:-90,LAT_RENDERED_MIN:xr,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),nr={Point:0,LineString:1,MultiLineString:1,Polygon:2};function rt(C,A){var $=nr[C.geometry.type]-nr[A.geometry.type];return $===0&&C.geometry.type===Re.POLYGON?C.area-A.area:$}function Fo(C){return C.map(function(A){return A.geometry.type===Re.POLYGON&&(A.area=u.geometry({type:Re.FEATURE,property:{},geometry:A.geometry})),A}).sort(rt).map(function(A){return delete A.area,A})}function Ws(C,A){return A===void 0&&(A=0),[[C.point.x-A,C.point.y-A],[C.point.x+A,C.point.y+A]]}function At(C){if(this._items={},this._nums={},this._length=C?C.length:0,C)for(var A=0,$=C.length;A<$;A++)this.add(C[A]),C[A]!==void 0&&(typeof C[A]=="string"?this._items[C[A]]=A:this._nums[C[A]]=A)}At.prototype.add=function(C){return this.has(C)||(this._length++,typeof C=="string"?this._items[C]=this._length:this._nums[C]=this._length),this},At.prototype.delete=function(C){return this.has(C)===!1||(this._length--,delete this._items[C],delete this._nums[C]),this},At.prototype.has=function(C){return(typeof C=="string"||typeof C=="number")&&(this._items[C]!==void 0||this._nums[C]!==void 0)},At.prototype.values=function(){var C=this,A=[];return Object.keys(this._items).forEach(function($){A.push({k:$,v:C._items[$]})}),Object.keys(this._nums).forEach(function($){A.push({k:JSON.parse($),v:C._nums[$]})}),A.sort(function($,ne){return $.v-ne.v}).map(function($){return $.k})},At.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Pr=[Ct.FEATURE,Ct.MIDPOINT,Ct.VERTEX],No={click:function(C,A,$){return Ma(C,A,$,$.options.clickBuffer)},touch:function(C,A,$){return Ma(C,A,$,$.options.touchBuffer)}};function Ma(C,A,$,ne){if($.map===null)return[];var ae=C?Ws(C,ne):A,ge={};$.options.styles&&(ge.layers=$.options.styles.map(function(ht){return ht.id}).filter(function(ht){return $.map.getLayer(ht)!=null}));var ve=$.map.queryRenderedFeatures(ae,ge).filter(function(ht){return Pr.indexOf(ht.properties.meta)!==-1}),Xe=new At,nt=[];return ve.forEach(function(ht){var ft=ht.properties.id;Xe.has(ft)||(Xe.add(ft),nt.push(ht))}),Fo(nt)}function zo(C,A){var $=No.click(C,null,A),ne={mouse:_e.NONE};return $[0]&&(ne.mouse=$[0].properties.active===gn.ACTIVE?_e.MOVE:_e.POINTER,ne.feature=$[0].properties.meta),A.events.currentModeName().indexOf("draw")!==-1&&(ne.mouse=_e.ADD),A.ui.queueMapClasses(ne),A.ui.updateMapClasses(),$[0]}function Zs(C,A){var $=C.x-A.x,ne=C.y-A.y;return Math.sqrt($*$+ne*ne)}function Ht(C,A,$){$===void 0&&($={});var ne=$.fineTolerance!=null?$.fineTolerance:4,ae=$.grossTolerance!=null?$.grossTolerance:12,ge=$.interval!=null?$.interval:500;C.point=C.point||A.point,C.time=C.time||A.time;var ve=Zs(C.point,A.point);return ve<ne||ve<ae&&A.time-C.time<ge}function Bo(C,A,$){$===void 0&&($={});var ne=$.tolerance!=null?$.tolerance:25,ae=$.interval!=null?$.interval:250;return C.point=C.point||A.point,C.time=C.time||A.time,Zs(C.point,A.point)<ne&&A.time-C.time<ae}var mr={exports:{}},gr=mr.exports=function(C,A){if(A||(A=16),C===void 0&&(C=128),C<=0)return"0";for(var $=Math.log(Math.pow(2,C))/Math.log(A),ne=2;$===1/0;ne*=2)$=Math.log(Math.pow(2,C/ne))/Math.log(A)*ne;var ae=$-Math.floor($),ge="";for(ne=0;ne<Math.floor($);ne++)ge=Math.floor(Math.random()*A).toString(A)+ge;if(ae){var ve=Math.pow(A,ae);ge=Math.floor(Math.random()*ve).toString(A)+ge}var Xe=parseInt(ge,A);return Xe!==1/0&&Xe>=Math.pow(2,C)?gr(C,A):ge};gr.rack=function(C,A,$){var ne=function(ge){var ve=0;do{if(ve++>10){if(!$)throw new Error("too many ID collisions, use more bits");C+=$}var Xe=gr(C,A)}while(Object.hasOwnProperty.call(ae,Xe));return ae[Xe]=ge,Xe},ae=ne.hats={};return ne.get=function(ge){return ne.hats[ge]},ne.set=function(ge,ve){return ne.hats[ge]=ve,ne},ne.bits=C||128,ne.base=A||16,ne};var Zi=s(mr.exports),un=function(C,A){this.ctx=C,this.properties=A.properties||{},this.coordinates=A.geometry.coordinates,this.id=A.id||Zi(),this.type=A.geometry.type};un.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},un.prototype.incomingCoords=function(C){this.setCoordinates(C)},un.prototype.setCoordinates=function(C){this.coordinates=C,this.changed()},un.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},un.prototype.setProperty=function(C,A){this.properties[C]=A},un.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Re.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},un.prototype.internal=function(C){var A={id:this.id,meta:Ct.FEATURE,"meta:type":this.type,active:gn.INACTIVE,mode:C};if(this.ctx.options.userProperties)for(var $ in this.properties)A["user_"+$]=this.properties[$];return{type:Re.FEATURE,properties:A,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var ti=function(C,A){un.call(this,C,A)};(ti.prototype=Object.create(un.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},ti.prototype.updateCoordinate=function(C,A,$){this.coordinates=arguments.length===3?[A,$]:[C,A],this.changed()},ti.prototype.getCoordinate=function(){return this.getCoordinates()};var ni=function(C,A){un.call(this,C,A)};(ni.prototype=Object.create(un.prototype)).isValid=function(){return this.coordinates.length>1},ni.prototype.addCoordinate=function(C,A,$){this.changed();var ne=parseInt(C,10);this.coordinates.splice(ne,0,[A,$])},ni.prototype.getCoordinate=function(C){var A=parseInt(C,10);return JSON.parse(JSON.stringify(this.coordinates[A]))},ni.prototype.removeCoordinate=function(C){this.changed(),this.coordinates.splice(parseInt(C,10),1)},ni.prototype.updateCoordinate=function(C,A,$){var ne=parseInt(C,10);this.coordinates[ne]=[A,$],this.changed()};var br=function(C,A){un.call(this,C,A),this.coordinates=this.coordinates.map(function($){return $.slice(0,-1)})};(br.prototype=Object.create(un.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(C){return C.length>2})},br.prototype.incomingCoords=function(C){this.coordinates=C.map(function(A){return A.slice(0,-1)}),this.changed()},br.prototype.setCoordinates=function(C){this.coordinates=C,this.changed()},br.prototype.addCoordinate=function(C,A,$){this.changed();var ne=C.split(".").map(function(ae){return parseInt(ae,10)});this.coordinates[ne[0]].splice(ne[1],0,[A,$])},br.prototype.removeCoordinate=function(C){this.changed();var A=C.split(".").map(function(ne){return parseInt(ne,10)}),$=this.coordinates[A[0]];$&&($.splice(A[1],1),$.length<3&&this.coordinates.splice(A[0],1))},br.prototype.getCoordinate=function(C){var A=C.split(".").map(function(ne){return parseInt(ne,10)}),$=this.coordinates[A[0]];return JSON.parse(JSON.stringify($[A[1]]))},br.prototype.getCoordinates=function(){return this.coordinates.map(function(C){return C.concat([C[0]])})},br.prototype.updateCoordinate=function(C,A,$){this.changed();var ne=C.split("."),ae=parseInt(ne[0],10),ge=parseInt(ne[1],10);this.coordinates[ae]===void 0&&(this.coordinates[ae]=[]),this.coordinates[ae][ge]=[A,$]};var co={MultiPoint:ti,MultiLineString:ni,MultiPolygon:br},ms=function(C,A,$,ne,ae){var ge=$.split("."),ve=parseInt(ge[0],10),Xe=ge[1]?ge.slice(1).join("."):null;return C[ve][A](Xe,ne,ae)},_r=function(C,A){if(un.call(this,C,A),delete this.coordinates,this.model=co[A.geometry.type],this.model===void 0)throw new TypeError(A.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(A.geometry.coordinates)};function qt(C){this.map=C.map,this.drawConfig=JSON.parse(JSON.stringify(C.options||{})),this._ctx=C}(_r.prototype=Object.create(un.prototype))._coordinatesToFeatures=function(C){var A=this,$=this.model.bind(this);return C.map(function(ne){return new $(A.ctx,{id:Zi(),type:Re.FEATURE,properties:{},geometry:{coordinates:ne,type:A.type.replace("Multi","")}})})},_r.prototype.isValid=function(){return this.features.every(function(C){return C.isValid()})},_r.prototype.setCoordinates=function(C){this.features=this._coordinatesToFeatures(C),this.changed()},_r.prototype.getCoordinate=function(C){return ms(this.features,"getCoordinate",C)},_r.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(C){return C.type===Re.POLYGON?C.getCoordinates():C.coordinates})))},_r.prototype.updateCoordinate=function(C,A,$){ms(this.features,"updateCoordinate",C,A,$),this.changed()},_r.prototype.addCoordinate=function(C,A,$){ms(this.features,"addCoordinate",C,A,$),this.changed()},_r.prototype.removeCoordinate=function(C){ms(this.features,"removeCoordinate",C),this.changed()},_r.prototype.getFeatures=function(){return this.features},qt.prototype.setSelected=function(C){return this._ctx.store.setSelected(C)},qt.prototype.setSelectedCoordinates=function(C){var A=this;this._ctx.store.setSelectedCoordinates(C),C.reduce(function($,ne){return $[ne.feature_id]===void 0&&($[ne.feature_id]=!0,A._ctx.store.get(ne.feature_id).changed()),$},{})},qt.prototype.getSelected=function(){return this._ctx.store.getSelected()},qt.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},qt.prototype.isSelected=function(C){return this._ctx.store.isSelected(C)},qt.prototype.getFeature=function(C){return this._ctx.store.get(C)},qt.prototype.select=function(C){return this._ctx.store.select(C)},qt.prototype.deselect=function(C){return this._ctx.store.deselect(C)},qt.prototype.deleteFeature=function(C,A){return A===void 0&&(A={}),this._ctx.store.delete(C,A)},qt.prototype.addFeature=function(C){return this._ctx.store.add(C)},qt.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},qt.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},qt.prototype.setActionableState=function(C){C===void 0&&(C={});var A={trash:C.trash||!1,combineFeatures:C.combineFeatures||!1,uncombineFeatures:C.uncombineFeatures||!1};return this._ctx.events.actionable(A)},qt.prototype.changeMode=function(C,A,$){return A===void 0&&(A={}),$===void 0&&($={}),this._ctx.events.changeMode(C,A,$)},qt.prototype.updateUIClasses=function(C){return this._ctx.ui.queueMapClasses(C)},qt.prototype.activateUIButton=function(C){return this._ctx.ui.setActiveButton(C)},qt.prototype.featuresAt=function(C,A,$){if($===void 0&&($="click"),$!=="click"&&$!=="touch")throw new Error("invalid buffer type");return No[$](C,A,this._ctx)},qt.prototype.newFeature=function(C){var A=C.geometry.type;return A===Re.POINT?new ti(this._ctx,C):A===Re.LINE_STRING?new ni(this._ctx,C):A===Re.POLYGON?new br(this._ctx,C):new _r(this._ctx,C)},qt.prototype.isInstanceOf=function(C,A){if(C===Re.POINT)return A instanceof ti;if(C===Re.LINE_STRING)return A instanceof ni;if(C===Re.POLYGON)return A instanceof br;if(C==="MultiFeature")return A instanceof _r;throw new Error("Unknown feature class: "+C)},qt.prototype.doRender=function(C){return this._ctx.store.featureChanged(C)},qt.prototype.onSetup=function(){},qt.prototype.onDrag=function(){},qt.prototype.onClick=function(){},qt.prototype.onMouseMove=function(){},qt.prototype.onMouseDown=function(){},qt.prototype.onMouseUp=function(){},qt.prototype.onMouseOut=function(){},qt.prototype.onKeyUp=function(){},qt.prototype.onKeyDown=function(){},qt.prototype.onTouchStart=function(){},qt.prototype.onTouchMove=function(){},qt.prototype.onTouchEnd=function(){},qt.prototype.onTap=function(){},qt.prototype.onStop=function(){},qt.prototype.onTrash=function(){},qt.prototype.onCombineFeature=function(){},qt.prototype.onUncombineFeature=function(){},qt.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Jt={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Xs=Object.keys(Jt);function hi(C){var A=Object.keys(C);return function($,ne){ne===void 0&&(ne={});var ae={},ge=A.reduce(function(ve,Xe){return ve[Xe]=C[Xe],ve},new qt($));return{start:function(){var ve=this;ae=ge.onSetup(ne),Xs.forEach(function(Xe){var nt,ht=Jt[Xe],ft=function(){return!1};C[ht]&&(ft=function(){return!0}),ve.on(Xe,ft,(nt=ht,function(ot){return ge[nt](ae,ot)}))})},stop:function(){ge.onStop(ae)},trash:function(){ge.onTrash(ae)},combineFeatures:function(){ge.onCombineFeatures(ae)},uncombineFeatures:function(){ge.onUncombineFeatures(ae)},render:function(ve,Xe){ge.toDisplayFeatures(ae,ve,Xe)}}}}function uo(C){return[].concat(C).filter(function(A){return A!==void 0})}function Jn(){var C=this;if(!(C.ctx.map&&C.ctx.map.getSource(ie.HOT)!==void 0))return nt();var A=C.ctx.events.currentModeName();C.ctx.ui.queueMapClasses({mode:A});var $=[],ne=[];C.isDirty?ne=C.getAllIds():($=C.getChangedIds().filter(function(ht){return C.get(ht)!==void 0}),ne=C.sources.hot.filter(function(ht){return ht.properties.id&&$.indexOf(ht.properties.id)===-1&&C.get(ht.properties.id)!==void 0}).map(function(ht){return ht.properties.id})),C.sources.hot=[];var ae=C.sources.cold.length;C.sources.cold=C.isDirty?[]:C.sources.cold.filter(function(ht){var ft=ht.properties.id||ht.properties.parent;return $.indexOf(ft)===-1});var ge=ae!==C.sources.cold.length||ne.length>0;function ve(ht,ft){var ot=C.get(ht).internal(A);C.ctx.events.currentModeRender(ot,function(Pt){C.sources[ft].push(Pt)})}if($.forEach(function(ht){return ve(ht,"hot")}),ne.forEach(function(ht){return ve(ht,"cold")}),ge&&C.ctx.map.getSource(ie.COLD).setData({type:Re.FEATURE_COLLECTION,features:C.sources.cold}),C.ctx.map.getSource(ie.HOT).setData({type:Re.FEATURE_COLLECTION,features:C.sources.hot}),C._emitSelectionChange&&(C.ctx.map.fire(Mt.SELECTION_CHANGE,{features:C.getSelected().map(function(ht){return ht.toGeoJSON()}),points:C.getSelectedCoordinates().map(function(ht){return{type:Re.FEATURE,properties:{},geometry:{type:Re.POINT,coordinates:ht.coordinates}}})}),C._emitSelectionChange=!1),C._deletedFeaturesToEmit.length){var Xe=C._deletedFeaturesToEmit.map(function(ht){return ht.toGeoJSON()});C._deletedFeaturesToEmit=[],C.ctx.map.fire(Mt.DELETE,{features:Xe})}function nt(){C.isDirty=!1,C.clearChangedIds()}nt(),C.ctx.map.fire(Mt.RENDER,{})}function cn(C){var A,$=this;this._features={},this._featureIds=new At,this._selectedFeatureIds=new At,this._selectedCoordinates=[],this._changedFeatureIds=new At,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=C,this.sources={hot:[],cold:[]},this.render=function(){A||(A=requestAnimationFrame(function(){A=null,Jn.call($)}))},this.isDirty=!1}function Sa(C,A){var $=C._selectedCoordinates.filter(function(ne){return C._selectedFeatureIds.has(ne.feature_id)});C._selectedCoordinates.length===$.length||A.silent||(C._emitSelectionChange=!0),C._selectedCoordinates=$}cn.prototype.createRenderBatch=function(){var C=this,A=this.render,$=0;return this.render=function(){$++},function(){C.render=A,$>0&&C.render()}},cn.prototype.setDirty=function(){return this.isDirty=!0,this},cn.prototype.featureChanged=function(C){return this._changedFeatureIds.add(C),this},cn.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},cn.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},cn.prototype.getAllIds=function(){return this._featureIds.values()},cn.prototype.add=function(C){return this.featureChanged(C.id),this._features[C.id]=C,this._featureIds.add(C.id),this},cn.prototype.delete=function(C,A){var $=this;return A===void 0&&(A={}),uo(C).forEach(function(ne){$._featureIds.has(ne)&&($._featureIds.delete(ne),$._selectedFeatureIds.delete(ne),A.silent||$._deletedFeaturesToEmit.indexOf($._features[ne])===-1&&$._deletedFeaturesToEmit.push($._features[ne]),delete $._features[ne],$.isDirty=!0)}),Sa(this,A),this},cn.prototype.get=function(C){return this._features[C]},cn.prototype.getAll=function(){var C=this;return Object.keys(this._features).map(function(A){return C._features[A]})},cn.prototype.select=function(C,A){var $=this;return A===void 0&&(A={}),uo(C).forEach(function(ne){$._selectedFeatureIds.has(ne)||($._selectedFeatureIds.add(ne),$._changedFeatureIds.add(ne),A.silent||($._emitSelectionChange=!0))}),this},cn.prototype.deselect=function(C,A){var $=this;return A===void 0&&(A={}),uo(C).forEach(function(ne){$._selectedFeatureIds.has(ne)&&($._selectedFeatureIds.delete(ne),$._changedFeatureIds.add(ne),A.silent||($._emitSelectionChange=!0))}),Sa(this,A),this},cn.prototype.clearSelected=function(C){return C===void 0&&(C={}),this.deselect(this._selectedFeatureIds.values(),{silent:C.silent}),this},cn.prototype.setSelected=function(C,A){var $=this;return A===void 0&&(A={}),C=uo(C),this.deselect(this._selectedFeatureIds.values().filter(function(ne){return C.indexOf(ne)===-1}),{silent:A.silent}),this.select(C.filter(function(ne){return!$._selectedFeatureIds.has(ne)}),{silent:A.silent}),this},cn.prototype.setSelectedCoordinates=function(C){return this._selectedCoordinates=C,this._emitSelectionChange=!0,this},cn.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},cn.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},cn.prototype.getSelected=function(){var C=this;return this._selectedFeatureIds.values().map(function(A){return C.get(A)})},cn.prototype.getSelectedCoordinates=function(){var C=this;return this._selectedCoordinates.map(function(A){return{coordinates:C.get(A.feature_id).getCoordinate(A.coord_path)}})},cn.prototype.isSelected=function(C){return this._selectedFeatureIds.has(C)},cn.prototype.setFeatureProperty=function(C,A,$){this.get(C).setProperty(A,$),this.featureChanged(C)},cn.prototype.storeMapConfig=function(){var C=this;Un.forEach(function(A){C.ctx.map[A]&&(C._mapInitialConfig[A]=C.ctx.map[A].isEnabled())})},cn.prototype.restoreMapConfig=function(){var C=this;Object.keys(this._mapInitialConfig).forEach(function(A){C._mapInitialConfig[A]?C.ctx.map[A].enable():C.ctx.map[A].disable()})},cn.prototype.getInitialConfigValue=function(C){return this._mapInitialConfig[C]===void 0||this._mapInitialConfig[C]};var ho=function(){for(var C=arguments,A={},$=0;$<arguments.length;$++){var ne=C[$];for(var ae in ne)di.call(ne,ae)&&(A[ae]=ne[ae])}return A},di=Object.prototype.hasOwnProperty,bi=s(ho),Ys=["mode","feature","mouse"];function Aa(C){var A=null,$=null,ne={onRemove:function(){return C.map.off("load",ne.connect),clearInterval($),ne.removeLayers(),C.store.restoreMapConfig(),C.ui.removeButtons(),C.events.removeEventListeners(),C.ui.clearMapClasses(),C.boxZoomInitial&&C.map.boxZoom.enable(),C.map=null,C.container=null,C.store=null,A&&A.parentNode&&A.parentNode.removeChild(A),A=null,this},connect:function(){C.map.off("load",ne.connect),clearInterval($),ne.addLayers(),C.store.storeMapConfig(),C.events.addEventListeners()},onAdd:function(ae){var ge=ae.fire;return ae.fire=function(ve,Xe){var nt=arguments;return ge.length===1&&arguments.length!==1&&(nt=[bi({},{type:ve},Xe)]),ge.apply(ae,nt)},C.map=ae,C.events=function(ve){var Xe=Object.keys(ve.options.modes).reduce(function(Ne,yt){return Ne[yt]=hi(ve.options.modes[yt]),Ne},{}),nt={},ht={},ft={},ot=null,Pt=null;ft.drag=function(Ne,yt){yt({point:Ne.point,time:new Date().getTime()})?(ve.ui.queueMapClasses({mouse:_e.DRAG}),Pt.drag(Ne)):Ne.originalEvent.stopPropagation()},ft.mousedrag=function(Ne){ft.drag(Ne,function(yt){return!Ht(nt,yt)})},ft.touchdrag=function(Ne){ft.drag(Ne,function(yt){return!Bo(ht,yt)})},ft.mousemove=function(Ne){if((Ne.originalEvent.buttons!==void 0?Ne.originalEvent.buttons:Ne.originalEvent.which)===1)return ft.mousedrag(Ne);var yt=zo(Ne,ve);Ne.featureTarget=yt,Pt.mousemove(Ne)},ft.mousedown=function(Ne){nt={time:new Date().getTime(),point:Ne.point};var yt=zo(Ne,ve);Ne.featureTarget=yt,Pt.mousedown(Ne)},ft.mouseup=function(Ne){var yt=zo(Ne,ve);Ne.featureTarget=yt,Ht(nt,{point:Ne.point,time:new Date().getTime()})?Pt.click(Ne):Pt.mouseup(Ne)},ft.mouseout=function(Ne){Pt.mouseout(Ne)},ft.touchstart=function(Ne){if(ve.options.touchEnabled){ht={time:new Date().getTime(),point:Ne.point};var yt=No.touch(Ne,null,ve)[0];Ne.featureTarget=yt,Pt.touchstart(Ne)}},ft.touchmove=function(Ne){if(ve.options.touchEnabled)return Pt.touchmove(Ne),ft.touchdrag(Ne)},ft.touchend=function(Ne){if(Ne.originalEvent.preventDefault(),ve.options.touchEnabled){var yt=No.touch(Ne,null,ve)[0];Ne.featureTarget=yt,Bo(ht,{time:new Date().getTime(),point:Ne.point})?Pt.tap(Ne):Pt.touchend(Ne)}};var Zn=function(Ne){return!(Ne===8||Ne===46||Ne>=48&&Ne<=57)};function kt(Ne,yt,Cn){Cn===void 0&&(Cn={}),Pt.stop();var Tn=Xe[Ne];if(Tn===void 0)throw new Error(Ne+" is not valid");ot=Ne;var Dn=Tn(ve,yt);Pt=o(Dn,ve),Cn.silent||ve.map.fire(Mt.MODE_CHANGE,{mode:Ne}),ve.store.setDirty(),ve.store.render()}ft.keydown=function(Ne){(Ne.srcElement||Ne.target).classList.contains("mapboxgl-canvas")&&(Ne.keyCode!==8&&Ne.keyCode!==46||!ve.options.controls.trash?Zn(Ne.keyCode)?Pt.keydown(Ne):Ne.keyCode===49&&ve.options.controls.point?kt(tt.DRAW_POINT):Ne.keyCode===50&&ve.options.controls.line_string?kt(tt.DRAW_LINE_STRING):Ne.keyCode===51&&ve.options.controls.polygon&&kt(tt.DRAW_POLYGON):(Ne.preventDefault(),Pt.trash()))},ft.keyup=function(Ne){Zn(Ne.keyCode)&&Pt.keyup(Ne)},ft.zoomend=function(){ve.store.changeZoom()},ft.data=function(Ne){if(Ne.dataType==="style"){var yt=ve.setup,Cn=ve.map,Tn=ve.options,Dn=ve.store;Tn.styles.some(function(hl){return Cn.getLayer(hl.id)})||(yt.addLayers(),Dn.setDirty(),Dn.render())}};var _n={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){ot=ve.options.defaultMode,Pt=o(Xe[ot](ve),ve)},changeMode:kt,actionable:function(Ne){var yt=!1;Object.keys(Ne).forEach(function(Cn){if(_n[Cn]===void 0)throw new Error("Invalid action type");_n[Cn]!==Ne[Cn]&&(yt=!0),_n[Cn]=Ne[Cn]}),yt&&ve.map.fire(Mt.ACTIONABLE,{actions:_n})},currentModeName:function(){return ot},currentModeRender:function(Ne,yt){return Pt.render(Ne,yt)},fire:function(Ne,yt){ft[Ne]&&ft[Ne](yt)},addEventListeners:function(){ve.map.on("mousemove",ft.mousemove),ve.map.on("mousedown",ft.mousedown),ve.map.on("mouseup",ft.mouseup),ve.map.on("data",ft.data),ve.map.on("touchmove",ft.touchmove),ve.map.on("touchstart",ft.touchstart),ve.map.on("touchend",ft.touchend),ve.container.addEventListener("mouseout",ft.mouseout),ve.options.keybindings&&(ve.container.addEventListener("keydown",ft.keydown),ve.container.addEventListener("keyup",ft.keyup))},removeEventListeners:function(){ve.map.off("mousemove",ft.mousemove),ve.map.off("mousedown",ft.mousedown),ve.map.off("mouseup",ft.mouseup),ve.map.off("data",ft.data),ve.map.off("touchmove",ft.touchmove),ve.map.off("touchstart",ft.touchstart),ve.map.off("touchend",ft.touchend),ve.container.removeEventListener("mouseout",ft.mouseout),ve.options.keybindings&&(ve.container.removeEventListener("keydown",ft.keydown),ve.container.removeEventListener("keyup",ft.keyup))},trash:function(Ne){Pt.trash(Ne)},combineFeatures:function(){Pt.combineFeatures()},uncombineFeatures:function(){Pt.uncombineFeatures()},getMode:function(){return ot}}}(C),C.ui=function(ve){var Xe={},nt=null,ht={mode:null,feature:null,mouse:null},ft={mode:null,feature:null,mouse:null};function ot(Ne){ft=bi(ft,Ne)}function Pt(){var Ne,yt;if(ve.container){var Cn=[],Tn=[];Ys.forEach(function(Dn){ft[Dn]!==ht[Dn]&&(Cn.push(Dn+"-"+ht[Dn]),ft[Dn]!==null&&Tn.push(Dn+"-"+ft[Dn]))}),Cn.length>0&&(Ne=ve.container.classList).remove.apply(Ne,Cn),Tn.length>0&&(yt=ve.container.classList).add.apply(yt,Tn),ht=bi(ht,ft)}}function Zn(Ne,yt){yt===void 0&&(yt={});var Cn=document.createElement("button");return Cn.className=j.CONTROL_BUTTON+" "+yt.className,Cn.setAttribute("title",yt.title),yt.container.appendChild(Cn),Cn.addEventListener("click",function(Tn){if(Tn.preventDefault(),Tn.stopPropagation(),Tn.target===nt)return kt(),void yt.onDeactivate();_n(Ne),yt.onActivate()},!0),Cn}function kt(){nt&&(nt.classList.remove(j.ACTIVE_BUTTON),nt=null)}function _n(Ne){kt();var yt=Xe[Ne];yt&&yt&&Ne!=="trash"&&(yt.classList.add(j.ACTIVE_BUTTON),nt=yt)}return{setActiveButton:_n,queueMapClasses:ot,updateMapClasses:Pt,clearMapClasses:function(){ot({mode:null,feature:null,mouse:null}),Pt()},addButtons:function(){var Ne=ve.options.controls,yt=document.createElement("div");return yt.className=j.CONTROL_GROUP+" "+j.CONTROL_BASE,Ne&&(Ne[Be.LINE]&&(Xe[Be.LINE]=Zn(Be.LINE,{container:yt,className:j.CONTROL_BUTTON_LINE,title:"LineString tool "+(ve.options.keybindings?"(l)":""),onActivate:function(){return ve.events.changeMode(tt.DRAW_LINE_STRING)},onDeactivate:function(){return ve.events.trash()}})),Ne[Be.POLYGON]&&(Xe[Be.POLYGON]=Zn(Be.POLYGON,{container:yt,className:j.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(ve.options.keybindings?"(p)":""),onActivate:function(){return ve.events.changeMode(tt.DRAW_POLYGON)},onDeactivate:function(){return ve.events.trash()}})),Ne[Be.POINT]&&(Xe[Be.POINT]=Zn(Be.POINT,{container:yt,className:j.CONTROL_BUTTON_POINT,title:"Marker tool "+(ve.options.keybindings?"(m)":""),onActivate:function(){return ve.events.changeMode(tt.DRAW_POINT)},onDeactivate:function(){return ve.events.trash()}})),Ne.trash&&(Xe.trash=Zn("trash",{container:yt,className:j.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){ve.events.trash()}})),Ne.combine_features&&(Xe.combine_features=Zn("combineFeatures",{container:yt,className:j.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){ve.events.combineFeatures()}})),Ne.uncombine_features&&(Xe.uncombine_features=Zn("uncombineFeatures",{container:yt,className:j.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){ve.events.uncombineFeatures()}}))),yt},removeButtons:function(){Object.keys(Xe).forEach(function(Ne){var yt=Xe[Ne];yt.parentNode&&yt.parentNode.removeChild(yt),delete Xe[Ne]})}}}(C),C.container=ae.getContainer(),C.store=new cn(C),A=C.ui.addButtons(),C.options.boxSelect&&(C.boxZoomInitial=ae.boxZoom.isEnabled(),ae.boxZoom.disable(),ae.dragPan.disable(),ae.dragPan.enable()),ae.loaded()?ne.connect():(ae.on("load",ne.connect),$=setInterval(function(){ae.loaded()&&ne.connect()},16)),C.events.start(),A},addLayers:function(){C.map.addSource(ie.COLD,{data:{type:Re.FEATURE_COLLECTION,features:[]},type:"geojson"}),C.map.addSource(ie.HOT,{data:{type:Re.FEATURE_COLLECTION,features:[]},type:"geojson"}),C.options.styles.forEach(function(ae){C.map.addLayer(ae)}),C.store.setDirty(!0),C.store.render()},removeLayers:function(){C.options.styles.forEach(function(ae){C.map.getLayer(ae.id)&&C.map.removeLayer(ae.id)}),C.map.getSource(ie.COLD)&&C.map.removeSource(ie.COLD),C.map.getSource(ie.HOT)&&C.map.removeSource(ie.HOT)}};return C.setup=ne,ne}var fo=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function po(C){return function(A){var $=A.featureTarget;return!!$&&!!$.properties&&$.properties.meta===C}}function Pa(C){return!!C.originalEvent&&!!C.originalEvent.shiftKey&&C.originalEvent.button===0}function Xi(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.active===gn.ACTIVE&&C.featureTarget.properties.meta===Ct.FEATURE}function ri(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.active===gn.INACTIVE&&C.featureTarget.properties.meta===Ct.FEATURE}function Ni(C){return C.featureTarget===void 0}function gs(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.meta===Ct.FEATURE}function zi(C){var A=C.featureTarget;return!!A&&!!A.properties&&A.properties.meta===Ct.VERTEX}function mo(C){return!!C.originalEvent&&C.originalEvent.shiftKey===!0}function Vo(C){return C.keyCode===27}function Yi(C){return C.keyCode===13}var jo=Object.freeze({__proto__:null,isOfMetaType:po,isShiftMousedown:Pa,isActiveFeature:Xi,isInactiveFeature:ri,noTarget:Ni,isFeature:gs,isVertex:zi,isShiftDown:mo,isEscapeKey:Vo,isEnterKey:Yi,isTrue:function(){return!0}}),_s=wi;function wi(C,A){this.x=C,this.y=A}wi.prototype={clone:function(){return new wi(this.x,this.y)},add:function(C){return this.clone()._add(C)},sub:function(C){return this.clone()._sub(C)},multByPoint:function(C){return this.clone()._multByPoint(C)},divByPoint:function(C){return this.clone()._divByPoint(C)},mult:function(C){return this.clone()._mult(C)},div:function(C){return this.clone()._div(C)},rotate:function(C){return this.clone()._rotate(C)},rotateAround:function(C,A){return this.clone()._rotateAround(C,A)},matMult:function(C){return this.clone()._matMult(C)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(C){return this.x===C.x&&this.y===C.y},dist:function(C){return Math.sqrt(this.distSqr(C))},distSqr:function(C){var A=C.x-this.x,$=C.y-this.y;return A*A+$*$},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(C){return Math.atan2(this.y-C.y,this.x-C.x)},angleWith:function(C){return this.angleWithSep(C.x,C.y)},angleWithSep:function(C,A){return Math.atan2(this.x*A-this.y*C,this.x*C+this.y*A)},_matMult:function(C){var A=C[0]*this.x+C[1]*this.y,$=C[2]*this.x+C[3]*this.y;return this.x=A,this.y=$,this},_add:function(C){return this.x+=C.x,this.y+=C.y,this},_sub:function(C){return this.x-=C.x,this.y-=C.y,this},_mult:function(C){return this.x*=C,this.y*=C,this},_div:function(C){return this.x/=C,this.y/=C,this},_multByPoint:function(C){return this.x*=C.x,this.y*=C.y,this},_divByPoint:function(C){return this.x/=C.x,this.y/=C.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var C=this.y;return this.y=this.x,this.x=-C,this},_rotate:function(C){var A=Math.cos(C),$=Math.sin(C),ne=A*this.x-$*this.y,ae=$*this.x+A*this.y;return this.x=ne,this.y=ae,this},_rotateAround:function(C,A){var $=Math.cos(C),ne=Math.sin(C),ae=A.x+$*(this.x-A.x)-ne*(this.y-A.y),ge=A.y+ne*(this.x-A.x)+$*(this.y-A.y);return this.x=ae,this.y=ge,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},wi.convert=function(C){return C instanceof wi?C:Array.isArray(C)?new wi(C[0],C[1]):C};var Ks=s(_s);function Js(C,A){var $=A.getBoundingClientRect();return new Ks(C.clientX-$.left-(A.clientLeft||0),C.clientY-$.top-(A.clientTop||0))}function re(C,A,$,ne){return{type:Re.FEATURE,properties:{meta:Ct.VERTEX,parent:C,coord_path:$,active:ne?gn.ACTIVE:gn.INACTIVE},geometry:{type:Re.POINT,coordinates:A}}}function V(C,A,$){var ne=A.geometry.coordinates,ae=$.geometry.coordinates;if(ne[1]>85||ne[1]<xr||ae[1]>85||ae[1]<xr)return null;var ge={lng:(ne[0]+ae[0])/2,lat:(ne[1]+ae[1])/2};return{type:Re.FEATURE,properties:{meta:Ct.MIDPOINT,parent:C,lng:ge.lng,lat:ge.lat,coord_path:$.properties.coord_path},geometry:{type:Re.POINT,coordinates:[ge.lng,ge.lat]}}}function U(C,A,$){A===void 0&&(A={}),$===void 0&&($=null);var ne,ae=C.geometry,ge=ae.type,ve=ae.coordinates,Xe=C.properties&&C.properties.id,nt=[];function ht(ot,Pt){var Zn="",kt=null;ot.forEach(function(_n,Ne){var yt=Pt!=null?Pt+"."+Ne:String(Ne),Cn=re(Xe,_n,yt,ft(yt));if(A.midpoints&&kt){var Tn=V(Xe,kt,Cn);Tn&&nt.push(Tn)}kt=Cn;var Dn=JSON.stringify(_n);Zn!==Dn&&nt.push(Cn),Ne===0&&(Zn=Dn)})}function ft(ot){return!!A.selectedPaths&&A.selectedPaths.indexOf(ot)!==-1}return ge===Re.POINT?nt.push(re(Xe,ve,$,ft($))):ge===Re.POLYGON?ve.forEach(function(ot,Pt){ht(ot,$!==null?$+"."+Pt:String(Pt))}):ge===Re.LINE_STRING?ht(ve,$):ge.indexOf(Re.MULTI_PREFIX)===0&&(ne=ge.replace(Re.MULTI_PREFIX,""),ve.forEach(function(ot,Pt){var Zn={type:Re.FEATURE,properties:C.properties,geometry:{type:ne,coordinates:ot}};nt=nt.concat(U(Zn,A,Pt))})),nt}var ee={enable:function(C){setTimeout(function(){C.map&&C.map.doubleClickZoom&&C._ctx&&C._ctx.store&&C._ctx.store.getInitialConfigValue&&C._ctx.store.getInitialConfigValue("doubleClickZoom")&&C.map.doubleClickZoom.enable()},0)},disable:function(C){setTimeout(function(){C.map&&C.map.doubleClickZoom&&C.map.doubleClickZoom.disable()},0)}},ce={exports:{}},pe=function(C){if(!C||!C.type)return null;var A=Ee[C.type];if(!A)return null;if(A==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:C}]};if(A==="feature")return{type:"FeatureCollection",features:[C]};if(A==="featurecollection")return C},Ee={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},we=s(pe),me=Object.freeze({__proto__:null,default:function C(A){switch(A&&A.type||null){case"FeatureCollection":return A.features=A.features.reduce(function($,ne){return $.concat(C(ne))},[]),A;case"Feature":return A.geometry?C(A.geometry).map(function($){var ne={type:"Feature",properties:JSON.parse(JSON.stringify(A.properties)),geometry:$};return A.id!==void 0&&(ne.id=A.id),ne}):[A];case"MultiPoint":return A.coordinates.map(function($){return{type:"Point",coordinates:$}});case"MultiPolygon":return A.coordinates.map(function($){return{type:"Polygon",coordinates:$}});case"MultiLineString":return A.coordinates.map(function($){return{type:"LineString",coordinates:$}});case"GeometryCollection":return A.geometries.map(C).reduce(function($,ne){return $.concat(ne)},[]);case"Point":case"Polygon":case"LineString":return[A]}}}),Se=pe,Ke=h(me),it=function(C){return function A($){return Array.isArray($)&&$.length&&typeof $[0]=="number"?[$]:$.reduce(function(ne,ae){return Array.isArray(ae)&&Array.isArray(ae[0])?ne.concat(A(ae)):(ne.push(ae),ne)},[])}(C)};Ke instanceof Function||(Ke=Ke.default);var Ze={exports:{}},Lt=Ze.exports=function(C){return new St(C)};function St(C){this.value=C}function Ot(C,A,$){var ne=[],ae=[],ge=!0;return function ve(Xe){var nt=$?$t(Xe):Xe,ht={},ft=!0,ot={node:nt,node_:Xe,path:[].concat(ne),parent:ae[ae.length-1],parents:ae,key:ne.slice(-1)[0],isRoot:ne.length===0,level:ne.length,circular:null,update:function(kt,_n){ot.isRoot||(ot.parent.node[ot.key]=kt),ot.node=kt,_n&&(ft=!1)},delete:function(kt){delete ot.parent.node[ot.key],kt&&(ft=!1)},remove:function(kt){cr(ot.parent.node)?ot.parent.node.splice(ot.key,1):delete ot.parent.node[ot.key],kt&&(ft=!1)},keys:null,before:function(kt){ht.before=kt},after:function(kt){ht.after=kt},pre:function(kt){ht.pre=kt},post:function(kt){ht.post=kt},stop:function(){ge=!1},block:function(){ft=!1}};if(!ge)return ot;function Pt(){if(typeof ot.node=="object"&&ot.node!==null){ot.keys&&ot.node_===ot.node||(ot.keys=Wt(ot.node)),ot.isLeaf=ot.keys.length==0;for(var kt=0;kt<ae.length;kt++)if(ae[kt].node_===Xe){ot.circular=ae[kt];break}}else ot.isLeaf=!0,ot.keys=null;ot.notLeaf=!ot.isLeaf,ot.notRoot=!ot.isRoot}Pt();var Zn=A.call(ot,ot.node);return Zn!==void 0&&ot.update&&ot.update(Zn),ht.before&&ht.before.call(ot,ot.node),ft&&(typeof ot.node!="object"||ot.node===null||ot.circular||(ae.push(ot),Pt(),wr(ot.keys,function(kt,_n){ne.push(kt),ht.pre&&ht.pre.call(ot,ot.node[kt],kt);var Ne=ve(ot.node[kt]);$&&or.call(ot.node,kt)&&(ot.node[kt]=Ne.node),Ne.isLast=_n==ot.keys.length-1,Ne.isFirst=_n==0,ht.post&&ht.post.call(ot,Ne),ne.pop()}),ae.pop()),ht.after&&ht.after.call(ot,ot.node)),ot}(C).node}function $t(C){if(typeof C=="object"&&C!==null){var A;if(cr(C))A=[];else if(Sn(C)==="[object Date]")A=new Date(C.getTime?C.getTime():C);else if(function(ae){return Sn(ae)==="[object RegExp]"}(C))A=new RegExp(C);else if(function(ae){return Sn(ae)==="[object Error]"}(C))A={message:C.message};else if(function(ae){return Sn(ae)==="[object Boolean]"}(C))A=new Boolean(C);else if(function(ae){return Sn(ae)==="[object Number]"}(C))A=new Number(C);else if(function(ae){return Sn(ae)==="[object String]"}(C))A=new String(C);else if(Object.create&&Object.getPrototypeOf)A=Object.create(Object.getPrototypeOf(C));else if(C.constructor===Object)A={};else{var $=C.constructor&&C.constructor.prototype||C.__proto__||{},ne=function(){};ne.prototype=$,A=new ne}return wr(Wt(C),function(ae){A[ae]=C[ae]}),A}return C}St.prototype.get=function(C){for(var A=this.value,$=0;$<C.length;$++){var ne=C[$];if(!A||!or.call(A,ne)){A=void 0;break}A=A[ne]}return A},St.prototype.has=function(C){for(var A=this.value,$=0;$<C.length;$++){var ne=C[$];if(!A||!or.call(A,ne))return!1;A=A[ne]}return!0},St.prototype.set=function(C,A){for(var $=this.value,ne=0;ne<C.length-1;ne++){var ae=C[ne];or.call($,ae)||($[ae]={}),$=$[ae]}return $[C[ne]]=A,A},St.prototype.map=function(C){return Ot(this.value,C,!0)},St.prototype.forEach=function(C){return this.value=Ot(this.value,C,!1),this.value},St.prototype.reduce=function(C,A){var $=arguments.length===1,ne=$?this.value:A;return this.forEach(function(ae){this.isRoot&&$||(ne=C.call(this,ne,ae))}),ne},St.prototype.paths=function(){var C=[];return this.forEach(function(A){C.push(this.path)}),C},St.prototype.nodes=function(){var C=[];return this.forEach(function(A){C.push(this.node)}),C},St.prototype.clone=function(){var C=[],A=[];return function $(ne){for(var ae=0;ae<C.length;ae++)if(C[ae]===ne)return A[ae];if(typeof ne=="object"&&ne!==null){var ge=$t(ne);return C.push(ne),A.push(ge),wr(Wt(ne),function(ve){ge[ve]=$(ne[ve])}),C.pop(),A.pop(),ge}return ne}(this.value)};var Wt=Object.keys||function(C){var A=[];for(var $ in C)A.push($);return A};function Sn(C){return Object.prototype.toString.call(C)}var cr=Array.isArray||function(C){return Object.prototype.toString.call(C)==="[object Array]"},wr=function(C,A){if(C.forEach)return C.forEach(A);for(var $=0;$<C.length;$++)A(C[$],$,C)};wr(Wt(St.prototype),function(C){Lt[C]=function(A){var $=[].slice.call(arguments,1),ne=new St(A);return ne[C].apply(ne,$)}});var or=Object.hasOwnProperty||function(C,A){return A in C},Ki=Ze.exports,Rr=Rn;function Rn(C){if(!(this instanceof Rn))return new Rn(C);this._bbox=C||[1/0,1/0,-1/0,-1/0],this._valid=!!C}Rn.prototype.include=function(C){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],C[0]),this._bbox[1]=Math.min(this._bbox[1],C[1]),this._bbox[2]=Math.max(this._bbox[2],C[0]),this._bbox[3]=Math.max(this._bbox[3],C[1]),this},Rn.prototype.equals=function(C){var A;return A=C instanceof Rn?C.bbox():C,this._bbox[0]==A[0]&&this._bbox[1]==A[1]&&this._bbox[2]==A[2]&&this._bbox[3]==A[3]},Rn.prototype.center=function(C){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Rn.prototype.union=function(C){var A;return this._valid=!0,A=C instanceof Rn?C.bbox():C,this._bbox[0]=Math.min(this._bbox[0],A[0]),this._bbox[1]=Math.min(this._bbox[1],A[1]),this._bbox[2]=Math.max(this._bbox[2],A[2]),this._bbox[3]=Math.max(this._bbox[3],A[3]),this},Rn.prototype.bbox=function(){return this._valid?this._bbox:null},Rn.prototype.contains=function(C){if(!C)return this._fastContains();if(!this._valid)return null;var A=C[0],$=C[1];return this._bbox[0]<=A&&this._bbox[1]<=$&&this._bbox[2]>=A&&this._bbox[3]>=$},Rn.prototype.intersect=function(C){return this._valid?(A=C instanceof Rn?C.bbox():C,!(this._bbox[0]>A[2]||this._bbox[2]<A[0]||this._bbox[3]<A[1]||this._bbox[1]>A[3])):null;var A},Rn.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var C="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",C)},Rn.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Qs=function(C){if(!C)return[];var A=Ke(Se(C)),$=[];return A.features.forEach(function(ne){ne.geometry&&($=$.concat(it(ne.geometry.coordinates)))}),$},Bh=Ki,au=Rr,hn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ql=Object.keys(hn);function ys(C){for(var A=au(),$=Qs(C),ne=0;ne<$.length;ne++)A.include($[ne]);return A}ce.exports=function(C){return ys(C).bbox()},ce.exports.polygon=function(C){return ys(C).polygon()},ce.exports.bboxify=function(C){return Bh(C).map(function(A){A&&Ql.some(function($){return!!A[$]&&hn[$].indexOf(A.type)!==-1})&&(A.bbox=ys(A).bbox(),this.update(A))})};var ec=s(ce.exports),vs=-90;function Ei(C,A){var $=vs,ne=90,ae=vs,ge=90,ve=270,Xe=-270;C.forEach(function(ht){var ft=ec(ht),ot=ft[1],Pt=ft[3],Zn=ft[0],kt=ft[2];ot>$&&($=ot),Pt<ne&&(ne=Pt),Pt>ae&&(ae=Pt),ot<ge&&(ge=ot),Zn<ve&&(ve=Zn),kt>Xe&&(Xe=kt)});var nt=A;return $+nt.lat>85&&(nt.lat=85-$),ae+nt.lat>90&&(nt.lat=90-ae),ne+nt.lat<-85&&(nt.lat=-85-ne),ge+nt.lat<vs&&(nt.lat=vs-ge),ve+nt.lng<=-270&&(nt.lng+=360*Math.ceil(Math.abs(nt.lng)/360)),Xe+nt.lng>=270&&(nt.lng-=360*Math.ceil(Math.abs(nt.lng)/360)),nt}function Bi(C,A){var $=Ei(C.map(function(ne){return ne.toGeoJSON()}),A);C.forEach(function(ne){var ae,ge=ne.getCoordinates(),ve=function(nt){var ht={lng:nt[0]+$.lng,lat:nt[1]+$.lat};return[ht.lng,ht.lat]},Xe=function(nt){return nt.map(function(ht){return ve(ht)})};ne.type===Re.POINT?ae=ve(ge):ne.type===Re.LINE_STRING||ne.type===Re.MULTI_POINT?ae=ge.map(ve):ne.type===Re.POLYGON||ne.type===Re.MULTI_LINE_STRING?ae=ge.map(Xe):ne.type===Re.MULTI_POLYGON&&(ae=ge.map(function(nt){return nt.map(function(ht){return Xe(ht)})})),ne.incomingCoords(ae)})}var fr={onSetup:function(C){var A=this,$={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:C.featureIds||[]};return this.setSelected($.initiallySelectedFeatureIds.filter(function(ne){return A.getFeature(ne)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),$},fireUpdate:function(){this.map.fire(Mt.UPDATE,{action:En.MOVE,features:this.getSelected().map(function(C){return C.toGeoJSON()})})},fireActionable:function(){var C=this,A=this.getSelected(),$=A.filter(function(Xe){return C.isInstanceOf("MultiFeature",Xe)}),ne=!1;if(A.length>1){ne=!0;var ae=A[0].type.replace("Multi","");A.forEach(function(Xe){Xe.type.replace("Multi","")!==ae&&(ne=!1)})}var ge=$.length>0,ve=A.length>0;this.setActionableState({combineFeatures:ne,uncombineFeatures:ge,trash:ve})},getUniqueIds:function(C){return C.length?C.map(function(A){return A.properties.id}).filter(function(A){return A!==void 0}).reduce(function(A,$){return A.add($),A},new At).values():[]},stopExtendedInteractions:function(C){C.boxSelectElement&&(C.boxSelectElement.parentNode&&C.boxSelectElement.parentNode.removeChild(C.boxSelectElement),C.boxSelectElement=null),this.map.dragPan.enable(),C.boxSelecting=!1,C.canBoxSelect=!1,C.dragMoving=!1,C.canDragMove=!1},onStop:function(){ee.enable(this)},onMouseMove:function(C,A){return gs(A)&&C.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(C),!0},onMouseOut:function(C){return!C.dragMoving||this.fireUpdate()}};fr.onTap=fr.onClick=function(C,A){return Ni(A)?this.clickAnywhere(C,A):po(Ct.VERTEX)(A)?this.clickOnVertex(C,A):gs(A)?this.clickOnFeature(C,A):void 0},fr.clickAnywhere=function(C){var A=this,$=this.getSelectedIds();$.length&&(this.clearSelectedFeatures(),$.forEach(function(ne){return A.doRender(ne)})),ee.enable(this),this.stopExtendedInteractions(C)},fr.clickOnVertex=function(C,A){this.changeMode(tt.DIRECT_SELECT,{featureId:A.featureTarget.properties.parent,coordPath:A.featureTarget.properties.coord_path,startPos:A.lngLat}),this.updateUIClasses({mouse:_e.MOVE})},fr.startOnActiveFeature=function(C,A){this.stopExtendedInteractions(C),this.map.dragPan.disable(),this.doRender(A.featureTarget.properties.id),C.canDragMove=!0,C.dragMoveLocation=A.lngLat},fr.clickOnFeature=function(C,A){var $=this;ee.disable(this),this.stopExtendedInteractions(C);var ne=mo(A),ae=this.getSelectedIds(),ge=A.featureTarget.properties.id,ve=this.isSelected(ge);if(!ne&&ve&&this.getFeature(ge).type!==Re.POINT)return this.changeMode(tt.DIRECT_SELECT,{featureId:ge});ve&&ne?(this.deselect(ge),this.updateUIClasses({mouse:_e.POINTER}),ae.length===1&&ee.enable(this)):!ve&&ne?(this.select(ge),this.updateUIClasses({mouse:_e.MOVE})):ve||ne||(ae.forEach(function(Xe){return $.doRender(Xe)}),this.setSelected(ge),this.updateUIClasses({mouse:_e.MOVE})),this.doRender(ge)},fr.onMouseDown=function(C,A){return Xi(A)?this.startOnActiveFeature(C,A):this.drawConfig.boxSelect&&Pa(A)?this.startBoxSelect(C,A):void 0},fr.startBoxSelect=function(C,A){this.stopExtendedInteractions(C),this.map.dragPan.disable(),C.boxSelectStartLocation=Js(A.originalEvent,this.map.getContainer()),C.canBoxSelect=!0},fr.onTouchStart=function(C,A){if(Xi(A))return this.startOnActiveFeature(C,A)},fr.onDrag=function(C,A){return C.canDragMove?this.dragMove(C,A):this.drawConfig.boxSelect&&C.canBoxSelect?this.whileBoxSelect(C,A):void 0},fr.whileBoxSelect=function(C,A){C.boxSelecting=!0,this.updateUIClasses({mouse:_e.ADD}),C.boxSelectElement||(C.boxSelectElement=document.createElement("div"),C.boxSelectElement.classList.add(j.BOX_SELECT),this.map.getContainer().appendChild(C.boxSelectElement));var $=Js(A.originalEvent,this.map.getContainer()),ne=Math.min(C.boxSelectStartLocation.x,$.x),ae=Math.max(C.boxSelectStartLocation.x,$.x),ge=Math.min(C.boxSelectStartLocation.y,$.y),ve=Math.max(C.boxSelectStartLocation.y,$.y),Xe="translate("+ne+"px, "+ge+"px)";C.boxSelectElement.style.transform=Xe,C.boxSelectElement.style.WebkitTransform=Xe,C.boxSelectElement.style.width=ae-ne+"px",C.boxSelectElement.style.height=ve-ge+"px"},fr.dragMove=function(C,A){C.dragMoving=!0,A.originalEvent.stopPropagation();var $={lng:A.lngLat.lng-C.dragMoveLocation.lng,lat:A.lngLat.lat-C.dragMoveLocation.lat};Bi(this.getSelected(),$),C.dragMoveLocation=A.lngLat},fr.onTouchEnd=fr.onMouseUp=function(C,A){var $=this;if(C.dragMoving)this.fireUpdate();else if(C.boxSelecting){var ne=[C.boxSelectStartLocation,Js(A.originalEvent,this.map.getContainer())],ae=this.featuresAt(null,ne,"click"),ge=this.getUniqueIds(ae).filter(function(ve){return!$.isSelected(ve)});ge.length&&(this.select(ge),ge.forEach(function(ve){return $.doRender(ve)}),this.updateUIClasses({mouse:_e.MOVE}))}this.stopExtendedInteractions(C)},fr.toDisplayFeatures=function(C,A,$){A.properties.active=this.isSelected(A.properties.id)?gn.ACTIVE:gn.INACTIVE,$(A),this.fireActionable(),A.properties.active===gn.ACTIVE&&A.geometry.type!==Re.POINT&&U(A).forEach($)},fr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},fr.onCombineFeatures=function(){var C=this.getSelected();if(!(C.length===0||C.length<2)){for(var A=[],$=[],ne=C[0].type.replace("Multi",""),ae=0;ae<C.length;ae++){var ge=C[ae];if(ge.type.replace("Multi","")!==ne)return;ge.type.includes("Multi")?ge.getCoordinates().forEach(function(Xe){A.push(Xe)}):A.push(ge.getCoordinates()),$.push(ge.toGeoJSON())}if($.length>1){var ve=this.newFeature({type:Re.FEATURE,properties:$[0].properties,geometry:{type:"Multi"+ne,coordinates:A}});this.addFeature(ve),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([ve.id]),this.map.fire(Mt.COMBINE_FEATURES,{createdFeatures:[ve.toGeoJSON()],deletedFeatures:$})}this.fireActionable()}},fr.onUncombineFeatures=function(){var C=this,A=this.getSelected();if(A.length!==0){for(var $=[],ne=[],ae=function(ve){var Xe=A[ve];C.isInstanceOf("MultiFeature",Xe)&&(Xe.getFeatures().forEach(function(nt){C.addFeature(nt),nt.properties=Xe.properties,$.push(nt.toGeoJSON()),C.select([nt.id])}),C.deleteFeature(Xe.id,{silent:!0}),ne.push(Xe.toGeoJSON()))},ge=0;ge<A.length;ge++)ae(ge);$.length>1&&this.map.fire(Mt.UNCOMBINE_FEATURES,{createdFeatures:$,deletedFeatures:ne}),this.fireActionable()}};var ul=po(Ct.VERTEX),Uo=po(Ct.MIDPOINT),zr={fireUpdate:function(){this.map.fire(Mt.UPDATE,{action:En.CHANGE_COORDINATES,features:this.getSelected().map(function(C){return C.toGeoJSON()})})},fireActionable:function(C){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:C.selectedCoordPaths.length>0})},startDragging:function(C,A){this.map.dragPan.disable(),C.canDragMove=!0,C.dragMoveLocation=A.lngLat},stopDragging:function(C){this.map.dragPan.enable(),C.dragMoving=!1,C.canDragMove=!1,C.dragMoveLocation=null},onVertex:function(C,A){this.startDragging(C,A);var $=A.featureTarget.properties,ne=C.selectedCoordPaths.indexOf($.coord_path);mo(A)||ne!==-1?mo(A)&&ne===-1&&C.selectedCoordPaths.push($.coord_path):C.selectedCoordPaths=[$.coord_path];var ae=this.pathsToCoordinates(C.featureId,C.selectedCoordPaths);this.setSelectedCoordinates(ae)},onMidpoint:function(C,A){this.startDragging(C,A);var $=A.featureTarget.properties;C.feature.addCoordinate($.coord_path,$.lng,$.lat),this.fireUpdate(),C.selectedCoordPaths=[$.coord_path]},pathsToCoordinates:function(C,A){return A.map(function($){return{feature_id:C,coord_path:$}})},onFeature:function(C,A){C.selectedCoordPaths.length===0?this.startDragging(C,A):this.stopDragging(C)},dragFeature:function(C,A,$){Bi(this.getSelected(),$),C.dragMoveLocation=A.lngLat},dragVertex:function(C,A,$){for(var ne=C.selectedCoordPaths.map(function(Xe){return C.feature.getCoordinate(Xe)}),ae=Ei(ne.map(function(Xe){return{type:Re.FEATURE,properties:{},geometry:{type:Re.POINT,coordinates:Xe}}}),$),ge=0;ge<ne.length;ge++){var ve=ne[ge];C.feature.updateCoordinate(C.selectedCoordPaths[ge],ve[0]+ae.lng,ve[1]+ae.lat)}},clickNoTarget:function(){this.changeMode(tt.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(tt.SIMPLE_SELECT)},clickActiveFeature:function(C){C.selectedCoordPaths=[],this.clearSelectedCoordinates(),C.feature.changed()},onSetup:function(C){var A=C.featureId,$=this.getFeature(A);if(!$)throw new Error("You must provide a featureId to enter direct_select mode");if($.type===Re.POINT)throw new TypeError("direct_select mode doesn't handle point features");var ne={featureId:A,feature:$,dragMoveLocation:C.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:C.coordPath?[C.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(A,ne.selectedCoordPaths)),this.setSelected(A),ee.disable(this),this.setActionableState({trash:!0}),ne},onStop:function(){ee.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(C,A,$){C.featureId===A.properties.id?(A.properties.active=gn.ACTIVE,$(A),U(A,{map:this.map,midpoints:!0,selectedPaths:C.selectedCoordPaths}).forEach($)):(A.properties.active=gn.INACTIVE,$(A)),this.fireActionable(C)},onTrash:function(C){C.selectedCoordPaths.sort(function(A,$){return $.localeCompare(A,"en",{numeric:!0})}).forEach(function(A){return C.feature.removeCoordinate(A)}),this.fireUpdate(),C.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(C),C.feature.isValid()===!1&&(this.deleteFeature([C.featureId]),this.changeMode(tt.SIMPLE_SELECT,{}))},onMouseMove:function(C,A){var $=Xi(A),ne=ul(A),ae=Uo(A),ge=C.selectedCoordPaths.length===0;return $&&ge||ne&&!ge?this.updateUIClasses({mouse:_e.MOVE}):this.updateUIClasses({mouse:_e.NONE}),(ne||$||ae)&&C.dragMoving&&this.fireUpdate(),this.stopDragging(C),!0},onMouseOut:function(C){return C.dragMoving&&this.fireUpdate(),!0}};zr.onTouchStart=zr.onMouseDown=function(C,A){return ul(A)?this.onVertex(C,A):Xi(A)?this.onFeature(C,A):Uo(A)?this.onMidpoint(C,A):void 0},zr.onDrag=function(C,A){if(C.canDragMove===!0){C.dragMoving=!0,A.originalEvent.stopPropagation();var $={lng:A.lngLat.lng-C.dragMoveLocation.lng,lat:A.lngLat.lat-C.dragMoveLocation.lat};C.selectedCoordPaths.length>0?this.dragVertex(C,A,$):this.dragFeature(C,A,$),C.dragMoveLocation=A.lngLat}},zr.onClick=function(C,A){return Ni(A)?this.clickNoTarget(C,A):Xi(A)?this.clickActiveFeature(C,A):ri(A)?this.clickInactive(C,A):void this.stopDragging(C)},zr.onTap=function(C,A){return Ni(A)?this.clickNoTarget(C,A):Xi(A)?this.clickActiveFeature(C,A):ri(A)?this.clickInactive(C,A):void 0},zr.onTouchEnd=zr.onMouseUp=function(C){C.dragMoving&&this.fireUpdate(),this.stopDragging(C)};var ii={};function Oe(C,A){return!!C.lngLat&&C.lngLat.lng===A[0]&&C.lngLat.lat===A[1]}ii.onSetup=function(){var C=this.newFeature({type:Re.FEATURE,properties:{},geometry:{type:Re.POINT,coordinates:[]}});return this.addFeature(C),this.clearSelectedFeatures(),this.updateUIClasses({mouse:_e.ADD}),this.activateUIButton(Be.POINT),this.setActionableState({trash:!0}),{point:C}},ii.stopDrawingAndRemove=function(C){this.deleteFeature([C.point.id],{silent:!0}),this.changeMode(tt.SIMPLE_SELECT)},ii.onTap=ii.onClick=function(C,A){this.updateUIClasses({mouse:_e.MOVE}),C.point.updateCoordinate("",A.lngLat.lng,A.lngLat.lat),this.map.fire(Mt.CREATE,{features:[C.point.toGeoJSON()]}),this.changeMode(tt.SIMPLE_SELECT,{featureIds:[C.point.id]})},ii.onStop=function(C){this.activateUIButton(),C.point.getCoordinate().length||this.deleteFeature([C.point.id],{silent:!0})},ii.toDisplayFeatures=function(C,A,$){var ne=A.properties.id===C.point.id;if(A.properties.active=ne?gn.ACTIVE:gn.INACTIVE,!ne)return $(A)},ii.onTrash=ii.stopDrawingAndRemove,ii.onKeyUp=function(C,A){if(Vo(A)||Yi(A))return this.stopDrawingAndRemove(C,A)};var Hr={onSetup:function(){var C=this.newFeature({type:Re.FEATURE,properties:{},geometry:{type:Re.POLYGON,coordinates:[[]]}});return this.addFeature(C),this.clearSelectedFeatures(),ee.disable(this),this.updateUIClasses({mouse:_e.ADD}),this.activateUIButton(Be.POLYGON),this.setActionableState({trash:!0}),{polygon:C,currentVertexPosition:0}},clickAnywhere:function(C,A){if(C.currentVertexPosition>0&&Oe(A,C.polygon.coordinates[0][C.currentVertexPosition-1]))return this.changeMode(tt.SIMPLE_SELECT,{featureIds:[C.polygon.id]});this.updateUIClasses({mouse:_e.ADD}),C.polygon.updateCoordinate("0."+C.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),C.currentVertexPosition++,C.polygon.updateCoordinate("0."+C.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)},clickOnVertex:function(C){return this.changeMode(tt.SIMPLE_SELECT,{featureIds:[C.polygon.id]})},onMouseMove:function(C,A){C.polygon.updateCoordinate("0."+C.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),zi(A)&&this.updateUIClasses({mouse:_e.POINTER})}};Hr.onTap=Hr.onClick=function(C,A){return zi(A)?this.clickOnVertex(C,A):this.clickAnywhere(C,A)},Hr.onKeyUp=function(C,A){Vo(A)?(this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(tt.SIMPLE_SELECT)):Yi(A)&&this.changeMode(tt.SIMPLE_SELECT,{featureIds:[C.polygon.id]})},Hr.onStop=function(C){this.updateUIClasses({mouse:_e.NONE}),ee.enable(this),this.activateUIButton(),this.getFeature(C.polygon.id)!==void 0&&(C.polygon.removeCoordinate("0."+C.currentVertexPosition),C.polygon.isValid()?this.map.fire(Mt.CREATE,{features:[C.polygon.toGeoJSON()]}):(this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(tt.SIMPLE_SELECT,{},{silent:!0})))},Hr.toDisplayFeatures=function(C,A,$){var ne=A.properties.id===C.polygon.id;if(A.properties.active=ne?gn.ACTIVE:gn.INACTIVE,!ne)return $(A);if(A.geometry.coordinates.length!==0){var ae=A.geometry.coordinates[0].length;if(!(ae<3)){if(A.properties.meta=Ct.FEATURE,$(re(C.polygon.id,A.geometry.coordinates[0][0],"0.0",!1)),ae>3){var ge=A.geometry.coordinates[0].length-3;$(re(C.polygon.id,A.geometry.coordinates[0][ge],"0."+ge,!1))}if(ae<=4){var ve=[[A.geometry.coordinates[0][0][0],A.geometry.coordinates[0][0][1]],[A.geometry.coordinates[0][1][0],A.geometry.coordinates[0][1][1]]];if($({type:Re.FEATURE,properties:A.properties,geometry:{coordinates:ve,type:Re.LINE_STRING}}),ae===3)return}return $(A)}}},Hr.onTrash=function(C){this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(tt.SIMPLE_SELECT)};var $n={onSetup:function(C){var A,$,ne=(C=C||{}).featureId,ae="forward";if(ne){if(!(A=this.getFeature(ne)))throw new Error("Could not find a feature with the provided featureId");var ge=C.from;if(ge&&ge.type==="Feature"&&ge.geometry&&ge.geometry.type==="Point"&&(ge=ge.geometry),ge&&ge.type==="Point"&&ge.coordinates&&ge.coordinates.length===2&&(ge=ge.coordinates),!ge||!Array.isArray(ge))throw new Error("Please use the `from` property to indicate which point to continue the line from");var ve=A.coordinates.length-1;if(A.coordinates[ve][0]===ge[0]&&A.coordinates[ve][1]===ge[1])$=ve+1,A.addCoordinate.apply(A,[$].concat(A.coordinates[ve]));else{if(A.coordinates[0][0]!==ge[0]||A.coordinates[0][1]!==ge[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ae="backwards",$=0,A.addCoordinate.apply(A,[$].concat(A.coordinates[0]))}}else A=this.newFeature({type:Re.FEATURE,properties:{},geometry:{type:Re.LINE_STRING,coordinates:[]}}),$=0,this.addFeature(A);return this.clearSelectedFeatures(),ee.disable(this),this.updateUIClasses({mouse:_e.ADD}),this.activateUIButton(Be.LINE),this.setActionableState({trash:!0}),{line:A,currentVertexPosition:$,direction:ae}},clickAnywhere:function(C,A){if(C.currentVertexPosition>0&&Oe(A,C.line.coordinates[C.currentVertexPosition-1])||C.direction==="backwards"&&Oe(A,C.line.coordinates[C.currentVertexPosition+1]))return this.changeMode(tt.SIMPLE_SELECT,{featureIds:[C.line.id]});this.updateUIClasses({mouse:_e.ADD}),C.line.updateCoordinate(C.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),C.direction==="forward"?(C.currentVertexPosition++,C.line.updateCoordinate(C.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)):C.line.addCoordinate(0,A.lngLat.lng,A.lngLat.lat)},clickOnVertex:function(C){return this.changeMode(tt.SIMPLE_SELECT,{featureIds:[C.line.id]})},onMouseMove:function(C,A){C.line.updateCoordinate(C.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),zi(A)&&this.updateUIClasses({mouse:_e.POINTER})}};$n.onTap=$n.onClick=function(C,A){if(zi(A))return this.clickOnVertex(C,A);this.clickAnywhere(C,A)},$n.onKeyUp=function(C,A){Yi(A)?this.changeMode(tt.SIMPLE_SELECT,{featureIds:[C.line.id]}):Vo(A)&&(this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(tt.SIMPLE_SELECT))},$n.onStop=function(C){ee.enable(this),this.activateUIButton(),this.getFeature(C.line.id)!==void 0&&(C.line.removeCoordinate(""+C.currentVertexPosition),C.line.isValid()?this.map.fire(Mt.CREATE,{features:[C.line.toGeoJSON()]}):(this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(tt.SIMPLE_SELECT,{},{silent:!0})))},$n.onTrash=function(C){this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(tt.SIMPLE_SELECT)},$n.toDisplayFeatures=function(C,A,$){var ne=A.properties.id===C.line.id;if(A.properties.active=ne?gn.ACTIVE:gn.INACTIVE,!ne)return $(A);A.geometry.coordinates.length<2||(A.properties.meta=Ct.FEATURE,$(re(C.line.id,A.geometry.coordinates[C.direction==="forward"?A.geometry.coordinates.length-2:1],""+(C.direction==="forward"?A.geometry.coordinates.length-2:1),!1)),$(A))};var Er={simple_select:fr,direct_select:zr,draw_point:ii,draw_polygon:Hr,draw_line_string:$n},lu={defaultMode:tt.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:fo,modes:Er,controls:{},userProperties:!1},Ji={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},tc={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function nc(C,A){return C.map(function($){return $.source?$:bi($,{id:$.id+"."+A,source:A==="hot"?ie.HOT:ie.COLD})})}var $o={exports:{}};(function(C,A){var $="__lodash_hash_undefined__",ne=9007199254740991,ae="[object Arguments]",ge="[object Array]",ve="[object Boolean]",Xe="[object Date]",nt="[object Error]",ht="[object Function]",ft="[object Map]",ot="[object Number]",Pt="[object Object]",Zn="[object Promise]",kt="[object RegExp]",_n="[object Set]",Ne="[object String]",yt="[object Symbol]",Cn="[object WeakMap]",Tn="[object ArrayBuffer]",Dn="[object DataView]",hl=/^\[object .+?Constructor\]$/,Ra=/^(?:0|[1-9]\d*)$/,Ft={};Ft["[object Float32Array]"]=Ft["[object Float64Array]"]=Ft["[object Int8Array]"]=Ft["[object Int16Array]"]=Ft["[object Int32Array]"]=Ft["[object Uint8Array]"]=Ft["[object Uint8ClampedArray]"]=Ft["[object Uint16Array]"]=Ft["[object Uint32Array]"]=!0,Ft[ae]=Ft[ge]=Ft[Tn]=Ft[ve]=Ft[Dn]=Ft[Xe]=Ft[nt]=Ft[ht]=Ft[ft]=Ft[ot]=Ft[Pt]=Ft[kt]=Ft[_n]=Ft[Ne]=Ft[Cn]=!1;var ea=typeof global=="object"&&global&&global.Object===Object&&global,rc=typeof self=="object"&&self&&self.Object===Object&&self,qr=ea||rc||Function("return this")(),Or=A&&!A.nodeType&&A,dl=Or&&C&&!C.nodeType&&C,fl=dl&&dl.exports===Or,ji=fl&&ea.process,go=function(){try{return ji&&ji.binding&&ji.binding("util")}catch{}}(),Oa=go&&go.isTypedArray;function Vh(be,Le){for(var ut=-1,wt=be==null?0:be.length;++ut<wt;)if(Le(be[ut],ut,be))return!0;return!1}function ic(be){var Le=-1,ut=Array(be.size);return be.forEach(function(wt,Qn){ut[++Le]=[Qn,wt]}),ut}function ta(be){var Le=-1,ut=Array(be.size);return be.forEach(function(wt){ut[++Le]=wt}),ut}var Ui,pl,Go,_o=Array.prototype,ka=Function.prototype,Ci=Object.prototype,na=qr["__core-js_shared__"],xs=ka.toString,oi=Ci.hasOwnProperty,oc=(Ui=/[^.]+$/.exec(na&&na.keys&&na.keys.IE_PROTO||""))?"Symbol(src)_1."+Ui:"",La=Ci.toString,sc=RegExp("^"+xs.call(oi).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ml=fl?qr.Buffer:void 0,yo=qr.Symbol,dn=qr.Uint8Array,cu=Ci.propertyIsEnumerable,ac=_o.splice,Ho=yo?yo.toStringTag:void 0,gl=Object.getOwnPropertySymbols,uu=ml?ml.isBuffer:void 0,lc=(pl=Object.keys,Go=Object,function(be){return pl(Go(be))}),qo=ws(qr,"DataView"),Wo=ws(qr,"Map"),Zo=ws(qr,"Promise"),$i=ws(qr,"Set"),vo=ws(qr,"WeakMap"),Xo=ws(Object,"create"),hu=bo(qo),Fa=bo(Wo),cc=bo(Zo),uc=bo($i),_l=bo(vo),Na=yo?yo.prototype:void 0,za=Na?Na.valueOf:void 0;function Xt(be){var Le=-1,ut=be==null?0:be.length;for(this.clear();++Le<ut;){var wt=be[Le];this.set(wt[0],wt[1])}}function pi(be){var Le=-1,ut=be==null?0:be.length;for(this.clear();++Le<ut;){var wt=be[Le];this.set(wt[0],wt[1])}}function Yo(be){var Le=-1,ut=be==null?0:be.length;for(this.clear();++Le<ut;){var wt=be[Le];this.set(wt[0],wt[1])}}function ra(be){var Le=-1,ut=be==null?0:be.length;for(this.__data__=new Yo;++Le<ut;)this.add(be[Le])}function xo(be){var Le=this.__data__=new pi(be);this.size=Le.size}function bs(be,Le){var ut=mi(be),wt=!ut&&fc(be),Qn=!ut&&!wt&&aa(be),rn=!ut&&!wt&&!Qn&&pu(be),sr=ut||wt||Qn||rn,rr=sr?function(yr,Wr){for(var wo=-1,Zr=Array(yr);++wo<yr;)Zr[wo]=Wr(wo);return Zr}(be.length,String):[],Di=rr.length;for(var ur in be)!Le&&!oi.call(be,ur)||sr&&(ur=="length"||Qn&&(ur=="offset"||ur=="parent")||rn&&(ur=="buffer"||ur=="byteLength"||ur=="byteOffset")||oa(ur,Di))||rr.push(ur);return rr}function ia(be,Le){for(var ut=be.length;ut--;)if(sa(be[ut][0],Le))return ut;return-1}function Ba(be){return be==null?be===void 0?"[object Undefined]":"[object Null]":Ho&&Ho in Object(be)?function(Le){var ut=oi.call(Le,Ho),wt=Le[Ho];try{Le[Ho]=void 0;var Qn=!0}catch{}var rn=La.call(Le);return Qn&&(ut?Le[Ho]=wt:delete Le[Ho]),rn}(be):function(Le){return La.call(Le)}(be)}function du(be){return Es(be)&&Ba(be)==ae}function fu(be,Le,ut,wt,Qn){return be===Le||(be==null||Le==null||!Es(be)&&!Es(Le)?be!=be&&Le!=Le:function(rn,sr,rr,Di,ur,yr){var Wr=mi(rn),wo=mi(sr),Zr=Wr?ge:Ti(rn),Eo=wo?ge:Ti(sr),la=(Zr=Zr==ae?Pt:Zr)==Pt,xl=(Eo=Eo==ae?Pt:Eo)==Pt,Cs=Zr==Eo;if(Cs&&aa(rn)){if(!aa(sr))return!1;Wr=!0,la=!1}if(Cs&&!la)return yr||(yr=new xo),Wr||pu(rn)?yl(rn,sr,rr,Di,ur,yr):function(fn,xn,Xr,Ii,bl,kr,si){switch(Xr){case Dn:if(fn.byteLength!=xn.byteLength||fn.byteOffset!=xn.byteOffset)return!1;fn=fn.buffer,xn=xn.buffer;case Tn:return!(fn.byteLength!=xn.byteLength||!kr(new dn(fn),new dn(xn)));case ve:case Xe:case ot:return sa(+fn,+xn);case nt:return fn.name==xn.name&&fn.message==xn.message;case kt:case Ne:return fn==xn+"";case ft:var Gi=ic;case _n:var Jo=1&Ii;if(Gi||(Gi=ta),fn.size!=xn.size&&!Jo)return!1;var tn=si.get(fn);if(tn)return tn==xn;Ii|=2,si.set(fn,xn);var Qi=yl(Gi(fn),Gi(xn),Ii,bl,kr,si);return si.delete(fn),Qi;case yt:if(za)return za.call(fn)==za.call(xn)}return!1}(rn,sr,Zr,rr,Di,ur,yr);if(!(1&rr)){var Ko=la&&oi.call(rn,"__wrapped__"),Ts=xl&&oi.call(sr,"__wrapped__");if(Ko||Ts){var mu=Ko?rn.value():rn,gu=Ts?sr.value():sr;return yr||(yr=new xo),ur(mu,gu,rr,Di,yr)}}return Cs?(yr||(yr=new xo),function(fn,xn,Xr,Ii,bl,kr){var si=1&Xr,Gi=Va(fn),Jo=Gi.length,tn=Va(xn).length;if(Jo!=tn&&!si)return!1;for(var Qi=Jo;Qi--;){var Qo=Gi[Qi];if(!(si?Qo in xn:oi.call(xn,Qo)))return!1}var $a=kr.get(fn);if($a&&kr.get(xn))return $a==xn;var Co=!0;kr.set(fn,xn),kr.set(xn,fn);for(var wl=si;++Qi<Jo;){var Ds=fn[Qo=Gi[Qi]],Mi=xn[Qo];if(Ii)var gc=si?Ii(Mi,Ds,Qo,xn,fn,kr):Ii(Ds,Mi,Qo,fn,xn,kr);if(!(gc===void 0?Ds===Mi||bl(Ds,Mi,Xr,Ii,kr):gc)){Co=!1;break}wl||(wl=Qo=="constructor")}if(Co&&!wl){var Is=fn.constructor,To=xn.constructor;Is==To||!("constructor"in fn)||!("constructor"in xn)||typeof Is=="function"&&Is instanceof Is&&typeof To=="function"&&To instanceof To||(Co=!1)}return kr.delete(fn),kr.delete(xn),Co}(rn,sr,rr,Di,ur,yr)):!1}(be,Le,ut,wt,fu,Qn))}function hc(be){return!(!pc(be)||function(Le){return!!oc&&oc in Le}(be))&&(vl(be)?sc:hl).test(bo(be))}function dc(be){if(ut=(Le=be)&&Le.constructor,wt=typeof ut=="function"&&ut.prototype||Ci,Le!==wt)return lc(be);var Le,ut,wt,Qn=[];for(var rn in Object(be))oi.call(be,rn)&&rn!="constructor"&&Qn.push(rn);return Qn}function yl(be,Le,ut,wt,Qn,rn){var sr=1&ut,rr=be.length,Di=Le.length;if(rr!=Di&&!(sr&&Di>rr))return!1;var ur=rn.get(be);if(ur&&rn.get(Le))return ur==Le;var yr=-1,Wr=!0,wo=2&ut?new ra:void 0;for(rn.set(be,Le),rn.set(Le,be);++yr<rr;){var Zr=be[yr],Eo=Le[yr];if(wt)var la=sr?wt(Eo,Zr,yr,Le,be,rn):wt(Zr,Eo,yr,be,Le,rn);if(la!==void 0){if(la)continue;Wr=!1;break}if(wo){if(!Vh(Le,function(xl,Cs){if(Ko=Cs,!wo.has(Ko)&&(Zr===xl||Qn(Zr,xl,ut,wt,rn)))return wo.push(Cs);var Ko})){Wr=!1;break}}else if(Zr!==Eo&&!Qn(Zr,Eo,ut,wt,rn)){Wr=!1;break}}return rn.delete(be),rn.delete(Le),Wr}function Va(be){return function(Le,ut,wt){var Qn=ut(Le);return mi(Le)?Qn:function(rn,sr){for(var rr=-1,Di=sr.length,ur=rn.length;++rr<Di;)rn[ur+rr]=sr[rr];return rn}(Qn,wt(Le))}(be,mc,jh)}function ja(be,Le){var ut,wt,Qn=be.__data__;return((wt=typeof(ut=Le))=="string"||wt=="number"||wt=="symbol"||wt=="boolean"?ut!=="__proto__":ut===null)?Qn[typeof Le=="string"?"string":"hash"]:Qn.map}function ws(be,Le){var ut=function(wt,Qn){return wt?.[Qn]}(be,Le);return hc(ut)?ut:void 0}Xt.prototype.clear=function(){this.__data__=Xo?Xo(null):{},this.size=0},Xt.prototype.delete=function(be){var Le=this.has(be)&&delete this.__data__[be];return this.size-=Le?1:0,Le},Xt.prototype.get=function(be){var Le=this.__data__;if(Xo){var ut=Le[be];return ut===$?void 0:ut}return oi.call(Le,be)?Le[be]:void 0},Xt.prototype.has=function(be){var Le=this.__data__;return Xo?Le[be]!==void 0:oi.call(Le,be)},Xt.prototype.set=function(be,Le){var ut=this.__data__;return this.size+=this.has(be)?0:1,ut[be]=Xo&&Le===void 0?$:Le,this},pi.prototype.clear=function(){this.__data__=[],this.size=0},pi.prototype.delete=function(be){var Le=this.__data__,ut=ia(Le,be);return!(ut<0)&&(ut==Le.length-1?Le.pop():ac.call(Le,ut,1),--this.size,!0)},pi.prototype.get=function(be){var Le=this.__data__,ut=ia(Le,be);return ut<0?void 0:Le[ut][1]},pi.prototype.has=function(be){return ia(this.__data__,be)>-1},pi.prototype.set=function(be,Le){var ut=this.__data__,wt=ia(ut,be);return wt<0?(++this.size,ut.push([be,Le])):ut[wt][1]=Le,this},Yo.prototype.clear=function(){this.size=0,this.__data__={hash:new Xt,map:new(Wo||pi),string:new Xt}},Yo.prototype.delete=function(be){var Le=ja(this,be).delete(be);return this.size-=Le?1:0,Le},Yo.prototype.get=function(be){return ja(this,be).get(be)},Yo.prototype.has=function(be){return ja(this,be).has(be)},Yo.prototype.set=function(be,Le){var ut=ja(this,be),wt=ut.size;return ut.set(be,Le),this.size+=ut.size==wt?0:1,this},ra.prototype.add=ra.prototype.push=function(be){return this.__data__.set(be,$),this},ra.prototype.has=function(be){return this.__data__.has(be)},xo.prototype.clear=function(){this.__data__=new pi,this.size=0},xo.prototype.delete=function(be){var Le=this.__data__,ut=Le.delete(be);return this.size=Le.size,ut},xo.prototype.get=function(be){return this.__data__.get(be)},xo.prototype.has=function(be){return this.__data__.has(be)},xo.prototype.set=function(be,Le){var ut=this.__data__;if(ut instanceof pi){var wt=ut.__data__;if(!Wo||wt.length<199)return wt.push([be,Le]),this.size=++ut.size,this;ut=this.__data__=new Yo(wt)}return ut.set(be,Le),this.size=ut.size,this};var jh=gl?function(be){return be==null?[]:(be=Object(be),function(Le,ut){for(var wt=-1,Qn=Le==null?0:Le.length,rn=0,sr=[];++wt<Qn;){var rr=Le[wt];ut(rr,wt,Le)&&(sr[rn++]=rr)}return sr}(gl(be),function(Le){return cu.call(be,Le)}))}:function(){return[]},Ti=Ba;function oa(be,Le){return!!(Le=Le??ne)&&(typeof be=="number"||Ra.test(be))&&be>-1&&be%1==0&&be<Le}function bo(be){if(be!=null){try{return xs.call(be)}catch{}try{return be+""}catch{}}return""}function sa(be,Le){return be===Le||be!=be&&Le!=Le}(qo&&Ti(new qo(new ArrayBuffer(1)))!=Dn||Wo&&Ti(new Wo)!=ft||Zo&&Ti(Zo.resolve())!=Zn||$i&&Ti(new $i)!=_n||vo&&Ti(new vo)!=Cn)&&(Ti=function(be){var Le=Ba(be),ut=Le==Pt?be.constructor:void 0,wt=ut?bo(ut):"";if(wt)switch(wt){case hu:return Dn;case Fa:return ft;case cc:return Zn;case uc:return _n;case _l:return Cn}return Le});var fc=du(function(){return arguments}())?du:function(be){return Es(be)&&oi.call(be,"callee")&&!cu.call(be,"callee")},mi=Array.isArray,aa=uu||function(){return!1};function vl(be){if(!pc(be))return!1;var Le=Ba(be);return Le==ht||Le=="[object GeneratorFunction]"||Le=="[object AsyncFunction]"||Le=="[object Proxy]"}function Ua(be){return typeof be=="number"&&be>-1&&be%1==0&&be<=ne}function pc(be){var Le=typeof be;return be!=null&&(Le=="object"||Le=="function")}function Es(be){return be!=null&&typeof be=="object"}var pu=Oa?function(be){return function(Le){return be(Le)}}(Oa):function(be){return Es(be)&&Ua(be.length)&&!!Ft[Ba(be)]};function mc(be){return(Le=be)!=null&&Ua(Le.length)&&!vl(Le)?bs(be):dc(be);var Le}C.exports=function(be,Le){return fu(be,Le)}})($o,$o.exports);var at=s($o.exports);function Yt(C,A){return C.length===A.length&&JSON.stringify(C.map(function($){return $}).sort())===JSON.stringify(A.map(function($){return $}).sort())}var Zt={Polygon:br,LineString:ni,Point:ti,MultiPolygon:_r,MultiLineString:_r,MultiPoint:_r},fi=Object.freeze({__proto__:null,CommonSelectors:jo,constrainFeatureMovement:Ei,createMidPoint:V,createSupplementaryPoints:U,createVertex:re,doubleClickZoom:ee,euclideanDistance:Zs,featuresAt:No,getFeatureAtAndSetCursors:zo,isClick:Ht,isEventAtCoordinates:Oe,isTap:Bo,mapEventToBoundingBox:Ws,ModeHandler:o,moveFeatures:Bi,sortFeatures:Fo,stringSetsAreEqual:Yt,StringSet:At,theme:fo,toDenseArray:uo}),Vi=function(C,A){var $={options:C=function(ae){ae===void 0&&(ae={});var ge=bi(ae);return ae.controls||(ge.controls={}),ae.displayControlsDefault===!1?ge.controls=bi(tc,ae.controls):ge.controls=bi(Ji,ae.controls),(ge=bi(lu,ge)).styles=nc(ge.styles,"cold").concat(nc(ge.styles,"hot")),ge}(C)};A=function(ae,ge){return ge.modes=tt,ge.getFeatureIdsAt=function(ve){return No.click({point:ve},null,ae).map(function(Xe){return Xe.properties.id})},ge.getSelectedIds=function(){return ae.store.getSelectedIds()},ge.getSelected=function(){return{type:Re.FEATURE_COLLECTION,features:ae.store.getSelectedIds().map(function(ve){return ae.store.get(ve)}).map(function(ve){return ve.toGeoJSON()})}},ge.getSelectedPoints=function(){return{type:Re.FEATURE_COLLECTION,features:ae.store.getSelectedCoordinates().map(function(ve){return{type:Re.FEATURE,properties:{},geometry:{type:Re.POINT,coordinates:ve.coordinates}}})}},ge.set=function(ve){if(ve.type===void 0||ve.type!==Re.FEATURE_COLLECTION||!Array.isArray(ve.features))throw new Error("Invalid FeatureCollection");var Xe=ae.store.createRenderBatch(),nt=ae.store.getAllIds().slice(),ht=ge.add(ve),ft=new At(ht);return(nt=nt.filter(function(ot){return!ft.has(ot)})).length&&ge.delete(nt),Xe(),ht},ge.add=function(ve){var Xe=JSON.parse(JSON.stringify(we(ve))).features.map(function(nt){if(nt.id=nt.id||Zi(),nt.geometry===null)throw new Error("Invalid geometry: null");if(ae.store.get(nt.id)===void 0||ae.store.get(nt.id).type!==nt.geometry.type){var ht=Zt[nt.geometry.type];if(ht===void 0)throw new Error("Invalid geometry type: "+nt.geometry.type+".");var ft=new ht(ae,nt);ae.store.add(ft)}else{var ot=ae.store.get(nt.id);ot.properties=nt.properties,at(ot.properties,nt.properties)||ae.store.featureChanged(ot.id),at(ot.getCoordinates(),nt.geometry.coordinates)||ot.incomingCoords(nt.geometry.coordinates)}return nt.id});return ae.store.render(),Xe},ge.get=function(ve){var Xe=ae.store.get(ve);if(Xe)return Xe.toGeoJSON()},ge.getAll=function(){return{type:Re.FEATURE_COLLECTION,features:ae.store.getAll().map(function(ve){return ve.toGeoJSON()})}},ge.delete=function(ve){return ae.store.delete(ve,{silent:!0}),ge.getMode()!==tt.DIRECT_SELECT||ae.store.getSelectedIds().length?ae.store.render():ae.events.changeMode(tt.SIMPLE_SELECT,void 0,{silent:!0}),ge},ge.deleteAll=function(){return ae.store.delete(ae.store.getAllIds(),{silent:!0}),ge.getMode()===tt.DIRECT_SELECT?ae.events.changeMode(tt.SIMPLE_SELECT,void 0,{silent:!0}):ae.store.render(),ge},ge.changeMode=function(ve,Xe){return Xe===void 0&&(Xe={}),ve===tt.SIMPLE_SELECT&&ge.getMode()===tt.SIMPLE_SELECT?(Yt(Xe.featureIds||[],ae.store.getSelectedIds())||(ae.store.setSelected(Xe.featureIds,{silent:!0}),ae.store.render()),ge):(ve===tt.DIRECT_SELECT&&ge.getMode()===tt.DIRECT_SELECT&&Xe.featureId===ae.store.getSelectedIds()[0]||ae.events.changeMode(ve,Xe,{silent:!0}),ge)},ge.getMode=function(){return ae.events.getMode()},ge.trash=function(){return ae.events.trash({silent:!0}),ge},ge.combineFeatures=function(){return ae.events.combineFeatures({silent:!0}),ge},ge.uncombineFeatures=function(){return ae.events.uncombineFeatures({silent:!0}),ge},ge.setFeatureProperty=function(ve,Xe,nt){return ae.store.setFeatureProperty(ve,Xe,nt),ge},ge}($,A),$.api=A;var ne=Aa($);return A.onAdd=ne.onAdd,A.onRemove=ne.onRemove,A.types=Be,A.options=C,A};function Vt(C){Vi(C,this)}return Vt.modes=Er,Vt.constants=ei,Vt.lib=fi,Vt})});var Dw=null;var U_=1,Iw=Symbol("SIGNAL");function tr(o){let s=Dw;return Dw=o,s}var Mw={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function oS(o){if(!(H_(o)&&!o.dirty)&&!(!o.dirty&&o.lastCleanEpoch===U_)){if(!o.producerMustRecompute(o)&&!$_(o)){o.dirty=!1,o.lastCleanEpoch=U_;return}o.producerRecomputeValue(o),o.dirty=!1,o.lastCleanEpoch=U_}}function Sw(o){return o&&(o.nextProducerIndex=0),tr(o)}function Aw(o,s){if(tr(s),!(!o||o.producerNode===void 0||o.producerIndexOfThis===void 0||o.producerLastReadVersion===void 0)){if(H_(o))for(let h=o.nextProducerIndex;h<o.producerNode.length;h++)G_(o.producerNode[h],o.producerIndexOfThis[h]);for(;o.producerNode.length>o.nextProducerIndex;)o.producerNode.pop(),o.producerLastReadVersion.pop(),o.producerIndexOfThis.pop()}}function $_(o){Pp(o);for(let s=0;s<o.producerNode.length;s++){let h=o.producerNode[s],u=o.producerLastReadVersion[s];if(u!==h.version||(oS(h),u!==h.version))return!0}return!1}function Pw(o){if(Pp(o),H_(o))for(let s=0;s<o.producerNode.length;s++)G_(o.producerNode[s],o.producerIndexOfThis[s]);o.producerNode.length=o.producerLastReadVersion.length=o.producerIndexOfThis.length=0,o.liveConsumerNode&&(o.liveConsumerNode.length=o.liveConsumerIndexOfThis.length=0)}function G_(o,s){if(sS(o),Pp(o),o.liveConsumerNode.length===1)for(let u=0;u<o.producerNode.length;u++)G_(o.producerNode[u],o.producerIndexOfThis[u]);let h=o.liveConsumerNode.length-1;if(o.liveConsumerNode[s]=o.liveConsumerNode[h],o.liveConsumerIndexOfThis[s]=o.liveConsumerIndexOfThis[h],o.liveConsumerNode.length--,o.liveConsumerIndexOfThis.length--,s<o.liveConsumerNode.length){let u=o.liveConsumerIndexOfThis[s],g=o.liveConsumerNode[s];Pp(g),g.producerIndexOfThis[u]=s}}function H_(o){return o.consumerIsAlwaysLive||(o?.liveConsumerNode?.length??0)>0}function Pp(o){o.producerNode??=[],o.producerIndexOfThis??=[],o.producerLastReadVersion??=[]}function sS(o){o.liveConsumerNode??=[],o.liveConsumerIndexOfThis??=[]}function aS(){throw new Error}var lS=aS;function Rw(o){lS=o}function nn(o){return typeof o=="function"}function Wu(o){let h=o(u=>{Error.call(u),u.stack=new Error().stack});return h.prototype=Object.create(Error.prototype),h.prototype.constructor=h,h}var Rp=Wu(o=>function(h){o(this),this.message=h?`${h.length} errors occurred during unsubscription:
${h.map((u,g)=>`${g+1}) ${u.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=h});function Vd(o,s){if(o){let h=o.indexOf(s);0<=h&&o.splice(h,1)}}var Jr=class o{constructor(s){this.initialTeardown=s,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let s;if(!this.closed){this.closed=!0;let{_parentage:h}=this;if(h)if(this._parentage=null,Array.isArray(h))for(let i of h)i.remove(this);else h.remove(this);let{initialTeardown:u}=this;if(nn(u))try{u()}catch(i){s=i instanceof Rp?i.errors:[i]}let{_finalizers:g}=this;if(g){this._finalizers=null;for(let i of g)try{Ow(i)}catch(w){s=s??[],w instanceof Rp?s=[...s,...w.errors]:s.push(w)}}if(s)throw new Rp(s)}}add(s){var h;if(s&&s!==this)if(this.closed)Ow(s);else{if(s instanceof o){if(s.closed||s._hasParent(this))return;s._addParent(this)}(this._finalizers=(h=this._finalizers)!==null&&h!==void 0?h:[]).push(s)}}_hasParent(s){let{_parentage:h}=this;return h===s||Array.isArray(h)&&h.includes(s)}_addParent(s){let{_parentage:h}=this;this._parentage=Array.isArray(h)?(h.push(s),h):h?[h,s]:s}_removeParent(s){let{_parentage:h}=this;h===s?this._parentage=null:Array.isArray(h)&&Vd(h,s)}remove(s){let{_finalizers:h}=this;h&&Vd(h,s),s instanceof o&&s._removeParent(this)}};Jr.EMPTY=(()=>{let o=new Jr;return o.closed=!0,o})();var q_=Jr.EMPTY;function Op(o){return o instanceof Jr||o&&"closed"in o&&nn(o.remove)&&nn(o.add)&&nn(o.unsubscribe)}function Ow(o){nn(o)?o():o.unsubscribe()}var zs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Zu={setTimeout(o,s,...h){let{delegate:u}=Zu;return u?.setTimeout?u.setTimeout(o,s,...h):setTimeout(o,s,...h)},clearTimeout(o){let{delegate:s}=Zu;return(s?.clearTimeout||clearTimeout)(o)},delegate:void 0};function kp(o){Zu.setTimeout(()=>{let{onUnhandledError:s}=zs;if(s)s(o);else throw o})}function jd(){}var kw=W_("C",void 0,void 0);function Lw(o){return W_("E",void 0,o)}function Fw(o){return W_("N",o,void 0)}function W_(o,s,h){return{kind:o,value:s,error:h}}var Bc=null;function Xu(o){if(zs.useDeprecatedSynchronousErrorHandling){let s=!Bc;if(s&&(Bc={errorThrown:!1,error:null}),o(),s){let{errorThrown:h,error:u}=Bc;if(Bc=null,h)throw u}}else o()}function Nw(o){zs.useDeprecatedSynchronousErrorHandling&&Bc&&(Bc.errorThrown=!0,Bc.error=o)}var Vc=class extends Jr{constructor(s){super(),this.isStopped=!1,s?(this.destination=s,Op(s)&&s.add(this)):this.destination=hS}static create(s,h,u){return new Yu(s,h,u)}next(s){this.isStopped?X_(Fw(s),this):this._next(s)}error(s){this.isStopped?X_(Lw(s),this):(this.isStopped=!0,this._error(s))}complete(){this.isStopped?X_(kw,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(s){this.destination.next(s)}_error(s){try{this.destination.error(s)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},cS=Function.prototype.bind;function Z_(o,s){return cS.call(o,s)}var Y_=class{constructor(s){this.partialObserver=s}next(s){let{partialObserver:h}=this;if(h.next)try{h.next(s)}catch(u){Lp(u)}}error(s){let{partialObserver:h}=this;if(h.error)try{h.error(s)}catch(u){Lp(u)}else Lp(s)}complete(){let{partialObserver:s}=this;if(s.complete)try{s.complete()}catch(h){Lp(h)}}},Yu=class extends Vc{constructor(s,h,u){super();let g;if(nn(s)||!s)g={next:s??void 0,error:h??void 0,complete:u??void 0};else{let i;this&&zs.useDeprecatedNextContext?(i=Object.create(s),i.unsubscribe=()=>this.unsubscribe(),g={next:s.next&&Z_(s.next,i),error:s.error&&Z_(s.error,i),complete:s.complete&&Z_(s.complete,i)}):g=s}this.destination=new Y_(g)}};function Lp(o){zs.useDeprecatedSynchronousErrorHandling?Nw(o):kp(o)}function uS(o){throw o}function X_(o,s){let{onStoppedNotification:h}=zs;h&&Zu.setTimeout(()=>h(o,s))}var hS={closed:!0,next:jd,error:uS,complete:jd};var Ku=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Po(o){return o}function K_(...o){return J_(o)}function J_(o){return o.length===0?Po:o.length===1?o[0]:function(h){return o.reduce((u,g)=>g(u),h)}}var Yn=(()=>{class o{constructor(h){h&&(this._subscribe=h)}lift(h){let u=new o;return u.source=this,u.operator=h,u}subscribe(h,u,g){let i=fS(h)?h:new Yu(h,u,g);return Xu(()=>{let{operator:w,source:O}=this;i.add(w?w.call(i,O):O?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(h){try{return this._subscribe(h)}catch(u){h.error(u)}}forEach(h,u){return u=zw(u),new u((g,i)=>{let w=new Yu({next:O=>{try{h(O)}catch(B){i(B),w.unsubscribe()}},error:i,complete:g});this.subscribe(w)})}_subscribe(h){var u;return(u=this.source)===null||u===void 0?void 0:u.subscribe(h)}[Ku](){return this}pipe(...h){return J_(h)(this)}toPromise(h){return h=zw(h),new h((u,g)=>{let i;this.subscribe(w=>i=w,w=>g(w),()=>u(i))})}}return o.create=s=>new o(s),o})();function zw(o){var s;return(s=o??zs.Promise)!==null&&s!==void 0?s:Promise}function dS(o){return o&&nn(o.next)&&nn(o.error)&&nn(o.complete)}function fS(o){return o&&o instanceof Vc||dS(o)&&Op(o)}function Q_(o){return nn(o?.lift)}function An(o){return s=>{if(Q_(s))return s.lift(function(h){try{return o(h,this)}catch(u){this.error(u)}});throw new TypeError("Unable to lift unknown Observable type")}}function bn(o,s,h,u,g){return new ey(o,s,h,u,g)}var ey=class extends Vc{constructor(s,h,u,g,i,w){super(s),this.onFinalize=i,this.shouldUnsubscribe=w,this._next=h?function(O){try{h(O)}catch(B){s.error(B)}}:super._next,this._error=g?function(O){try{g(O)}catch(B){s.error(B)}finally{this.unsubscribe()}}:super._error,this._complete=u?function(){try{u()}catch(O){s.error(O)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var s;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:h}=this;super.unsubscribe(),!h&&((s=this.onFinalize)===null||s===void 0||s.call(this))}}};function Ju(){return An((o,s)=>{let h=null;o._refCount++;let u=bn(s,void 0,void 0,void 0,()=>{if(!o||o._refCount<=0||0<--o._refCount){h=null;return}let g=o._connection,i=h;h=null,g&&(!i||g===i)&&g.unsubscribe(),s.unsubscribe()});o.subscribe(u),u.closed||(h=o.connect())})}var Qu=class extends Yn{constructor(s,h){super(),this.source=s,this.subjectFactory=h,this._subject=null,this._refCount=0,this._connection=null,Q_(s)&&(this.lift=s.lift)}_subscribe(s){return this.getSubject().subscribe(s)}getSubject(){let s=this._subject;return(!s||s.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:s}=this;this._subject=this._connection=null,s?.unsubscribe()}connect(){let s=this._connection;if(!s){s=this._connection=new Jr;let h=this.getSubject();s.add(this.source.subscribe(bn(h,void 0,()=>{this._teardown(),h.complete()},u=>{this._teardown(),h.error(u)},()=>this._teardown()))),s.closed&&(this._connection=null,s=Jr.EMPTY)}return s}refCount(){return Ju()(this)}};var Bw=Wu(o=>function(){o(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var qi=(()=>{class o extends Yn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(h){let u=new Fp(this,this);return u.operator=h,u}_throwIfClosed(){if(this.closed)throw new Bw}next(h){Xu(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let u of this.currentObservers)u.next(h)}})}error(h){Xu(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=h;let{observers:u}=this;for(;u.length;)u.shift().error(h)}})}complete(){Xu(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:h}=this;for(;h.length;)h.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var h;return((h=this.observers)===null||h===void 0?void 0:h.length)>0}_trySubscribe(h){return this._throwIfClosed(),super._trySubscribe(h)}_subscribe(h){return this._throwIfClosed(),this._checkFinalizedStatuses(h),this._innerSubscribe(h)}_innerSubscribe(h){let{hasError:u,isStopped:g,observers:i}=this;return u||g?q_:(this.currentObservers=null,i.push(h),new Jr(()=>{this.currentObservers=null,Vd(i,h)}))}_checkFinalizedStatuses(h){let{hasError:u,thrownError:g,isStopped:i}=this;u?h.error(g):i&&h.complete()}asObservable(){let h=new Yn;return h.source=this,h}}return o.create=(s,h)=>new Fp(s,h),o})(),Fp=class extends qi{constructor(s,h){super(),this.destination=s,this.source=h}next(s){var h,u;(u=(h=this.destination)===null||h===void 0?void 0:h.next)===null||u===void 0||u.call(h,s)}error(s){var h,u;(u=(h=this.destination)===null||h===void 0?void 0:h.error)===null||u===void 0||u.call(h,s)}complete(){var s,h;(h=(s=this.destination)===null||s===void 0?void 0:s.complete)===null||h===void 0||h.call(s)}_subscribe(s){var h,u;return(u=(h=this.source)===null||h===void 0?void 0:h.subscribe(s))!==null&&u!==void 0?u:q_}};var _i=class extends qi{constructor(s){super(),this._value=s}get value(){return this.getValue()}_subscribe(s){let h=super._subscribe(s);return!h.closed&&s.next(this._value),h}getValue(){let{hasError:s,thrownError:h,_value:u}=this;if(s)throw h;return this._throwIfClosed(),u}next(s){super.next(this._value=s)}};var Ro=new Yn(o=>o.complete());function Vw(o){return o&&nn(o.schedule)}function jw(o){return o[o.length-1]}function Np(o){return nn(jw(o))?o.pop():void 0}function Bl(o){return Vw(jw(o))?o.pop():void 0}function $w(o,s,h,u){function g(i){return i instanceof h?i:new h(function(w){w(i)})}return new(h||(h=Promise))(function(i,w){function O(ie){try{j(u.next(ie))}catch(_e){w(_e)}}function B(ie){try{j(u.throw(ie))}catch(_e){w(_e)}}function j(ie){ie.done?i(ie.value):g(ie.value).then(O,B)}j((u=u.apply(o,s||[])).next())})}function Uw(o){var s=typeof Symbol=="function"&&Symbol.iterator,h=s&&o[s],u=0;if(h)return h.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&u>=o.length&&(o=void 0),{value:o&&o[u++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function jc(o){return this instanceof jc?(this.v=o,this):new jc(o)}function Gw(o,s,h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u=h.apply(o,s||[]),g,i=[];return g={},w("next"),w("throw"),w("return"),g[Symbol.asyncIterator]=function(){return this},g;function w(Be){u[Be]&&(g[Be]=function(Re){return new Promise(function(tt,Mt){i.push([Be,Re,tt,Mt])>1||O(Be,Re)})})}function O(Be,Re){try{B(u[Be](Re))}catch(tt){_e(i[0][3],tt)}}function B(Be){Be.value instanceof jc?Promise.resolve(Be.value.v).then(j,ie):_e(i[0][2],Be)}function j(Be){O("next",Be)}function ie(Be){O("throw",Be)}function _e(Be,Re){Be(Re),i.shift(),i.length&&O(i[0][0],i[0][1])}}function Hw(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=o[Symbol.asyncIterator],h;return s?s.call(o):(o=typeof Uw=="function"?Uw(o):o[Symbol.iterator](),h={},u("next"),u("throw"),u("return"),h[Symbol.asyncIterator]=function(){return this},h);function u(i){h[i]=o[i]&&function(w){return new Promise(function(O,B){w=o[i](w),g(O,B,w.done,w.value)})}}function g(i,w,O,B){Promise.resolve(B).then(function(j){i({value:j,done:O})},w)}}var zp=o=>o&&typeof o.length=="number"&&typeof o!="function";function Bp(o){return nn(o?.then)}function Vp(o){return nn(o[Ku])}function jp(o){return Symbol.asyncIterator&&nn(o?.[Symbol.asyncIterator])}function Up(o){return new TypeError(`You provided ${o!==null&&typeof o=="object"?"an invalid object":`'${o}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function pS(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var $p=pS();function Gp(o){return nn(o?.[$p])}function Hp(o){return Gw(this,arguments,function*(){let h=o.getReader();try{for(;;){let{value:u,done:g}=yield jc(h.read());if(g)return yield jc(void 0);yield yield jc(u)}}finally{h.releaseLock()}})}function qp(o){return nn(o?.getReader)}function $r(o){if(o instanceof Yn)return o;if(o!=null){if(Vp(o))return mS(o);if(zp(o))return gS(o);if(Bp(o))return _S(o);if(jp(o))return qw(o);if(Gp(o))return yS(o);if(qp(o))return vS(o)}throw Up(o)}function mS(o){return new Yn(s=>{let h=o[Ku]();if(nn(h.subscribe))return h.subscribe(s);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function gS(o){return new Yn(s=>{for(let h=0;h<o.length&&!s.closed;h++)s.next(o[h]);s.complete()})}function _S(o){return new Yn(s=>{o.then(h=>{s.closed||(s.next(h),s.complete())},h=>s.error(h)).then(null,kp)})}function yS(o){return new Yn(s=>{for(let h of o)if(s.next(h),s.closed)return;s.complete()})}function qw(o){return new Yn(s=>{xS(o,s).catch(h=>s.error(h))})}function vS(o){return qw(Hp(o))}function xS(o,s){var h,u,g,i;return $w(this,void 0,void 0,function*(){try{for(h=Hw(o);u=yield h.next(),!u.done;){let w=u.value;if(s.next(w),s.closed)return}}catch(w){g={error:w}}finally{try{u&&!u.done&&(i=h.return)&&(yield i.call(h))}finally{if(g)throw g.error}}s.complete()})}function so(o,s,h,u=0,g=!1){let i=s.schedule(function(){h(),g?o.add(this.schedule(null,u)):this.unsubscribe()},u);if(o.add(i),!g)return i}function Wp(o,s=0){return An((h,u)=>{h.subscribe(bn(u,g=>so(u,o,()=>u.next(g),s),()=>so(u,o,()=>u.complete(),s),g=>so(u,o,()=>u.error(g),s)))})}function Zp(o,s=0){return An((h,u)=>{u.add(o.schedule(()=>h.subscribe(u),s))})}function Ww(o,s){return $r(o).pipe(Zp(s),Wp(s))}function Zw(o,s){return $r(o).pipe(Zp(s),Wp(s))}function Xw(o,s){return new Yn(h=>{let u=0;return s.schedule(function(){u===o.length?h.complete():(h.next(o[u++]),h.closed||this.schedule())})})}function Yw(o,s){return new Yn(h=>{let u;return so(h,s,()=>{u=o[$p](),so(h,s,()=>{let g,i;try{({value:g,done:i}=u.next())}catch(w){h.error(w);return}i?h.complete():h.next(g)},0,!0)}),()=>nn(u?.return)&&u.return()})}function Xp(o,s){if(!o)throw new Error("Iterable cannot be null");return new Yn(h=>{so(h,s,()=>{let u=o[Symbol.asyncIterator]();so(h,s,()=>{u.next().then(g=>{g.done?h.complete():h.next(g.value)})},0,!0)})})}function Kw(o,s){return Xp(Hp(o),s)}function Jw(o,s){if(o!=null){if(Vp(o))return Ww(o,s);if(zp(o))return Xw(o,s);if(Bp(o))return Zw(o,s);if(jp(o))return Xp(o,s);if(Gp(o))return Yw(o,s);if(qp(o))return Kw(o,s)}throw Up(o)}function Fr(o,s){return s?Jw(o,s):$r(o)}function on(...o){let s=Bl(o);return Fr(o,s)}function eh(o,s){let h=nn(o)?o:()=>o,u=g=>g.error(h());return new Yn(s?g=>s.schedule(u,0,g):u)}function ty(o){return!!o&&(o instanceof Yn||nn(o.lift)&&nn(o.subscribe))}var tl=Wu(o=>function(){o(this),this.name="EmptyError",this.message="no elements in sequence"});function wn(o,s){return An((h,u)=>{let g=0;h.subscribe(bn(u,i=>{u.next(o.call(s,i,g++))}))})}var{isArray:bS}=Array;function wS(o,s){return bS(s)?o(...s):o(s)}function Yp(o){return wn(s=>wS(o,s))}var{isArray:ES}=Array,{getPrototypeOf:CS,prototype:TS,keys:DS}=Object;function Kp(o){if(o.length===1){let s=o[0];if(ES(s))return{args:s,keys:null};if(IS(s)){let h=DS(s);return{args:h.map(u=>s[u]),keys:h}}}return{args:o,keys:null}}function IS(o){return o&&typeof o=="object"&&CS(o)===TS}function Jp(o,s){return o.reduce((h,u,g)=>(h[u]=s[g],h),{})}function Qp(...o){let s=Bl(o),h=Np(o),{args:u,keys:g}=Kp(o);if(u.length===0)return Fr([],s);let i=new Yn(MS(u,s,g?w=>Jp(g,w):Po));return h?i.pipe(Yp(h)):i}function MS(o,s,h=Po){return u=>{Qw(s,()=>{let{length:g}=o,i=new Array(g),w=g,O=g;for(let B=0;B<g;B++)Qw(s,()=>{let j=Fr(o[B],s),ie=!1;j.subscribe(bn(u,_e=>{i[B]=_e,ie||(ie=!0,O--),O||u.next(h(i.slice()))},()=>{--w||u.complete()}))},u)},u)}}function Qw(o,s,h){o?so(h,o,s):s()}function e1(o,s,h,u,g,i,w,O){let B=[],j=0,ie=0,_e=!1,Be=()=>{_e&&!B.length&&!j&&s.complete()},Re=Mt=>j<u?tt(Mt):B.push(Mt),tt=Mt=>{i&&s.next(Mt),j++;let En=!1;$r(h(Mt,ie++)).subscribe(bn(s,Ct=>{g?.(Ct),i?Re(Ct):s.next(Ct)},()=>{En=!0},void 0,()=>{if(En)try{for(j--;B.length&&j<u;){let Ct=B.shift();w?so(s,w,()=>tt(Ct)):tt(Ct)}Be()}catch(Ct){s.error(Ct)}}))};return o.subscribe(bn(s,Re,()=>{_e=!0,Be()})),()=>{O?.()}}function Qr(o,s,h=1/0){return nn(s)?Qr((u,g)=>wn((i,w)=>s(u,i,g,w))($r(o(u,g))),h):(typeof s=="number"&&(h=s),An((u,g)=>e1(u,g,o,h)))}function ny(o=1/0){return Qr(Po,o)}function t1(){return ny(1)}function th(...o){return t1()(Fr(o,Bl(o)))}function em(o){return new Yn(s=>{$r(o()).subscribe(s)})}function ry(...o){let s=Np(o),{args:h,keys:u}=Kp(o),g=new Yn(i=>{let{length:w}=h;if(!w){i.complete();return}let O=new Array(w),B=w,j=w;for(let ie=0;ie<w;ie++){let _e=!1;$r(h[ie]).subscribe(bn(i,Be=>{_e||(_e=!0,j--),O[ie]=Be},()=>B--,void 0,()=>{(!B||!_e)&&(j||i.next(u?Jp(u,O):O),i.complete())}))}});return s?g.pipe(Yp(s)):g}function Bs(o,s){return An((h,u)=>{let g=0;h.subscribe(bn(u,i=>o.call(s,i,g++)&&u.next(i)))})}function Vl(o){return An((s,h)=>{let u=null,g=!1,i;u=s.subscribe(bn(h,void 0,void 0,w=>{i=$r(o(w,Vl(o)(s))),u?(u.unsubscribe(),u=null,i.subscribe(h)):g=!0})),g&&(u.unsubscribe(),u=null,i.subscribe(h))})}function n1(o,s,h,u,g){return(i,w)=>{let O=h,B=s,j=0;i.subscribe(bn(w,ie=>{let _e=j++;B=O?o(B,ie,_e):(O=!0,ie),u&&w.next(B)},g&&(()=>{O&&w.next(B),w.complete()})))}}function nh(o,s){return nn(s)?Qr(o,s,1):Qr(o,1)}function jl(o){return An((s,h)=>{let u=!1;s.subscribe(bn(h,g=>{u=!0,h.next(g)},()=>{u||h.next(o),h.complete()}))})}function nl(o){return o<=0?()=>Ro:An((s,h)=>{let u=0;s.subscribe(bn(h,g=>{++u<=o&&(h.next(g),o<=u&&h.complete())}))})}function iy(o){return wn(()=>o)}function tm(o=SS){return An((s,h)=>{let u=!1;s.subscribe(bn(h,g=>{u=!0,h.next(g)},()=>u?h.complete():h.error(o())))})}function SS(){return new tl}function Ud(o){return An((s,h)=>{try{s.subscribe(h)}finally{h.add(o)}})}function va(o,s){let h=arguments.length>=2;return u=>u.pipe(o?Bs((g,i)=>o(g,i,u)):Po,nl(1),h?jl(s):tm(()=>new tl))}function rh(o){return o<=0?()=>Ro:An((s,h)=>{let u=[];s.subscribe(bn(h,g=>{u.push(g),o<u.length&&u.shift()},()=>{for(let g of u)h.next(g);h.complete()},void 0,()=>{u=null}))})}function oy(o,s){let h=arguments.length>=2;return u=>u.pipe(o?Bs((g,i)=>o(g,i,u)):Po,rh(1),h?jl(s):tm(()=>new tl))}function sy(o,s){return An(n1(o,s,arguments.length>=2,!0))}function ay(...o){let s=Bl(o);return An((h,u)=>{(s?th(o,h,s):th(o,h)).subscribe(u)})}function Vs(o,s){return An((h,u)=>{let g=null,i=0,w=!1,O=()=>w&&!g&&u.complete();h.subscribe(bn(u,B=>{g?.unsubscribe();let j=0,ie=i++;$r(o(B,ie)).subscribe(g=bn(u,_e=>u.next(s?s(B,_e,ie,j++):_e),()=>{g=null,O()}))},()=>{w=!0,O()}))})}function ly(o){return An((s,h)=>{$r(o).subscribe(bn(h,()=>h.complete(),jd)),!h.closed&&s.subscribe(h)})}function yi(o,s,h){let u=nn(o)||s||h?{next:o,error:s,complete:h}:o;return u?An((g,i)=>{var w;(w=u.subscribe)===null||w===void 0||w.call(u);let O=!0;g.subscribe(bn(i,B=>{var j;(j=u.next)===null||j===void 0||j.call(u,B),i.next(B)},()=>{var B;O=!1,(B=u.complete)===null||B===void 0||B.call(u),i.complete()},B=>{var j;O=!1,(j=u.error)===null||j===void 0||j.call(u,B),i.error(B)},()=>{var B,j;O&&((B=u.unsubscribe)===null||B===void 0||B.call(u)),(j=u.finalize)===null||j===void 0||j.call(u)}))}):Po}var AS="https://g.co/ng/security#xss",Gt=class extends Error{constructor(s,h){super(sv(s,h)),this.code=s}};function sv(o,s){return`${`NG0${Math.abs(o)}`}${s?": "+s:""}`}function Dm(o){return{toString:o}.toString()}var $d=globalThis;function lr(o){for(let s in o)if(o[s]===lr)return s;throw Error("Could not find renamed property on target object.")}function PS(o,s){for(let h in s)s.hasOwnProperty(h)&&!o.hasOwnProperty(h)&&(o[h]=s[h])}function ao(o){if(typeof o=="string")return o;if(Array.isArray(o))return"["+o.map(ao).join(", ")+"]";if(o==null)return""+o;if(o.overriddenName)return`${o.overriddenName}`;if(o.name)return`${o.name}`;let s=o.toString();if(s==null)return""+s;let h=s.indexOf(`
`);return h===-1?s:s.substring(0,h)}function r1(o,s){return o==null||o===""?s===null?"":s:s==null||s===""?o:o+" "+s}var RS=lr({__forward_ref__:lr});function yh(o){return o.__forward_ref__=yh,o.toString=function(){return ao(this())},o}function Wi(o){return B1(o)?o():o}function B1(o){return typeof o=="function"&&o.hasOwnProperty(RS)&&o.__forward_ref__===yh}function sn(o){return{token:o.token,providedIn:o.providedIn||null,factory:o.factory,value:void 0}}function vh(o){return{providers:o.providers||[],imports:o.imports||[]}}function Im(o){return i1(o,j1)||i1(o,U1)}function V1(o){return Im(o)!==null}function i1(o,s){return o.hasOwnProperty(s)?o[s]:null}function OS(o){let s=o&&(o[j1]||o[U1]);return s||null}function o1(o){return o&&(o.hasOwnProperty(s1)||o.hasOwnProperty(kS))?o[s1]:null}var j1=lr({\u0275prov:lr}),s1=lr({\u0275inj:lr}),U1=lr({ngInjectableDef:lr}),kS=lr({ngInjectorDef:lr}),an=class{constructor(s,h){this._desc=s,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof h=="number"?this.__NG_ELEMENT_ID__=h:h!==void 0&&(this.\u0275prov=sn({token:this,providedIn:h.providedIn||"root",factory:h.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function $1(o){return o&&!!o.\u0275providers}var LS=lr({\u0275cmp:lr}),FS=lr({\u0275dir:lr}),NS=lr({\u0275pipe:lr}),zS=lr({\u0275mod:lr}),cm=lr({\u0275fac:lr}),Gd=lr({__NG_ELEMENT_ID__:lr}),a1=lr({__NG_ENV_ID__:lr});function BS(o){return typeof o=="string"?o:o==null?"":String(o)}function VS(o){return typeof o=="function"?o.name||o.toString():typeof o=="object"&&o!=null&&typeof o.type=="function"?o.type.name||o.type.toString():BS(o)}function jS(o,s){let h=s?`. Dependency path: ${s.join(" > ")} > ${o}`:"";throw new Gt(-200,o)}function av(o,s){throw new Gt(-201,!1)}var mn=function(o){return o[o.Default=0]="Default",o[o.Host=1]="Host",o[o.Self=2]="Self",o[o.SkipSelf=4]="SkipSelf",o[o.Optional=8]="Optional",o}(mn||{}),Cy;function G1(){return Cy}function ss(o){let s=Cy;return Cy=o,s}function H1(o,s,h){let u=Im(o);if(u&&u.providedIn=="root")return u.value===void 0?u.value=u.factory():u.value;if(h&mn.Optional)return null;if(s!==void 0)return s;av(o,"Injector")}var US={},Hd=US,$S="__NG_DI_FLAG__",um="ngTempTokenPath",GS="ngTokenPath",HS=/\n/gm,qS="\u0275",l1="__source",ah;function WS(){return ah}function Ul(o){let s=ah;return ah=o,s}function ZS(o,s=mn.Default){if(ah===void 0)throw new Gt(-203,!1);return ah===null?H1(o,void 0,s):ah.get(o,s&mn.Optional?null:void 0,s)}function Pn(o,s=mn.Default){return(G1()||ZS)(Wi(o),s)}function It(o,s=mn.Default){return Pn(o,Mm(s))}function Mm(o){return typeof o>"u"||typeof o=="number"?o:0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)}function Ty(o){let s=[];for(let h=0;h<o.length;h++){let u=Wi(o[h]);if(Array.isArray(u)){if(u.length===0)throw new Gt(900,!1);let g,i=mn.Default;for(let w=0;w<u.length;w++){let O=u[w],B=XS(O);typeof B=="number"?B===-1?g=O.token:i|=B:g=O}s.push(Pn(g,i))}else s.push(Pn(u))}return s}function XS(o){return o[$S]}function YS(o,s,h,u){let g=o[um];throw s[l1]&&g.unshift(s[l1]),o.message=KS(`
`+o.message,g,h,u),o[GS]=g,o[um]=null,o}function KS(o,s,h,u=null){o=o&&o.charAt(0)===`
`&&o.charAt(1)==qS?o.slice(2):o;let g=ao(s);if(Array.isArray(s))g=s.map(ao).join(" -> ");else if(typeof s=="object"){let i=[];for(let w in s)if(s.hasOwnProperty(w)){let O=s[w];i.push(w+":"+(typeof O=="string"?JSON.stringify(O):ao(O)))}g=`{${i.join(", ")}}`}return`${h}${u?"("+u+")":""}[${g}]: ${o.replace(HS,`
  `)}`}function ch(o,s){let h=o.hasOwnProperty(cm);return h?o[cm]:null}function lv(o,s){o.forEach(h=>Array.isArray(h)?lv(h,s):s(h))}function q1(o,s,h){s>=o.length?o.push(h):o.splice(s,0,h)}function hm(o,s){return s>=o.length-1?o.pop():o.splice(s,1)[0]}function JS(o,s,h,u){let g=o.length;if(g==s)o.push(h,u);else if(g===1)o.push(u,o[0]),o[0]=h;else{for(g--,o.push(o[g-1],o[g]);g>s;){let i=g-2;o[g]=o[i],g--}o[s]=h,o[s+1]=u}}function QS(o,s,h){let u=nf(o,s);return u>=0?o[u|1]=h:(u=~u,JS(o,u,s,h)),u}function cy(o,s){let h=nf(o,s);if(h>=0)return o[h|1]}function nf(o,s){return eA(o,s,1)}function eA(o,s,h){let u=0,g=o.length>>h;for(;g!==u;){let i=u+(g-u>>1),w=o[i<<h];if(s===w)return i<<h;w>s?g=i:u=i+1}return~(g<<h)}var uh={},as=[],hh=new an(""),W1=new an("",-1),Z1=new an(""),dm=class{get(s,h=Hd){if(h===Hd){let u=new Error(`NullInjectorError: No provider for ${ao(s)}!`);throw u.name="NullInjectorError",u}return h}},X1=function(o){return o[o.OnPush=0]="OnPush",o[o.Default=1]="Default",o}(X1||{}),wa=function(o){return o[o.Emulated=0]="Emulated",o[o.None=2]="None",o[o.ShadowDom=3]="ShadowDom",o}(wa||{}),Oo=function(o){return o[o.None=0]="None",o[o.SignalBased=1]="SignalBased",o[o.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",o}(Oo||{});function tA(o,s,h){let u=o.length;for(;;){let g=o.indexOf(s,h);if(g===-1)return g;if(g===0||o.charCodeAt(g-1)<=32){let i=s.length;if(g+i===u||o.charCodeAt(g+i)<=32)return g}h=g+1}}function Dy(o,s,h){let u=0;for(;u<h.length;){let g=h[u];if(typeof g=="number"){if(g!==0)break;u++;let i=h[u++],w=h[u++],O=h[u++];o.setAttribute(s,w,O,i)}else{let i=g,w=h[++u];rA(i)?o.setProperty(s,i,w):o.setAttribute(s,i,w),u++}}return u}function nA(o){return o===3||o===4||o===6}function rA(o){return o.charCodeAt(0)===64}function qd(o,s){if(!(s===null||s.length===0))if(o===null||o.length===0)o=s.slice();else{let h=-1;for(let u=0;u<s.length;u++){let g=s[u];typeof g=="number"?h=g:h===0||(h===-1||h===2?c1(o,h,g,null,s[++u]):c1(o,h,g,null,null))}}return o}function c1(o,s,h,u,g){let i=0,w=o.length;if(s===-1)w=-1;else for(;i<o.length;){let O=o[i++];if(typeof O=="number"){if(O===s){w=-1;break}else if(O>s){w=i-1;break}}}for(;i<o.length;){let O=o[i];if(typeof O=="number")break;if(O===h){if(u===null){g!==null&&(o[i+1]=g);return}else if(u===o[i+1]){o[i+2]=g;return}}i++,u!==null&&i++,g!==null&&i++}w!==-1&&(o.splice(w,0,s),i=w+1),o.splice(i++,0,h),u!==null&&o.splice(i++,0,u),g!==null&&o.splice(i++,0,g)}var Y1="ng-template";function iA(o,s,h,u){let g=0;if(u){for(;g<s.length&&typeof s[g]=="string";g+=2)if(s[g]==="class"&&tA(s[g+1].toLowerCase(),h,0)!==-1)return!0}else if(cv(o))return!1;if(g=s.indexOf(1,g),g>-1){let i;for(;++g<s.length&&typeof(i=s[g])=="string";)if(i.toLowerCase()===h)return!0}return!1}function cv(o){return o.type===4&&o.value!==Y1}function oA(o,s,h){let u=o.type===4&&!h?Y1:o.value;return s===u}function sA(o,s,h){let u=4,g=o.attrs,i=g!==null?cA(g):0,w=!1;for(let O=0;O<s.length;O++){let B=s[O];if(typeof B=="number"){if(!w&&!js(u)&&!js(B))return!1;if(w&&js(B))continue;w=!1,u=B|u&1;continue}if(!w)if(u&4){if(u=2|u&1,B!==""&&!oA(o,B,h)||B===""&&s.length===1){if(js(u))return!1;w=!0}}else if(u&8){if(g===null||!iA(o,g,B,h)){if(js(u))return!1;w=!0}}else{let j=s[++O],ie=aA(B,g,cv(o),h);if(ie===-1){if(js(u))return!1;w=!0;continue}if(j!==""){let _e;if(ie>i?_e="":_e=g[ie+1].toLowerCase(),u&2&&j!==_e){if(js(u))return!1;w=!0}}}}return js(u)||w}function js(o){return(o&1)===0}function aA(o,s,h,u){if(s===null)return-1;let g=0;if(u||!h){let i=!1;for(;g<s.length;){let w=s[g];if(w===o)return g;if(w===3||w===6)i=!0;else if(w===1||w===2){let O=s[++g];for(;typeof O=="string";)O=s[++g];continue}else{if(w===4)break;if(w===0){g+=4;continue}}g+=i?1:2}return-1}else return uA(s,o)}function lA(o,s,h=!1){for(let u=0;u<s.length;u++)if(sA(o,s[u],h))return!0;return!1}function cA(o){for(let s=0;s<o.length;s++){let h=o[s];if(nA(h))return s}return o.length}function uA(o,s){let h=o.indexOf(4);if(h>-1)for(h++;h<o.length;){let u=o[h];if(typeof u=="number")return-1;if(u===s)return h;h++}return-1}function u1(o,s){return o?":not("+s.trim()+")":s}function hA(o){let s=o[0],h=1,u=2,g="",i=!1;for(;h<o.length;){let w=o[h];if(typeof w=="string")if(u&2){let O=o[++h];g+="["+w+(O.length>0?'="'+O+'"':"")+"]"}else u&8?g+="."+w:u&4&&(g+=" "+w);else g!==""&&!js(w)&&(s+=u1(i,g),g=""),u=w,i=i||!js(u);h++}return g!==""&&(s+=u1(i,g)),s}function dA(o){return o.map(hA).join(",")}function fA(o){let s=[],h=[],u=1,g=2;for(;u<o.length;){let i=o[u];if(typeof i=="string")g===2?i!==""&&s.push(i,o[++u]):g===8&&h.push(i);else{if(!js(g))break;g=i}u++}return{attrs:s,classes:h}}function xh(o){return Dm(()=>{let s=tE(o),h=dr(Dt({},s),{decls:o.decls,vars:o.vars,template:o.template,consts:o.consts||null,ngContentSelectors:o.ngContentSelectors,onPush:o.changeDetection===X1.OnPush,directiveDefs:null,pipeDefs:null,dependencies:s.standalone&&o.dependencies||null,getStandaloneInjector:null,signals:o.signals??!1,data:o.data||{},encapsulation:o.encapsulation||wa.Emulated,styles:o.styles||as,_:null,schemas:o.schemas||null,tView:null,id:""});nE(h);let u=o.dependencies;return h.directiveDefs=d1(u,!1),h.pipeDefs=d1(u,!0),h.id=gA(h),h})}function pA(o){return Gc(o)||K1(o)}function mA(o){return o!==null}function bh(o){return Dm(()=>({type:o.type,bootstrap:o.bootstrap||as,declarations:o.declarations||as,imports:o.imports||as,exports:o.exports||as,transitiveCompileScopes:null,schemas:o.schemas||null,id:o.id||null}))}function h1(o,s){if(o==null)return uh;let h={};for(let u in o)if(o.hasOwnProperty(u)){let g=o[u],i,w,O=Oo.None;Array.isArray(g)?(O=g[0],i=g[1],w=g[2]??i):(i=g,w=g),s?(h[i]=O!==Oo.None?[u,O]:u,s[i]=w):h[i]=u}return h}function us(o){return Dm(()=>{let s=tE(o);return nE(s),s})}function Gc(o){return o[LS]||null}function K1(o){return o[FS]||null}function J1(o){return o[NS]||null}function Q1(o){let s=Gc(o)||K1(o)||J1(o);return s!==null?s.standalone:!1}function eE(o,s){let h=o[zS]||null;if(!h&&s===!0)throw new Error(`Type ${ao(o)} does not have '\u0275mod' property.`);return h}function tE(o){let s={};return{type:o.type,providersResolver:null,factory:null,hostBindings:o.hostBindings||null,hostVars:o.hostVars||0,hostAttrs:o.hostAttrs||null,contentQueries:o.contentQueries||null,declaredInputs:s,inputTransforms:null,inputConfig:o.inputs||uh,exportAs:o.exportAs||null,standalone:o.standalone===!0,signals:o.signals===!0,selectors:o.selectors||as,viewQuery:o.viewQuery||null,features:o.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:h1(o.inputs,s),outputs:h1(o.outputs),debugInfo:null}}function nE(o){o.features?.forEach(s=>s(o))}function d1(o,s){if(!o)return null;let h=s?J1:pA;return()=>(typeof o=="function"?o():o).map(u=>h(u)).filter(mA)}function gA(o){let s=0,h=[o.selectors,o.ngContentSelectors,o.hostVars,o.hostAttrs,o.consts,o.vars,o.decls,o.encapsulation,o.standalone,o.signals,o.exportAs,JSON.stringify(o.inputs),JSON.stringify(o.outputs),Object.getOwnPropertyNames(o.type.prototype),!!o.contentQueries,!!o.viewQuery].join("|");for(let g of h)s=Math.imul(31,s)+g.charCodeAt(0)<<0;return s+=2147483648,"c"+s}function Sm(o){return{\u0275providers:o}}function _A(...o){return{\u0275providers:rE(!0,o),\u0275fromNgModule:!0}}function rE(o,...s){let h=[],u=new Set,g,i=w=>{h.push(w)};return lv(s,w=>{let O=w;Iy(O,i,[],u)&&(g||=[],g.push(O))}),g!==void 0&&iE(g,i),h}function iE(o,s){for(let h=0;h<o.length;h++){let{ngModule:u,providers:g}=o[h];uv(g,i=>{s(i,u)})}}function Iy(o,s,h,u){if(o=Wi(o),!o)return!1;let g=null,i=o1(o),w=!i&&Gc(o);if(!i&&!w){let B=o.ngModule;if(i=o1(B),i)g=B;else return!1}else{if(w&&!w.standalone)return!1;g=o}let O=u.has(g);if(w){if(O)return!1;if(u.add(g),w.dependencies){let B=typeof w.dependencies=="function"?w.dependencies():w.dependencies;for(let j of B)Iy(j,s,h,u)}}else if(i){if(i.imports!=null&&!O){u.add(g);let j;try{lv(i.imports,ie=>{Iy(ie,s,h,u)&&(j||=[],j.push(ie))})}finally{}j!==void 0&&iE(j,s)}if(!O){let j=ch(g)||(()=>new g);s({provide:g,useFactory:j,deps:as},g),s({provide:Z1,useValue:g,multi:!0},g),s({provide:hh,useValue:()=>Pn(g),multi:!0},g)}let B=i.providers;if(B!=null&&!O){let j=o;uv(B,ie=>{s(ie,j)})}}else return!1;return g!==o&&o.providers!==void 0}function uv(o,s){for(let h of o)$1(h)&&(h=h.\u0275providers),Array.isArray(h)?uv(h,s):s(h)}var yA=lr({provide:String,useValue:lr});function oE(o){return o!==null&&typeof o=="object"&&yA in o}function vA(o){return!!(o&&o.useExisting)}function xA(o){return!!(o&&o.useFactory)}function dh(o){return typeof o=="function"}function bA(o){return!!o.useClass}var Am=new an(""),im={},wA={},uy;function hv(){return uy===void 0&&(uy=new dm),uy}var cs=class{},Wd=class extends cs{get destroyed(){return this._destroyed}constructor(s,h,u,g){super(),this.parent=h,this.source=u,this.scopes=g,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Sy(s,w=>this.processProvider(w)),this.records.set(W1,ih(void 0,this)),g.has("environment")&&this.records.set(cs,ih(void 0,this));let i=this.records.get(Am);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(Z1,as,mn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let s=tr(null);try{for(let u of this._ngOnDestroyHooks)u.ngOnDestroy();let h=this._onDestroyHooks;this._onDestroyHooks=[];for(let u of h)u()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),tr(s)}}onDestroy(s){return this.assertNotDestroyed(),this._onDestroyHooks.push(s),()=>this.removeOnDestroy(s)}runInContext(s){this.assertNotDestroyed();let h=Ul(this),u=ss(void 0),g;try{return s()}finally{Ul(h),ss(u)}}get(s,h=Hd,u=mn.Default){if(this.assertNotDestroyed(),s.hasOwnProperty(a1))return s[a1](this);u=Mm(u);let g,i=Ul(this),w=ss(void 0);try{if(!(u&mn.SkipSelf)){let B=this.records.get(s);if(B===void 0){let j=IA(s)&&Im(s);j&&this.injectableDefInScope(j)?B=ih(My(s),im):B=null,this.records.set(s,B)}if(B!=null)return this.hydrate(s,B)}let O=u&mn.Self?hv():this.parent;return h=u&mn.Optional&&h===Hd?null:h,O.get(s,h)}catch(O){if(O.name==="NullInjectorError"){if((O[um]=O[um]||[]).unshift(ao(s)),i)throw O;return YS(O,s,"R3InjectorError",this.source)}else throw O}finally{ss(w),Ul(i)}}resolveInjectorInitializers(){let s=tr(null),h=Ul(this),u=ss(void 0),g;try{let i=this.get(hh,as,mn.Self);for(let w of i)w()}finally{Ul(h),ss(u),tr(s)}}toString(){let s=[],h=this.records;for(let u of h.keys())s.push(ao(u));return`R3Injector[${s.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Gt(205,!1)}processProvider(s){s=Wi(s);let h=dh(s)?s:Wi(s&&s.provide),u=CA(s);if(!dh(s)&&s.multi===!0){let g=this.records.get(h);g||(g=ih(void 0,im,!0),g.factory=()=>Ty(g.multi),this.records.set(h,g)),h=s,g.multi.push(s)}this.records.set(h,u)}hydrate(s,h){let u=tr(null);try{return h.value===im&&(h.value=wA,h.value=h.factory()),typeof h.value=="object"&&h.value&&DA(h.value)&&this._ngOnDestroyHooks.add(h.value),h.value}finally{tr(u)}}injectableDefInScope(s){if(!s.providedIn)return!1;let h=Wi(s.providedIn);return typeof h=="string"?h==="any"||this.scopes.has(h):this.injectorDefTypes.has(h)}removeOnDestroy(s){let h=this._onDestroyHooks.indexOf(s);h!==-1&&this._onDestroyHooks.splice(h,1)}};function My(o){let s=Im(o),h=s!==null?s.factory:ch(o);if(h!==null)return h;if(o instanceof an)throw new Gt(204,!1);if(o instanceof Function)return EA(o);throw new Gt(204,!1)}function EA(o){if(o.length>0)throw new Gt(204,!1);let h=OS(o);return h!==null?()=>h.factory(o):()=>new o}function CA(o){if(oE(o))return ih(void 0,o.useValue);{let s=sE(o);return ih(s,im)}}function sE(o,s,h){let u;if(dh(o)){let g=Wi(o);return ch(g)||My(g)}else if(oE(o))u=()=>Wi(o.useValue);else if(xA(o))u=()=>o.useFactory(...Ty(o.deps||[]));else if(vA(o))u=()=>Pn(Wi(o.useExisting));else{let g=Wi(o&&(o.useClass||o.provide));if(TA(o))u=()=>new g(...Ty(o.deps));else return ch(g)||My(g)}return u}function ih(o,s,h=!1){return{factory:o,value:s,multi:h?[]:void 0}}function TA(o){return!!o.deps}function DA(o){return o!==null&&typeof o=="object"&&typeof o.ngOnDestroy=="function"}function IA(o){return typeof o=="function"||typeof o=="object"&&o instanceof an}function Sy(o,s){for(let h of o)Array.isArray(h)?Sy(h,s):h&&$1(h)?Sy(h.\u0275providers,s):s(h)}function Kc(o,s){o instanceof Wd&&o.assertNotDestroyed();let h,u=Ul(o),g=ss(void 0);try{return s()}finally{Ul(u),ss(g)}}function MA(){return G1()!==void 0||WS()!=null}function SA(o){return typeof o=="function"}var sl=0,Mn=1,en=2,Fi=3,Us=4,$s=5,fm=6,Zd=7,rl=8,fh=9,Ea=10,lo=11,Xd=12,f1=13,rf=14,Ca=15,dv=16,oh=17,Pm=18,Rm=19,aE=20,$l=21,hy=22,Hc=23,qc=25,lE=1;var Wc=7,pm=8,mm=9,ls=10,fv=function(o){return o[o.None=0]="None",o[o.HasTransplantedViews=2]="HasTransplantedViews",o}(fv||{});function Uc(o){return Array.isArray(o)&&typeof o[lE]=="object"}function al(o){return Array.isArray(o)&&o[lE]===!0}function cE(o){return(o.flags&4)!==0}function Om(o){return o.componentOffset>-1}function uE(o){return(o.flags&1)===1}function Gl(o){return!!o.template}function AA(o){return(o[en]&512)!==0}var Ay=class{constructor(s,h,u){this.previousValue=s,this.currentValue=h,this.firstChange=u}isFirstChange(){return this.firstChange}};function hE(o,s,h,u){s!==null?s.applyValueToInputSignal(s,u):o[h]=u}function Jc(){return dE}function dE(o){return o.type.prototype.ngOnChanges&&(o.setInput=RA),PA}Jc.ngInherit=!0;function PA(){let o=pE(this),s=o?.current;if(s){let h=o.previous;if(h===uh)o.previous=s;else for(let u in s)h[u]=s[u];o.current=null,this.ngOnChanges(s)}}function RA(o,s,h,u,g){let i=this.declaredInputs[u],w=pE(o)||OA(o,{previous:uh,current:null}),O=w.current||(w.current={}),B=w.previous,j=B[i];O[i]=new Ay(j&&j.currentValue,h,B===uh),hE(o,s,g,h)}var fE="__ngSimpleChanges__";function pE(o){return o[fE]||null}function OA(o,s){return o[fE]=s}var p1=null;var xa=function(o,s,h){p1?.(o,s,h)},kA="svg",LA="math",FA=!1;function NA(){return FA}function Ta(o){for(;Array.isArray(o);)o=o[sl];return o}function zA(o,s){return Ta(s[o])}function Gs(o,s){return Ta(s[o.index])}function mE(o,s){return o.data[s]}function ql(o,s){let h=s[o];return Uc(h)?h:h[sl]}function pv(o){return(o[en]&128)===128}function BA(o){return al(o[Fi])}function m1(o,s){return s==null?null:o[s]}function gE(o){o[oh]=0}function VA(o){o[en]&1024||(o[en]|=1024,pv(o)&&Yd(o))}function mv(o){return!!(o[en]&9216||o[Hc]?.dirty)}function Py(o){o[Ea].changeDetectionScheduler?.notify(1),mv(o)?Yd(o):o[en]&64&&(NA()?(o[en]|=1024,Yd(o)):o[Ea].changeDetectionScheduler?.notify())}function Yd(o){o[Ea].changeDetectionScheduler?.notify();let s=Kd(o);for(;s!==null&&!(s[en]&8192||(s[en]|=8192,!pv(s)));)s=Kd(s)}function _E(o,s){if((o[en]&256)===256)throw new Gt(911,!1);o[$l]===null&&(o[$l]=[]),o[$l].push(s)}function jA(o,s){if(o[$l]===null)return;let h=o[$l].indexOf(s);h!==-1&&o[$l].splice(h,1)}function Kd(o){let s=o[Fi];return al(s)?s[Fi]:s}var jn={lFrame:CE(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function UA(){return jn.lFrame.elementDepthCount}function $A(){jn.lFrame.elementDepthCount++}function GA(){jn.lFrame.elementDepthCount--}function yE(){return jn.bindingsEnabled}function HA(){return jn.skipHydrationRootTNode!==null}function qA(o){return jn.skipHydrationRootTNode===o}function WA(){jn.skipHydrationRootTNode=null}function vi(){return jn.lFrame.lView}function ll(){return jn.lFrame.tView}function Hs(){let o=vE();for(;o!==null&&o.type===64;)o=o.parent;return o}function vE(){return jn.lFrame.currentTNode}function ZA(){let o=jn.lFrame,s=o.currentTNode;return o.isParent?s:s.parent}function km(o,s){let h=jn.lFrame;h.currentTNode=o,h.isParent=s}function xE(){return jn.lFrame.isParent}function XA(){jn.lFrame.isParent=!1}function YA(o){return jn.lFrame.bindingIndex=o}function KA(){return jn.lFrame.bindingIndex++}function JA(o){let s=jn.lFrame,h=s.bindingIndex;return s.bindingIndex=s.bindingIndex+o,h}function QA(){return jn.lFrame.inI18n}function e2(o,s){let h=jn.lFrame;h.bindingIndex=h.bindingRootIndex=o,Ry(s)}function t2(){return jn.lFrame.currentDirectiveIndex}function Ry(o){jn.lFrame.currentDirectiveIndex=o}function n2(o){let s=jn.lFrame.currentDirectiveIndex;return s===-1?null:o[s]}function bE(o){jn.lFrame.currentQueryIndex=o}function r2(o){let s=o[Mn];return s.type===2?s.declTNode:s.type===1?o[$s]:null}function wE(o,s,h){if(h&mn.SkipSelf){let g=s,i=o;for(;g=g.parent,g===null&&!(h&mn.Host);)if(g=r2(i),g===null||(i=i[rf],g.type&10))break;if(g===null)return!1;s=g,o=i}let u=jn.lFrame=EE();return u.currentTNode=s,u.lView=o,!0}function gv(o){let s=EE(),h=o[Mn];jn.lFrame=s,s.currentTNode=h.firstChild,s.lView=o,s.tView=h,s.contextLView=o,s.bindingIndex=h.bindingStartIndex,s.inI18n=!1}function EE(){let o=jn.lFrame,s=o===null?null:o.child;return s===null?CE(o):s}function CE(o){let s={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:o,child:null,inI18n:!1};return o!==null&&(o.child=s),s}function TE(){let o=jn.lFrame;return jn.lFrame=o.parent,o.currentTNode=null,o.lView=null,o}var DE=TE;function _v(){let o=TE();o.isParent=!0,o.tView=null,o.selectedIndex=-1,o.contextLView=null,o.elementDepthCount=0,o.currentDirectiveIndex=-1,o.currentNamespace=null,o.bindingRootIndex=-1,o.bindingIndex=-1,o.currentQueryIndex=0}function of(){return jn.lFrame.selectedIndex}function Zc(o){jn.lFrame.selectedIndex=o}function i2(){let o=jn.lFrame;return mE(o.tView,o.selectedIndex)}function o2(){return jn.lFrame.currentNamespace}var IE=!0;function ME(){return IE}function SE(o){IE=o}function s2(o,s,h){let{ngOnChanges:u,ngOnInit:g,ngDoCheck:i}=s.type.prototype;if(u){let w=dE(s);(h.preOrderHooks??=[]).push(o,w),(h.preOrderCheckHooks??=[]).push(o,w)}g&&(h.preOrderHooks??=[]).push(0-o,g),i&&((h.preOrderHooks??=[]).push(o,i),(h.preOrderCheckHooks??=[]).push(o,i))}function AE(o,s){for(let h=s.directiveStart,u=s.directiveEnd;h<u;h++){let i=o.data[h].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:O,ngAfterViewInit:B,ngAfterViewChecked:j,ngOnDestroy:ie}=i;w&&(o.contentHooks??=[]).push(-h,w),O&&((o.contentHooks??=[]).push(h,O),(o.contentCheckHooks??=[]).push(h,O)),B&&(o.viewHooks??=[]).push(-h,B),j&&((o.viewHooks??=[]).push(h,j),(o.viewCheckHooks??=[]).push(h,j)),ie!=null&&(o.destroyHooks??=[]).push(h,ie)}}function om(o,s,h){PE(o,s,3,h)}function sm(o,s,h,u){(o[en]&3)===h&&PE(o,s,h,u)}function dy(o,s){let h=o[en];(h&3)===s&&(h&=16383,h+=1,o[en]=h)}function PE(o,s,h,u){let g=u!==void 0?o[oh]&65535:0,i=u??-1,w=s.length-1,O=0;for(let B=g;B<w;B++)if(typeof s[B+1]=="number"){if(O=s[B],u!=null&&O>=u)break}else s[B]<0&&(o[oh]+=65536),(O<i||i==-1)&&(a2(o,h,s,B),o[oh]=(o[oh]&4294901760)+B+2),B++}function g1(o,s){xa(4,o,s);let h=tr(null);try{s.call(o)}finally{tr(h),xa(5,o,s)}}function a2(o,s,h,u){let g=h[u]<0,i=h[u+1],w=g?-h[u]:h[u],O=o[w];g?o[en]>>14<o[oh]>>16&&(o[en]&3)===s&&(o[en]+=16384,g1(O,i)):g1(O,i)}var lh=-1,Xc=class{constructor(s,h,u){this.factory=s,this.resolving=!1,this.canSeeViewProviders=h,this.injectImpl=u}};function l2(o){return o instanceof Xc}function c2(o){return(o.flags&8)!==0}function u2(o){return(o.flags&16)!==0}function RE(o){return o!==lh}function gm(o){return o&32767}function h2(o){return o>>16}function _m(o,s){let h=h2(o),u=s;for(;h>0;)u=u[rf],h--;return u}var Oy=!0;function _1(o){let s=Oy;return Oy=o,s}var d2=256,OE=d2-1,kE=5,f2=0,ba={};function p2(o,s,h){let u;typeof h=="string"?u=h.charCodeAt(0)||0:h.hasOwnProperty(Gd)&&(u=h[Gd]),u==null&&(u=h[Gd]=f2++);let g=u&OE,i=1<<g;s.data[o+(g>>kE)]|=i}function ym(o,s){let h=LE(o,s);if(h!==-1)return h;let u=s[Mn];u.firstCreatePass&&(o.injectorIndex=s.length,fy(u.data,o),fy(s,null),fy(u.blueprint,null));let g=yv(o,s),i=o.injectorIndex;if(RE(g)){let w=gm(g),O=_m(g,s),B=O[Mn].data;for(let j=0;j<8;j++)s[i+j]=O[w+j]|B[w+j]}return s[i+8]=g,i}function fy(o,s){o.push(0,0,0,0,0,0,0,0,s)}function LE(o,s){return o.injectorIndex===-1||o.parent&&o.parent.injectorIndex===o.injectorIndex||s[o.injectorIndex+8]===null?-1:o.injectorIndex}function yv(o,s){if(o.parent&&o.parent.injectorIndex!==-1)return o.parent.injectorIndex;let h=0,u=null,g=s;for(;g!==null;){if(u=VE(g),u===null)return lh;if(h++,g=g[rf],u.injectorIndex!==-1)return u.injectorIndex|h<<16}return lh}function ky(o,s,h){p2(o,s,h)}function FE(o,s,h){if(h&mn.Optional||o!==void 0)return o;av(s,"NodeInjector")}function NE(o,s,h,u){if(h&mn.Optional&&u===void 0&&(u=null),!(h&(mn.Self|mn.Host))){let g=o[fh],i=ss(void 0);try{return g?g.get(s,u,h&mn.Optional):H1(s,u,h&mn.Optional)}finally{ss(i)}}return FE(u,s,h)}function zE(o,s,h,u=mn.Default,g){if(o!==null){if(s[en]&2048&&!(u&mn.Self)){let w=v2(o,s,h,u,ba);if(w!==ba)return w}let i=BE(o,s,h,u,ba);if(i!==ba)return i}return NE(s,h,u,g)}function BE(o,s,h,u,g){let i=_2(h);if(typeof i=="function"){if(!wE(s,o,u))return u&mn.Host?FE(g,h,u):NE(s,h,u,g);try{let w;if(w=i(u),w==null&&!(u&mn.Optional))av(h);else return w}finally{DE()}}else if(typeof i=="number"){let w=null,O=LE(o,s),B=lh,j=u&mn.Host?s[Ca][$s]:null;for((O===-1||u&mn.SkipSelf)&&(B=O===-1?yv(o,s):s[O+8],B===lh||!v1(u,!1)?O=-1:(w=s[Mn],O=gm(B),s=_m(B,s)));O!==-1;){let ie=s[Mn];if(y1(i,O,ie.data)){let _e=m2(O,s,h,w,u,j);if(_e!==ba)return _e}B=s[O+8],B!==lh&&v1(u,s[Mn].data[O+8]===j)&&y1(i,O,s)?(w=ie,O=gm(B),s=_m(B,s)):O=-1}}return g}function m2(o,s,h,u,g,i){let w=s[Mn],O=w.data[o+8],B=u==null?Om(O)&&Oy:u!=w&&(O.type&3)!==0,j=g&mn.Host&&i===O,ie=g2(O,w,h,B,j);return ie!==null?ph(s,w,ie,O):ba}function g2(o,s,h,u,g){let i=o.providerIndexes,w=s.data,O=i&1048575,B=o.directiveStart,j=o.directiveEnd,ie=i>>20,_e=u?O:O+ie,Be=g?O+ie:j;for(let Re=_e;Re<Be;Re++){let tt=w[Re];if(Re<B&&h===tt||Re>=B&&tt.type===h)return Re}if(g){let Re=w[B];if(Re&&Gl(Re)&&Re.type===h)return B}return null}function ph(o,s,h,u){let g=o[h],i=s.data;if(l2(g)){let w=g;w.resolving&&jS(VS(i[h]));let O=_1(w.canSeeViewProviders);w.resolving=!0;let B,j=w.injectImpl?ss(w.injectImpl):null,ie=wE(o,u,mn.Default);try{g=o[h]=w.factory(void 0,i,o,u),s.firstCreatePass&&h>=u.directiveStart&&s2(h,i[h],s)}finally{j!==null&&ss(j),_1(O),w.resolving=!1,DE()}}return g}function _2(o){if(typeof o=="string")return o.charCodeAt(0)||0;let s=o.hasOwnProperty(Gd)?o[Gd]:void 0;return typeof s=="number"?s>=0?s&OE:y2:s}function y1(o,s,h){let u=1<<o;return!!(h[s+(o>>kE)]&u)}function v1(o,s){return!(o&mn.Self)&&!(o&mn.Host&&s)}var $c=class{constructor(s,h){this._tNode=s,this._lView=h}get(s,h,u){return zE(this._tNode,this._lView,s,Mm(u),h)}};function y2(){return new $c(Hs(),vi())}function sf(o){return Dm(()=>{let s=o.prototype.constructor,h=s[cm]||Ly(s),u=Object.prototype,g=Object.getPrototypeOf(o.prototype).constructor;for(;g&&g!==u;){let i=g[cm]||Ly(g);if(i&&i!==h)return i;g=Object.getPrototypeOf(g)}return i=>new i})}function Ly(o){return B1(o)?()=>{let s=Ly(Wi(o));return s&&s()}:ch(o)}function v2(o,s,h,u,g){let i=o,w=s;for(;i!==null&&w!==null&&w[en]&2048&&!(w[en]&512);){let O=BE(i,w,h,u|mn.Self,ba);if(O!==ba)return O;let B=i.parent;if(!B){let j=w[aE];if(j){let ie=j.get(h,ba,u);if(ie!==ba)return ie}B=VE(w),w=w[rf]}i=B}return g}function VE(o){let s=o[Mn],h=s.type;return h===2?s.declTNode:h===1?o[$s]:null}function x1(o,s=null,h=null,u){let g=jE(o,s,h,u);return g.resolveInjectorInitializers(),g}function jE(o,s=null,h=null,u,g=new Set){let i=[h||as,_A(o)];return u=u||(typeof o=="object"?void 0:ao(o)),new Wd(i,s||hv(),u||null,g)}var wh=(()=>{let s=class s{static create(u,g){if(Array.isArray(u))return x1({name:""},g,u,"");{let i=u.name??"";return x1({name:i},u.parent,u.providers,i)}}};s.THROW_IF_NOT_FOUND=Hd,s.NULL=new dm,s.\u0275prov=sn({token:s,providedIn:"any",factory:()=>Pn(W1)}),s.__NG_ELEMENT_ID__=-1;let o=s;return o})();var x2="ngOriginalError";function py(o){return o[x2]}var il=class{constructor(){this._console=console}handleError(s){let h=this._findOriginalError(s);this._console.error("ERROR",s),h&&this._console.error("ORIGINAL ERROR",h)}_findOriginalError(s){let h=s&&py(s);for(;h&&py(h);)h=py(h);return h||null}},UE=new an("",{providedIn:"root",factory:()=>It(il).handleError.bind(void 0)}),$E=(()=>{let s=class s{};s.__NG_ELEMENT_ID__=b2,s.__NG_ENV_ID__=u=>u;let o=s;return o})(),Fy=class extends $E{constructor(s){super(),this._lView=s}onDestroy(s){return _E(this._lView,s),()=>jA(this._lView,s)}};function b2(){return new Fy(vi())}function w2(){return vv(Hs(),vi())}function vv(o,s){return new Qc(Gs(o,s))}var Qc=(()=>{let s=class s{constructor(u){this.nativeElement=u}};s.__NG_ELEMENT_ID__=w2;let o=s;return o})();var Ny=class extends qi{constructor(s=!1){super(),this.destroyRef=void 0,this.__isAsync=s,MA()&&(this.destroyRef=It($E,{optional:!0})??void 0)}emit(s){let h=tr(null);try{super.next(s)}finally{tr(h)}}subscribe(s,h,u){let g=s,i=h||(()=>null),w=u;if(s&&typeof s=="object"){let B=s;g=B.next?.bind(B),i=B.error?.bind(B),w=B.complete?.bind(B)}this.__isAsync&&(i=my(i),g&&(g=my(g)),w&&(w=my(w)));let O=super.subscribe({next:g,error:i,complete:w});return s instanceof Jr&&s.add(O),O}};function my(o){return s=>{setTimeout(o,void 0,s)}}var Li=Ny;function GE(o){return(o.flags&128)===128}var HE=new Map,E2=0;function C2(){return E2++}function T2(o){HE.set(o[Rm],o)}function D2(o){HE.delete(o[Rm])}var b1="__ngContext__";function mh(o,s){Uc(s)?(o[b1]=s[Rm],T2(s)):o[b1]=s}function qE(o){return ZE(o[Xd])}function WE(o){return ZE(o[Us])}function ZE(o){for(;o!==null&&!al(o);)o=o[Us];return o}var zy;function XE(o){zy=o}function I2(){if(zy!==void 0)return zy;if(typeof document<"u")return document;throw new Gt(210,!1)}var xv=new an("",{providedIn:"root",factory:()=>M2}),M2="ng",bv=new an(""),Eh=new an("",{providedIn:"platform",factory:()=>"unknown"});var wv=new an("",{providedIn:"root",factory:()=>I2().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var S2="h",A2="b";var P2=()=>null;function Ev(o,s,h=!1){return P2(o,s,h)}var YE=!1,R2=new an("",{providedIn:"root",factory:()=>YE});var By=class{constructor(s){this.changingThisBreaksApplicationSecurity=s}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${AS})`}};function Cv(o){return o instanceof By?o.changingThisBreaksApplicationSecurity:o}function KE(o){return o instanceof Function?o():o}var ol=function(o){return o[o.Important=1]="Important",o[o.DashCase=2]="DashCase",o}(ol||{}),O2;function Tv(o,s){return O2(o,s)}function sh(o,s,h,u,g){if(u!=null){let i,w=!1;al(u)?i=u:Uc(u)&&(w=!0,u=u[sl]);let O=Ta(u);o===0&&h!==null?g==null?nC(s,h,O):vm(s,h,O,g||null,!0):o===1&&h!==null?vm(s,h,O,g||null,!0):o===2?X2(s,O,w):o===3&&s.destroyNode(O),i!=null&&K2(s,o,i,h,g)}}function k2(o,s){return o.createText(s)}function JE(o,s,h){return o.createElement(s,h)}function L2(o,s){QE(o,s),s[sl]=null,s[$s]=null}function F2(o,s,h,u,g,i){u[sl]=g,u[$s]=s,Lm(o,u,h,1,g,i)}function QE(o,s){s[Ea].changeDetectionScheduler?.notify(1),Lm(o,s,s[lo],2,null,null)}function N2(o){let s=o[Xd];if(!s)return gy(o[Mn],o);for(;s;){let h=null;if(Uc(s))h=s[Xd];else{let u=s[ls];u&&(h=u)}if(!h){for(;s&&!s[Us]&&s!==o;)Uc(s)&&gy(s[Mn],s),s=s[Fi];s===null&&(s=o),Uc(s)&&gy(s[Mn],s),h=s&&s[Us]}s=h}}function z2(o,s,h,u){let g=ls+u,i=h.length;u>0&&(h[g-1][Us]=s),u<i-ls?(s[Us]=h[g],q1(h,ls+u,s)):(h.push(s),s[Us]=null),s[Fi]=h;let w=s[dv];w!==null&&h!==w&&B2(w,s);let O=s[Pm];O!==null&&O.insertView(o),Py(s),s[en]|=128}function B2(o,s){let h=o[mm],g=s[Fi][Fi][Ca];s[Ca]!==g&&(o[en]|=fv.HasTransplantedViews),h===null?o[mm]=[s]:h.push(s)}function eC(o,s){let h=o[mm],u=h.indexOf(s);h.splice(u,1)}function Vy(o,s){if(o.length<=ls)return;let h=ls+s,u=o[h];if(u){let g=u[dv];g!==null&&g!==o&&eC(g,u),s>0&&(o[h-1][Us]=u[Us]);let i=hm(o,ls+s);L2(u[Mn],u);let w=i[Pm];w!==null&&w.detachView(i[Mn]),u[Fi]=null,u[Us]=null,u[en]&=-129}return u}function tC(o,s){if(!(s[en]&256)){let h=s[lo];h.destroyNode&&Lm(o,s,h,3,null,null),N2(s)}}function gy(o,s){if(s[en]&256)return;let h=tr(null);try{s[en]&=-129,s[en]|=256,s[Hc]&&Pw(s[Hc]),j2(o,s),V2(o,s),s[Mn].type===1&&s[lo].destroy();let u=s[dv];if(u!==null&&al(s[Fi])){u!==s[Fi]&&eC(u,s);let g=s[Pm];g!==null&&g.detachView(o)}D2(s)}finally{tr(h)}}function V2(o,s){let h=o.cleanup,u=s[Zd];if(h!==null)for(let i=0;i<h.length-1;i+=2)if(typeof h[i]=="string"){let w=h[i+3];w>=0?u[w]():u[-w].unsubscribe(),i+=2}else{let w=u[h[i+1]];h[i].call(w)}u!==null&&(s[Zd]=null);let g=s[$l];if(g!==null){s[$l]=null;for(let i=0;i<g.length;i++){let w=g[i];w()}}}function j2(o,s){let h;if(o!=null&&(h=o.destroyHooks)!=null)for(let u=0;u<h.length;u+=2){let g=s[h[u]];if(!(g instanceof Xc)){let i=h[u+1];if(Array.isArray(i))for(let w=0;w<i.length;w+=2){let O=g[i[w]],B=i[w+1];xa(4,O,B);try{B.call(O)}finally{xa(5,O,B)}}else{xa(4,g,i);try{i.call(g)}finally{xa(5,g,i)}}}}}function U2(o,s,h){return $2(o,s.parent,h)}function $2(o,s,h){let u=s;for(;u!==null&&u.type&40;)s=u,u=s.parent;if(u===null)return h[sl];{let{componentOffset:g}=u;if(g>-1){let{encapsulation:i}=o.data[u.directiveStart+g];if(i===wa.None||i===wa.Emulated)return null}return Gs(u,h)}}function vm(o,s,h,u,g){o.insertBefore(s,h,u,g)}function nC(o,s,h){o.appendChild(s,h)}function w1(o,s,h,u,g){u!==null?vm(o,s,h,u,g):nC(o,s,h)}function G2(o,s,h,u){o.removeChild(s,h,u)}function Dv(o,s){return o.parentNode(s)}function H2(o,s){return o.nextSibling(s)}function q2(o,s,h){return Z2(o,s,h)}function W2(o,s,h){return o.type&40?Gs(o,h):null}var Z2=W2,E1;function rC(o,s,h,u){let g=U2(o,u,s),i=s[lo],w=u.parent||s[$s],O=q2(w,u,s);if(g!=null)if(Array.isArray(h))for(let B=0;B<h.length;B++)w1(i,g,h[B],O,!1);else w1(i,g,h,O,!1);E1!==void 0&&E1(i,u,s,h,g)}function am(o,s){if(s!==null){let h=s.type;if(h&3)return Gs(s,o);if(h&4)return jy(-1,o[s.index]);if(h&8){let u=s.child;if(u!==null)return am(o,u);{let g=o[s.index];return al(g)?jy(-1,g):Ta(g)}}else{if(h&32)return Tv(s,o)()||Ta(o[s.index]);{let u=iC(o,s);if(u!==null){if(Array.isArray(u))return u[0];let g=Kd(o[Ca]);return am(g,u)}else return am(o,s.next)}}}return null}function iC(o,s){if(s!==null){let u=o[Ca][$s],g=s.projection;return u.projection[g]}return null}function jy(o,s){let h=ls+o+1;if(h<s.length){let u=s[h],g=u[Mn].firstChild;if(g!==null)return am(u,g)}return s[Wc]}function X2(o,s,h){let u=Dv(o,s);u&&G2(o,u,s,h)}function Iv(o,s,h,u,g,i,w){for(;h!=null;){let O=u[h.index],B=h.type;if(w&&s===0&&(O&&mh(Ta(O),u),h.flags|=2),(h.flags&32)!==32)if(B&8)Iv(o,s,h.child,u,g,i,!1),sh(s,o,g,O,i);else if(B&32){let j=Tv(h,u),ie;for(;ie=j();)sh(s,o,g,ie,i);sh(s,o,g,O,i)}else B&16?Y2(o,s,u,h,g,i):sh(s,o,g,O,i);h=w?h.projectionNext:h.next}}function Lm(o,s,h,u,g,i){Iv(h,u,o.firstChild,s,g,i,!1)}function Y2(o,s,h,u,g,i){let w=h[Ca],B=w[$s].projection[u.projection];if(Array.isArray(B))for(let j=0;j<B.length;j++){let ie=B[j];sh(s,o,g,ie,i)}else{let j=B,ie=w[Fi];GE(u)&&(j.flags|=128),Iv(o,s,j,ie,g,i,!0)}}function K2(o,s,h,u,g){let i=h[Wc],w=Ta(h);i!==w&&sh(s,o,u,i,g);for(let O=ls;O<h.length;O++){let B=h[O];Lm(B[Mn],B,o,s,u,i)}}function J2(o,s,h,u,g){if(s)g?o.addClass(h,u):o.removeClass(h,u);else{let i=u.indexOf("-")===-1?void 0:ol.DashCase;g==null?o.removeStyle(h,u,i):(typeof g=="string"&&g.endsWith("!important")&&(g=g.slice(0,-10),i|=ol.Important),o.setStyle(h,u,g,i))}}function Q2(o,s,h){o.setAttribute(s,"style",h)}function oC(o,s,h){h===""?o.removeAttribute(s,"class"):o.setAttribute(s,"class",h)}function sC(o,s,h){let{mergedAttrs:u,classes:g,styles:i}=h;u!==null&&Dy(o,s,u),g!==null&&oC(o,s,g),i!==null&&Q2(o,s,i)}var Fm={};function aC(o=1){lC(ll(),vi(),of()+o,!1)}function lC(o,s,h,u){if(!u)if((s[en]&3)===3){let i=o.preOrderCheckHooks;i!==null&&om(s,i,h)}else{let i=o.preOrderHooks;i!==null&&sm(s,i,0,h)}Zc(h)}function Nr(o,s=mn.Default){let h=vi();if(h===null)return Pn(o,s);let u=Hs();return zE(u,h,Wi(o),s)}function cC(o,s,h,u,g,i){let w=tr(null);try{let O=null;g&Oo.SignalBased&&(O=s[u][Iw]),O!==null&&O.transformFn!==void 0&&(i=O.transformFn(i)),g&Oo.HasDecoratorInputTransform&&(i=o.inputTransforms[u].call(s,i)),o.setInput!==null?o.setInput(s,O,i,h,u):hE(s,O,u,i)}finally{tr(w)}}function eP(o,s){let h=o.hostBindingOpCodes;if(h!==null)try{for(let u=0;u<h.length;u++){let g=h[u];if(g<0)Zc(~g);else{let i=g,w=h[++u],O=h[++u];e2(w,i);let B=s[i];O(2,B)}}}finally{Zc(-1)}}function Mv(o,s,h,u,g,i,w,O,B,j,ie){let _e=s.blueprint.slice();return _e[sl]=g,_e[en]=u|4|128|8|64,(j!==null||o&&o[en]&2048)&&(_e[en]|=2048),gE(_e),_e[Fi]=_e[rf]=o,_e[rl]=h,_e[Ea]=w||o&&o[Ea],_e[lo]=O||o&&o[lo],_e[fh]=B||o&&o[fh]||null,_e[$s]=i,_e[Rm]=C2(),_e[fm]=ie,_e[aE]=j,_e[Ca]=s.type==2?o[Ca]:_e,_e}function Sv(o,s,h,u,g){let i=o.data[s];if(i===null)i=tP(o,s,h,u,g),QA()&&(i.flags|=32);else if(i.type&64){i.type=h,i.value=u,i.attrs=g;let w=ZA();i.injectorIndex=w===null?-1:w.injectorIndex}return km(i,!0),i}function tP(o,s,h,u,g){let i=vE(),w=xE(),O=w?i:i&&i.parent,B=o.data[s]=lP(o,O,h,s,u,g);return o.firstChild===null&&(o.firstChild=B),i!==null&&(w?i.child==null&&B.parent!==null&&(i.child=B):i.next===null&&(i.next=B,B.prev=i)),B}function uC(o,s,h,u){if(h===0)return-1;let g=s.length;for(let i=0;i<h;i++)s.push(u),o.blueprint.push(u),o.data.push(null);return g}function hC(o,s,h,u,g){let i=of(),w=u&2;try{Zc(-1),w&&s.length>qc&&lC(o,s,qc,!1),xa(w?2:0,g),h(u,g)}finally{Zc(i),xa(w?3:1,g)}}function dC(o,s,h){if(cE(s)){let u=tr(null);try{let g=s.directiveStart,i=s.directiveEnd;for(let w=g;w<i;w++){let O=o.data[w];if(O.contentQueries){let B=h[w];O.contentQueries(1,B,w)}}}finally{tr(u)}}}function nP(o,s,h){yE()&&(gP(o,s,h,Gs(h,s)),(h.flags&64)===64&&gC(o,s,h))}function rP(o,s,h=Gs){let u=s.localNames;if(u!==null){let g=s.index+1;for(let i=0;i<u.length;i+=2){let w=u[i+1],O=w===-1?h(s,o):o[w];o[g++]=O}}}function fC(o){let s=o.tView;return s===null||s.incompleteFirstPass?o.tView=pC(1,null,o.template,o.decls,o.vars,o.directiveDefs,o.pipeDefs,o.viewQuery,o.schemas,o.consts,o.id):s}function pC(o,s,h,u,g,i,w,O,B,j,ie){let _e=qc+u,Be=_e+g,Re=iP(_e,Be),tt=typeof j=="function"?j():j;return Re[Mn]={type:o,blueprint:Re,template:h,queries:null,viewQuery:O,declTNode:s,data:Re.slice().fill(null,_e),bindingStartIndex:_e,expandoStartIndex:Be,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof w=="function"?w():w,firstChild:null,schemas:B,consts:tt,incompleteFirstPass:!1,ssrId:ie}}function iP(o,s){let h=[];for(let u=0;u<s;u++)h.push(u<o?null:Fm);return h}function oP(o,s,h,u){let i=u.get(R2,YE)||h===wa.ShadowDom,w=o.selectRootElement(s,i);return sP(w),w}function sP(o){aP(o)}var aP=()=>null;function lP(o,s,h,u,g,i){let w=s?s.injectorIndex:-1,O=0;return HA()&&(O|=128),{type:h,index:u,insertBeforeIndex:null,injectorIndex:w,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:O,providerIndexes:0,value:g,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:s,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function C1(o,s,h,u,g){for(let i in s){if(!s.hasOwnProperty(i))continue;let w=s[i];if(w===void 0)continue;u??={};let O,B=Oo.None;Array.isArray(w)?(O=w[0],B=w[1]):O=w;let j=i;if(g!==null){if(!g.hasOwnProperty(i))continue;j=g[i]}o===0?T1(u,h,j,O,B):T1(u,h,j,O)}return u}function T1(o,s,h,u,g){let i;o.hasOwnProperty(h)?(i=o[h]).push(s,u):i=o[h]=[s,u],g!==void 0&&i.push(g)}function cP(o,s,h){let u=s.directiveStart,g=s.directiveEnd,i=o.data,w=s.attrs,O=[],B=null,j=null;for(let ie=u;ie<g;ie++){let _e=i[ie],Be=h?h.get(_e):null,Re=Be?Be.inputs:null,tt=Be?Be.outputs:null;B=C1(0,_e.inputs,ie,B,Re),j=C1(1,_e.outputs,ie,j,tt);let Mt=B!==null&&w!==null&&!cv(s)?TP(B,ie,w):null;O.push(Mt)}B!==null&&(B.hasOwnProperty("class")&&(s.flags|=8),B.hasOwnProperty("style")&&(s.flags|=16)),s.initialInputs=O,s.inputs=B,s.outputs=j}function uP(o){return o==="class"?"className":o==="for"?"htmlFor":o==="formaction"?"formAction":o==="innerHtml"?"innerHTML":o==="readonly"?"readOnly":o==="tabindex"?"tabIndex":o}function hP(o,s,h,u,g,i,w,O){let B=Gs(s,h),j=s.inputs,ie;!O&&j!=null&&(ie=j[u])?(Pv(o,h,ie,u,g),Om(s)&&dP(h,s.index)):s.type&3?(u=uP(u),g=w!=null?w(g,s.value||"",u):g,i.setProperty(B,u,g)):s.type&12}function dP(o,s){let h=ql(s,o);h[en]&16||(h[en]|=64)}function fP(o,s,h,u){if(yE()){let g=u===null?null:{"":-1},i=yP(o,h),w,O;i===null?w=O=null:[w,O]=i,w!==null&&mC(o,s,h,w,g,O),g&&vP(h,u,g)}h.mergedAttrs=qd(h.mergedAttrs,h.attrs)}function mC(o,s,h,u,g,i){for(let j=0;j<u.length;j++)ky(ym(h,s),o,u[j].type);bP(h,o.data.length,u.length);for(let j=0;j<u.length;j++){let ie=u[j];ie.providersResolver&&ie.providersResolver(ie)}let w=!1,O=!1,B=uC(o,s,u.length,null);for(let j=0;j<u.length;j++){let ie=u[j];h.mergedAttrs=qd(h.mergedAttrs,ie.hostAttrs),wP(o,h,s,B,ie),xP(B,ie,g),ie.contentQueries!==null&&(h.flags|=4),(ie.hostBindings!==null||ie.hostAttrs!==null||ie.hostVars!==0)&&(h.flags|=64);let _e=ie.type.prototype;!w&&(_e.ngOnChanges||_e.ngOnInit||_e.ngDoCheck)&&((o.preOrderHooks??=[]).push(h.index),w=!0),!O&&(_e.ngOnChanges||_e.ngDoCheck)&&((o.preOrderCheckHooks??=[]).push(h.index),O=!0),B++}cP(o,h,i)}function pP(o,s,h,u,g){let i=g.hostBindings;if(i){let w=o.hostBindingOpCodes;w===null&&(w=o.hostBindingOpCodes=[]);let O=~s.index;mP(w)!=O&&w.push(O),w.push(h,u,i)}}function mP(o){let s=o.length;for(;s>0;){let h=o[--s];if(typeof h=="number"&&h<0)return h}return 0}function gP(o,s,h,u){let g=h.directiveStart,i=h.directiveEnd;Om(h)&&EP(s,h,o.data[g+h.componentOffset]),o.firstCreatePass||ym(h,s),mh(u,s);let w=h.initialInputs;for(let O=g;O<i;O++){let B=o.data[O],j=ph(s,o,O,h);if(mh(j,s),w!==null&&CP(s,O-g,j,B,h,w),Gl(B)){let ie=ql(h.index,s);ie[rl]=ph(s,o,O,h)}}}function gC(o,s,h){let u=h.directiveStart,g=h.directiveEnd,i=h.index,w=t2();try{Zc(i);for(let O=u;O<g;O++){let B=o.data[O],j=s[O];Ry(O),(B.hostBindings!==null||B.hostVars!==0||B.hostAttrs!==null)&&_P(B,j)}}finally{Zc(-1),Ry(w)}}function _P(o,s){o.hostBindings!==null&&o.hostBindings(1,s)}function yP(o,s){let h=o.directiveRegistry,u=null,g=null;if(h)for(let i=0;i<h.length;i++){let w=h[i];if(lA(s,w.selectors,!1))if(u||(u=[]),Gl(w))if(w.findHostDirectiveDefs!==null){let O=[];g=g||new Map,w.findHostDirectiveDefs(w,O,g),u.unshift(...O,w);let B=O.length;Uy(o,s,B)}else u.unshift(w),Uy(o,s,0);else g=g||new Map,w.findHostDirectiveDefs?.(w,u,g),u.push(w)}return u===null?null:[u,g]}function Uy(o,s,h){s.componentOffset=h,(o.components??=[]).push(s.index)}function vP(o,s,h){if(s){let u=o.localNames=[];for(let g=0;g<s.length;g+=2){let i=h[s[g+1]];if(i==null)throw new Gt(-301,!1);u.push(s[g],i)}}}function xP(o,s,h){if(h){if(s.exportAs)for(let u=0;u<s.exportAs.length;u++)h[s.exportAs[u]]=o;Gl(s)&&(h[""]=o)}}function bP(o,s,h){o.flags|=1,o.directiveStart=s,o.directiveEnd=s+h,o.providerIndexes=s}function wP(o,s,h,u,g){o.data[u]=g;let i=g.factory||(g.factory=ch(g.type,!0)),w=new Xc(i,Gl(g),Nr);o.blueprint[u]=w,h[u]=w,pP(o,s,u,uC(o,h,g.hostVars,Fm),g)}function EP(o,s,h){let u=Gs(s,o),g=fC(h),i=o[Ea].rendererFactory,w=16;h.signals?w=4096:h.onPush&&(w=64);let O=Av(o,Mv(o,g,null,w,u,s,null,i.createRenderer(u,h),null,null,null));o[s.index]=O}function CP(o,s,h,u,g,i){let w=i[s];if(w!==null)for(let O=0;O<w.length;){let B=w[O++],j=w[O++],ie=w[O++],_e=w[O++];cC(u,h,B,j,ie,_e)}}function TP(o,s,h){let u=null,g=0;for(;g<h.length;){let i=h[g];if(i===0){g+=4;continue}else if(i===5){g+=2;continue}if(typeof i=="number")break;if(o.hasOwnProperty(i)){u===null&&(u=[]);let w=o[i];for(let O=0;O<w.length;O+=3)if(w[O]===s){u.push(i,w[O+1],w[O+2],h[g+1]);break}}g+=2}return u}function DP(o,s,h,u){return[o,!0,0,s,null,u,null,h,null,null]}function _C(o,s){let h=o.contentQueries;if(h!==null){let u=tr(null);try{for(let g=0;g<h.length;g+=2){let i=h[g],w=h[g+1];if(w!==-1){let O=o.data[w];bE(i),O.contentQueries(2,s[w],w)}}}finally{tr(u)}}}function Av(o,s){return o[Xd]?o[f1][Us]=s:o[Xd]=s,o[f1]=s,s}function $y(o,s,h){bE(0);let u=tr(null);try{s(o,h)}finally{tr(u)}}function IP(o){return o[Zd]||(o[Zd]=[])}function MP(o){return o.cleanup||(o.cleanup=[])}function yC(o,s){let h=o[fh],u=h?h.get(il,null):null;u&&u.handleError(s)}function Pv(o,s,h,u,g){for(let i=0;i<h.length;){let w=h[i++],O=h[i++],B=h[i++],j=s[w],ie=o.data[w];cC(ie,j,u,O,B,g)}}function SP(o,s){let h=ql(s,o),u=h[Mn];AP(u,h);let g=h[sl];g!==null&&h[fm]===null&&(h[fm]=Ev(g,h[fh])),vC(u,h,h[rl])}function AP(o,s){for(let h=s.length;h<o.blueprint.length;h++)s.push(o.blueprint[h])}function vC(o,s,h){gv(s);try{let u=o.viewQuery;u!==null&&$y(1,u,h);let g=o.template;g!==null&&hC(o,s,g,1,h),o.firstCreatePass&&(o.firstCreatePass=!1),s[Pm]?.finishViewCreation(o),o.staticContentQueries&&_C(o,s),o.staticViewQueries&&$y(2,o.viewQuery,h);let i=o.components;i!==null&&PP(s,i)}catch(u){throw o.firstCreatePass&&(o.incompleteFirstPass=!0,o.firstCreatePass=!1),u}finally{s[en]&=-5,_v()}}function PP(o,s){for(let h=0;h<s.length;h++)SP(o,s[h])}function D1(o,s){return!s||s.firstChild===null||GE(o)}function RP(o,s,h,u=!0){let g=s[Mn];if(z2(g,s,o,h),u){let w=jy(h,o),O=s[lo],B=Dv(O,o[Wc]);B!==null&&F2(g,o[$s],O,s,B,w)}let i=s[fm];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function xm(o,s,h,u,g=!1){for(;h!==null;){let i=s[h.index];i!==null&&u.push(Ta(i)),al(i)&&OP(i,u);let w=h.type;if(w&8)xm(o,s,h.child,u);else if(w&32){let O=Tv(h,s),B;for(;B=O();)u.push(B)}else if(w&16){let O=iC(s,h);if(Array.isArray(O))u.push(...O);else{let B=Kd(s[Ca]);xm(B[Mn],B,O,u,!0)}}h=g?h.projectionNext:h.next}return u}function OP(o,s){for(let h=ls;h<o.length;h++){let u=o[h],g=u[Mn].firstChild;g!==null&&xm(u[Mn],u,g,s)}o[Wc]!==o[sl]&&s.push(o[Wc])}var xC=[];function kP(o){return o[Hc]??LP(o)}function LP(o){let s=xC.pop()??Object.create(NP);return s.lView=o,s}function FP(o){o.lView[Hc]!==o&&(o.lView=null,xC.push(o))}var NP=dr(Dt({},Mw),{consumerIsAlwaysLive:!0,consumerMarkedDirty:o=>{Yd(o.lView)},consumerOnSignalRead(){this.lView[Hc]=this}}),bC=100;function wC(o,s=!0,h=0){let u=o[Ea],g=u.rendererFactory,i=!1;i||g.begin?.();try{zP(o,h)}catch(w){throw s&&yC(o,w),w}finally{i||(g.end?.(),u.inlineEffectRunner?.flush())}}function zP(o,s){Gy(o,s);let h=0;for(;mv(o);){if(h===bC)throw new Gt(103,!1);h++,Gy(o,1)}}function BP(o,s,h,u){let g=s[en];if((g&256)===256)return;let i=!1;!i&&s[Ea].inlineEffectRunner?.flush(),gv(s);let w=null,O=null;!i&&VP(o)&&(O=kP(s),w=Sw(O));try{gE(s),YA(o.bindingStartIndex),h!==null&&hC(o,s,h,2,u);let B=(g&3)===3;if(!i)if(B){let _e=o.preOrderCheckHooks;_e!==null&&om(s,_e,null)}else{let _e=o.preOrderHooks;_e!==null&&sm(s,_e,0,null),dy(s,0)}if(jP(s),EC(s,0),o.contentQueries!==null&&_C(o,s),!i)if(B){let _e=o.contentCheckHooks;_e!==null&&om(s,_e)}else{let _e=o.contentHooks;_e!==null&&sm(s,_e,1),dy(s,1)}eP(o,s);let j=o.components;j!==null&&TC(s,j,0);let ie=o.viewQuery;if(ie!==null&&$y(2,ie,u),!i)if(B){let _e=o.viewCheckHooks;_e!==null&&om(s,_e)}else{let _e=o.viewHooks;_e!==null&&sm(s,_e,2),dy(s,2)}if(o.firstUpdatePass===!0&&(o.firstUpdatePass=!1),s[hy]){for(let _e of s[hy])_e();s[hy]=null}i||(s[en]&=-73)}catch(B){throw Yd(s),B}finally{O!==null&&(Aw(O,w),FP(O)),_v()}}function VP(o){return o.type!==2}function EC(o,s){for(let h=qE(o);h!==null;h=WE(h))for(let u=ls;u<h.length;u++){let g=h[u];CC(g,s)}}function jP(o){for(let s=qE(o);s!==null;s=WE(s)){if(!(s[en]&fv.HasTransplantedViews))continue;let h=s[mm];for(let u=0;u<h.length;u++){let g=h[u],i=g[Fi];VA(g)}}}function UP(o,s,h){let u=ql(s,o);CC(u,h)}function CC(o,s){pv(o)&&Gy(o,s)}function Gy(o,s){let u=o[Mn],g=o[en],i=o[Hc],w=!!(s===0&&g&16);if(w||=!!(g&64&&s===0),w||=!!(g&1024),w||=!!(i?.dirty&&$_(i)),i&&(i.dirty=!1),o[en]&=-9217,w)BP(u,o,u.template,o[rl]);else if(g&8192){EC(o,1);let O=u.components;O!==null&&TC(o,O,1)}}function TC(o,s,h){for(let u=0;u<s.length;u++)UP(o,s[u],h)}function Rv(o){for(o[Ea].changeDetectionScheduler?.notify();o;){o[en]|=64;let s=Kd(o);if(AA(o)&&!s)return o;o=s}return null}var gh=class{get rootNodes(){let s=this._lView,h=s[Mn];return xm(h,s,h.firstChild,[])}constructor(s,h,u=!0){this._lView=s,this._cdRefInjectingView=h,this.notifyErrorHandler=u,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[rl]}set context(s){this._lView[rl]=s}get destroyed(){return(this._lView[en]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let s=this._lView[Fi];if(al(s)){let h=s[pm],u=h?h.indexOf(this):-1;u>-1&&(Vy(s,u),hm(h,u))}this._attachedToViewContainer=!1}tC(this._lView[Mn],this._lView)}onDestroy(s){_E(this._lView,s)}markForCheck(){Rv(this._cdRefInjectingView||this._lView)}detach(){this._lView[en]&=-129}reattach(){Py(this._lView),this._lView[en]|=128}detectChanges(){this._lView[en]|=1024,wC(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Gt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,QE(this._lView[Mn],this._lView)}attachToAppRef(s){if(this._attachedToViewContainer)throw new Gt(902,!1);this._appRef=s,Py(this._lView)}};var uj=new RegExp(`^(\\d+)*(${A2}|${S2})*(.*)`);var $P=()=>null;function I1(o,s){return $P(o,s)}var Hy=class{},qy=class{},bm=class{};function GP(o){let s=Error(`No component factory found for ${ao(o)}.`);return s[HP]=o,s}var HP="ngComponent";var Wy=class{resolveComponentFactory(s){throw GP(s)}},Nm=(()=>{let s=class s{};s.NULL=new Wy;let o=s;return o})(),Jd=class{},Ch=(()=>{let s=class s{constructor(){this.destroyNode=null}};s.__NG_ELEMENT_ID__=()=>qP();let o=s;return o})();function qP(){let o=vi(),s=Hs(),h=ql(s.index,o);return(Uc(h)?h:o)[lo]}var WP=(()=>{let s=class s{};s.\u0275prov=sn({token:s,providedIn:"root",factory:()=>null});let o=s;return o})(),_y={};var M1=new Set;function DC(o){M1.has(o)||(M1.add(o),performance?.mark?.("mark_feature_usage",{detail:{feature:o}}))}function S1(...o){}function ZP(){let o=typeof $d.requestAnimationFrame=="function",s=$d[o?"requestAnimationFrame":"setTimeout"],h=$d[o?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&s&&h){let u=s[Zone.__symbol__("OriginalDelegate")];u&&(s=u);let g=h[Zone.__symbol__("OriginalDelegate")];g&&(h=g)}return{nativeRequestAnimationFrame:s,nativeCancelAnimationFrame:h}}var Gr=class o{constructor({enableLongStackTrace:s=!1,shouldCoalesceEventChangeDetection:h=!1,shouldCoalesceRunChangeDetection:u=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Li(!1),this.onMicrotaskEmpty=new Li(!1),this.onStable=new Li(!1),this.onError=new Li(!1),typeof Zone>"u")throw new Gt(908,!1);Zone.assertZonePatched();let g=this;g._nesting=0,g._outer=g._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),s&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!u&&h,g.shouldCoalesceRunChangeDetection=u,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=ZP().nativeRequestAnimationFrame,KP(g)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!o.isInAngularZone())throw new Gt(909,!1)}static assertNotInAngularZone(){if(o.isInAngularZone())throw new Gt(909,!1)}run(s,h,u){return this._inner.run(s,h,u)}runTask(s,h,u,g){let i=this._inner,w=i.scheduleEventTask("NgZoneEvent: "+g,s,XP,S1,S1);try{return i.runTask(w,h,u)}finally{i.cancelTask(w)}}runGuarded(s,h,u){return this._inner.runGuarded(s,h,u)}runOutsideAngular(s){return this._outer.run(s)}},XP={};function Ov(o){if(o._nesting==0&&!o.hasPendingMicrotasks&&!o.isStable)try{o._nesting++,o.onMicrotaskEmpty.emit(null)}finally{if(o._nesting--,!o.hasPendingMicrotasks)try{o.runOutsideAngular(()=>o.onStable.emit(null))}finally{o.isStable=!0}}}function YP(o){o.isCheckStableRunning||o.lastRequestAnimationFrameId!==-1||(o.lastRequestAnimationFrameId=o.nativeRequestAnimationFrame.call($d,()=>{o.fakeTopEventTask||(o.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{o.lastRequestAnimationFrameId=-1,Zy(o),o.isCheckStableRunning=!0,Ov(o),o.isCheckStableRunning=!1},void 0,()=>{},()=>{})),o.fakeTopEventTask.invoke()}),Zy(o))}function KP(o){let s=()=>{YP(o)};o._inner=o._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(h,u,g,i,w,O)=>{if(JP(O))return h.invokeTask(g,i,w,O);try{return A1(o),h.invokeTask(g,i,w,O)}finally{(o.shouldCoalesceEventChangeDetection&&i.type==="eventTask"||o.shouldCoalesceRunChangeDetection)&&s(),P1(o)}},onInvoke:(h,u,g,i,w,O,B)=>{try{return A1(o),h.invoke(g,i,w,O,B)}finally{o.shouldCoalesceRunChangeDetection&&s(),P1(o)}},onHasTask:(h,u,g,i)=>{h.hasTask(g,i),u===g&&(i.change=="microTask"?(o._hasPendingMicrotasks=i.microTask,Zy(o),Ov(o)):i.change=="macroTask"&&(o.hasPendingMacrotasks=i.macroTask))},onHandleError:(h,u,g,i)=>(h.handleError(g,i),o.runOutsideAngular(()=>o.onError.emit(i)),!1)})}function Zy(o){o._hasPendingMicrotasks||(o.shouldCoalesceEventChangeDetection||o.shouldCoalesceRunChangeDetection)&&o.lastRequestAnimationFrameId!==-1?o.hasPendingMicrotasks=!0:o.hasPendingMicrotasks=!1}function A1(o){o._nesting++,o.isStable&&(o.isStable=!1,o.onUnstable.emit(null))}function P1(o){o._nesting--,Ov(o)}function JP(o){return!Array.isArray(o)||o.length!==1?!1:o[0].data?.__ignore_ng_zone__===!0}var IC=(()=>{let s=class s{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let u=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let g of u)g()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};s.\u0275prov=sn({token:s,providedIn:"root",factory:()=>new s});let o=s;return o})();function Xy(o,s,h){let u=h?o.styles:null,g=h?o.classes:null,i=0;if(s!==null)for(let w=0;w<s.length;w++){let O=s[w];if(typeof O=="number")i=O;else if(i==1)g=r1(g,O);else if(i==2){let B=O,j=s[++w];u=r1(u,B+": "+j+";")}}h?o.styles=u:o.stylesWithoutHost=u,h?o.classes=g:o.classesWithoutHost=g}var wm=class extends Nm{constructor(s){super(),this.ngModule=s}resolveComponentFactory(s){let h=Gc(s);return new Qd(h,this.ngModule)}};function R1(o){let s=[];for(let h in o){if(!o.hasOwnProperty(h))continue;let u=o[h];u!==void 0&&s.push({propName:Array.isArray(u)?u[0]:u,templateName:h})}return s}function QP(o){let s=o.toLowerCase();return s==="svg"?kA:s==="math"?LA:null}var Yy=class{constructor(s,h){this.injector=s,this.parentInjector=h}get(s,h,u){u=Mm(u);let g=this.injector.get(s,_y,u);return g!==_y||h===_y?g:this.parentInjector.get(s,h,u)}},Qd=class extends bm{get inputs(){let s=this.componentDef,h=s.inputTransforms,u=R1(s.inputs);if(h!==null)for(let g of u)h.hasOwnProperty(g.propName)&&(g.transform=h[g.propName]);return u}get outputs(){return R1(this.componentDef.outputs)}constructor(s,h){super(),this.componentDef=s,this.ngModule=h,this.componentType=s.type,this.selector=dA(s.selectors),this.ngContentSelectors=s.ngContentSelectors?s.ngContentSelectors:[],this.isBoundToModule=!!h}create(s,h,u,g){let i=tr(null);try{g=g||this.ngModule;let w=g instanceof cs?g:g?.injector;w&&this.componentDef.getStandaloneInjector!==null&&(w=this.componentDef.getStandaloneInjector(w)||w);let O=w?new Yy(s,w):s,B=O.get(Jd,null);if(B===null)throw new Gt(407,!1);let j=O.get(WP,null),ie=O.get(IC,null),_e=O.get(Hy,null),Be={rendererFactory:B,sanitizer:j,inlineEffectRunner:null,afterRenderEventManager:ie,changeDetectionScheduler:_e},Re=B.createRenderer(null,this.componentDef),tt=this.componentDef.selectors[0][0]||"div",Mt=u?oP(Re,u,this.componentDef.encapsulation,O):JE(Re,tt,QP(tt)),En=512;this.componentDef.signals?En|=4096:this.componentDef.onPush||(En|=16);let Ct=null;Mt!==null&&(Ct=Ev(Mt,O,!0));let gn=pC(0,null,null,1,0,null,null,null,null,null,null),Un=Mv(null,gn,null,En,null,null,Be,Re,O,null,Ct);gv(Un);let xr,ei;try{let nr=this.componentDef,rt,Fo=null;nr.findHostDirectiveDefs?(rt=[],Fo=new Map,nr.findHostDirectiveDefs(nr,rt,Fo),rt.push(nr)):rt=[nr];let Ws=eR(Un,Mt),At=tR(Ws,Mt,nr,rt,Un,Be,Re);ei=mE(gn,qc),Mt&&iR(Re,nr,Mt,u),h!==void 0&&oR(ei,this.ngContentSelectors,h),xr=rR(At,nr,rt,Fo,Un,[sR]),vC(gn,Un,null)}finally{_v()}return new Ky(this.componentType,xr,vv(ei,Un),Un,ei)}finally{tr(i)}}},Ky=class extends qy{constructor(s,h,u,g,i){super(),this.location=u,this._rootLView=g,this._tNode=i,this.previousInputValues=null,this.instance=h,this.hostView=this.changeDetectorRef=new gh(g,void 0,!1),this.componentType=s}setInput(s,h){let u=this._tNode.inputs,g;if(u!==null&&(g=u[s])){if(this.previousInputValues??=new Map,this.previousInputValues.has(s)&&Object.is(this.previousInputValues.get(s),h))return;let i=this._rootLView;Pv(i[Mn],i,g,s,h),this.previousInputValues.set(s,h);let w=ql(this._tNode.index,i);Rv(w)}}get injector(){return new $c(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(s){this.hostView.onDestroy(s)}};function eR(o,s){let h=o[Mn],u=qc;return o[u]=s,Sv(h,u,2,"#host",null)}function tR(o,s,h,u,g,i,w){let O=g[Mn];nR(u,o,s,w);let B=null;s!==null&&(B=Ev(s,g[fh]));let j=i.rendererFactory.createRenderer(s,h),ie=16;h.signals?ie=4096:h.onPush&&(ie=64);let _e=Mv(g,fC(h),null,ie,g[o.index],o,i,j,null,null,B);return O.firstCreatePass&&Uy(O,o,u.length-1),Av(g,_e),g[o.index]=_e}function nR(o,s,h,u){for(let g of o)s.mergedAttrs=qd(s.mergedAttrs,g.hostAttrs);s.mergedAttrs!==null&&(Xy(s,s.mergedAttrs,!0),h!==null&&sC(u,h,s))}function rR(o,s,h,u,g,i){let w=Hs(),O=g[Mn],B=Gs(w,g);mC(O,g,w,h,null,u);for(let ie=0;ie<h.length;ie++){let _e=w.directiveStart+ie,Be=ph(g,O,_e,w);mh(Be,g)}gC(O,g,w),B&&mh(B,g);let j=ph(g,O,w.directiveStart+w.componentOffset,w);if(o[rl]=g[rl]=j,i!==null)for(let ie of i)ie(j,s);return dC(O,w,g),j}function iR(o,s,h,u){if(u)Dy(o,h,["ng-version","17.3.6"]);else{let{attrs:g,classes:i}=fA(s.selectors[0]);g&&Dy(o,h,g),i&&i.length>0&&oC(o,h,i.join(" "))}}function oR(o,s,h){let u=o.projection=[];for(let g=0;g<s.length;g++){let i=h[g];u.push(i!=null?Array.from(i):null)}}function sR(){let o=Hs();AE(vi()[Mn],o)}var zm=(()=>{let s=class s{};s.__NG_ELEMENT_ID__=aR;let o=s;return o})();function aR(){let o=Hs();return cR(o,vi())}var lR=zm,MC=class extends lR{constructor(s,h,u){super(),this._lContainer=s,this._hostTNode=h,this._hostLView=u}get element(){return vv(this._hostTNode,this._hostLView)}get injector(){return new $c(this._hostTNode,this._hostLView)}get parentInjector(){let s=yv(this._hostTNode,this._hostLView);if(RE(s)){let h=_m(s,this._hostLView),u=gm(s),g=h[Mn].data[u+8];return new $c(g,h)}else return new $c(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(s){let h=O1(this._lContainer);return h!==null&&h[s]||null}get length(){return this._lContainer.length-ls}createEmbeddedView(s,h,u){let g,i;typeof u=="number"?g=u:u!=null&&(g=u.index,i=u.injector);let w=I1(this._lContainer,s.ssrId),O=s.createEmbeddedViewImpl(h||{},i,w);return this.insertImpl(O,g,D1(this._hostTNode,w)),O}createComponent(s,h,u,g,i){let w=s&&!SA(s),O;if(w)O=h;else{let tt=h||{};O=tt.index,u=tt.injector,g=tt.projectableNodes,i=tt.environmentInjector||tt.ngModuleRef}let B=w?s:new Qd(Gc(s)),j=u||this.parentInjector;if(!i&&B.ngModule==null){let Mt=(w?j:this.parentInjector).get(cs,null);Mt&&(i=Mt)}let ie=Gc(B.componentType??{}),_e=I1(this._lContainer,ie?.id??null),Be=_e?.firstChild??null,Re=B.create(j,g,Be,i);return this.insertImpl(Re.hostView,O,D1(this._hostTNode,_e)),Re}insert(s,h){return this.insertImpl(s,h,!0)}insertImpl(s,h,u){let g=s._lView;if(BA(g)){let O=this.indexOf(s);if(O!==-1)this.detach(O);else{let B=g[Fi],j=new MC(B,B[$s],B[Fi]);j.detach(j.indexOf(s))}}let i=this._adjustIndex(h),w=this._lContainer;return RP(w,g,i,u),s.attachToViewContainerRef(),q1(yy(w),i,s),s}move(s,h){return this.insert(s,h)}indexOf(s){let h=O1(this._lContainer);return h!==null?h.indexOf(s):-1}remove(s){let h=this._adjustIndex(s,-1),u=Vy(this._lContainer,h);u&&(hm(yy(this._lContainer),h),tC(u[Mn],u))}detach(s){let h=this._adjustIndex(s,-1),u=Vy(this._lContainer,h);return u&&hm(yy(this._lContainer),h)!=null?new gh(u):null}_adjustIndex(s,h=0){return s??this.length+h}};function O1(o){return o[pm]}function yy(o){return o[pm]||(o[pm]=[])}function cR(o,s){let h,u=s[o.index];return al(u)?h=u:(h=DP(u,s,null,o),s[o.index]=h,Av(s,h)),hR(h,s,o,u),new MC(h,o,s)}function uR(o,s){let h=o[lo],u=h.createComment(""),g=Gs(s,o),i=Dv(h,g);return vm(h,i,u,H2(h,g),!1),u}var hR=dR;function dR(o,s,h,u){if(o[Wc])return;let g;h.type&8?g=Ta(u):g=uR(s,h),o[Wc]=g}function fR(o){return Object.getPrototypeOf(o.prototype).constructor}function Wl(o){let s=fR(o.type),h=!0,u=[o];for(;s;){let g;if(Gl(o))g=s.\u0275cmp||s.\u0275dir;else{if(s.\u0275cmp)throw new Gt(903,!1);g=s.\u0275dir}if(g){if(h){u.push(g);let w=o;w.inputs=nm(o.inputs),w.inputTransforms=nm(o.inputTransforms),w.declaredInputs=nm(o.declaredInputs),w.outputs=nm(o.outputs);let O=g.hostBindings;O&&yR(o,O);let B=g.viewQuery,j=g.contentQueries;if(B&&gR(o,B),j&&_R(o,j),pR(o,g),PS(o.outputs,g.outputs),Gl(g)&&g.data.animation){let ie=o.data;ie.animation=(ie.animation||[]).concat(g.data.animation)}}let i=g.features;if(i)for(let w=0;w<i.length;w++){let O=i[w];O&&O.ngInherit&&O(o),O===Wl&&(h=!1)}}s=Object.getPrototypeOf(s)}mR(u)}function pR(o,s){for(let h in s.inputs){if(!s.inputs.hasOwnProperty(h)||o.inputs.hasOwnProperty(h))continue;let u=s.inputs[h];if(u!==void 0&&(o.inputs[h]=u,o.declaredInputs[h]=s.declaredInputs[h],s.inputTransforms!==null)){let g=Array.isArray(u)?u[0]:u;if(!s.inputTransforms.hasOwnProperty(g))continue;o.inputTransforms??={},o.inputTransforms[g]=s.inputTransforms[g]}}}function mR(o){let s=0,h=null;for(let u=o.length-1;u>=0;u--){let g=o[u];g.hostVars=s+=g.hostVars,g.hostAttrs=qd(g.hostAttrs,h=qd(h,g.hostAttrs))}}function nm(o){return o===uh?{}:o===as?[]:o}function gR(o,s){let h=o.viewQuery;h?o.viewQuery=(u,g)=>{s(u,g),h(u,g)}:o.viewQuery=s}function _R(o,s){let h=o.contentQueries;h?o.contentQueries=(u,g,i)=>{s(u,g,i),h(u,g,i)}:o.contentQueries=s}function yR(o,s){let h=o.hostBindings;h?o.hostBindings=(u,g)=>{s(u,g),h(u,g)}:o.hostBindings=s}var Hl=class{},ef=class{};var Jy=class extends Hl{constructor(s,h,u){super(),this._parent=h,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new wm(this);let g=eE(s);this._bootstrapComponents=KE(g.bootstrap),this._r3Injector=jE(s,h,[{provide:Hl,useValue:this},{provide:Nm,useValue:this.componentFactoryResolver},...u],ao(s),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(s)}get injector(){return this._r3Injector}destroy(){let s=this._r3Injector;!s.destroyed&&s.destroy(),this.destroyCbs.forEach(h=>h()),this.destroyCbs=null}onDestroy(s){this.destroyCbs.push(s)}},Qy=class extends ef{constructor(s){super(),this.moduleType=s}create(s){return new Jy(this.moduleType,s,[])}};var Em=class extends Hl{constructor(s){super(),this.componentFactoryResolver=new wm(this),this.instance=null;let h=new Wd([...s.providers,{provide:Hl,useValue:this},{provide:Nm,useValue:this.componentFactoryResolver}],s.parent||hv(),s.debugName,new Set(["environment"]));this.injector=h,s.runEnvironmentInitializers&&h.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(s){this.injector.onDestroy(s)}};function kv(o,s,h=null){return new Em({providers:o,parent:s,debugName:h,runEnvironmentInitializers:!0}).injector}var Bm=(()=>{let s=class s{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new _i(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let u=this.taskId++;return this.pendingTasks.add(u),u}remove(u){this.pendingTasks.delete(u),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();function SC(o,s,h){let u=o[s];return Object.is(u,h)?!1:(o[s]=h,!0)}function vR(o){return(o.flags&32)===32}function rm(o,s){return o<<17|s<<2}function Yc(o){return o>>17&32767}function xR(o){return(o&2)==2}function bR(o,s){return o&131071|s<<17}function ev(o){return o|2}function _h(o){return(o&131068)>>2}function vy(o,s){return o&-131069|s<<2}function wR(o){return(o&1)===1}function tv(o){return o|1}function ER(o,s,h,u,g,i){let w=i?s.classBindings:s.styleBindings,O=Yc(w),B=_h(w);o[u]=h;let j=!1,ie;if(Array.isArray(h)){let _e=h;ie=_e[1],(ie===null||nf(_e,ie)>0)&&(j=!0)}else ie=h;if(g)if(B!==0){let Be=Yc(o[O+1]);o[u+1]=rm(Be,O),Be!==0&&(o[Be+1]=vy(o[Be+1],u)),o[O+1]=bR(o[O+1],u)}else o[u+1]=rm(O,0),O!==0&&(o[O+1]=vy(o[O+1],u)),O=u;else o[u+1]=rm(B,0),O===0?O=u:o[B+1]=vy(o[B+1],u),B=u;j&&(o[u+1]=ev(o[u+1])),k1(o,ie,u,!0),k1(o,ie,u,!1),CR(s,ie,o,u,i),w=rm(O,B),i?s.classBindings=w:s.styleBindings=w}function CR(o,s,h,u,g){let i=g?o.residualClasses:o.residualStyles;i!=null&&typeof s=="string"&&nf(i,s)>=0&&(h[u+1]=tv(h[u+1]))}function k1(o,s,h,u){let g=o[h+1],i=s===null,w=u?Yc(g):_h(g),O=!1;for(;w!==0&&(O===!1||i);){let B=o[w],j=o[w+1];TR(B,s)&&(O=!0,o[w+1]=u?tv(j):ev(j)),w=u?Yc(j):_h(j)}O&&(o[h+1]=u?ev(g):tv(g))}function TR(o,s){return o===null||s==null||(Array.isArray(o)?o[1]:o)===s?!0:Array.isArray(o)&&typeof s=="string"?nf(o,s)>=0:!1}function Lv(o,s,h){let u=vi(),g=KA();if(SC(u,g,s)){let i=ll(),w=i2();hP(i,w,u,o,s,u[lo],h,!1)}return Lv}function L1(o,s,h,u,g){let i=s.inputs,w=g?"class":"style";Pv(o,h,i[w],w,u)}function Vm(o,s){return DR(o,s,null,!0),Vm}function DR(o,s,h,u){let g=vi(),i=ll(),w=JA(2);if(i.firstUpdatePass&&MR(i,o,w,u),s!==Fm&&SC(g,w,s)){let O=i.data[of()];OR(i,O,g,g[lo],o,g[w+1]=kR(s,h),u,w)}}function IR(o,s){return s>=o.expandoStartIndex}function MR(o,s,h,u){let g=o.data;if(g[h+1]===null){let i=g[of()],w=IR(o,h);LR(i,u)&&s===null&&!w&&(s=!1),s=SR(g,i,s,u),ER(g,i,s,h,w,u)}}function SR(o,s,h,u){let g=n2(o),i=u?s.residualClasses:s.residualStyles;if(g===null)(u?s.classBindings:s.styleBindings)===0&&(h=xy(null,o,s,h,u),h=tf(h,s.attrs,u),i=null);else{let w=s.directiveStylingLast;if(w===-1||o[w]!==g)if(h=xy(g,o,s,h,u),i===null){let B=AR(o,s,u);B!==void 0&&Array.isArray(B)&&(B=xy(null,o,s,B[1],u),B=tf(B,s.attrs,u),PR(o,s,u,B))}else i=RR(o,s,u)}return i!==void 0&&(u?s.residualClasses=i:s.residualStyles=i),h}function AR(o,s,h){let u=h?s.classBindings:s.styleBindings;if(_h(u)!==0)return o[Yc(u)]}function PR(o,s,h,u){let g=h?s.classBindings:s.styleBindings;o[Yc(g)]=u}function RR(o,s,h){let u,g=s.directiveEnd;for(let i=1+s.directiveStylingLast;i<g;i++){let w=o[i].hostAttrs;u=tf(u,w,h)}return tf(u,s.attrs,h)}function xy(o,s,h,u,g){let i=null,w=h.directiveEnd,O=h.directiveStylingLast;for(O===-1?O=h.directiveStart:O++;O<w&&(i=s[O],u=tf(u,i.hostAttrs,g),i!==o);)O++;return o!==null&&(h.directiveStylingLast=O),u}function tf(o,s,h){let u=h?1:2,g=-1;if(s!==null)for(let i=0;i<s.length;i++){let w=s[i];typeof w=="number"?g=w:g===u&&(Array.isArray(o)||(o=o===void 0?[]:["",o]),QS(o,w,h?!0:s[++i]))}return o===void 0?null:o}function OR(o,s,h,u,g,i,w,O){if(!(s.type&3))return;let B=o.data,j=B[O+1],ie=wR(j)?F1(B,s,h,g,_h(j),w):void 0;if(!Cm(ie)){Cm(i)||xR(j)&&(i=F1(B,null,h,g,O,w));let _e=zA(of(),h);J2(u,w,_e,g,i)}}function F1(o,s,h,u,g,i){let w=s===null,O;for(;g>0;){let B=o[g],j=Array.isArray(B),ie=j?B[1]:B,_e=ie===null,Be=h[g+1];Be===Fm&&(Be=_e?as:void 0);let Re=_e?cy(Be,u):ie===u?Be:void 0;if(j&&!Cm(Re)&&(Re=cy(B,u)),Cm(Re)&&(O=Re,w))return O;let tt=o[g+1];g=w?Yc(tt):_h(tt)}if(s!==null){let B=i?s.residualClasses:s.residualStyles;B!=null&&(O=cy(B,u))}return O}function Cm(o){return o!==void 0}function kR(o,s){return o==null||o===""||(typeof s=="string"?o=o+s:typeof o=="object"&&(o=ao(Cv(o)))),o}function LR(o,s){return(o.flags&(s?8:16))!==0}function FR(o,s,h,u,g,i){let w=s.consts,O=m1(w,g),B=Sv(s,o,2,u,O);return fP(s,h,B,m1(w,i)),B.attrs!==null&&Xy(B,B.attrs,!1),B.mergedAttrs!==null&&Xy(B,B.mergedAttrs,!0),s.queries!==null&&s.queries.elementStart(s,B),B}function hs(o,s,h,u){let g=vi(),i=ll(),w=qc+o,O=g[lo],B=i.firstCreatePass?FR(w,i,g,s,h,u):i.data[w],j=NR(i,g,B,O,s,o);g[w]=j;let ie=uE(B);return km(B,!0),sC(O,j,B),!vR(B)&&ME()&&rC(i,g,j,B),UA()===0&&mh(j,g),$A(),ie&&(nP(i,g,B),dC(i,B,g)),u!==null&&rP(g,B),hs}function qs(){let o=Hs();xE()?XA():(o=o.parent,km(o,!1));let s=o;qA(s)&&WA(),GA();let h=ll();return h.firstCreatePass&&(AE(h,o),cE(o)&&h.queries.elementEnd(o)),s.classesWithoutHost!=null&&c2(s)&&L1(h,s,vi(),s.classesWithoutHost,!0),s.stylesWithoutHost!=null&&u2(s)&&L1(h,s,vi(),s.stylesWithoutHost,!1),qs}function Zl(o,s,h,u){return hs(o,s,h,u),qs(),Zl}var NR=(o,s,h,u,g,i)=>(SE(!0),JE(u,g,o2()));var Tm="en-US";var zR=Tm;function BR(o){typeof o=="string"&&(zR=o.toLowerCase().replace(/_/g,"-"))}function ds(o,s,h,u){let g=vi(),i=ll(),w=Hs();return jR(i,g,g[lo],w,o,s,u),ds}function VR(o,s,h,u){let g=o.cleanup;if(g!=null)for(let i=0;i<g.length-1;i+=2){let w=g[i];if(w===h&&g[i+1]===u){let O=s[Zd],B=g[i+2];return O.length>B?O[B]:null}typeof w=="string"&&(i+=2)}return null}function jR(o,s,h,u,g,i,w){let O=uE(u),j=o.firstCreatePass&&MP(o),ie=s[rl],_e=IP(s),Be=!0;if(u.type&3||w){let Mt=Gs(u,s),En=w?w(Mt):Mt,Ct=_e.length,gn=w?xr=>w(Ta(xr[u.index])):u.index,Un=null;if(!w&&O&&(Un=VR(o,s,g,u.index)),Un!==null){let xr=Un.__ngLastListenerFn__||Un;xr.__ngNextListenerFn__=i,Un.__ngLastListenerFn__=i,Be=!1}else{i=z1(u,s,ie,i,!1);let xr=h.listen(En,g,i);_e.push(i,xr),j&&j.push(g,gn,Ct,Ct+1)}}else i=z1(u,s,ie,i,!1);let Re=u.outputs,tt;if(Be&&Re!==null&&(tt=Re[g])){let Mt=tt.length;if(Mt)for(let En=0;En<Mt;En+=2){let Ct=tt[En],gn=tt[En+1],ei=s[Ct][gn].subscribe(i),nr=_e.length;_e.push(i,ei),j&&j.push(g,u.index,nr,-(nr+1))}}}function N1(o,s,h,u){let g=tr(null);try{return xa(6,s,h),h(u)!==!1}catch(i){return yC(o,i),!1}finally{xa(7,s,h),tr(g)}}function z1(o,s,h,u,g){return function i(w){if(w===Function)return u;let O=o.componentOffset>-1?ql(o.index,s):s;Rv(O);let B=N1(s,h,u,w),j=i.__ngNextListenerFn__;for(;j;)B=N1(s,h,j,w)&&B,j=j.__ngNextListenerFn__;return g&&B===!1&&w.preventDefault(),B}}function eu(o,s=""){let h=vi(),u=ll(),g=o+qc,i=u.firstCreatePass?Sv(u,g,1,s,null):u.data[g],w=UR(u,h,i,s,o);h[g]=w,ME()&&rC(u,h,w,i),km(i,!1)}var UR=(o,s,h,u,g)=>(SE(!0),k2(s[lo],u));function $R(o,s,h){let u=ll();if(u.firstCreatePass){let g=Gl(o);nv(h,u.data,u.blueprint,g,!0),nv(s,u.data,u.blueprint,g,!1)}}function nv(o,s,h,u,g){if(o=Wi(o),Array.isArray(o))for(let i=0;i<o.length;i++)nv(o[i],s,h,u,g);else{let i=ll(),w=vi(),O=Hs(),B=dh(o)?o:Wi(o.provide),j=sE(o),ie=O.providerIndexes&1048575,_e=O.directiveStart,Be=O.providerIndexes>>20;if(dh(o)||!o.multi){let Re=new Xc(j,g,Nr),tt=wy(B,s,g?ie:ie+Be,_e);tt===-1?(ky(ym(O,w),i,B),by(i,o,s.length),s.push(B),O.directiveStart++,O.directiveEnd++,g&&(O.providerIndexes+=1048576),h.push(Re),w.push(Re)):(h[tt]=Re,w[tt]=Re)}else{let Re=wy(B,s,ie+Be,_e),tt=wy(B,s,ie,ie+Be),Mt=Re>=0&&h[Re],En=tt>=0&&h[tt];if(g&&!En||!g&&!Mt){ky(ym(O,w),i,B);let Ct=qR(g?HR:GR,h.length,g,u,j);!g&&En&&(h[tt].providerFactory=Ct),by(i,o,s.length,0),s.push(B),O.directiveStart++,O.directiveEnd++,g&&(O.providerIndexes+=1048576),h.push(Ct),w.push(Ct)}else{let Ct=AC(h[g?tt:Re],j,!g&&u);by(i,o,Re>-1?Re:tt,Ct)}!g&&u&&En&&h[tt].componentProviders++}}}function by(o,s,h,u){let g=dh(s),i=bA(s);if(g||i){let B=(i?Wi(s.useClass):s).prototype.ngOnDestroy;if(B){let j=o.destroyHooks||(o.destroyHooks=[]);if(!g&&s.multi){let ie=j.indexOf(h);ie===-1?j.push(h,[u,B]):j[ie+1].push(u,B)}else j.push(h,B)}}}function AC(o,s,h){return h&&o.componentProviders++,o.multi.push(s)-1}function wy(o,s,h,u){for(let g=h;g<u;g++)if(s[g]===o)return g;return-1}function GR(o,s,h,u){return rv(this.multi,[])}function HR(o,s,h,u){let g=this.multi,i;if(this.providerFactory){let w=this.providerFactory.componentProviders,O=ph(h,h[Mn],this.providerFactory.index,u);i=O.slice(0,w),rv(g,i);for(let B=w;B<O.length;B++)i.push(O[B])}else i=[],rv(g,i);return i}function rv(o,s){for(let h=0;h<o.length;h++){let u=o[h];s.push(u())}return s}function qR(o,s,h,u,g){let i=new Xc(o,h,Nr);return i.multi=[],i.index=s,i.componentProviders=0,AC(i,g,u&&!h),i}function jm(o,s=[]){return h=>{h.providersResolver=(u,g)=>$R(u,g?g(o):o,s)}}var WR=(()=>{let s=class s{constructor(u){this._injector=u,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(u){if(!u.standalone)return null;if(!this.cachedInjectors.has(u)){let g=rE(!1,u.type),i=g.length>0?kv([g],this._injector,`Standalone[${u.type.name}]`):null;this.cachedInjectors.set(u,i)}return this.cachedInjectors.get(u)}ngOnDestroy(){try{for(let u of this.cachedInjectors.values())u!==null&&u.destroy()}finally{this.cachedInjectors.clear()}}};s.\u0275prov=sn({token:s,providedIn:"environment",factory:()=>new s(Pn(cs))});let o=s;return o})();function Th(o){DC("NgStandalone"),o.getStandaloneInjector=s=>s.get(WR).getOrCreateStandaloneInjector(o)}var Um=(()=>{let s=class s{log(u){console.log(u)}warn(u){console.warn(u)}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"platform"});let o=s;return o})();var PC=new an("");function tu(o){return!!o&&typeof o.then=="function"}function RC(o){return!!o&&typeof o.subscribe=="function"}var OC=new an(""),kC=(()=>{let s=class s{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((u,g)=>{this.resolve=u,this.reject=g}),this.appInits=It(OC,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let u=[];for(let i of this.appInits){let w=i();if(tu(w))u.push(w);else if(RC(w)){let O=new Promise((B,j)=>{w.subscribe({complete:B,error:j})});u.push(O)}}let g=()=>{this.done=!0,this.resolve()};Promise.all(u).then(()=>{g()}).catch(i=>{this.reject(i)}),u.length===0&&g(),this.initialized=!0}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})(),Fv=new an("");function ZR(){Rw(()=>{throw new Gt(600,!1)})}function XR(o){return o.isBoundToModule}function YR(o,s,h){try{let u=h();return tu(u)?u.catch(g=>{throw s.runOutsideAngular(()=>o.handleError(g)),g}):u}catch(u){throw s.runOutsideAngular(()=>o.handleError(u)),u}}var af=(()=>{let s=class s{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=It(UE),this.afterRenderEffectManager=It(IC),this.externalTestViews=new Set,this.beforeRender=new qi,this.afterTick=new qi,this.componentTypes=[],this.components=[],this.isStable=It(Bm).hasPendingTasks.pipe(wn(u=>!u)),this._injector=It(cs)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(u,g){let i=u instanceof bm;if(!this._injector.get(kC).done){let Re=!i&&Q1(u),tt=!1;throw new Gt(405,tt)}let O;i?O=u:O=this._injector.get(Nm).resolveComponentFactory(u),this.componentTypes.push(O.componentType);let B=XR(O)?void 0:this._injector.get(Hl),j=g||O.selector,ie=O.create(wh.NULL,[],j,B),_e=ie.location.nativeElement,Be=ie.injector.get(PC,null);return Be?.registerApplication(_e),ie.onDestroy(()=>{this.detachView(ie.hostView),Ey(this.components,ie),Be?.unregisterApplication(_e)}),this._loadComponent(ie),ie}tick(){this._tick(!0)}_tick(u){if(this._runningTick)throw new Gt(101,!1);let g=tr(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(u)}catch(i){this.internalErrorHandler(i)}finally{this.afterTick.next(),this._runningTick=!1,tr(g)}}detectChangesInAttachedViews(u){let g=0,i=this.afterRenderEffectManager;for(;;){if(g===bC)throw new Gt(103,!1);if(u){let w=g===0;this.beforeRender.next(w);for(let{_lView:O,notifyErrorHandler:B}of this._views)KR(O,w,B)}if(g++,i.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:w})=>iv(w))&&(i.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:w})=>iv(w))))break}}attachView(u){let g=u;this._views.push(g),g.attachToAppRef(this)}detachView(u){let g=u;Ey(this._views,g),g.detachFromAppRef()}_loadComponent(u){this.attachView(u.hostView),this.tick(),this.components.push(u);let g=this._injector.get(Fv,[]);[...this._bootstrapListeners,...g].forEach(i=>i(u))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(u=>u()),this._views.slice().forEach(u=>u.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(u){return this._destroyListeners.push(u),()=>Ey(this._destroyListeners,u)}destroy(){if(this._destroyed)throw new Gt(406,!1);let u=this._injector;u.destroy&&!u.destroyed&&u.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();function Ey(o,s){let h=o.indexOf(s);h>-1&&o.splice(h,1)}function KR(o,s,h){!s&&!iv(o)||JR(o,h,s)}function iv(o){return mv(o)}function JR(o,s,h){let u;h?(u=0,o[en]|=1024):o[en]&64?u=0:u=1,wC(o,s,u)}var ov=class{constructor(s,h){this.ngModuleFactory=s,this.componentFactories=h}},Nv=(()=>{let s=class s{compileModuleSync(u){return new Qy(u)}compileModuleAsync(u){return Promise.resolve(this.compileModuleSync(u))}compileModuleAndAllComponentsSync(u){let g=this.compileModuleSync(u),i=eE(u),w=KE(i.declarations).reduce((O,B)=>{let j=Gc(B);return j&&O.push(new Qd(j)),O},[]);return new ov(g,w)}compileModuleAndAllComponentsAsync(u){return Promise.resolve(this.compileModuleAndAllComponentsSync(u))}clearCache(){}clearCacheFor(u){}getModuleId(u){}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();var QR=(()=>{let s=class s{constructor(){this.zone=It(Gr),this.applicationRef=It(af)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();function eO(o){return[{provide:Gr,useFactory:o},{provide:hh,multi:!0,useFactory:()=>{let s=It(QR,{optional:!0});return()=>s.initialize()}},{provide:hh,multi:!0,useFactory:()=>{let s=It(iO);return()=>{s.initialize()}}},{provide:UE,useFactory:tO}]}function tO(){let o=It(Gr),s=It(il);return h=>o.runOutsideAngular(()=>s.handleError(h))}function nO(o){let s=eO(()=>new Gr(rO(o)));return Sm([[],s])}function rO(o){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:o?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:o?.runCoalescing??!1}}var iO=(()=>{let s=class s{constructor(){this.subscription=new Jr,this.initialized=!1,this.zone=It(Gr),this.pendingTasks=It(Bm)}initialize(){if(this.initialized)return;this.initialized=!0;let u=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(u=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Gr.assertNotInAngularZone(),queueMicrotask(()=>{u!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(u),u=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Gr.assertInAngularZone(),u??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();function oO(){return typeof $localize<"u"&&$localize.locale||Tm}var zv=new an("",{providedIn:"root",factory:()=>It(zv,mn.Optional|mn.SkipSelf)||oO()});var LC=new an("");var lm=null;function sO(o=[],s){return wh.create({name:s,providers:[{provide:Am,useValue:"platform"},{provide:LC,useValue:new Set([()=>lm=null])},...o]})}function aO(o=[]){if(lm)return lm;let s=sO(o);return lm=s,ZR(),lO(s),s}function lO(o){o.get(bv,null)?.forEach(h=>h())}var Dh=(()=>{let s=class s{};s.__NG_ELEMENT_ID__=cO;let o=s;return o})();function cO(o){return uO(Hs(),vi(),(o&16)===16)}function uO(o,s,h){if(Om(o)&&!h){let u=ql(o.index,s);return new gh(u,u)}else if(o.type&47){let u=s[Ca];return new gh(u,s)}return null}function FC(o){try{let{rootComponent:s,appProviders:h,platformProviders:u}=o,g=aO(u),i=[nO(),...h||[]],O=new Em({providers:i,parent:g,debugName:"",runEnvironmentInitializers:!1}).injector,B=O.get(Gr);return B.run(()=>{O.resolveInjectorInitializers();let j=O.get(il,null),ie;B.runOutsideAngular(()=>{ie=B.onError.subscribe({next:Re=>{j.handleError(Re)}})});let _e=()=>O.destroy(),Be=g.get(LC);return Be.add(_e),O.onDestroy(()=>{ie.unsubscribe(),Be.delete(_e)}),YR(j,B,()=>{let Re=O.get(kC);return Re.runInitializers(),Re.donePromise.then(()=>{let tt=O.get(zv,Tm);BR(tt||Tm);let Mt=O.get(af);return s!==void 0&&Mt.bootstrap(s),Mt})})})}catch(s){return Promise.reject(s)}}var VC=null;function cl(){return VC}function jC(o){VC??=o}var $m=class{};var fs=new an(""),UC=(()=>{let s=class s{historyGo(u){throw new Error("")}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:()=>It(fO),providedIn:"platform"});let o=s;return o})();var fO=(()=>{let s=class s extends UC{constructor(){super(),this._doc=It(fs),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return cl().getBaseHref(this._doc)}onPopState(u){let g=cl().getGlobalEventTarget(this._doc,"window");return g.addEventListener("popstate",u,!1),()=>g.removeEventListener("popstate",u)}onHashChange(u){let g=cl().getGlobalEventTarget(this._doc,"window");return g.addEventListener("hashchange",u,!1),()=>g.removeEventListener("hashchange",u)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(u){this._location.pathname=u}pushState(u,g,i){this._history.pushState(u,g,i)}replaceState(u,g,i){this._history.replaceState(u,g,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(u=0){this._history.go(u)}getState(){return this._history.state}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:()=>new s,providedIn:"platform"});let o=s;return o})();function $C(o,s){if(o.length==0)return s;if(s.length==0)return o;let h=0;return o.endsWith("/")&&h++,s.startsWith("/")&&h++,h==2?o+s.substring(1):h==1?o+s:o+"/"+s}function NC(o){let s=o.match(/#|\?|$/),h=s&&s.index||o.length,u=h-(o[h-1]==="/"?1:0);return o.slice(0,u)+o.slice(h)}function nu(o){return o&&o[0]!=="?"?"?"+o:o}var Hm=(()=>{let s=class s{historyGo(u){throw new Error("")}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:()=>It(GC),providedIn:"root"});let o=s;return o})(),pO=new an(""),GC=(()=>{let s=class s extends Hm{constructor(u,g){super(),this._platformLocation=u,this._removeListenerFns=[],this._baseHref=g??this._platformLocation.getBaseHrefFromDOM()??It(fs).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}prepareExternalUrl(u){return $C(this._baseHref,u)}path(u=!1){let g=this._platformLocation.pathname+nu(this._platformLocation.search),i=this._platformLocation.hash;return i&&u?`${g}${i}`:g}pushState(u,g,i,w){let O=this.prepareExternalUrl(i+nu(w));this._platformLocation.pushState(u,g,O)}replaceState(u,g,i,w){let O=this.prepareExternalUrl(i+nu(w));this._platformLocation.replaceState(u,g,O)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(u=0){this._platformLocation.historyGo?.(u)}};s.\u0275fac=function(g){return new(g||s)(Pn(UC),Pn(pO,8))},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();var lf=(()=>{let s=class s{constructor(u){this._subject=new Li,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=u;let g=this._locationStrategy.getBaseHref();this._basePath=_O(NC(zC(g))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(u=!1){return this.normalize(this._locationStrategy.path(u))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(u,g=""){return this.path()==this.normalize(u+nu(g))}normalize(u){return s.stripTrailingSlash(gO(this._basePath,zC(u)))}prepareExternalUrl(u){return u&&u[0]!=="/"&&(u="/"+u),this._locationStrategy.prepareExternalUrl(u)}go(u,g="",i=null){this._locationStrategy.pushState(i,"",u,g),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+nu(g)),i)}replaceState(u,g="",i=null){this._locationStrategy.replaceState(i,"",u,g),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+nu(g)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(u=0){this._locationStrategy.historyGo?.(u)}onUrlChange(u){return this._urlChangeListeners.push(u),this._urlChangeSubscription??=this.subscribe(g=>{this._notifyUrlChangeListeners(g.url,g.state)}),()=>{let g=this._urlChangeListeners.indexOf(u);this._urlChangeListeners.splice(g,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(u="",g){this._urlChangeListeners.forEach(i=>i(u,g))}subscribe(u,g,i){return this._subject.subscribe({next:u,error:g,complete:i})}};s.normalizeQueryParams=nu,s.joinWithSlash=$C,s.stripTrailingSlash=NC,s.\u0275fac=function(g){return new(g||s)(Pn(Hm))},s.\u0275prov=sn({token:s,factory:()=>mO(),providedIn:"root"});let o=s;return o})();function mO(){return new lf(Pn(Hm))}function gO(o,s){if(!o||!s.startsWith(o))return s;let h=s.substring(o.length);return h===""||["/",";","?","#"].includes(h[0])?h:s}function zC(o){return o.replace(/\/index.html$/,"")}function _O(o){if(new RegExp("^(https?:)?//").test(o)){let[,h]=o.split(/\/\/[^\/]+/);return h}return o}function HC(o,s){s=encodeURIComponent(s);for(let h of o.split(";")){let u=h.indexOf("="),[g,i]=u==-1?[h,""]:[h.slice(0,u),h.slice(u+1)];if(g.trim()===s)return decodeURIComponent(i)}return null}var qC="browser",yO="server";function Vv(o){return o===yO}var Gm=class{};var $v=class extends $m{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Gv=class o extends $v{static makeCurrent(){jC(new o)}onAndCancel(s,h,u){return s.addEventListener(h,u),()=>{s.removeEventListener(h,u)}}dispatchEvent(s,h){s.dispatchEvent(h)}remove(s){s.parentNode&&s.parentNode.removeChild(s)}createElement(s,h){return h=h||this.getDefaultDocument(),h.createElement(s)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(s){return s.nodeType===Node.ELEMENT_NODE}isShadowRoot(s){return s instanceof DocumentFragment}getGlobalEventTarget(s,h){return h==="window"?window:h==="document"?s:h==="body"?s.body:null}getBaseHref(s){let h=xO();return h==null?null:bO(h)}resetBaseElement(){cf=null}getUserAgent(){return window.navigator.userAgent}getCookie(s){return HC(document.cookie,s)}},cf=null;function xO(){return cf=cf||document.querySelector("base"),cf?cf.getAttribute("href"):null}function bO(o){return new URL(o,document.baseURI).pathname}var wO=(()=>{let s=class s{build(){return new XMLHttpRequest}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac});let o=s;return o})(),Hv=new an(""),YC=(()=>{let s=class s{constructor(u,g){this._zone=g,this._eventNameToPlugin=new Map,u.forEach(i=>{i.manager=this}),this._plugins=u.slice().reverse()}addEventListener(u,g,i){return this._findPluginFor(g).addEventListener(u,g,i)}getZone(){return this._zone}_findPluginFor(u){let g=this._eventNameToPlugin.get(u);if(g)return g;if(g=this._plugins.find(w=>w.supports(u)),!g)throw new Gt(5101,!1);return this._eventNameToPlugin.set(u,g),g}};s.\u0275fac=function(g){return new(g||s)(Pn(Hv),Pn(Gr))},s.\u0275prov=sn({token:s,factory:s.\u0275fac});let o=s;return o})(),qm=class{constructor(s){this._doc=s}},jv="ng-app-id",KC=(()=>{let s=class s{constructor(u,g,i,w={}){this.doc=u,this.appId=g,this.nonce=i,this.platformId=w,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Vv(w),this.resetHostNodes()}addStyles(u){for(let g of u)this.changeUsageCount(g,1)===1&&this.onStyleAdded(g)}removeStyles(u){for(let g of u)this.changeUsageCount(g,-1)<=0&&this.onStyleRemoved(g)}ngOnDestroy(){let u=this.styleNodesInDOM;u&&(u.forEach(g=>g.remove()),u.clear());for(let g of this.getAllStyles())this.onStyleRemoved(g);this.resetHostNodes()}addHost(u){this.hostNodes.add(u);for(let g of this.getAllStyles())this.addStyleToHost(u,g)}removeHost(u){this.hostNodes.delete(u)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(u){for(let g of this.hostNodes)this.addStyleToHost(g,u)}onStyleRemoved(u){let g=this.styleRef;g.get(u)?.elements?.forEach(i=>i.remove()),g.delete(u)}collectServerRenderedStyles(){let u=this.doc.head?.querySelectorAll(`style[${jv}="${this.appId}"]`);if(u?.length){let g=new Map;return u.forEach(i=>{i.textContent!=null&&g.set(i.textContent,i)}),g}return null}changeUsageCount(u,g){let i=this.styleRef;if(i.has(u)){let w=i.get(u);return w.usage+=g,w.usage}return i.set(u,{usage:g,elements:[]}),g}getStyleElement(u,g){let i=this.styleNodesInDOM,w=i?.get(g);if(w?.parentNode===u)return i.delete(g),w.removeAttribute(jv),w;{let O=this.doc.createElement("style");return this.nonce&&O.setAttribute("nonce",this.nonce),O.textContent=g,this.platformIsServer&&O.setAttribute(jv,this.appId),u.appendChild(O),O}}addStyleToHost(u,g){let i=this.getStyleElement(u,g),w=this.styleRef,O=w.get(g)?.elements;O?O.push(i):w.set(g,{elements:[i],usage:1})}resetHostNodes(){let u=this.hostNodes;u.clear(),u.add(this.doc.head)}};s.\u0275fac=function(g){return new(g||s)(Pn(fs),Pn(xv),Pn(wv,8),Pn(Eh))},s.\u0275prov=sn({token:s,factory:s.\u0275fac});let o=s;return o})(),Uv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Wv=/%COMP%/g,JC="%COMP%",EO=`_nghost-${JC}`,CO=`_ngcontent-${JC}`,TO=!0,DO=new an("",{providedIn:"root",factory:()=>TO});function IO(o){return CO.replace(Wv,o)}function MO(o){return EO.replace(Wv,o)}function QC(o,s){return s.map(h=>h.replace(Wv,o))}var WC=(()=>{let s=class s{constructor(u,g,i,w,O,B,j,ie=null){this.eventManager=u,this.sharedStylesHost=g,this.appId=i,this.removeStylesOnCompDestroy=w,this.doc=O,this.platformId=B,this.ngZone=j,this.nonce=ie,this.rendererByCompId=new Map,this.platformIsServer=Vv(B),this.defaultRenderer=new uf(u,O,j,this.platformIsServer)}createRenderer(u,g){if(!u||!g)return this.defaultRenderer;this.platformIsServer&&g.encapsulation===wa.ShadowDom&&(g=dr(Dt({},g),{encapsulation:wa.Emulated}));let i=this.getOrCreateRenderer(u,g);return i instanceof Wm?i.applyToHost(u):i instanceof hf&&i.applyStyles(),i}getOrCreateRenderer(u,g){let i=this.rendererByCompId,w=i.get(g.id);if(!w){let O=this.doc,B=this.ngZone,j=this.eventManager,ie=this.sharedStylesHost,_e=this.removeStylesOnCompDestroy,Be=this.platformIsServer;switch(g.encapsulation){case wa.Emulated:w=new Wm(j,ie,g,this.appId,_e,O,B,Be);break;case wa.ShadowDom:return new qv(j,ie,u,g,O,B,this.nonce,Be);default:w=new hf(j,ie,g,_e,O,B,Be);break}i.set(g.id,w)}return w}ngOnDestroy(){this.rendererByCompId.clear()}};s.\u0275fac=function(g){return new(g||s)(Pn(YC),Pn(KC),Pn(xv),Pn(DO),Pn(fs),Pn(Eh),Pn(Gr),Pn(wv))},s.\u0275prov=sn({token:s,factory:s.\u0275fac});let o=s;return o})(),uf=class{constructor(s,h,u,g){this.eventManager=s,this.doc=h,this.ngZone=u,this.platformIsServer=g,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(s,h){return h?this.doc.createElementNS(Uv[h]||h,s):this.doc.createElement(s)}createComment(s){return this.doc.createComment(s)}createText(s){return this.doc.createTextNode(s)}appendChild(s,h){(ZC(s)?s.content:s).appendChild(h)}insertBefore(s,h,u){s&&(ZC(s)?s.content:s).insertBefore(h,u)}removeChild(s,h){s&&s.removeChild(h)}selectRootElement(s,h){let u=typeof s=="string"?this.doc.querySelector(s):s;if(!u)throw new Gt(-5104,!1);return h||(u.textContent=""),u}parentNode(s){return s.parentNode}nextSibling(s){return s.nextSibling}setAttribute(s,h,u,g){if(g){h=g+":"+h;let i=Uv[g];i?s.setAttributeNS(i,h,u):s.setAttribute(h,u)}else s.setAttribute(h,u)}removeAttribute(s,h,u){if(u){let g=Uv[u];g?s.removeAttributeNS(g,h):s.removeAttribute(`${u}:${h}`)}else s.removeAttribute(h)}addClass(s,h){s.classList.add(h)}removeClass(s,h){s.classList.remove(h)}setStyle(s,h,u,g){g&(ol.DashCase|ol.Important)?s.style.setProperty(h,u,g&ol.Important?"important":""):s.style[h]=u}removeStyle(s,h,u){u&ol.DashCase?s.style.removeProperty(h):s.style[h]=""}setProperty(s,h,u){s!=null&&(s[h]=u)}setValue(s,h){s.nodeValue=h}listen(s,h,u){if(typeof s=="string"&&(s=cl().getGlobalEventTarget(this.doc,s),!s))throw new Error(`Unsupported event target ${s} for event ${h}`);return this.eventManager.addEventListener(s,h,this.decoratePreventDefault(u))}decoratePreventDefault(s){return h=>{if(h==="__ngUnwrap__")return s;(this.platformIsServer?this.ngZone.runGuarded(()=>s(h)):s(h))===!1&&h.preventDefault()}}};function ZC(o){return o.tagName==="TEMPLATE"&&o.content!==void 0}var qv=class extends uf{constructor(s,h,u,g,i,w,O,B){super(s,i,w,B),this.sharedStylesHost=h,this.hostEl=u,this.shadowRoot=u.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let j=QC(g.id,g.styles);for(let ie of j){let _e=document.createElement("style");O&&_e.setAttribute("nonce",O),_e.textContent=ie,this.shadowRoot.appendChild(_e)}}nodeOrShadowRoot(s){return s===this.hostEl?this.shadowRoot:s}appendChild(s,h){return super.appendChild(this.nodeOrShadowRoot(s),h)}insertBefore(s,h,u){return super.insertBefore(this.nodeOrShadowRoot(s),h,u)}removeChild(s,h){return super.removeChild(this.nodeOrShadowRoot(s),h)}parentNode(s){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(s)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},hf=class extends uf{constructor(s,h,u,g,i,w,O,B){super(s,i,w,O),this.sharedStylesHost=h,this.removeStylesOnCompDestroy=g,this.styles=B?QC(B,u.styles):u.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Wm=class extends hf{constructor(s,h,u,g,i,w,O,B){let j=g+"-"+u.id;super(s,h,u,i,w,O,B,j),this.contentAttr=IO(j),this.hostAttr=MO(j)}applyToHost(s){this.applyStyles(),this.setAttribute(s,this.hostAttr,"")}createElement(s,h){let u=super.createElement(s,h);return super.setAttribute(u,this.contentAttr,""),u}},SO=(()=>{let s=class s extends qm{constructor(u){super(u)}supports(u){return!0}addEventListener(u,g,i){return u.addEventListener(g,i,!1),()=>this.removeEventListener(u,g,i)}removeEventListener(u,g,i){return u.removeEventListener(g,i)}};s.\u0275fac=function(g){return new(g||s)(Pn(fs))},s.\u0275prov=sn({token:s,factory:s.\u0275fac});let o=s;return o})(),XC=["alt","control","meta","shift"],AO={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},PO={alt:o=>o.altKey,control:o=>o.ctrlKey,meta:o=>o.metaKey,shift:o=>o.shiftKey},RO=(()=>{let s=class s extends qm{constructor(u){super(u)}supports(u){return s.parseEventName(u)!=null}addEventListener(u,g,i){let w=s.parseEventName(g),O=s.eventCallback(w.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>cl().onAndCancel(u,w.domEventName,O))}static parseEventName(u){let g=u.toLowerCase().split("."),i=g.shift();if(g.length===0||!(i==="keydown"||i==="keyup"))return null;let w=s._normalizeKey(g.pop()),O="",B=g.indexOf("code");if(B>-1&&(g.splice(B,1),O="code."),XC.forEach(ie=>{let _e=g.indexOf(ie);_e>-1&&(g.splice(_e,1),O+=ie+".")}),O+=w,g.length!=0||w.length===0)return null;let j={};return j.domEventName=i,j.fullKey=O,j}static matchEventFullKeyCode(u,g){let i=AO[u.key]||u.key,w="";return g.indexOf("code.")>-1&&(i=u.code,w="code."),i==null||!i?!1:(i=i.toLowerCase(),i===" "?i="space":i==="."&&(i="dot"),XC.forEach(O=>{if(O!==i){let B=PO[O];B(u)&&(w+=O+".")}}),w+=i,w===g)}static eventCallback(u,g,i){return w=>{s.matchEventFullKeyCode(w,u)&&i.runGuarded(()=>g(w))}}static _normalizeKey(u){return u==="esc"?"escape":u}};s.\u0275fac=function(g){return new(g||s)(Pn(fs))},s.\u0275prov=sn({token:s,factory:s.\u0275fac});let o=s;return o})();function eT(o,s){return FC(Dt({rootComponent:o},OO(s)))}function OO(o){return{appProviders:[...zO,...o?.providers??[]],platformProviders:NO}}function kO(){Gv.makeCurrent()}function LO(){return new il}function FO(){return XE(document),document}var NO=[{provide:Eh,useValue:qC},{provide:bv,useValue:kO,multi:!0},{provide:fs,useFactory:FO,deps:[]}];var zO=[{provide:Am,useValue:"root"},{provide:il,useFactory:LO,deps:[]},{provide:Hv,useClass:SO,multi:!0,deps:[fs,Gr,Eh]},{provide:Hv,useClass:RO,multi:!0,deps:[fs]},WC,KC,YC,{provide:Jd,useExisting:WC},{provide:Gm,useClass:wO,deps:[]},[]];var tT=(()=>{let s=class s{constructor(u){this._doc=u}getTitle(){return this._doc.title}setTitle(u){this._doc.title=u||""}};s.\u0275fac=function(g){return new(g||s)(Pn(fs))},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();var ln="primary",Df=Symbol("RouteTitle"),Jv=class{constructor(s){this.params=s||{}}has(s){return Object.prototype.hasOwnProperty.call(this.params,s)}get(s){if(this.has(s)){let h=this.params[s];return Array.isArray(h)?h[0]:h}return null}getAll(s){if(this.has(s)){let h=this.params[s];return Array.isArray(h)?h:[h]}return[]}get keys(){return Object.keys(this.params)}};function Rh(o){return new Jv(o)}function jO(o,s,h){let u=h.path.split("/");if(u.length>o.length||h.pathMatch==="full"&&(s.hasChildren()||u.length<o.length))return null;let g={};for(let i=0;i<u.length;i++){let w=u[i],O=o[i];if(w.startsWith(":"))g[w.substring(1)]=O;else if(w!==O.path)return null}return{consumed:o.slice(0,u.length),posParams:g}}function UO(o,s){if(o.length!==s.length)return!1;for(let h=0;h<o.length;++h)if(!Da(o[h],s[h]))return!1;return!0}function Da(o,s){let h=o?Qv(o):void 0,u=s?Qv(s):void 0;if(!h||!u||h.length!=u.length)return!1;let g;for(let i=0;i<h.length;i++)if(g=h[i],!aT(o[g],s[g]))return!1;return!0}function Qv(o){return[...Object.keys(o),...Object.getOwnPropertySymbols(o)]}function aT(o,s){if(Array.isArray(o)&&Array.isArray(s)){if(o.length!==s.length)return!1;let h=[...o].sort(),u=[...s].sort();return h.every((g,i)=>u[i]===g)}else return o===s}function lT(o){return o.length>0?o[o.length-1]:null}function Kl(o){return ty(o)?o:tu(o)?Fr(Promise.resolve(o)):on(o)}var $O={exact:uT,subset:hT},cT={exact:GO,subset:HO,ignored:()=>!0};function nT(o,s,h){return $O[h.paths](o.root,s.root,h.matrixParams)&&cT[h.queryParams](o.queryParams,s.queryParams)&&!(h.fragment==="exact"&&o.fragment!==s.fragment)}function GO(o,s){return Da(o,s)}function uT(o,s,h){if(!iu(o.segments,s.segments)||!Ym(o.segments,s.segments,h)||o.numberOfChildren!==s.numberOfChildren)return!1;for(let u in s.children)if(!o.children[u]||!uT(o.children[u],s.children[u],h))return!1;return!0}function HO(o,s){return Object.keys(s).length<=Object.keys(o).length&&Object.keys(s).every(h=>aT(o[h],s[h]))}function hT(o,s,h){return dT(o,s,s.segments,h)}function dT(o,s,h,u){if(o.segments.length>h.length){let g=o.segments.slice(0,h.length);return!(!iu(g,h)||s.hasChildren()||!Ym(g,h,u))}else if(o.segments.length===h.length){if(!iu(o.segments,h)||!Ym(o.segments,h,u))return!1;for(let g in s.children)if(!o.children[g]||!hT(o.children[g],s.children[g],u))return!1;return!0}else{let g=h.slice(0,o.segments.length),i=h.slice(o.segments.length);return!iu(o.segments,g)||!Ym(o.segments,g,u)||!o.children[ln]?!1:dT(o.children[ln],s,i,u)}}function Ym(o,s,h){return s.every((u,g)=>cT[h](o[g].parameters,u.parameters))}var Xl=class{constructor(s=new Kn([],{}),h={},u=null){this.root=s,this.queryParams=h,this.fragment=u}get queryParamMap(){return this._queryParamMap??=Rh(this.queryParams),this._queryParamMap}toString(){return ZO.serialize(this)}},Kn=class{constructor(s,h){this.segments=s,this.children=h,this.parent=null,Object.values(h).forEach(u=>u.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Km(this)}},ru=class{constructor(s,h){this.path=s,this.parameters=h}get parameterMap(){return this._parameterMap??=Rh(this.parameters),this._parameterMap}toString(){return pT(this)}};function qO(o,s){return iu(o,s)&&o.every((h,u)=>Da(h.parameters,s[u].parameters))}function iu(o,s){return o.length!==s.length?!1:o.every((h,u)=>h.path===s[u].path)}function WO(o,s){let h=[];return Object.entries(o.children).forEach(([u,g])=>{u===ln&&(h=h.concat(s(g,u)))}),Object.entries(o.children).forEach(([u,g])=>{u!==ln&&(h=h.concat(s(g,u)))}),h}var T0=(()=>{let s=class s{};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:()=>new Qm,providedIn:"root"});let o=s;return o})(),Qm=class{parse(s){let h=new t0(s);return new Xl(h.parseRootSegment(),h.parseQueryParams(),h.parseFragment())}serialize(s){let h=`/${df(s.root,!0)}`,u=KO(s.queryParams),g=typeof s.fragment=="string"?`#${XO(s.fragment)}`:"";return`${h}${u}${g}`}},ZO=new Qm;function Km(o){return o.segments.map(s=>pT(s)).join("/")}function df(o,s){if(!o.hasChildren())return Km(o);if(s){let h=o.children[ln]?df(o.children[ln],!1):"",u=[];return Object.entries(o.children).forEach(([g,i])=>{g!==ln&&u.push(`${g}:${df(i,!1)}`)}),u.length>0?`${h}(${u.join("//")})`:h}else{let h=WO(o,(u,g)=>g===ln?[df(o.children[ln],!1)]:[`${g}:${df(u,!1)}`]);return Object.keys(o.children).length===1&&o.children[ln]!=null?`${Km(o)}/${h[0]}`:`${Km(o)}/(${h.join("//")})`}}function fT(o){return encodeURIComponent(o).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Zm(o){return fT(o).replace(/%3B/gi,";")}function XO(o){return encodeURI(o)}function e0(o){return fT(o).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Jm(o){return decodeURIComponent(o)}function rT(o){return Jm(o.replace(/\+/g,"%20"))}function pT(o){return`${e0(o.path)}${YO(o.parameters)}`}function YO(o){return Object.entries(o).map(([s,h])=>`;${e0(s)}=${e0(h)}`).join("")}function KO(o){let s=Object.entries(o).map(([h,u])=>Array.isArray(u)?u.map(g=>`${Zm(h)}=${Zm(g)}`).join("&"):`${Zm(h)}=${Zm(u)}`).filter(h=>h);return s.length?`?${s.join("&")}`:""}var JO=/^[^\/()?;#]+/;function Zv(o){let s=o.match(JO);return s?s[0]:""}var QO=/^[^\/()?;=#]+/;function ek(o){let s=o.match(QO);return s?s[0]:""}var tk=/^[^=?&#]+/;function nk(o){let s=o.match(tk);return s?s[0]:""}var rk=/^[^&#]+/;function ik(o){let s=o.match(rk);return s?s[0]:""}var t0=class{constructor(s){this.url=s,this.remaining=s}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Kn([],{}):new Kn([],this.parseChildren())}parseQueryParams(){let s={};if(this.consumeOptional("?"))do this.parseQueryParam(s);while(this.consumeOptional("&"));return s}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let s=[];for(this.peekStartsWith("(")||s.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),s.push(this.parseSegment());let h={};this.peekStartsWith("/(")&&(this.capture("/"),h=this.parseParens(!0));let u={};return this.peekStartsWith("(")&&(u=this.parseParens(!1)),(s.length>0||Object.keys(h).length>0)&&(u[ln]=new Kn(s,h)),u}parseSegment(){let s=Zv(this.remaining);if(s===""&&this.peekStartsWith(";"))throw new Gt(4009,!1);return this.capture(s),new ru(Jm(s),this.parseMatrixParams())}parseMatrixParams(){let s={};for(;this.consumeOptional(";");)this.parseParam(s);return s}parseParam(s){let h=ek(this.remaining);if(!h)return;this.capture(h);let u="";if(this.consumeOptional("=")){let g=Zv(this.remaining);g&&(u=g,this.capture(u))}s[Jm(h)]=Jm(u)}parseQueryParam(s){let h=nk(this.remaining);if(!h)return;this.capture(h);let u="";if(this.consumeOptional("=")){let w=ik(this.remaining);w&&(u=w,this.capture(u))}let g=rT(h),i=rT(u);if(s.hasOwnProperty(g)){let w=s[g];Array.isArray(w)||(w=[w],s[g]=w),w.push(i)}else s[g]=i}parseParens(s){let h={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let u=Zv(this.remaining),g=this.remaining[u.length];if(g!=="/"&&g!==")"&&g!==";")throw new Gt(4010,!1);let i;u.indexOf(":")>-1?(i=u.slice(0,u.indexOf(":")),this.capture(i),this.capture(":")):s&&(i=ln);let w=this.parseChildren();h[i]=Object.keys(w).length===1?w[ln]:new Kn([],w),this.consumeOptional("//")}return h}peekStartsWith(s){return this.remaining.startsWith(s)}consumeOptional(s){return this.peekStartsWith(s)?(this.remaining=this.remaining.substring(s.length),!0):!1}capture(s){if(!this.consumeOptional(s))throw new Gt(4011,!1)}};function mT(o){return o.segments.length>0?new Kn([],{[ln]:o}):o}function gT(o){let s={};for(let[u,g]of Object.entries(o.children)){let i=gT(g);if(u===ln&&i.segments.length===0&&i.hasChildren())for(let[w,O]of Object.entries(i.children))s[w]=O;else(i.segments.length>0||i.hasChildren())&&(s[u]=i)}let h=new Kn(o.segments,s);return ok(h)}function ok(o){if(o.numberOfChildren===1&&o.children[ln]){let s=o.children[ln];return new Kn(o.segments.concat(s.segments),s.children)}return o}function Oh(o){return o instanceof Xl}function sk(o,s,h=null,u=null){let g=_T(o);return yT(g,s,h,u)}function _T(o){let s;function h(i){let w={};for(let B of i.children){let j=h(B);w[B.outlet]=j}let O=new Kn(i.url,w);return i===o&&(s=O),O}let u=h(o.root),g=mT(u);return s??g}function yT(o,s,h,u){let g=o;for(;g.parent;)g=g.parent;if(s.length===0)return Xv(g,g,g,h,u);let i=ak(s);if(i.toRoot())return Xv(g,g,new Kn([],{}),h,u);let w=lk(i,g,o),O=w.processChildren?mf(w.segmentGroup,w.index,i.commands):xT(w.segmentGroup,w.index,i.commands);return Xv(g,w.segmentGroup,O,h,u)}function eg(o){return typeof o=="object"&&o!=null&&!o.outlets&&!o.segmentPath}function yf(o){return typeof o=="object"&&o!=null&&o.outlets}function Xv(o,s,h,u,g){let i={};u&&Object.entries(u).forEach(([B,j])=>{i[B]=Array.isArray(j)?j.map(ie=>`${ie}`):`${j}`});let w;o===s?w=h:w=vT(o,s,h);let O=mT(gT(w));return new Xl(O,i,g)}function vT(o,s,h){let u={};return Object.entries(o.children).forEach(([g,i])=>{i===s?u[g]=h:u[g]=vT(i,s,h)}),new Kn(o.segments,u)}var tg=class{constructor(s,h,u){if(this.isAbsolute=s,this.numberOfDoubleDots=h,this.commands=u,s&&u.length>0&&eg(u[0]))throw new Gt(4003,!1);let g=u.find(yf);if(g&&g!==lT(u))throw new Gt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function ak(o){if(typeof o[0]=="string"&&o.length===1&&o[0]==="/")return new tg(!0,0,o);let s=0,h=!1,u=o.reduce((g,i,w)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let O={};return Object.entries(i.outlets).forEach(([B,j])=>{O[B]=typeof j=="string"?j.split("/"):j}),[...g,{outlets:O}]}if(i.segmentPath)return[...g,i.segmentPath]}return typeof i!="string"?[...g,i]:w===0?(i.split("/").forEach((O,B)=>{B==0&&O==="."||(B==0&&O===""?h=!0:O===".."?s++:O!=""&&g.push(O))}),g):[...g,i]},[]);return new tg(h,s,u)}var Ah=class{constructor(s,h,u){this.segmentGroup=s,this.processChildren=h,this.index=u}};function lk(o,s,h){if(o.isAbsolute)return new Ah(s,!0,0);if(!h)return new Ah(s,!1,NaN);if(h.parent===null)return new Ah(h,!0,0);let u=eg(o.commands[0])?0:1,g=h.segments.length-1+u;return ck(h,g,o.numberOfDoubleDots)}function ck(o,s,h){let u=o,g=s,i=h;for(;i>g;){if(i-=g,u=u.parent,!u)throw new Gt(4005,!1);g=u.segments.length}return new Ah(u,!1,g-i)}function uk(o){return yf(o[0])?o[0].outlets:{[ln]:o}}function xT(o,s,h){if(o??=new Kn([],{}),o.segments.length===0&&o.hasChildren())return mf(o,s,h);let u=hk(o,s,h),g=h.slice(u.commandIndex);if(u.match&&u.pathIndex<o.segments.length){let i=new Kn(o.segments.slice(0,u.pathIndex),{});return i.children[ln]=new Kn(o.segments.slice(u.pathIndex),o.children),mf(i,0,g)}else return u.match&&g.length===0?new Kn(o.segments,{}):u.match&&!o.hasChildren()?n0(o,s,h):u.match?mf(o,0,g):n0(o,s,h)}function mf(o,s,h){if(h.length===0)return new Kn(o.segments,{});{let u=uk(h),g={};if(Object.keys(u).some(i=>i!==ln)&&o.children[ln]&&o.numberOfChildren===1&&o.children[ln].segments.length===0){let i=mf(o.children[ln],s,h);return new Kn(o.segments,i.children)}return Object.entries(u).forEach(([i,w])=>{typeof w=="string"&&(w=[w]),w!==null&&(g[i]=xT(o.children[i],s,w))}),Object.entries(o.children).forEach(([i,w])=>{u[i]===void 0&&(g[i]=w)}),new Kn(o.segments,g)}}function hk(o,s,h){let u=0,g=s,i={match:!1,pathIndex:0,commandIndex:0};for(;g<o.segments.length;){if(u>=h.length)return i;let w=o.segments[g],O=h[u];if(yf(O))break;let B=`${O}`,j=u<h.length-1?h[u+1]:null;if(g>0&&B===void 0)break;if(B&&j&&typeof j=="object"&&j.outlets===void 0){if(!oT(B,j,w))return i;u+=2}else{if(!oT(B,{},w))return i;u++}g++}return{match:!0,pathIndex:g,commandIndex:u}}function n0(o,s,h){let u=o.segments.slice(0,s),g=0;for(;g<h.length;){let i=h[g];if(yf(i)){let B=dk(i.outlets);return new Kn(u,B)}if(g===0&&eg(h[0])){let B=o.segments[s];u.push(new ru(B.path,iT(h[0]))),g++;continue}let w=yf(i)?i.outlets[ln]:`${i}`,O=g<h.length-1?h[g+1]:null;w&&O&&eg(O)?(u.push(new ru(w,iT(O))),g+=2):(u.push(new ru(w,{})),g++)}return new Kn(u,{})}function dk(o){let s={};return Object.entries(o).forEach(([h,u])=>{typeof u=="string"&&(u=[u]),u!==null&&(s[h]=n0(new Kn([],{}),0,u))}),s}function iT(o){let s={};return Object.entries(o).forEach(([h,u])=>s[h]=`${u}`),s}function oT(o,s,h){return o==h.path&&Da(s,h.parameters)}var gf="imperative",xi=function(o){return o[o.NavigationStart=0]="NavigationStart",o[o.NavigationEnd=1]="NavigationEnd",o[o.NavigationCancel=2]="NavigationCancel",o[o.NavigationError=3]="NavigationError",o[o.RoutesRecognized=4]="RoutesRecognized",o[o.ResolveStart=5]="ResolveStart",o[o.ResolveEnd=6]="ResolveEnd",o[o.GuardsCheckStart=7]="GuardsCheckStart",o[o.GuardsCheckEnd=8]="GuardsCheckEnd",o[o.RouteConfigLoadStart=9]="RouteConfigLoadStart",o[o.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",o[o.ChildActivationStart=11]="ChildActivationStart",o[o.ChildActivationEnd=12]="ChildActivationEnd",o[o.ActivationStart=13]="ActivationStart",o[o.ActivationEnd=14]="ActivationEnd",o[o.Scroll=15]="Scroll",o[o.NavigationSkipped=16]="NavigationSkipped",o}(xi||{}),ps=class{constructor(s,h){this.id=s,this.url=h}},vf=class extends ps{constructor(s,h,u="imperative",g=null){super(s,h),this.type=xi.NavigationStart,this.navigationTrigger=u,this.restoredState=g}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},ou=class extends ps{constructor(s,h,u){super(s,h),this.urlAfterRedirects=u,this.type=xi.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Lo=function(o){return o[o.Redirect=0]="Redirect",o[o.SupersededByNewNavigation=1]="SupersededByNewNavigation",o[o.NoDataFromResolver=2]="NoDataFromResolver",o[o.GuardRejected=3]="GuardRejected",o}(Lo||{}),r0=function(o){return o[o.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",o[o.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",o}(r0||{}),Yl=class extends ps{constructor(s,h,u,g){super(s,h),this.reason=u,this.code=g,this.type=xi.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},su=class extends ps{constructor(s,h,u,g){super(s,h),this.reason=u,this.code=g,this.type=xi.NavigationSkipped}},xf=class extends ps{constructor(s,h,u,g){super(s,h),this.error=u,this.target=g,this.type=xi.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},ng=class extends ps{constructor(s,h,u,g){super(s,h),this.urlAfterRedirects=u,this.state=g,this.type=xi.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},i0=class extends ps{constructor(s,h,u,g){super(s,h),this.urlAfterRedirects=u,this.state=g,this.type=xi.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},o0=class extends ps{constructor(s,h,u,g,i){super(s,h),this.urlAfterRedirects=u,this.state=g,this.shouldActivate=i,this.type=xi.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},s0=class extends ps{constructor(s,h,u,g){super(s,h),this.urlAfterRedirects=u,this.state=g,this.type=xi.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},a0=class extends ps{constructor(s,h,u,g){super(s,h),this.urlAfterRedirects=u,this.state=g,this.type=xi.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},l0=class{constructor(s){this.route=s,this.type=xi.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},c0=class{constructor(s){this.route=s,this.type=xi.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},u0=class{constructor(s){this.snapshot=s,this.type=xi.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},h0=class{constructor(s){this.snapshot=s,this.type=xi.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},d0=class{constructor(s){this.snapshot=s,this.type=xi.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},f0=class{constructor(s){this.snapshot=s,this.type=xi.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var bf=class{},wf=class{constructor(s){this.url=s}};var p0=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new lg,this.attachRef=null}},lg=(()=>{let s=class s{constructor(){this.contexts=new Map}onChildOutletCreated(u,g){let i=this.getOrCreateContext(u);i.outlet=g,this.contexts.set(u,i)}onChildOutletDestroyed(u){let g=this.getContext(u);g&&(g.outlet=null,g.attachRef=null)}onOutletDeactivated(){let u=this.contexts;return this.contexts=new Map,u}onOutletReAttached(u){this.contexts=u}getOrCreateContext(u){let g=this.getContext(u);return g||(g=new p0,this.contexts.set(u,g)),g}getContext(u){return this.contexts.get(u)||null}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})(),rg=class{constructor(s){this._root=s}get root(){return this._root.value}parent(s){let h=this.pathFromRoot(s);return h.length>1?h[h.length-2]:null}children(s){let h=m0(s,this._root);return h?h.children.map(u=>u.value):[]}firstChild(s){let h=m0(s,this._root);return h&&h.children.length>0?h.children[0].value:null}siblings(s){let h=g0(s,this._root);return h.length<2?[]:h[h.length-2].children.map(g=>g.value).filter(g=>g!==s)}pathFromRoot(s){return g0(s,this._root).map(h=>h.value)}};function m0(o,s){if(o===s.value)return s;for(let h of s.children){let u=m0(o,h);if(u)return u}return null}function g0(o,s){if(o===s.value)return[s];for(let h of s.children){let u=g0(o,h);if(u.length)return u.unshift(s),u}return[]}var ko=class{constructor(s,h){this.value=s,this.children=h}toString(){return`TreeNode(${this.value})`}};function Sh(o){let s={};return o&&o.children.forEach(h=>s[h.value.outlet]=h),s}var ig=class extends rg{constructor(s,h){super(s),this.snapshot=h,I0(this,s)}toString(){return this.snapshot.toString()}};function bT(o){let s=fk(o),h=new _i([new ru("",{})]),u=new _i({}),g=new _i({}),i=new _i({}),w=new _i(""),O=new kh(h,u,i,w,g,ln,o,s.root);return O.snapshot=s.root,new ig(new ko(O,[]),s)}function fk(o){let s={},h={},u={},g="",i=new Ef([],s,u,g,h,ln,o,null,{});return new og("",new ko(i,[]))}var kh=class{constructor(s,h,u,g,i,w,O,B){this.urlSubject=s,this.paramsSubject=h,this.queryParamsSubject=u,this.fragmentSubject=g,this.dataSubject=i,this.outlet=w,this.component=O,this._futureSnapshot=B,this.title=this.dataSubject?.pipe(wn(j=>j[Df]))??on(void 0),this.url=s,this.params=h,this.queryParams=u,this.fragment=g,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(wn(s=>Rh(s))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(wn(s=>Rh(s))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function D0(o,s,h="emptyOnly"){let u,{routeConfig:g}=o;return s!==null&&(h==="always"||g?.path===""||!s.component&&!s.routeConfig?.loadComponent)?u={params:Dt(Dt({},s.params),o.params),data:Dt(Dt({},s.data),o.data),resolve:Dt(Dt(Dt(Dt({},o.data),s.data),g?.data),o._resolvedData)}:u={params:Dt({},o.params),data:Dt({},o.data),resolve:Dt(Dt({},o.data),o._resolvedData??{})},g&&ET(g)&&(u.resolve[Df]=g.title),u}var Ef=class{get title(){return this.data?.[Df]}constructor(s,h,u,g,i,w,O,B,j){this.url=s,this.params=h,this.queryParams=u,this.fragment=g,this.data=i,this.outlet=w,this.component=O,this.routeConfig=B,this._resolve=j}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Rh(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Rh(this.queryParams),this._queryParamMap}toString(){let s=this.url.map(u=>u.toString()).join("/"),h=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${s}', path:'${h}')`}},og=class extends rg{constructor(s,h){super(h),this.url=s,I0(this,h)}toString(){return wT(this._root)}};function I0(o,s){s.value._routerState=o,s.children.forEach(h=>I0(o,h))}function wT(o){let s=o.children.length>0?` { ${o.children.map(wT).join(", ")} } `:"";return`${o.value}${s}`}function Yv(o){if(o.snapshot){let s=o.snapshot,h=o._futureSnapshot;o.snapshot=h,Da(s.queryParams,h.queryParams)||o.queryParamsSubject.next(h.queryParams),s.fragment!==h.fragment&&o.fragmentSubject.next(h.fragment),Da(s.params,h.params)||o.paramsSubject.next(h.params),UO(s.url,h.url)||o.urlSubject.next(h.url),Da(s.data,h.data)||o.dataSubject.next(h.data)}else o.snapshot=o._futureSnapshot,o.dataSubject.next(o._futureSnapshot.data)}function _0(o,s){let h=Da(o.params,s.params)&&qO(o.url,s.url),u=!o.parent!=!s.parent;return h&&!u&&(!o.parent||_0(o.parent,s.parent))}function ET(o){return typeof o.title=="string"||o.title===null}var pk=(()=>{let s=class s{constructor(){this.activated=null,this._activatedRoute=null,this.name=ln,this.activateEvents=new Li,this.deactivateEvents=new Li,this.attachEvents=new Li,this.detachEvents=new Li,this.parentContexts=It(lg),this.location=It(zm),this.changeDetector=It(Dh),this.environmentInjector=It(cs),this.inputBinder=It(M0,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(u){if(u.name){let{firstChange:g,previousValue:i}=u.name;if(g)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(u){return this.parentContexts.getContext(u)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let u=this.parentContexts.getContext(this.name);u?.route&&(u.attachRef?this.attach(u.attachRef,u.route):this.activateWith(u.route,u.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Gt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Gt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Gt(4012,!1);this.location.detach();let u=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(u.instance),u}attach(u,g){this.activated=u,this._activatedRoute=g,this.location.insert(u.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(u.instance)}deactivate(){if(this.activated){let u=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(u)}}activateWith(u,g){if(this.isActivated)throw new Gt(4013,!1);this._activatedRoute=u;let i=this.location,O=u.snapshot.component,B=this.parentContexts.getOrCreateContext(this.name).children,j=new y0(u,B,i.injector);this.activated=i.createComponent(O,{index:i.length,injector:j,environmentInjector:g??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};s.\u0275fac=function(g){return new(g||s)},s.\u0275dir=us({type:s,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Jc]});let o=s;return o})(),y0=class o{__ngOutletInjector(s){return new o(this.route,this.childContexts,s)}constructor(s,h,u){this.route=s,this.childContexts=h,this.parent=u}get(s,h){return s===kh?this.route:s===lg?this.childContexts:this.parent.get(s,h)}},M0=new an("");function mk(o,s,h){let u=Cf(o,s._root,h?h._root:void 0);return new ig(u,s)}function Cf(o,s,h){if(h&&o.shouldReuseRoute(s.value,h.value.snapshot)){let u=h.value;u._futureSnapshot=s.value;let g=gk(o,s,h);return new ko(u,g)}else{if(o.shouldAttach(s.value)){let i=o.retrieve(s.value);if(i!==null){let w=i.route;return w.value._futureSnapshot=s.value,w.children=s.children.map(O=>Cf(o,O)),w}}let u=_k(s.value),g=s.children.map(i=>Cf(o,i));return new ko(u,g)}}function gk(o,s,h){return s.children.map(u=>{for(let g of h.children)if(o.shouldReuseRoute(u.value,g.value.snapshot))return Cf(o,u,g);return Cf(o,u)})}function _k(o){return new kh(new _i(o.url),new _i(o.params),new _i(o.queryParams),new _i(o.fragment),new _i(o.data),o.outlet,o.component,o)}var CT="ngNavigationCancelingError";function TT(o,s){let{redirectTo:h,navigationBehaviorOptions:u}=Oh(s)?{redirectTo:s,navigationBehaviorOptions:void 0}:s,g=DT(!1,Lo.Redirect);return g.url=h,g.navigationBehaviorOptions=u,g}function DT(o,s){let h=new Error(`NavigationCancelingError: ${o||""}`);return h[CT]=!0,h.cancellationCode=s,h}function yk(o){return IT(o)&&Oh(o.url)}function IT(o){return!!o&&o[CT]}var vk=(()=>{let s=class s{};s.\u0275fac=function(g){return new(g||s)},s.\u0275cmp=xh({type:s,selectors:[["ng-component"]],standalone:!0,features:[Th],decls:1,vars:0,template:function(g,i){g&1&&Zl(0,"router-outlet")},dependencies:[pk],encapsulation:2});let o=s;return o})();function xk(o,s){return o.providers&&!o._injector&&(o._injector=kv(o.providers,s,`Route: ${o.path}`)),o._injector??s}function S0(o){let s=o.children&&o.children.map(S0),h=s?dr(Dt({},o),{children:s}):Dt({},o);return!h.component&&!h.loadComponent&&(s||h.loadChildren)&&h.outlet&&h.outlet!==ln&&(h.component=vk),h}function Ia(o){return o.outlet||ln}function bk(o,s){let h=o.filter(u=>Ia(u)===s);return h.push(...o.filter(u=>Ia(u)!==s)),h}function If(o){if(!o)return null;if(o.routeConfig?._injector)return o.routeConfig._injector;for(let s=o.parent;s;s=s.parent){let h=s.routeConfig;if(h?._loadedInjector)return h._loadedInjector;if(h?._injector)return h._injector}return null}var wk=(o,s,h,u)=>wn(g=>(new v0(s,g.targetRouterState,g.currentRouterState,h,u).activate(o),g)),v0=class{constructor(s,h,u,g,i){this.routeReuseStrategy=s,this.futureState=h,this.currState=u,this.forwardEvent=g,this.inputBindingEnabled=i}activate(s){let h=this.futureState._root,u=this.currState?this.currState._root:null;this.deactivateChildRoutes(h,u,s),Yv(this.futureState.root),this.activateChildRoutes(h,u,s)}deactivateChildRoutes(s,h,u){let g=Sh(h);s.children.forEach(i=>{let w=i.value.outlet;this.deactivateRoutes(i,g[w],u),delete g[w]}),Object.values(g).forEach(i=>{this.deactivateRouteAndItsChildren(i,u)})}deactivateRoutes(s,h,u){let g=s.value,i=h?h.value:null;if(g===i)if(g.component){let w=u.getContext(g.outlet);w&&this.deactivateChildRoutes(s,h,w.children)}else this.deactivateChildRoutes(s,h,u);else i&&this.deactivateRouteAndItsChildren(h,u)}deactivateRouteAndItsChildren(s,h){s.value.component&&this.routeReuseStrategy.shouldDetach(s.value.snapshot)?this.detachAndStoreRouteSubtree(s,h):this.deactivateRouteAndOutlet(s,h)}detachAndStoreRouteSubtree(s,h){let u=h.getContext(s.value.outlet),g=u&&s.value.component?u.children:h,i=Sh(s);for(let w of Object.values(i))this.deactivateRouteAndItsChildren(w,g);if(u&&u.outlet){let w=u.outlet.detach(),O=u.children.onOutletDeactivated();this.routeReuseStrategy.store(s.value.snapshot,{componentRef:w,route:s,contexts:O})}}deactivateRouteAndOutlet(s,h){let u=h.getContext(s.value.outlet),g=u&&s.value.component?u.children:h,i=Sh(s);for(let w of Object.values(i))this.deactivateRouteAndItsChildren(w,g);u&&(u.outlet&&(u.outlet.deactivate(),u.children.onOutletDeactivated()),u.attachRef=null,u.route=null)}activateChildRoutes(s,h,u){let g=Sh(h);s.children.forEach(i=>{this.activateRoutes(i,g[i.value.outlet],u),this.forwardEvent(new f0(i.value.snapshot))}),s.children.length&&this.forwardEvent(new h0(s.value.snapshot))}activateRoutes(s,h,u){let g=s.value,i=h?h.value:null;if(Yv(g),g===i)if(g.component){let w=u.getOrCreateContext(g.outlet);this.activateChildRoutes(s,h,w.children)}else this.activateChildRoutes(s,h,u);else if(g.component){let w=u.getOrCreateContext(g.outlet);if(this.routeReuseStrategy.shouldAttach(g.snapshot)){let O=this.routeReuseStrategy.retrieve(g.snapshot);this.routeReuseStrategy.store(g.snapshot,null),w.children.onOutletReAttached(O.contexts),w.attachRef=O.componentRef,w.route=O.route.value,w.outlet&&w.outlet.attach(O.componentRef,O.route.value),Yv(O.route.value),this.activateChildRoutes(s,null,w.children)}else{let O=If(g.snapshot);w.attachRef=null,w.route=g,w.injector=O,w.outlet&&w.outlet.activateWith(g,w.injector),this.activateChildRoutes(s,null,w.children)}}else this.activateChildRoutes(s,null,u)}},sg=class{constructor(s){this.path=s,this.route=this.path[this.path.length-1]}},Ph=class{constructor(s,h){this.component=s,this.route=h}};function Ek(o,s,h){let u=o._root,g=s?s._root:null;return ff(u,g,h,[u.value])}function Ck(o){let s=o.routeConfig?o.routeConfig.canActivateChild:null;return!s||s.length===0?null:{node:o,guards:s}}function Fh(o,s){let h=Symbol(),u=s.get(o,h);return u===h?typeof o=="function"&&!V1(o)?o:s.get(o):u}function ff(o,s,h,u,g={canDeactivateChecks:[],canActivateChecks:[]}){let i=Sh(s);return o.children.forEach(w=>{Tk(w,i[w.value.outlet],h,u.concat([w.value]),g),delete i[w.value.outlet]}),Object.entries(i).forEach(([w,O])=>_f(O,h.getContext(w),g)),g}function Tk(o,s,h,u,g={canDeactivateChecks:[],canActivateChecks:[]}){let i=o.value,w=s?s.value:null,O=h?h.getContext(o.value.outlet):null;if(w&&i.routeConfig===w.routeConfig){let B=Dk(w,i,i.routeConfig.runGuardsAndResolvers);B?g.canActivateChecks.push(new sg(u)):(i.data=w.data,i._resolvedData=w._resolvedData),i.component?ff(o,s,O?O.children:null,u,g):ff(o,s,h,u,g),B&&O&&O.outlet&&O.outlet.isActivated&&g.canDeactivateChecks.push(new Ph(O.outlet.component,w))}else w&&_f(s,O,g),g.canActivateChecks.push(new sg(u)),i.component?ff(o,null,O?O.children:null,u,g):ff(o,null,h,u,g);return g}function Dk(o,s,h){if(typeof h=="function")return h(o,s);switch(h){case"pathParamsChange":return!iu(o.url,s.url);case"pathParamsOrQueryParamsChange":return!iu(o.url,s.url)||!Da(o.queryParams,s.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!_0(o,s)||!Da(o.queryParams,s.queryParams);case"paramsChange":default:return!_0(o,s)}}function _f(o,s,h){let u=Sh(o),g=o.value;Object.entries(u).forEach(([i,w])=>{g.component?s?_f(w,s.children.getContext(i),h):_f(w,null,h):_f(w,s,h)}),g.component?s&&s.outlet&&s.outlet.isActivated?h.canDeactivateChecks.push(new Ph(s.outlet.component,g)):h.canDeactivateChecks.push(new Ph(null,g)):h.canDeactivateChecks.push(new Ph(null,g))}function Mf(o){return typeof o=="function"}function Ik(o){return typeof o=="boolean"}function Mk(o){return o&&Mf(o.canLoad)}function Sk(o){return o&&Mf(o.canActivate)}function Ak(o){return o&&Mf(o.canActivateChild)}function Pk(o){return o&&Mf(o.canDeactivate)}function Rk(o){return o&&Mf(o.canMatch)}function MT(o){return o instanceof tl||o?.name==="EmptyError"}var Xm=Symbol("INITIAL_VALUE");function Lh(){return Vs(o=>Qp(o.map(s=>s.pipe(nl(1),ay(Xm)))).pipe(wn(s=>{for(let h of s)if(h!==!0){if(h===Xm)return Xm;if(h===!1||h instanceof Xl)return h}return!0}),Bs(s=>s!==Xm),nl(1)))}function Ok(o,s){return Qr(h=>{let{targetSnapshot:u,currentSnapshot:g,guards:{canActivateChecks:i,canDeactivateChecks:w}}=h;return w.length===0&&i.length===0?on(dr(Dt({},h),{guardsResult:!0})):kk(w,u,g,o).pipe(Qr(O=>O&&Ik(O)?Lk(u,i,o,s):on(O)),wn(O=>dr(Dt({},h),{guardsResult:O})))})}function kk(o,s,h,u){return Fr(o).pipe(Qr(g=>Vk(g.component,g.route,h,s,u)),va(g=>g!==!0,!0))}function Lk(o,s,h,u){return Fr(s).pipe(nh(g=>th(Nk(g.route.parent,u),Fk(g.route,u),Bk(o,g.path,h),zk(o,g.route,h))),va(g=>g!==!0,!0))}function Fk(o,s){return o!==null&&s&&s(new d0(o)),on(!0)}function Nk(o,s){return o!==null&&s&&s(new u0(o)),on(!0)}function zk(o,s,h){let u=s.routeConfig?s.routeConfig.canActivate:null;if(!u||u.length===0)return on(!0);let g=u.map(i=>em(()=>{let w=If(s)??h,O=Fh(i,w),B=Sk(O)?O.canActivate(s,o):Kc(w,()=>O(s,o));return Kl(B).pipe(va())}));return on(g).pipe(Lh())}function Bk(o,s,h){let u=s[s.length-1],i=s.slice(0,s.length-1).reverse().map(w=>Ck(w)).filter(w=>w!==null).map(w=>em(()=>{let O=w.guards.map(B=>{let j=If(w.node)??h,ie=Fh(B,j),_e=Ak(ie)?ie.canActivateChild(u,o):Kc(j,()=>ie(u,o));return Kl(_e).pipe(va())});return on(O).pipe(Lh())}));return on(i).pipe(Lh())}function Vk(o,s,h,u,g){let i=s&&s.routeConfig?s.routeConfig.canDeactivate:null;if(!i||i.length===0)return on(!0);let w=i.map(O=>{let B=If(s)??g,j=Fh(O,B),ie=Pk(j)?j.canDeactivate(o,s,h,u):Kc(B,()=>j(o,s,h,u));return Kl(ie).pipe(va())});return on(w).pipe(Lh())}function jk(o,s,h,u){let g=s.canLoad;if(g===void 0||g.length===0)return on(!0);let i=g.map(w=>{let O=Fh(w,o),B=Mk(O)?O.canLoad(s,h):Kc(o,()=>O(s,h));return Kl(B)});return on(i).pipe(Lh(),ST(u))}function ST(o){return K_(yi(s=>{if(Oh(s))throw TT(o,s)}),wn(s=>s===!0))}function Uk(o,s,h,u){let g=s.canMatch;if(!g||g.length===0)return on(!0);let i=g.map(w=>{let O=Fh(w,o),B=Rk(O)?O.canMatch(s,h):Kc(o,()=>O(s,h));return Kl(B)});return on(i).pipe(Lh(),ST(u))}var Tf=class{constructor(s){this.segmentGroup=s||null}},ag=class extends Error{constructor(s){super(),this.urlTree=s}};function Mh(o){return eh(new Tf(o))}function $k(o){return eh(new Gt(4e3,!1))}function Gk(o){return eh(DT(!1,Lo.GuardRejected))}var x0=class{constructor(s,h){this.urlSerializer=s,this.urlTree=h}lineralizeSegments(s,h){let u=[],g=h.root;for(;;){if(u=u.concat(g.segments),g.numberOfChildren===0)return on(u);if(g.numberOfChildren>1||!g.children[ln])return $k(s.redirectTo);g=g.children[ln]}}applyRedirectCommands(s,h,u){let g=this.applyRedirectCreateUrlTree(h,this.urlSerializer.parse(h),s,u);if(h.startsWith("/"))throw new ag(g);return g}applyRedirectCreateUrlTree(s,h,u,g){let i=this.createSegmentGroup(s,h.root,u,g);return new Xl(i,this.createQueryParams(h.queryParams,this.urlTree.queryParams),h.fragment)}createQueryParams(s,h){let u={};return Object.entries(s).forEach(([g,i])=>{if(typeof i=="string"&&i.startsWith(":")){let O=i.substring(1);u[g]=h[O]}else u[g]=i}),u}createSegmentGroup(s,h,u,g){let i=this.createSegments(s,h.segments,u,g),w={};return Object.entries(h.children).forEach(([O,B])=>{w[O]=this.createSegmentGroup(s,B,u,g)}),new Kn(i,w)}createSegments(s,h,u,g){return h.map(i=>i.path.startsWith(":")?this.findPosParam(s,i,g):this.findOrReturn(i,u))}findPosParam(s,h,u){let g=u[h.path.substring(1)];if(!g)throw new Gt(4001,!1);return g}findOrReturn(s,h){let u=0;for(let g of h){if(g.path===s.path)return h.splice(u),g;u++}return s}},b0={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Hk(o,s,h,u,g){let i=A0(o,s,h);return i.matched?(u=xk(s,u),Uk(u,s,h,g).pipe(wn(w=>w===!0?i:Dt({},b0)))):on(i)}function A0(o,s,h){if(s.path==="**")return qk(h);if(s.path==="")return s.pathMatch==="full"&&(o.hasChildren()||h.length>0)?Dt({},b0):{matched:!0,consumedSegments:[],remainingSegments:h,parameters:{},positionalParamSegments:{}};let g=(s.matcher||jO)(h,o,s);if(!g)return Dt({},b0);let i={};Object.entries(g.posParams??{}).forEach(([O,B])=>{i[O]=B.path});let w=g.consumed.length>0?Dt(Dt({},i),g.consumed[g.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:g.consumed,remainingSegments:h.slice(g.consumed.length),parameters:w,positionalParamSegments:g.posParams??{}}}function qk(o){return{matched:!0,parameters:o.length>0?lT(o).parameters:{},consumedSegments:o,remainingSegments:[],positionalParamSegments:{}}}function sT(o,s,h,u){return h.length>0&&Xk(o,h,u)?{segmentGroup:new Kn(s,Zk(u,new Kn(h,o.children))),slicedSegments:[]}:h.length===0&&Yk(o,h,u)?{segmentGroup:new Kn(o.segments,Wk(o,h,u,o.children)),slicedSegments:h}:{segmentGroup:new Kn(o.segments,o.children),slicedSegments:h}}function Wk(o,s,h,u){let g={};for(let i of h)if(cg(o,s,i)&&!u[Ia(i)]){let w=new Kn([],{});g[Ia(i)]=w}return Dt(Dt({},u),g)}function Zk(o,s){let h={};h[ln]=s;for(let u of o)if(u.path===""&&Ia(u)!==ln){let g=new Kn([],{});h[Ia(u)]=g}return h}function Xk(o,s,h){return h.some(u=>cg(o,s,u)&&Ia(u)!==ln)}function Yk(o,s,h){return h.some(u=>cg(o,s,u))}function cg(o,s,h){return(o.hasChildren()||s.length>0)&&h.pathMatch==="full"?!1:h.path===""}function Kk(o,s,h,u){return Ia(o)!==u&&(u===ln||!cg(s,h,o))?!1:A0(s,o,h).matched}function Jk(o,s,h){return s.length===0&&!o.children[h]}var w0=class{};function Qk(o,s,h,u,g,i,w="emptyOnly"){return new E0(o,s,h,u,g,w,i).recognize()}var eL=31,E0=class{constructor(s,h,u,g,i,w,O){this.injector=s,this.configLoader=h,this.rootComponentType=u,this.config=g,this.urlTree=i,this.paramsInheritanceStrategy=w,this.urlSerializer=O,this.applyRedirects=new x0(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(s){return new Gt(4002,`'${s.segmentGroup}'`)}recognize(){let s=sT(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(s).pipe(wn(h=>{let u=new Ef([],Object.freeze({}),Object.freeze(Dt({},this.urlTree.queryParams)),this.urlTree.fragment,{},ln,this.rootComponentType,null,{}),g=new ko(u,h),i=new og("",g),w=sk(u,[],this.urlTree.queryParams,this.urlTree.fragment);return w.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(w),this.inheritParamsAndData(i._root,null),{state:i,tree:w}}))}match(s){return this.processSegmentGroup(this.injector,this.config,s,ln).pipe(Vl(u=>{if(u instanceof ag)return this.urlTree=u.urlTree,this.match(u.urlTree.root);throw u instanceof Tf?this.noMatchError(u):u}))}inheritParamsAndData(s,h){let u=s.value,g=D0(u,h,this.paramsInheritanceStrategy);u.params=Object.freeze(g.params),u.data=Object.freeze(g.data),s.children.forEach(i=>this.inheritParamsAndData(i,u))}processSegmentGroup(s,h,u,g){return u.segments.length===0&&u.hasChildren()?this.processChildren(s,h,u):this.processSegment(s,h,u,u.segments,g,!0).pipe(wn(i=>i instanceof ko?[i]:[]))}processChildren(s,h,u){let g=[];for(let i of Object.keys(u.children))i==="primary"?g.unshift(i):g.push(i);return Fr(g).pipe(nh(i=>{let w=u.children[i],O=bk(h,i);return this.processSegmentGroup(s,O,w,i)}),sy((i,w)=>(i.push(...w),i)),jl(null),oy(),Qr(i=>{if(i===null)return Mh(u);let w=AT(i);return tL(w),on(w)}))}processSegment(s,h,u,g,i,w){return Fr(h).pipe(nh(O=>this.processSegmentAgainstRoute(O._injector??s,h,O,u,g,i,w).pipe(Vl(B=>{if(B instanceof Tf)return on(null);throw B}))),va(O=>!!O),Vl(O=>{if(MT(O))return Jk(u,g,i)?on(new w0):Mh(u);throw O}))}processSegmentAgainstRoute(s,h,u,g,i,w,O){return Kk(u,g,i,w)?u.redirectTo===void 0?this.matchSegmentAgainstRoute(s,g,u,i,w):this.allowRedirects&&O?this.expandSegmentAgainstRouteUsingRedirect(s,g,h,u,i,w):Mh(g):Mh(g)}expandSegmentAgainstRouteUsingRedirect(s,h,u,g,i,w){let{matched:O,consumedSegments:B,positionalParamSegments:j,remainingSegments:ie}=A0(h,g,i);if(!O)return Mh(h);g.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>eL&&(this.allowRedirects=!1));let _e=this.applyRedirects.applyRedirectCommands(B,g.redirectTo,j);return this.applyRedirects.lineralizeSegments(g,_e).pipe(Qr(Be=>this.processSegment(s,u,h,Be.concat(ie),w,!1)))}matchSegmentAgainstRoute(s,h,u,g,i){let w=Hk(h,u,g,s,this.urlSerializer);return u.path==="**"&&(h.children={}),w.pipe(Vs(O=>O.matched?(s=u._injector??s,this.getChildConfig(s,u,g).pipe(Vs(({routes:B})=>{let j=u._loadedInjector??s,{consumedSegments:ie,remainingSegments:_e,parameters:Be}=O,Re=new Ef(ie,Be,Object.freeze(Dt({},this.urlTree.queryParams)),this.urlTree.fragment,rL(u),Ia(u),u.component??u._loadedComponent??null,u,iL(u)),{segmentGroup:tt,slicedSegments:Mt}=sT(h,ie,_e,B);if(Mt.length===0&&tt.hasChildren())return this.processChildren(j,B,tt).pipe(wn(Ct=>Ct===null?null:new ko(Re,Ct)));if(B.length===0&&Mt.length===0)return on(new ko(Re,[]));let En=Ia(u)===i;return this.processSegment(j,B,tt,Mt,En?ln:i,!0).pipe(wn(Ct=>new ko(Re,Ct instanceof ko?[Ct]:[])))}))):Mh(h)))}getChildConfig(s,h,u){return h.children?on({routes:h.children,injector:s}):h.loadChildren?h._loadedRoutes!==void 0?on({routes:h._loadedRoutes,injector:h._loadedInjector}):jk(s,h,u,this.urlSerializer).pipe(Qr(g=>g?this.configLoader.loadChildren(s,h).pipe(yi(i=>{h._loadedRoutes=i.routes,h._loadedInjector=i.injector})):Gk(h))):on({routes:[],injector:s})}};function tL(o){o.sort((s,h)=>s.value.outlet===ln?-1:h.value.outlet===ln?1:s.value.outlet.localeCompare(h.value.outlet))}function nL(o){let s=o.value.routeConfig;return s&&s.path===""}function AT(o){let s=[],h=new Set;for(let u of o){if(!nL(u)){s.push(u);continue}let g=s.find(i=>u.value.routeConfig===i.value.routeConfig);g!==void 0?(g.children.push(...u.children),h.add(g)):s.push(u)}for(let u of h){let g=AT(u.children);s.push(new ko(u.value,g))}return s.filter(u=>!h.has(u))}function rL(o){return o.data||{}}function iL(o){return o.resolve||{}}function oL(o,s,h,u,g,i){return Qr(w=>Qk(o,s,h,u,w.extractedUrl,g,i).pipe(wn(({state:O,tree:B})=>dr(Dt({},w),{targetSnapshot:O,urlAfterRedirects:B}))))}function sL(o,s){return Qr(h=>{let{targetSnapshot:u,guards:{canActivateChecks:g}}=h;if(!g.length)return on(h);let i=new Set(g.map(B=>B.route)),w=new Set;for(let B of i)if(!w.has(B))for(let j of PT(B))w.add(j);let O=0;return Fr(w).pipe(nh(B=>i.has(B)?aL(B,u,o,s):(B.data=D0(B,B.parent,o).resolve,on(void 0))),yi(()=>O++),rh(1),Qr(B=>O===w.size?on(h):Ro))})}function PT(o){let s=o.children.map(h=>PT(h)).flat();return[o,...s]}function aL(o,s,h,u){let g=o.routeConfig,i=o._resolve;return g?.title!==void 0&&!ET(g)&&(i[Df]=g.title),lL(i,o,s,u).pipe(wn(w=>(o._resolvedData=w,o.data=D0(o,o.parent,h).resolve,null)))}function lL(o,s,h,u){let g=Qv(o);if(g.length===0)return on({});let i={};return Fr(g).pipe(Qr(w=>cL(o[w],s,h,u).pipe(va(),yi(O=>{i[w]=O}))),rh(1),iy(i),Vl(w=>MT(w)?Ro:eh(w)))}function cL(o,s,h,u){let g=If(s)??u,i=Fh(o,g),w=i.resolve?i.resolve(s,h):Kc(g,()=>i(s,h));return Kl(w)}function Kv(o){return Vs(s=>{let h=o(s);return h?Fr(h).pipe(wn(()=>s)):on(s)})}var RT=(()=>{let s=class s{buildTitle(u){let g,i=u.root;for(;i!==void 0;)g=this.getResolvedTitleForRoute(i)??g,i=i.children.find(w=>w.outlet===ln);return g}getResolvedTitleForRoute(u){return u.data[Df]}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:()=>It(uL),providedIn:"root"});let o=s;return o})(),uL=(()=>{let s=class s extends RT{constructor(u){super(),this.title=u}updateTitle(u){let g=this.buildTitle(u);g!==void 0&&this.title.setTitle(g)}};s.\u0275fac=function(g){return new(g||s)(Pn(tT))},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})(),P0=new an("",{providedIn:"root",factory:()=>({})}),R0=new an(""),hL=(()=>{let s=class s{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=It(Nv)}loadComponent(u){if(this.componentLoaders.get(u))return this.componentLoaders.get(u);if(u._loadedComponent)return on(u._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(u);let g=Kl(u.loadComponent()).pipe(wn(OT),yi(w=>{this.onLoadEndListener&&this.onLoadEndListener(u),u._loadedComponent=w}),Ud(()=>{this.componentLoaders.delete(u)})),i=new Qu(g,()=>new qi).pipe(Ju());return this.componentLoaders.set(u,i),i}loadChildren(u,g){if(this.childrenLoaders.get(g))return this.childrenLoaders.get(g);if(g._loadedRoutes)return on({routes:g._loadedRoutes,injector:g._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(g);let w=dL(g,this.compiler,u,this.onLoadEndListener).pipe(Ud(()=>{this.childrenLoaders.delete(g)})),O=new Qu(w,()=>new qi).pipe(Ju());return this.childrenLoaders.set(g,O),O}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();function dL(o,s,h,u){return Kl(o.loadChildren()).pipe(wn(OT),Qr(g=>g instanceof ef||Array.isArray(g)?on(g):Fr(s.compileModuleAsync(g))),wn(g=>{u&&u(o);let i,w,O=!1;return Array.isArray(g)?(w=g,O=!0):(i=g.create(h).injector,w=i.get(R0,[],{optional:!0,self:!0}).flat()),{routes:w.map(S0),injector:i}}))}function fL(o){return o&&typeof o=="object"&&"default"in o}function OT(o){return fL(o)?o.default:o}var O0=(()=>{let s=class s{};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:()=>It(pL),providedIn:"root"});let o=s;return o})(),pL=(()=>{let s=class s{shouldProcessUrl(u){return!0}extract(u){return u}merge(u,g){return u}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})(),mL=new an("");var gL=(()=>{let s=class s{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new qi,this.transitionAbortSubject=new qi,this.configLoader=It(hL),this.environmentInjector=It(cs),this.urlSerializer=It(T0),this.rootContexts=It(lg),this.location=It(lf),this.inputBindingEnabled=It(M0,{optional:!0})!==null,this.titleStrategy=It(RT),this.options=It(P0,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=It(O0),this.createViewTransition=It(mL,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>on(void 0),this.rootComponentType=null;let u=i=>this.events.next(new l0(i)),g=i=>this.events.next(new c0(i));this.configLoader.onLoadEndListener=g,this.configLoader.onLoadStartListener=u}complete(){this.transitions?.complete()}handleNavigationRequest(u){let g=++this.navigationId;this.transitions?.next(dr(Dt(Dt({},this.transitions.value),u),{id:g}))}setupNavigations(u,g,i){return this.transitions=new _i({id:0,currentUrlTree:g,currentRawUrl:g,extractedUrl:this.urlHandlingStrategy.extract(g),urlAfterRedirects:this.urlHandlingStrategy.extract(g),rawUrl:g,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:gf,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Bs(w=>w.id!==0),wn(w=>dr(Dt({},w),{extractedUrl:this.urlHandlingStrategy.extract(w.rawUrl)})),Vs(w=>{let O=!1,B=!1;return on(w).pipe(Vs(j=>{if(this.navigationId>w.id)return this.cancelNavigationTransition(w,"",Lo.SupersededByNewNavigation),Ro;this.currentTransition=w,this.currentNavigation={id:j.id,initialUrl:j.rawUrl,extractedUrl:j.extractedUrl,trigger:j.source,extras:j.extras,previousNavigation:this.lastSuccessfulNavigation?dr(Dt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let ie=!u.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),_e=j.extras.onSameUrlNavigation??u.onSameUrlNavigation;if(!ie&&_e!=="reload"){let Be="";return this.events.next(new su(j.id,this.urlSerializer.serialize(j.rawUrl),Be,r0.IgnoredSameUrlNavigation)),j.resolve(null),Ro}if(this.urlHandlingStrategy.shouldProcessUrl(j.rawUrl))return on(j).pipe(Vs(Be=>{let Re=this.transitions?.getValue();return this.events.next(new vf(Be.id,this.urlSerializer.serialize(Be.extractedUrl),Be.source,Be.restoredState)),Re!==this.transitions?.getValue()?Ro:Promise.resolve(Be)}),oL(this.environmentInjector,this.configLoader,this.rootComponentType,u.config,this.urlSerializer,this.paramsInheritanceStrategy),yi(Be=>{w.targetSnapshot=Be.targetSnapshot,w.urlAfterRedirects=Be.urlAfterRedirects,this.currentNavigation=dr(Dt({},this.currentNavigation),{finalUrl:Be.urlAfterRedirects});let Re=new ng(Be.id,this.urlSerializer.serialize(Be.extractedUrl),this.urlSerializer.serialize(Be.urlAfterRedirects),Be.targetSnapshot);this.events.next(Re)}));if(ie&&this.urlHandlingStrategy.shouldProcessUrl(j.currentRawUrl)){let{id:Be,extractedUrl:Re,source:tt,restoredState:Mt,extras:En}=j,Ct=new vf(Be,this.urlSerializer.serialize(Re),tt,Mt);this.events.next(Ct);let gn=bT(this.rootComponentType).snapshot;return this.currentTransition=w=dr(Dt({},j),{targetSnapshot:gn,urlAfterRedirects:Re,extras:dr(Dt({},En),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=Re,on(w)}else{let Be="";return this.events.next(new su(j.id,this.urlSerializer.serialize(j.extractedUrl),Be,r0.IgnoredByUrlHandlingStrategy)),j.resolve(null),Ro}}),yi(j=>{let ie=new i0(j.id,this.urlSerializer.serialize(j.extractedUrl),this.urlSerializer.serialize(j.urlAfterRedirects),j.targetSnapshot);this.events.next(ie)}),wn(j=>(this.currentTransition=w=dr(Dt({},j),{guards:Ek(j.targetSnapshot,j.currentSnapshot,this.rootContexts)}),w)),Ok(this.environmentInjector,j=>this.events.next(j)),yi(j=>{if(w.guardsResult=j.guardsResult,Oh(j.guardsResult))throw TT(this.urlSerializer,j.guardsResult);let ie=new o0(j.id,this.urlSerializer.serialize(j.extractedUrl),this.urlSerializer.serialize(j.urlAfterRedirects),j.targetSnapshot,!!j.guardsResult);this.events.next(ie)}),Bs(j=>j.guardsResult?!0:(this.cancelNavigationTransition(j,"",Lo.GuardRejected),!1)),Kv(j=>{if(j.guards.canActivateChecks.length)return on(j).pipe(yi(ie=>{let _e=new s0(ie.id,this.urlSerializer.serialize(ie.extractedUrl),this.urlSerializer.serialize(ie.urlAfterRedirects),ie.targetSnapshot);this.events.next(_e)}),Vs(ie=>{let _e=!1;return on(ie).pipe(sL(this.paramsInheritanceStrategy,this.environmentInjector),yi({next:()=>_e=!0,complete:()=>{_e||this.cancelNavigationTransition(ie,"",Lo.NoDataFromResolver)}}))}),yi(ie=>{let _e=new a0(ie.id,this.urlSerializer.serialize(ie.extractedUrl),this.urlSerializer.serialize(ie.urlAfterRedirects),ie.targetSnapshot);this.events.next(_e)}))}),Kv(j=>{let ie=_e=>{let Be=[];_e.routeConfig?.loadComponent&&!_e.routeConfig._loadedComponent&&Be.push(this.configLoader.loadComponent(_e.routeConfig).pipe(yi(Re=>{_e.component=Re}),wn(()=>{})));for(let Re of _e.children)Be.push(...ie(Re));return Be};return Qp(ie(j.targetSnapshot.root)).pipe(jl(null),nl(1))}),Kv(()=>this.afterPreactivation()),Vs(()=>{let{currentSnapshot:j,targetSnapshot:ie}=w,_e=this.createViewTransition?.(this.environmentInjector,j.root,ie.root);return _e?Fr(_e).pipe(wn(()=>w)):on(w)}),wn(j=>{let ie=mk(u.routeReuseStrategy,j.targetSnapshot,j.currentRouterState);return this.currentTransition=w=dr(Dt({},j),{targetRouterState:ie}),this.currentNavigation.targetRouterState=ie,w}),yi(()=>{this.events.next(new bf)}),wk(this.rootContexts,u.routeReuseStrategy,j=>this.events.next(j),this.inputBindingEnabled),nl(1),yi({next:j=>{O=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new ou(j.id,this.urlSerializer.serialize(j.extractedUrl),this.urlSerializer.serialize(j.urlAfterRedirects))),this.titleStrategy?.updateTitle(j.targetRouterState.snapshot),j.resolve(!0)},complete:()=>{O=!0}}),ly(this.transitionAbortSubject.pipe(yi(j=>{throw j}))),Ud(()=>{!O&&!B&&this.cancelNavigationTransition(w,"",Lo.SupersededByNewNavigation),this.currentTransition?.id===w.id&&(this.currentNavigation=null,this.currentTransition=null)}),Vl(j=>{if(B=!0,IT(j))this.events.next(new Yl(w.id,this.urlSerializer.serialize(w.extractedUrl),j.message,j.cancellationCode)),yk(j)?this.events.next(new wf(j.url)):w.resolve(!1);else{this.events.next(new xf(w.id,this.urlSerializer.serialize(w.extractedUrl),j,w.targetSnapshot??void 0));try{w.resolve(u.errorHandler(j))}catch(ie){this.options.resolveNavigationPromiseOnError?w.resolve(!1):w.reject(ie)}}return Ro}))}))}cancelNavigationTransition(u,g,i){let w=new Yl(u.id,this.urlSerializer.serialize(u.extractedUrl),g,i);this.events.next(w),u.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();function _L(o){return o!==gf}var yL=(()=>{let s=class s{};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:()=>It(vL),providedIn:"root"});let o=s;return o})(),C0=class{shouldDetach(s){return!1}store(s,h){}shouldAttach(s){return!1}retrieve(s){return null}shouldReuseRoute(s,h){return s.routeConfig===h.routeConfig}},vL=(()=>{let s=class s extends C0{};s.\u0275fac=(()=>{let u;return function(i){return(u||(u=sf(s)))(i||s)}})(),s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})(),kT=(()=>{let s=class s{};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:()=>It(xL),providedIn:"root"});let o=s;return o})(),xL=(()=>{let s=class s extends kT{constructor(){super(...arguments),this.location=It(lf),this.urlSerializer=It(T0),this.options=It(P0,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=It(O0),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Xl,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=bT(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(u){return this.location.subscribe(g=>{g.type==="popstate"&&u(g.url,g.state)})}handleRouterEvent(u,g){if(u instanceof vf)this.stateMemento=this.createStateMemento();else if(u instanceof su)this.rawUrlTree=g.initialUrl;else if(u instanceof ng){if(this.urlUpdateStrategy==="eager"&&!g.extras.skipLocationChange){let i=this.urlHandlingStrategy.merge(g.finalUrl,g.initialUrl);this.setBrowserUrl(i,g)}}else u instanceof bf?(this.currentUrlTree=g.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(g.finalUrl,g.initialUrl),this.routerState=g.targetRouterState,this.urlUpdateStrategy==="deferred"&&(g.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,g))):u instanceof Yl&&(u.code===Lo.GuardRejected||u.code===Lo.NoDataFromResolver)?this.restoreHistory(g):u instanceof xf?this.restoreHistory(g,!0):u instanceof ou&&(this.lastSuccessfulId=u.id,this.currentPageId=this.browserPageId)}setBrowserUrl(u,g){let i=this.urlSerializer.serialize(u);if(this.location.isCurrentPathEqualTo(i)||g.extras.replaceUrl){let w=this.browserPageId,O=Dt(Dt({},g.extras.state),this.generateNgRouterState(g.id,w));this.location.replaceState(i,"",O)}else{let w=Dt(Dt({},g.extras.state),this.generateNgRouterState(g.id,this.browserPageId+1));this.location.go(i,"",w)}}restoreHistory(u,g=!1){if(this.canceledNavigationResolution==="computed"){let i=this.browserPageId,w=this.currentPageId-i;w!==0?this.location.historyGo(w):this.currentUrlTree===u.finalUrl&&w===0&&(this.resetState(u),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(g&&this.resetState(u),this.resetUrlToCurrentUrlTree())}resetState(u){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,u.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(u,g){return this.canceledNavigationResolution==="computed"?{navigationId:u,\u0275routerPageId:g}:{navigationId:u}}};s.\u0275fac=(()=>{let u;return function(i){return(u||(u=sf(s)))(i||s)}})(),s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})(),pf=function(o){return o[o.COMPLETE=0]="COMPLETE",o[o.FAILED=1]="FAILED",o[o.REDIRECTING=2]="REDIRECTING",o}(pf||{});function bL(o,s){o.events.pipe(Bs(h=>h instanceof ou||h instanceof Yl||h instanceof xf||h instanceof su),wn(h=>h instanceof ou||h instanceof su?pf.COMPLETE:(h instanceof Yl?h.code===Lo.Redirect||h.code===Lo.SupersededByNewNavigation:!1)?pf.REDIRECTING:pf.FAILED),Bs(h=>h!==pf.REDIRECTING),nl(1)).subscribe(()=>{s()})}function wL(o){throw o}var EL={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},CL={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},LT=(()=>{let s=class s{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=It(Um),this.stateManager=It(kT),this.options=It(P0,{optional:!0})||{},this.pendingTasks=It(Bm),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=It(gL),this.urlSerializer=It(T0),this.location=It(lf),this.urlHandlingStrategy=It(O0),this._events=new qi,this.errorHandler=this.options.errorHandler||wL,this.navigated=!1,this.routeReuseStrategy=It(yL),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=It(R0,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!It(M0,{optional:!0}),this.eventsSubscription=new Jr,this.isNgZoneEnabled=It(Gr)instanceof Gr&&Gr.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:u=>{this.console.warn(u)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let u=this.navigationTransitions.events.subscribe(g=>{try{let i=this.navigationTransitions.currentTransition,w=this.navigationTransitions.currentNavigation;if(i!==null&&w!==null){if(this.stateManager.handleRouterEvent(g,w),g instanceof Yl&&g.code!==Lo.Redirect&&g.code!==Lo.SupersededByNewNavigation)this.navigated=!0;else if(g instanceof ou)this.navigated=!0;else if(g instanceof wf){let O=this.urlHandlingStrategy.merge(g.url,i.currentRawUrl),B={info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||_L(i.source)};this.scheduleNavigation(O,gf,null,B,{resolve:i.resolve,reject:i.reject,promise:i.promise})}}DL(g)&&this._events.next(g)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(u)}resetRootComponentType(u){this.routerState.root.component=u,this.navigationTransitions.rootComponentType=u}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),gf,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((u,g)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(u,"popstate",g)},0)})}navigateToSyncWithBrowser(u,g,i){let w={replaceUrl:!0},O=i?.navigationId?i:null;if(i){let j=Dt({},i);delete j.navigationId,delete j.\u0275routerPageId,Object.keys(j).length!==0&&(w.state=j)}let B=this.parseUrl(u);this.scheduleNavigation(B,g,O,w)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(u){this.config=u.map(S0),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(u,g={}){let{relativeTo:i,queryParams:w,fragment:O,queryParamsHandling:B,preserveFragment:j}=g,ie=j?this.currentUrlTree.fragment:O,_e=null;switch(B){case"merge":_e=Dt(Dt({},this.currentUrlTree.queryParams),w);break;case"preserve":_e=this.currentUrlTree.queryParams;break;default:_e=w||null}_e!==null&&(_e=this.removeEmptyProps(_e));let Be;try{let Re=i?i.snapshot:this.routerState.snapshot.root;Be=_T(Re)}catch{(typeof u[0]!="string"||!u[0].startsWith("/"))&&(u=[]),Be=this.currentUrlTree.root}return yT(Be,u,_e,ie??null)}navigateByUrl(u,g={skipLocationChange:!1}){let i=Oh(u)?u:this.parseUrl(u),w=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(w,gf,null,g)}navigate(u,g={skipLocationChange:!1}){return TL(u),this.navigateByUrl(this.createUrlTree(u,g),g)}serializeUrl(u){return this.urlSerializer.serialize(u)}parseUrl(u){try{return this.urlSerializer.parse(u)}catch{return this.urlSerializer.parse("/")}}isActive(u,g){let i;if(g===!0?i=Dt({},EL):g===!1?i=Dt({},CL):i=g,Oh(u))return nT(this.currentUrlTree,u,i);let w=this.parseUrl(u);return nT(this.currentUrlTree,w,i)}removeEmptyProps(u){return Object.entries(u).reduce((g,[i,w])=>(w!=null&&(g[i]=w),g),{})}scheduleNavigation(u,g,i,w,O){if(this.disposed)return Promise.resolve(!1);let B,j,ie;O?(B=O.resolve,j=O.reject,ie=O.promise):ie=new Promise((Be,Re)=>{B=Be,j=Re});let _e=this.pendingTasks.add();return bL(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(_e))}),this.navigationTransitions.handleNavigationRequest({source:g,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:u,extras:w,resolve:B,reject:j,promise:ie,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ie.catch(Be=>Promise.reject(Be))}};s.\u0275fac=function(g){return new(g||s)},s.\u0275prov=sn({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();function TL(o){for(let s=0;s<o.length;s++)if(o[s]==null)throw new Gt(4008,!1)}function DL(o){return!(o instanceof bf)&&!(o instanceof wf)}var IL=new an("");function FT(o,...s){return Sm([{provide:R0,multi:!0,useValue:o},[],{provide:kh,useFactory:ML,deps:[LT]},{provide:Fv,multi:!0,useFactory:SL},s.map(h=>h.\u0275providers)])}function ML(o){return o.routerState.root}function SL(){let o=It(wh);return s=>{let h=o.get(af);if(s!==h.components[0])return;let u=o.get(LT),g=o.get(AL);o.get(PL)===1&&u.initialNavigation(),o.get(RL,null,mn.Optional)?.setUpPreloading(),o.get(IL,null,mn.Optional)?.init(),u.resetRootComponentType(h.componentTypes[0]),g.closed||(g.next(),g.complete(),g.unsubscribe())}}var AL=new an("",{factory:()=>new qi}),PL=new an("",{providedIn:"root",factory:()=>1});var RL=new an("");var vD=Tw(zT()),G0=Tw(BT());var WT=(()=>{let s=class s{constructor(u,g){this._renderer=u,this._elementRef=g,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(u,g){this._renderer.setProperty(this._elementRef.nativeElement,u,g)}registerOnTouched(u){this.onTouched=u}registerOnChange(u){this.onChange=u}setDisabledState(u){this.setProperty("disabled",u)}};s.\u0275fac=function(g){return new(g||s)(Nr(Ch),Nr(Qc))},s.\u0275dir=us({type:s});let o=s;return o})(),OL=(()=>{let s=class s extends WT{};s.\u0275fac=(()=>{let u;return function(i){return(u||(u=sf(s)))(i||s)}})(),s.\u0275dir=us({type:s,features:[Wl]});let o=s;return o})(),ZT=new an("");var kL={provide:ZT,useExisting:yh(()=>vg),multi:!0};function LL(){let o=cl()?cl().getUserAgent():"";return/android (\d+)/.test(o.toLowerCase())}var FL=new an(""),vg=(()=>{let s=class s extends WT{constructor(u,g,i){super(u,g),this._compositionMode=i,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!LL())}writeValue(u){let g=u??"";this.setProperty("value",g)}_handleInput(u){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(u)}_compositionStart(){this._composing=!0}_compositionEnd(u){this._composing=!1,this._compositionMode&&this.onChange(u)}};s.\u0275fac=function(g){return new(g||s)(Nr(Ch),Nr(Qc),Nr(FL,8))},s.\u0275dir=us({type:s,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(g,i){g&1&&ds("input",function(O){return i._handleInput(O.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(O){return i._compositionEnd(O.target.value)})},features:[jm([kL]),Wl]});let o=s;return o})();function Jl(o){return o==null||(typeof o=="string"||Array.isArray(o))&&o.length===0}function XT(o){return o!=null&&typeof o.length=="number"}var YT=new an(""),KT=new an(""),NL=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,hg=class{static min(s){return zL(s)}static max(s){return BL(s)}static required(s){return VL(s)}static requiredTrue(s){return jL(s)}static email(s){return UL(s)}static minLength(s){return $L(s)}static maxLength(s){return GL(s)}static pattern(s){return HL(s)}static nullValidator(s){return JT(s)}static compose(s){return iD(s)}static composeAsync(s){return sD(s)}};function zL(o){return s=>{if(Jl(s.value)||Jl(o))return null;let h=parseFloat(s.value);return!isNaN(h)&&h<o?{min:{min:o,actual:s.value}}:null}}function BL(o){return s=>{if(Jl(s.value)||Jl(o))return null;let h=parseFloat(s.value);return!isNaN(h)&&h>o?{max:{max:o,actual:s.value}}:null}}function VL(o){return Jl(o.value)?{required:!0}:null}function jL(o){return o.value===!0?null:{required:!0}}function UL(o){return Jl(o.value)||NL.test(o.value)?null:{email:!0}}function $L(o){return s=>Jl(s.value)||!XT(s.value)?null:s.value.length<o?{minlength:{requiredLength:o,actualLength:s.value.length}}:null}function GL(o){return s=>XT(s.value)&&s.value.length>o?{maxlength:{requiredLength:o,actualLength:s.value.length}}:null}function HL(o){if(!o)return JT;let s,h;return typeof o=="string"?(h="",o.charAt(0)!=="^"&&(h+="^"),h+=o,o.charAt(o.length-1)!=="$"&&(h+="$"),s=new RegExp(h)):(h=o.toString(),s=o),u=>{if(Jl(u.value))return null;let g=u.value;return s.test(g)?null:{pattern:{requiredPattern:h,actualValue:g}}}}function JT(o){return null}function QT(o){return o!=null}function eD(o){return tu(o)?Fr(o):o}function tD(o){let s={};return o.forEach(h=>{s=h!=null?Dt(Dt({},s),h):s}),Object.keys(s).length===0?null:s}function nD(o,s){return s.map(h=>h(o))}function qL(o){return!o.validate}function rD(o){return o.map(s=>qL(s)?s:h=>s.validate(h))}function iD(o){if(!o)return null;let s=o.filter(QT);return s.length==0?null:function(h){return tD(nD(h,s))}}function oD(o){return o!=null?iD(rD(o)):null}function sD(o){if(!o)return null;let s=o.filter(QT);return s.length==0?null:function(h){let u=nD(h,s).map(eD);return ry(u).pipe(wn(tD))}}function aD(o){return o!=null?sD(rD(o)):null}function VT(o,s){return o===null?[s]:Array.isArray(o)?[...o,s]:[o,s]}function lD(o){return o._rawValidators}function cD(o){return o._rawAsyncValidators}function z0(o){return o?Array.isArray(o)?o:[o]:[]}function dg(o,s){return Array.isArray(o)?o.includes(s):o===s}function jT(o,s){let h=z0(s);return z0(o).forEach(g=>{dg(h,g)||h.push(g)}),h}function UT(o,s){return z0(s).filter(h=>!dg(o,h))}var fg=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(s){this._rawValidators=s||[],this._composedValidatorFn=oD(this._rawValidators)}_setAsyncValidators(s){this._rawAsyncValidators=s||[],this._composedAsyncValidatorFn=aD(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(s){this._onDestroyCallbacks.push(s)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(s=>s()),this._onDestroyCallbacks=[]}reset(s=void 0){this.control&&this.control.reset(s)}hasError(s,h){return this.control?this.control.hasError(s,h):!1}getError(s,h){return this.control?this.control.getError(s,h):null}},zh=class extends fg{get formDirective(){return null}get path(){return null}},Pf=class extends fg{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},pg=class{constructor(s){this._cd=s}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},WL={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Y5=dr(Dt({},WL),{"[class.ng-submitted]":"isSubmitted"}),uD=(()=>{let s=class s extends pg{constructor(u){super(u)}};s.\u0275fac=function(g){return new(g||s)(Nr(Pf,2))},s.\u0275dir=us({type:s,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(g,i){g&2&&Vm("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Wl]});let o=s;return o})(),hD=(()=>{let s=class s extends pg{constructor(u){super(u)}};s.\u0275fac=function(g){return new(g||s)(Nr(zh,10))},s.\u0275dir=us({type:s,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(g,i){g&2&&Vm("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[Wl]});let o=s;return o})();var Sf="VALID",ug="INVALID",Nh="PENDING",Af="DISABLED";function dD(o){return(xg(o)?o.validators:o)||null}function ZL(o){return Array.isArray(o)?oD(o):o||null}function fD(o,s){return(xg(s)?s.asyncValidators:o)||null}function XL(o){return Array.isArray(o)?aD(o):o||null}function xg(o){return o!=null&&!Array.isArray(o)&&typeof o=="object"}function YL(o,s,h){let u=o.controls;if(!(s?Object.keys(u):u).length)throw new Gt(1e3,"");if(!u[h])throw new Gt(1001,"")}function KL(o,s,h){o._forEachChild((u,g)=>{if(h[g]===void 0)throw new Gt(1002,"")})}var mg=class{constructor(s,h){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(s),this._assignAsyncValidators(h)}get validator(){return this._composedValidatorFn}set validator(s){this._rawValidators=this._composedValidatorFn=s}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(s){this._rawAsyncValidators=this._composedAsyncValidatorFn=s}get parent(){return this._parent}get valid(){return this.status===Sf}get invalid(){return this.status===ug}get pending(){return this.status==Nh}get disabled(){return this.status===Af}get enabled(){return this.status!==Af}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(s){this._assignValidators(s)}setAsyncValidators(s){this._assignAsyncValidators(s)}addValidators(s){this.setValidators(jT(s,this._rawValidators))}addAsyncValidators(s){this.setAsyncValidators(jT(s,this._rawAsyncValidators))}removeValidators(s){this.setValidators(UT(s,this._rawValidators))}removeAsyncValidators(s){this.setAsyncValidators(UT(s,this._rawAsyncValidators))}hasValidator(s){return dg(this._rawValidators,s)}hasAsyncValidator(s){return dg(this._rawAsyncValidators,s)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(s={}){this.touched=!0,this._parent&&!s.onlySelf&&this._parent.markAsTouched(s)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(s=>s.markAllAsTouched())}markAsUntouched(s={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(h=>{h.markAsUntouched({onlySelf:!0})}),this._parent&&!s.onlySelf&&this._parent._updateTouched(s)}markAsDirty(s={}){this.pristine=!1,this._parent&&!s.onlySelf&&this._parent.markAsDirty(s)}markAsPristine(s={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(h=>{h.markAsPristine({onlySelf:!0})}),this._parent&&!s.onlySelf&&this._parent._updatePristine(s)}markAsPending(s={}){this.status=Nh,s.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!s.onlySelf&&this._parent.markAsPending(s)}disable(s={}){let h=this._parentMarkedDirty(s.onlySelf);this.status=Af,this.errors=null,this._forEachChild(u=>{u.disable(dr(Dt({},s),{onlySelf:!0}))}),this._updateValue(),s.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(dr(Dt({},s),{skipPristineCheck:h})),this._onDisabledChange.forEach(u=>u(!0))}enable(s={}){let h=this._parentMarkedDirty(s.onlySelf);this.status=Sf,this._forEachChild(u=>{u.enable(dr(Dt({},s),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent}),this._updateAncestors(dr(Dt({},s),{skipPristineCheck:h})),this._onDisabledChange.forEach(u=>u(!1))}_updateAncestors(s){this._parent&&!s.onlySelf&&(this._parent.updateValueAndValidity(s),s.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(s){this._parent=s}getRawValue(){return this.value}updateValueAndValidity(s={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Sf||this.status===Nh)&&this._runAsyncValidator(s.emitEvent)),s.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!s.onlySelf&&this._parent.updateValueAndValidity(s)}_updateTreeValidity(s={emitEvent:!0}){this._forEachChild(h=>h._updateTreeValidity(s)),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Af:Sf}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(s){if(this.asyncValidator){this.status=Nh,this._hasOwnPendingAsyncValidator=!0;let h=eD(this.asyncValidator(this));this._asyncValidationSubscription=h.subscribe(u=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(u,{emitEvent:s})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(s,h={}){this.errors=s,this._updateControlsErrors(h.emitEvent!==!1)}get(s){let h=s;return h==null||(Array.isArray(h)||(h=h.split(".")),h.length===0)?null:h.reduce((u,g)=>u&&u._find(g),this)}getError(s,h){let u=h?this.get(h):this;return u&&u.errors?u.errors[s]:null}hasError(s,h){return!!this.getError(s,h)}get root(){let s=this;for(;s._parent;)s=s._parent;return s}_updateControlsErrors(s){this.status=this._calculateStatus(),s&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(s)}_initObservables(){this.valueChanges=new Li,this.statusChanges=new Li}_calculateStatus(){return this._allControlsDisabled()?Af:this.errors?ug:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Nh)?Nh:this._anyControlsHaveStatus(ug)?ug:Sf}_anyControlsHaveStatus(s){return this._anyControls(h=>h.status===s)}_anyControlsDirty(){return this._anyControls(s=>s.dirty)}_anyControlsTouched(){return this._anyControls(s=>s.touched)}_updatePristine(s={}){this.pristine=!this._anyControlsDirty(),this._parent&&!s.onlySelf&&this._parent._updatePristine(s)}_updateTouched(s={}){this.touched=this._anyControlsTouched(),this._parent&&!s.onlySelf&&this._parent._updateTouched(s)}_registerOnCollectionChange(s){this._onCollectionChange=s}_setUpdateStrategy(s){xg(s)&&s.updateOn!=null&&(this._updateOn=s.updateOn)}_parentMarkedDirty(s){let h=this._parent&&this._parent.dirty;return!s&&!!h&&!this._parent._anyControlsDirty()}_find(s){return null}_assignValidators(s){this._rawValidators=Array.isArray(s)?s.slice():s,this._composedValidatorFn=ZL(this._rawValidators)}_assignAsyncValidators(s){this._rawAsyncValidators=Array.isArray(s)?s.slice():s,this._composedAsyncValidatorFn=XL(this._rawAsyncValidators)}},gg=class extends mg{constructor(s,h,u){super(dD(h),fD(u,h)),this.controls=s,this._initObservables(),this._setUpdateStrategy(h),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(s,h){return this.controls[s]?this.controls[s]:(this.controls[s]=h,h.setParent(this),h._registerOnCollectionChange(this._onCollectionChange),h)}addControl(s,h,u={}){this.registerControl(s,h),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}removeControl(s,h={}){this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),delete this.controls[s],this.updateValueAndValidity({emitEvent:h.emitEvent}),this._onCollectionChange()}setControl(s,h,u={}){this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),delete this.controls[s],h&&this.registerControl(s,h),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}contains(s){return this.controls.hasOwnProperty(s)&&this.controls[s].enabled}setValue(s,h={}){KL(this,!0,s),Object.keys(s).forEach(u=>{YL(this,!0,u),this.controls[u].setValue(s[u],{onlySelf:!0,emitEvent:h.emitEvent})}),this.updateValueAndValidity(h)}patchValue(s,h={}){s!=null&&(Object.keys(s).forEach(u=>{let g=this.controls[u];g&&g.patchValue(s[u],{onlySelf:!0,emitEvent:h.emitEvent})}),this.updateValueAndValidity(h))}reset(s={},h={}){this._forEachChild((u,g)=>{u.reset(s?s[g]:null,{onlySelf:!0,emitEvent:h.emitEvent})}),this._updatePristine(h),this._updateTouched(h),this.updateValueAndValidity(h)}getRawValue(){return this._reduceChildren({},(s,h,u)=>(s[u]=h.getRawValue(),s))}_syncPendingControls(){let s=this._reduceChildren(!1,(h,u)=>u._syncPendingControls()?!0:h);return s&&this.updateValueAndValidity({onlySelf:!0}),s}_forEachChild(s){Object.keys(this.controls).forEach(h=>{let u=this.controls[h];u&&s(u,h)})}_setUpControls(){this._forEachChild(s=>{s.setParent(this),s._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(s){for(let[h,u]of Object.entries(this.controls))if(this.contains(h)&&s(u))return!0;return!1}_reduceValue(){let s={};return this._reduceChildren(s,(h,u,g)=>((u.enabled||this.disabled)&&(h[g]=u.value),h))}_reduceChildren(s,h){let u=s;return this._forEachChild((g,i)=>{u=h(u,g,i)}),u}_allControlsDisabled(){for(let s of Object.keys(this.controls))if(this.controls[s].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(s){return this.controls.hasOwnProperty(s)?this.controls[s]:null}};var pD=new an("CallSetDisabledState",{providedIn:"root",factory:()=>B0}),B0="always";function JL(o,s){return[...s.path,o]}function $T(o,s,h=B0){V0(o,s),s.valueAccessor.writeValue(o.value),(o.disabled||h==="always")&&s.valueAccessor.setDisabledState?.(o.disabled),eF(o,s),nF(o,s),tF(o,s),QL(o,s)}function GT(o,s,h=!0){let u=()=>{};s.valueAccessor&&(s.valueAccessor.registerOnChange(u),s.valueAccessor.registerOnTouched(u)),yg(o,s),o&&(s._invokeOnDestroyCallbacks(),o._registerOnCollectionChange(()=>{}))}function _g(o,s){o.forEach(h=>{h.registerOnValidatorChange&&h.registerOnValidatorChange(s)})}function QL(o,s){if(s.valueAccessor.setDisabledState){let h=u=>{s.valueAccessor.setDisabledState(u)};o.registerOnDisabledChange(h),s._registerOnDestroy(()=>{o._unregisterOnDisabledChange(h)})}}function V0(o,s){let h=lD(o);s.validator!==null?o.setValidators(VT(h,s.validator)):typeof h=="function"&&o.setValidators([h]);let u=cD(o);s.asyncValidator!==null?o.setAsyncValidators(VT(u,s.asyncValidator)):typeof u=="function"&&o.setAsyncValidators([u]);let g=()=>o.updateValueAndValidity();_g(s._rawValidators,g),_g(s._rawAsyncValidators,g)}function yg(o,s){let h=!1;if(o!==null){if(s.validator!==null){let g=lD(o);if(Array.isArray(g)&&g.length>0){let i=g.filter(w=>w!==s.validator);i.length!==g.length&&(h=!0,o.setValidators(i))}}if(s.asyncValidator!==null){let g=cD(o);if(Array.isArray(g)&&g.length>0){let i=g.filter(w=>w!==s.asyncValidator);i.length!==g.length&&(h=!0,o.setAsyncValidators(i))}}}let u=()=>{};return _g(s._rawValidators,u),_g(s._rawAsyncValidators,u),h}function eF(o,s){s.valueAccessor.registerOnChange(h=>{o._pendingValue=h,o._pendingChange=!0,o._pendingDirty=!0,o.updateOn==="change"&&mD(o,s)})}function tF(o,s){s.valueAccessor.registerOnTouched(()=>{o._pendingTouched=!0,o.updateOn==="blur"&&o._pendingChange&&mD(o,s),o.updateOn!=="submit"&&o.markAsTouched()})}function mD(o,s){o._pendingDirty&&o.markAsDirty(),o.setValue(o._pendingValue,{emitModelToViewChange:!1}),s.viewToModelUpdate(o._pendingValue),o._pendingChange=!1}function nF(o,s){let h=(u,g)=>{s.valueAccessor.writeValue(u),g&&s.viewToModelUpdate(u)};o.registerOnChange(h),s._registerOnDestroy(()=>{o._unregisterOnChange(h)})}function rF(o,s){o==null,V0(o,s)}function iF(o,s){return yg(o,s)}function oF(o,s){if(!o.hasOwnProperty("model"))return!1;let h=o.model;return h.isFirstChange()?!0:!Object.is(s,h.currentValue)}function sF(o){return Object.getPrototypeOf(o.constructor)===OL}function aF(o,s){o._syncPendingControls(),s.forEach(h=>{let u=h.control;u.updateOn==="submit"&&u._pendingChange&&(h.viewToModelUpdate(u._pendingValue),u._pendingChange=!1)})}function lF(o,s){if(!s)return null;Array.isArray(s);let h,u,g;return s.forEach(i=>{i.constructor===vg?h=i:sF(i)?u=i:g=i}),g||u||h||null}function cF(o,s){let h=o.indexOf(s);h>-1&&o.splice(h,1)}function HT(o,s){let h=o.indexOf(s);h>-1&&o.splice(h,1)}function qT(o){return typeof o=="object"&&o!==null&&Object.keys(o).length===2&&"value"in o&&"disabled"in o}var j0=class extends mg{constructor(s=null,h,u){super(dD(h),fD(u,h)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(s),this._setUpdateStrategy(h),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),xg(h)&&(h.nonNullable||h.initialValueIsDefault)&&(qT(s)?this.defaultValue=s.value:this.defaultValue=s)}setValue(s,h={}){this.value=this._pendingValue=s,this._onChange.length&&h.emitModelToViewChange!==!1&&this._onChange.forEach(u=>u(this.value,h.emitViewToModelChange!==!1)),this.updateValueAndValidity(h)}patchValue(s,h={}){this.setValue(s,h)}reset(s=this.defaultValue,h={}){this._applyFormState(s),this.markAsPristine(h),this.markAsUntouched(h),this.setValue(this.value,h),this._pendingChange=!1}_updateValue(){}_anyControls(s){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(s){this._onChange.push(s)}_unregisterOnChange(s){HT(this._onChange,s)}registerOnDisabledChange(s){this._onDisabledChange.push(s)}_unregisterOnDisabledChange(s){HT(this._onDisabledChange,s)}_forEachChild(s){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(s){qT(s)?(this.value=this._pendingValue=s.value,s.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=s}};var uF=o=>o instanceof j0;var gD=(()=>{let s=class s{};s.\u0275fac=function(g){return new(g||s)},s.\u0275dir=us({type:s,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let o=s;return o})();var _D=new an("");var hF={provide:zh,useExisting:yh(()=>U0)},U0=(()=>{let s=class s extends zh{constructor(u,g,i){super(),this.callSetDisabledState=i,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Li,this._setValidators(u),this._setAsyncValidators(g)}ngOnChanges(u){this._checkFormPresent(),u.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(yg(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(u){let g=this.form.get(u.path);return $T(g,u,this.callSetDisabledState),g.updateValueAndValidity({emitEvent:!1}),this.directives.push(u),g}getControl(u){return this.form.get(u.path)}removeControl(u){GT(u.control||null,u,!1),cF(this.directives,u)}addFormGroup(u){this._setUpFormContainer(u)}removeFormGroup(u){this._cleanUpFormContainer(u)}getFormGroup(u){return this.form.get(u.path)}addFormArray(u){this._setUpFormContainer(u)}removeFormArray(u){this._cleanUpFormContainer(u)}getFormArray(u){return this.form.get(u.path)}updateModel(u,g){this.form.get(u.path).setValue(g)}onSubmit(u){return this.submitted=!0,aF(this.form,this.directives),this.ngSubmit.emit(u),u?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(u=void 0){this.form.reset(u),this.submitted=!1}_updateDomValue(){this.directives.forEach(u=>{let g=u.control,i=this.form.get(u.path);g!==i&&(GT(g||null,u),uF(i)&&($T(i,u,this.callSetDisabledState),u.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(u){let g=this.form.get(u.path);rF(g,u),g.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(u){if(this.form){let g=this.form.get(u.path);g&&iF(g,u)&&g.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){V0(this.form,this),this._oldForm&&yg(this._oldForm,this)}_checkFormPresent(){this.form}};s.\u0275fac=function(g){return new(g||s)(Nr(YT,10),Nr(KT,10),Nr(pD,8))},s.\u0275dir=us({type:s,selectors:[["","formGroup",""]],hostBindings:function(g,i){g&1&&ds("submit",function(O){return i.onSubmit(O)})("reset",function(){return i.onReset()})},inputs:{form:[Oo.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[jm([hF]),Wl,Jc]});let o=s;return o})();var dF={provide:Pf,useExisting:yh(()=>$0)},$0=(()=>{let s=class s extends Pf{set isDisabled(u){}constructor(u,g,i,w,O){super(),this._ngModelWarningConfig=O,this._added=!1,this.name=null,this.update=new Li,this._ngModelWarningSent=!1,this._parent=u,this._setValidators(g),this._setAsyncValidators(i),this.valueAccessor=lF(this,w)}ngOnChanges(u){this._added||this._setUpControl(),oF(u,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(u){this.viewModel=u,this.update.emit(u)}get path(){return JL(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};s._ngModelWarningSentOnce=!1,s.\u0275fac=function(g){return new(g||s)(Nr(zh,13),Nr(YT,10),Nr(KT,10),Nr(ZT,10),Nr(_D,8))},s.\u0275dir=us({type:s,selectors:[["","formControlName",""]],inputs:{name:[Oo.None,"formControlName","name"],isDisabled:[Oo.None,"disabled","isDisabled"],model:[Oo.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[jm([dF]),Wl,Jc]});let o=s;return o})();var fF=(()=>{let s=class s{};s.\u0275fac=function(g){return new(g||s)},s.\u0275mod=bh({type:s}),s.\u0275inj=vh({});let o=s;return o})();var yD=(()=>{let s=class s{static withConfig(u){return{ngModule:s,providers:[{provide:_D,useValue:u.warnOnNgModelWithFormControl??"always"},{provide:pD,useValue:u.callSetDisabledState??B0}]}}};s.\u0275fac=function(g){return new(g||s)},s.\u0275mod=bh({type:s}),s.\u0275inj=vh({imports:[fF]});let o=s;return o})();var bg=(()=>{let s=class s{constructor(){this.form=new gg({heightInput:new j0("",hg.pattern("^[0-9]*$"))}),this.layers=[]}extrudePolygon(){var u=this.form.controls.heightInput.errors==null;if(u){let i=this.form.controls.heightInput.value;this.setHeight(+i),this.map.getPitch()<30&&this.map.setPitch(30);let w=this.extrudingArea.features[0].id+"";var g=this.map.getSource(w);g?this.map.setPaintProperty(w,"fill-extrusion-height",+i):this.addLayer(w)}}addLayer(u){this.map.addSource(u,{type:"geojson",data:this.extrudingArea}),this.map.addLayer({id:u,type:"fill-extrusion",source:u,paint:{"fill-extrusion-color":["get","color"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","base_height"],"fill-extrusion-opacity":.7}}),this.layers.push(u)}getExtrudeMode(){var u=this,g={};return g.onSetup=function(i){var w={count:0};return w.count=i.count||0,w},g.onClick=function(i,w){if(u.disableSelection(w),w.featureTarget){let B=w.featureTarget._geometry.coordinates,j=w.featureTarget.properties.id+"_source_id";var O=u.map.getSource(j);B[0].length>=4&&(u.extrudingArea=u.getExtrudeArea(B,j)),O&&u.selectedLayer!=j&&(u.map.setPaintProperty(u.selectedLayer,"fill-extrusion-color","aliceblue"),u.map.setPaintProperty(j,"fill-extrusion-color","red"),u.selectedLayer=j)}},g.toDisplayFeatures=function(i,w,O){O(w)},g}disableSelection(u){let g=[[u.point.x-5,u.point.y-5],[u.point.x+5,u.point.y+5]];var w=this.map.queryRenderedFeatures(g).filter(O=>O.layer.id.indexOf("_source_id")!=-1);w.length==0&&this.layers.forEach(O=>{this.map.setPaintProperty(O,"fill-extrusion-color","aliceblue")})}getExtrudeArea(u,g){return{type:"FeatureCollection",features:[{type:"Feature",properties:{level:1,name:"extrudingPolygon",height:150,base_height:0,color:"aliceblue"},geometry:{coordinates:u,type:"Polygon"},id:g}]}}setHeight(u){this.extrudingArea.features[0].properties.height=u}deleteLayer(){this.map.removeLayer(this.selectedLayer);var u=this.layers.indexOf(this.selectedLayer);this.layers.splice(u,1),this.selectedLayer=null}extrudeMode(){this.draw.changeMode("extrudeMode"),this.setExtrudeCursor()}lineMode(){this.draw.changeMode("draw_polygon"),this.setDefaultCursor()}freeMode(){this.draw.changeMode("simple_select"),this.setDefaultCursor()}trashMode(){this.draw.trash(),this.setDefaultCursor()}setExtrudeCursor(){this.map.getCanvas().style.cursor="pointer"}setDefaultCursor(){this.map.getCanvas().style.cursor="default",this.extrudingArea=null}ngOnInit(){this.map=new vD.Map({accessToken:"pk.eyJ1IjoibWFyb29uZWRpb25lIiwiYSI6ImNqdmp0MzB1azBpcDAzem1naHZwMjNndGIifQ.65nvvRg9QeFUV2c6b9W4Vw",container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[-87.61694,41.86625],zoom:15.99,pitch:40,bearing:20,antialias:!0});var u=this.getExtrudeMode();this.draw=new G0.default({displayControlsDefault:!1,defaultMode:"extrudeMode",modes:Object.assign({extrudeMode:u},G0.default.modes)}),this.map.addControl(this.draw,"top-left")}};s.\u0275fac=function(g){return new(g||s)},s.\u0275cmp=xh({type:s,selectors:[["poly"]],standalone:!0,features:[Th],decls:24,vars:1,consts:[[1,"aside"],[1,"aside__items","nostyle-list"],[1,"aside__item"],[1,"btn",3,"click"],[1,"aide__item"],[3,"formGroup"],["formControlName","heightInput","type","text","placeholder","height"],[3,"click"],["id","map",1,"map"]],template:function(g,i){g&1&&(hs(0,"aside",0)(1,"nav")(2,"ul",1)(3,"li",2)(4,"button",3),ds("click",function(){return i.lineMode()}),eu(5,"LINE"),qs()(),hs(6,"li",4)(7,"button",3),ds("click",function(){return i.freeMode()}),eu(8,"FREE"),qs()(),hs(9,"li",2)(10,"button",3),ds("click",function(){return i.trashMode()}),eu(11,"DELETE"),qs()(),hs(12,"li",2)(13,"button",3),ds("click",function(){return i.extrudeMode()}),eu(14,"EXTRUDE LAYER"),qs()(),hs(15,"li",2)(16,"button",3),ds("click",function(){return i.deleteLayer()}),eu(17,"DELETE LAYER"),qs()(),hs(18,"li",2)(19,"form",5),Zl(20,"input",6),hs(21,"button",7),ds("click",function(){return i.extrudePolygon()}),eu(22,"SUBMIT"),qs()()()()()(),Zl(23,"div",8)),g&2&&(aC(19),Lv("formGroup",i.form))},dependencies:[yD,gD,vg,uD,hD,U0,$0],styles:[".aside[_ngcontent-%COMP%]{position:absolute;left:30px;top:30px;z-index:10}",".map[_ngcontent-%COMP%]{min-width:100vh;min-height:100vh}"]});let o=s;return o})();var xD=[{path:"polygon",component:bg}];var bD={providers:[FT(xD)]};var wD=(()=>{let s=class s{constructor(){this.title="polygonApp"}};s.\u0275fac=function(g){return new(g||s)},s.\u0275cmp=xh({type:s,selectors:[["app-root"]],standalone:!0,features:[Th],decls:2,vars:0,template:function(g,i){g&1&&(hs(0,"main"),Zl(1,"poly"),qs())},dependencies:[bg]});let o=s;return o})();eT(wD,bD).catch(o=>console.error(o));
